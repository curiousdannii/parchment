/*

Quixe
=====

Built: 2016-07-15

Quixe -- a Glulx VM interpreter written in Javascript
GiDispa -- a GlkAPI dispatch layer for Quixe

Designed by Andrew Plotkin <erkyrath@eblong.com>
Copyright (c) 2010-2016 Andrew Plotkin
<http://eblong.com/zarf/glulx/quixe/>

*/
Quixe=function(){function a(a,b){Db=a;var c,d,e=Db.slice(0,64);for(c=0;c<e.length;c++)d=e[c].toString(16),d.length<2&&(d="0"+d),e[c]=d;Eb=e.join(""),b&&(Fb=b.rethrow_exceptions,Gb=b.do_vm_autosave,Hb=b.clear_vm_autosave),b&&b.debug_info_data_chunk&&lb(b.debug_info_data_chunk)}function b(){if(nb.vm_started)return void Glk.fatal_error("Quixe was inited twice!");try{g(),T(),La(),mb()}catch(a){if(a.stack&&e("JS stack dump:\n"+a.stack),f(),Glk.fatal_error("Quixe init: "+d(a)),Fb)throw a}}function c(){try{nb.done_executing=nb.vm_stopped,mb()}catch(a){if(a.stack&&e("JS stack dump:\n"+a.stack),f(),Glk.fatal_error("Quixe run: "+d(a)),Fb)throw a}}function d(a){if("string"==typeof a)return a;var b=a.toString();return a.message&&(b=b+" "+a.message),a.fileName&&(b=b+" "+a.fileName),a.lineNumber&&(b=b+" line:"+a.lineNumber),a.name&&(b=b+" "+a.name),a.number&&(b=b+" "+a.number),b}function e(a){window.console&&console.log?console.log(a):window.opera&&opera.postError&&opera.postError(a)}function f(){if(Cb&&Cb.length){var a,b,c,d,f=[];for(a=0;a<Cb.length;a++)d=Cb[a],d.vmfunc.funcaddr?(b="0x"+d.vmfunc.funcaddr.toString(16),c=dc.functionmap[d.vmfunc.funcaddr],c&&(b+=' "'+c.name+'"'),f.push(b)):f.push("(anonymous)");e("VM stack dump: "+f.join(", "))}}function g(){var a,b;for(a=0;256>a;a++)b=a.toString(16),16>a&&(b="0"+b),ob[a]=b;for(a=0;256>a;a++)b=a>=32&&127>a?34==a||39==a||92==a?"\\"+String.fromCharCode(a):String.fromCharCode(a):10==a?"\\n":"\\x"+ob[a],pb[a]=b}function h(a,b){return 16777216*a[b]+65536*a[b+1]+256*a[b+2]+a[b+3]}function i(a,b){return 256*a[b]+a[b+1]}function j(a,b){return a[b]}function k(a){return Bb[a]}function l(a){return 256*Bb[a]+Bb[a+1]}function m(a){return 16777216*Bb[a]+65536*Bb[a+1]+256*Bb[a+2]+Bb[a+3]}function n(a,b){return Bb.slice(a,a+b)}function o(a,b){Bb[a]=255&b}function p(a,b){Bb[a]=b>>8&255,Bb[a+1]=255&b}function q(a,b){Bb[a]=b>>24&255,Bb[a+1]=b>>16&255,Bb[a+2]=b>>8&255,Bb[a+3]=255&b}function r(a,b){for(var c=0;c<b.length;c++)a.push(b.charCodeAt(c))}function s(a,b){a.push(b>>24&255),a.push(b>>16&255),a.push(b>>8&255),a.push(255&b)}function t(a,b){a.push(b>>8&255),a.push(255&b)}function u(a,b){a.push(255&b)}function v(a,b,c){a[b]=c>>24&255,a[b+1]=c>>16&255,a[b+2]=c>>8&255,a[b+3]=255&c}function w(a,b,c){return String.fromCharCode.apply(this,a.slice(b,b+c))}function x(a){return Bb[a]>=128?"0xffffff"+ob[Bb[a]]:"0x"+ob[Bb[a]]}function y(a){return Bb[a]>=128?"0xffff"+ob[Bb[a]]+ob[Bb[a+1]]:Bb[a]?"0x"+ob[Bb[a]]+ob[Bb[a+1]]:"0x"+ob[Bb[a+1]]}function z(a){return Bb[a]?"0x"+ob[Bb[a]]+ob[Bb[a+1]]+ob[Bb[a+2]]+ob[Bb[a+3]]:Bb[a+1]?"0x"+ob[Bb[a+1]]+ob[Bb[a+2]]+ob[Bb[a+3]]:Bb[a+2]?"0x"+ob[Bb[a+2]]+ob[Bb[a+3]]:"0x"+ob[Bb[a+3]]}function A(a){return 4294967295==a?255&nb.frame.valstack.pop():k(a)}function B(a,b){4294967295==a?nb.frame.valstack.push(255&b):o(a,b)}function C(a){return 4294967295==a?nb.frame.valstack.pop():m(a)}function D(a,b){4294967295==a?nb.frame.valstack.push(b):q(a,b)}function E(a,b){return 4294967295==a?nb.frame.valstack.pop():m(a+4*b)}function F(a,b,c){4294967295==a?nb.frame.valstack.push(c):q(a+4*b,c)}function G(a){nb.resumevalue=a}function H(a){return 65536>a?String.fromCharCode(a):(a-=65536,String.fromCharCode(55296+(a>>10),56320+(1023&a)))}function I(a){if(256>a)return pb[a];if(65536>a){for(a=a.toString(16);a.length<4;)a="0"+a;return"\\u"+a}var b;return a-=65536,b=55296+(a>>10),a=56320+(1023&a),"\\u"+b.toString(16)+"\\u"+a.toString(16)}function J(a){return I(a.charCodeAt(0))}function K(a){return a=a.replace(qb,J),'"'+a+'"'}function L(a){var b,c;if(arguments.length>1){for(a+=" (",b=1;b<arguments.length;b++)c=arguments[b],c="number"==typeof c?c.toString(16):""+c,1!=b&&(a+=" "),a+=c;a+=")"}throw e(a),new Error(a)}function M(a,b,c,d){var e;return void 0===b&&(b="_func"),e=void 0===c?new Function("self",a):void 0===d?new Function("self",c,a):new Function("self",c,d,a)}function N(a,b,c,d){a?(this.funcaddr=a,this.startpc=b,this.functype=k(a)):(this.funcaddr=null,this.startpc=null,this.functype=null),this.pathaddrs={},this[0]={},this[1]={},this[2]={},this.locallen=null,this.localsformat=c,this.rawformat=d,this.localsindex=[];var e,f,g=0;for(e=0;e<this.localsformat.length;e++){var h=this.localsformat[e];if(4==h.size)for(;3&g;)g++;else if(2==h.size)for(;1&g;)g++;for(f=0;f<h.count;f++)this.localsindex.push({size:h.size,pos:g}),g+=h.size}for(;3&g;)g++;this.locallen=g}function O(a){var b;for(this.vmfunc=a,this.depth=null,this.framestart=null,this.framelen=null,this.valstack=[],this.localspos=null,this.localsindex=a.localsindex,this.locals=[],b=0;b<this.localsindex.length;b++){var c=this.localsindex[b];this.locals[c.pos]=0}this.framelen=8+a.rawformat.length+a.locallen}function P(a){var b=new O(a.vmfunc);return b.depth=a.depth,b.framestart=a.framestart,b.framelen=a.framelen,b.valstack=a.valstack.slice(0),b.localspos=a.localspos,b.locals=a.locals.slice(0),b.framelen=a.framelen,b}function Q(a,b){s(b,a.framelen);var c=a.vmfunc.rawformat;s(b,8+c.length);for(var d=0;d<c.length;d++)b.push(c[d]);for(var d=0;d<a.vmfunc.localsindex.length;d++){var e=a.vmfunc.localsindex[d];if(4==e.size){for(;3&b.length;)b.push(0);s(b,a.locals[e.pos])}else if(2==e.size){for(;1&b.length;)b.push(0);t(b,a.locals[e.pos])}else u(b,a.locals[e.pos])}for(;3&b.length;)b.push(0);for(var d=0;d<a.valstack.length;d++)s(b,a.valstack[d])}function R(a){var b=h(a,a.length-4);if(0>b||b>=a.length)return void e("Bad frameptr in serialized stack frame");a=a.splice(b,a.length);for(var c=h(a,0),d=h(a,4),f=a.slice(8,d),g=[],k=8;;){var l=j(a,k);k++;var m=j(a,k);if(k++,0==l)break;1!=l&&2!=l&&4!=l&&L("Invalid local variable size in function header.",l),g.push({size:l,count:m})}var n=new N(null,null,g,f),o=new O(n);o.framestart=b;for(var p=0;p<o.vmfunc.localsindex.length;p++){var q=o.vmfunc.localsindex[p];4==q.size?o.locals[q.pos]=h(a,d+q.pos):2==q.size?o.locals[q.pos]=i(a,d+q.pos):o.locals[q.pos]=j(a,d+q.pos)}for(var r=c;r<a.length;r+=4)o.valstack.push(h(a,r));return o}function S(a,b){0==a&&L("Tried to create a VMTextEnv for address zero."),this.addr=a,this.cacheable=void 0!==b,this.decoding_tree=b,this.vmstring_tables=[],this.cacheable&&(this.vmstring_tables[0]={},this.vmstring_tables[1]={},this.vmstring_tables[2]={})}function T(){function a(a,b){this.argsize=b?b:4,this.numops=a.length;for(var c=[],d=0;d<a.length;d++)c.push(a.charAt(d));this.formlist=c}var b=new a(""),c=new a("L"),d=new a("LL"),e=new a("LLL"),f=new a("LLLL"),g=new a("LS"),h=new a("LLS"),i=new a("LLLLLLS"),j=new a("LLLLLLLS"),k=new a("LLSS"),l=new a("LC"),m=new a("LLC"),n=new a("LLLC"),o=new a("LLLLC"),p=new a("ES"),q=new a("LES"),r=new a("EES"),s=new a("F"),t=new a("LF"),u=new a("LLF"),v=new a("EF"),w=new a("EF",1),x=new a("EF",2),y=new a("S"),z=new a("SS"),A=new a("CL"),B=new a("C");rb={0:b,16:r,17:q,18:h,19:h,20:h,21:p,24:r,25:r,26:r,27:p,28:h,29:h,30:h,32:c,34:d,35:d,36:e,37:e,38:e,39:e,40:e,41:e,42:e,43:e,44:e,45:e,48:m,49:c,50:A,51:d,52:d,64:v,65:x,66:w,68:g,69:g,72:h,73:h,74:h,75:h,76:e,77:e,78:e,79:e,80:s,81:t,82:b,83:d,84:c,112:c,113:c,114:c,115:c,256:h,257:c,258:y,259:g,260:c,272:g,273:c,288:b,289:y,290:b,291:l,292:t,293:B,294:s,295:d,304:u,320:y,321:c,328:z,329:d,336:j,337:j,338:i,352:l,353:m,354:n,355:o,368:d,369:e,376:g,377:c,384:d,385:d,400:g,401:g,402:g,408:g,409:g,416:h,417:h,418:h,419:h,420:k,424:g,425:g,426:g,427:h,432:g,433:g,434:g,435:g,436:g,437:g,438:h,448:f,449:f,450:e,451:e,452:e,453:e,456:d,457:d}}function U(a){if(0==a.mode)return"null";var b="m"+a.mode;if(null!=a.argsize&&(b=b+"s"+a.argsize),null!=a.addr&&(b=b+"a"+a.addr),nb.funcop_cache.key)return"self.funcop_cache."+b;var c={key:b,mode:a.mode,argsize:a.argsize,addr:a.addr};return nb.funcop_cache[b]=c,"self.funcop_cache."+b}function V(a,b,c){switch(b.mode){case 8:if(4==b.argsize){var d=c[0];if("0"===d)return a.offstack.push(c),void a.code.push("// push to offstack: "+c);if("_"===d)return da(a,c),void a.code.push("// re-push to offstack: "+c)}return holdvar=ba(a,!0),a.offstack.push(holdvar),void(4==b.argsize?a.code.push(holdvar+"=("+c+");"):2==b.argsize?a.code.push(holdvar+"=0xffff&("+c+");"):a.code.push(holdvar+"=0xff&("+c+");"));case 0:return void a.code.push("("+c+");");case 11:if(4==b.argsize){var d=c[0];if("0"===d)return ea(a,b.addr,c,!1),void a.code.push("// store to offloc["+b.addr+"]: "+c);if("_"===d)return ea(a,b.addr,c,!0),void a.code.push("// re-store to offloc["+b.addr+"]: "+c)}return ea(a,b.addr,void 0),void(4==b.argsize?a.code.push("self.frame.locals["+b.addr+"]=("+c+");"):2==b.argsize?a.code.push("self.frame.locals["+b.addr+"]=(0xffff &"+c+");"):a.code.push("self.frame.locals["+b.addr+"]=(0xff &"+c+");"));case 15:return void(4==b.argsize?a.code.push("self.MemW4("+b.addr+","+c+");"):2==b.argsize?a.code.push("self.MemW2("+b.addr+","+c+");"):a.code.push("self.MemW1("+b.addr+","+c+");"));default:L("Unknown addressing mode in store func operand.")}}function W(a,b,c){void 0===c&&(c=a.cp),a.code.push("self.frame.valstack.push("+b+","+c+",self.frame.framestart);")}function X(a){a.code.push("if (!substring) { substring=true;"),a.code.push("self.frame.valstack.push(0x11,0,nextcp,self.frame.framestart);"),a.code.push("}")}function Y(a,b){var c;if(a.code.push("// unload offstate: "+a.offstack.length+" stack"+(a.offloc.length?", plus locs":"")+(b?" (conditional)":"")),a.offstack.length&&a.code.push("self.frame.valstack.push("+a.offstack.join(",")+");"),a.offloc.length)for(c=0;c<a.offloc.length;c++)void 0!==a.offloc[c]&&a.offlocdirty[c]&&a.code.push("self.frame.locals["+c+"]="+a.offloc[c]+";");if(!b){var d;for(c=0;c<a.offloc.length;c++)d=a.offloc[c],void 0!==d&&void 0!==a.holduse[d]&&(a.holduse[d]=!1);for(a.offloc.length=0,a.offlocdirty.length=0;a.offstack.length;)d=a.offstack.pop(),void 0!==a.holduse[d]&&(a.holduse[d]=!1)}}function Z(a){if(0!=a.buffer.length){var b=a.buffer.join("");a.buffer.length=0,a.code.push("Glk.glk_put_jstring("+K(b)+");")}}function $(a,b,c){var d;if(ga(b))return d=Number(b),2147483648&d?""+(d-4294967296):b;if(d="("+b+"&0xffffffff)",c){var e=ba(a);return a.code.push(e+"="+d+";"),e}return d}function _(a,b,c){var d;if(ga(b))return d=Number(b),2147483648==d?"-0":""+Ja(d);if(d="self.decode_float("+b+")",c){var e=ba(a);return a.code.push(e+"="+d+";"),e}return d}function aa(a,b,c){if(ga(b)){var d=Number(b);if(0==d||1==d)c?(a.code.push("// quashing offstack for unconditional return: "+a.offstack.length),a.offstack.length=0,a.offloc.length=0,a.offlocdirty.length=0):a.code.push("// ignoring offstack for conditional return: "+a.offstack.length),a.code.push("if (self.leave_function()) return self.VMStopped;"),a.code.push("self.pop_callstub("+d+");");else{Y(a,!c);var e=a.cp+d-2>>>0;a.code.push("self.pc = "+e+";"),a.vmfunc.pathaddrs[e]=!0}}else Y(a,!c),a.code.push("if (("+b+")==0 || ("+b+")==1) {"),a.code.push("if (self.leave_function()) return self.VMStopped;"),a.code.push("self.pop_callstub("+b+");"),a.code.push("}"),a.code.push("else {"),a.code.push("self.pc = ("+a.cp+"+("+b+")-2) >>>0;"),a.code.push("}");a.code.push("return;")}function ba(a,b){for(var c,d=0;;){if(c="_hold"+d,!a.holduse[c])return a.holduse[c]=b?1:!0,c;d++}}function ca(a){var b=a.offstack.pop();if(ga(b))return b;var c=a.holduse[b];return(isNaN(c)||c===!1||c===!0)&&L("Offstack variable not marked as stack.",b),c--,0==c&&(c=!0),a.holduse[b]=c,b}function da(a,b){a.offstack.push(b);var c=a.holduse[b];c&&c!==!0?c++:c=1,a.holduse[b]=c}function ea(a,b,c,d){var e=a.offloc[b];if(e&&ha(e)){var f=a.holduse[e];f--,0==f&&(f=!0),a.holduse[e]=f}if(void 0===c)return a.offloc[b]=void 0,void(a.offlocdirty[b]=!1);if(a.offloc[b]=c,a.offlocdirty[b]=!0,d){var g=c,f=a.holduse[g];f&&f!==!0?f++:f=1,a.holduse[g]=f}}function fa(a,b){for(var c;a.offstack.length<b;)c=ba(a,!0),a.offstack.unshift(c),a.code.push(c+"=self.frame.valstack.pop();")}function ga(a){return"0"===a[0]}function ha(a){return"_"===a[0]}function ia(a,b,c,d){var e,f,g,h,i,j,n;for(d.desttype=0,d.numops=c.numops,e=b,b+=c.numops+1>>1,f=0;f<c.numops;f++){0==(1&f)?(g=k(e),h=15&g):(h=g>>4&15,e++);var o=c.formlist[f];if("L"!=o)if("E"!=o)if("S"!=o)if("F"!=o)if("C"!=o)L("Unknown operand type.",o);else{switch(h){case 8:d[f]="3,0";continue;case 0:d[f]="0,0";continue}if(h>=9&&11>=h){9==h?(j=k(b),b++):10==h?(j=l(b),b+=2):11==h&&(j=m(b),b+=4),d[f]="2,"+j;continue}switch(h){case 15:j=m(b)+Mb,b+=4;break;case 14:j=l(b)+Mb,b+=2;break;case 13:j=k(b)+Mb,b++;break;case 7:j=m(b),b+=4;break;case 6:j=l(b),b+=2;break;case 5:j=k(b),b++;break;default:L("Unknown addressing mode in store operand.")}d[f]="1,"+j}else{var p=d.func_store;switch(h){case 8:p.mode=8,p.argsize=c.argsize,d[f]=p;continue;case 0:p.mode=0,p.argsize=c.argsize,d[f]=p;continue}if(h>=9&&11>=h){9==h?(j=k(b),b++):10==h?(j=l(b),b+=2):11==h&&(j=m(b),b+=4),p.mode=11,p.addr=j,p.argsize=c.argsize,d[f]=p;continue}switch(h){case 15:j=m(b)+Mb,b+=4;break;case 14:j=l(b)+Mb,b+=2;break;case 13:j=k(b)+Mb,b++;break;case 7:j=m(b),b+=4;break;case 6:j=l(b),b+=2;break;case 5:j=k(b),b++;break;default:L("Unknown addressing mode in store operand.")}p.mode=15,p.addr=j,p.argsize=c.argsize,d[f]=p}else{switch(h){case 8:n=ba(a,!0),a.offstack.push(n),d[f]=n+"=(";continue;case 0:d[f]="(";continue}if(h>=9&&11>=h){9==h?(j=k(b),b++):10==h?(j=l(b),b+=2):11==h&&(j=m(b),b+=4),4==c.argsize?(n=ba(a,!0),ea(a,j,n,!1),d[f]=n+"=("):2==c.argsize?(ea(a,j,void 0),d[f]="self.frame.locals["+j+"]=(0xffff &"):(ea(a,j,void 0),d[f]="self.frame.locals["+j+"]=(0xff &");continue}switch(h){case 15:j=m(b)+Mb,b+=4;break;case 14:j=l(b)+Mb,b+=2;break;case 13:j=k(b)+Mb,b++;break;case 7:j=m(b),b+=4;break;case 6:j=l(b),b+=2;break;case 5:j=k(b),b++;break;default:L("Unknown addressing mode in store operand.")}i=4==c.argsize?"self.MemW4("+j+",":2==c.argsize?"self.MemW2("+j+",":"self.MemW1("+j+",",d[f]=i}else{switch(h){case 8:a.offstack.length?d[f]=ca(a):d[f]="self.frame.valstack.pop()";continue;case 0:d[f]="0";continue;case 1:i=x(b),b++,d[f]=i;continue;case 2:i=y(b),b+=2,d[f]=i;continue;case 3:i=z(b),b+=4,d[f]=i;continue}if(h>=9&&11>=h){if(9==h?(j=k(b),b++):10==h?(j=l(b),b+=2):11==h&&(j=m(b),b+=4),void 0!==a.offloc[j]){d[f]=a.offloc[j];continue}i=4==c.argsize?"self.frame.locals["+j+"]":2==c.argsize?"self.frame.locals["+j+"] & 0xffff":"self.frame.locals["+j+"] & 0xff",n=ba(a,!0),a.code.push(n+"=("+i+");"),a.offloc[j]=n,a.offlocdirty[j]=!1,d[f]=n;continue}switch(h){case 15:j=m(b)+Mb,b+=4;break;case 14:j=l(b)+Mb,b+=2;break;case 13:j=k(b)+Mb,b++;break;case 7:j=m(b),b+=4;break;case 6:j=l(b),b+=2;break;case 5:j=k(b),b++;break;default:L("Unknown addressing mode in load operand.")}i=4==c.argsize?"self.Mem4("+j+")":2==c.argsize?"self.Mem2("+j+")":"self.Mem1("+j+")",d[f]=i}else{switch(h){case 8:a.offstack.length?d[f]=ca(a):(n=ba(a),a.code.push(n+"=self.frame.valstack.pop();"),d[f]=n);continue;case 0:d[f]="0";continue;case 1:i=x(b),b++,d[f]=i;continue;case 2:i=y(b),b+=2,d[f]=i;continue;case 3:i=z(b),b+=4,d[f]=i;continue}if(h>=9&&11>=h){if(9==h?(j=k(b),b++):10==h?(j=l(b),b+=2):11==h&&(j=m(b),b+=4),void 0!==a.offloc[j]){d[f]=a.offloc[j];continue}i=4==c.argsize?"self.frame.locals["+j+"]":2==c.argsize?"self.frame.locals["+j+"] & 0xffff":"self.frame.locals["+j+"] & 0xff",n=ba(a,!0),a.code.push(n+"=("+i+");"),a.offloc[j]=n,a.offlocdirty[j]=!1,d[f]=n;continue}switch(h){case 15:j=m(b)+Mb,b+=4;break;case 14:j=l(b)+Mb,b+=2;break;case 13:j=k(b)+Mb,b++;break;case 7:j=m(b),b+=4;break;case 6:j=l(b),b+=2;break;case 5:j=k(b),b++;break;default:L("Unknown addressing mode in load operand.")}i=4==c.argsize?"self.Mem4("+j+")":2==c.argsize?"self.Mem2("+j+")":"self.Mem1("+j+")",n=ba(a),a.code.push(n+"=("+i+");"),d[f]=n}}return b}function ja(a){var b=a,c=k(b);192!=c&&193!=c&&(c>=192&&223>=c?L("Call to unknown type of function.",b):L("Call to non-function.",b)),b++;for(var d=[],e=b;;){var f=k(b);b++;var g=k(b);if(b++,0==f)break;1!=f&&2!=f&&4!=f&&L("Invalid local variable size in function header.",f),d.push({size:f,count:g})}for(var h=Bb.slice(e,b);h.length%4;)h.push(0);return new N(a,b,d,h)}function ka(a,b,c){var d,e,f,g=b,h={vmfunc:a,cp:null,prevcp:null,curiosys:c,code:[],holduse:{},varsused:{},offstack:[],offloc:[],offlocdirty:[],path_ends:!1},i={};for(i.func_store={},h.code.push("");!h.path_ends;){h.prevcp=g,e=g,d=k(g),void 0===d&&L("Tried to compile nonexistent address",g),g++,128&d&&(64&d?(d&=63,d=256*d|k(g),g++,d=256*d|k(g),g++,d=256*d|k(g),g++):(d&=127,d=256*d|k(g),g++)),h.code.push("// "+e.toString(16)+": opcode "+d.toString(16));var j=rb[d];j||L("Encountered unknown opcode.",d),g=ia(h,g,j,i),h.cp=g;var l=sb[d];l||L("Encountered unhandled opcode.",d),l(h,i);for(f in h.holduse)h.holduse[f]===!0&&(h.holduse[f]=!1);h.offstack.length&&h.code.push("// offstack: "+h.offstack.join(",")),h.offloc.length&&h.code.push("// offloc: "+h.offloc.join(",")+"; dirty: "+h.offlocdirty.join(",")),a.pathaddrs[g]&&!h.path_ends&&(h.code.push("// reached jump-in point"),h.code.push("self.pc="+g+";"),Y(h),h.code.push("return;"),h.path_ends=!0)}h.offstack.length&&L("Path compilation ended with nonempty offstack.",h.offstack.length),h.offloc.length&&L("Path compilation ended with nonempty offloc.",h.offloc.length);var m=[];for(f in h.holduse)m.push(f);for(f in h.varsused)m.push(f);return m.length&&(h.code[0]="var "+m.join(",")+";"),M(h.code.join("\n"),"_func_path_"+b)}function la(a,b){var c;Yb++;var d=wb[a];if(void 0!==d){Zb++;var e=d(b,nb.tempcallargs);return void oa(e)}var f=Ib[a];void 0===f&&(f=ja(a),Mb>a&&(Ib[a]=f)),nb.pc=f.startpc;var g=new O(f);if(g.depth=Cb.length,0==Cb.length?g.framestart=0:g.framestart=nb.frame.framestart+nb.frame.framelen+4*nb.frame.valstack.length,Cb.push(g),nb.frame=g,192==f.functype){for(c=b-1;c>=0;c--)nb.frame.valstack.push(nb.tempcallargs[c]);nb.frame.valstack.push(b)}else for(c=0;b>c;c++){var h=f.localsindex[c];if(void 0===h)break;4==h.size?nb.frame.locals[h.pos]=nb.tempcallargs[c]:2==h.size?nb.frame.locals[h.pos]=65535&nb.tempcallargs[c]:1==h.size&&(nb.frame.locals[h.pos]=255&nb.tempcallargs[c])}}function ma(){var a=nb.frame.depth;return Cb.pop(),0==Cb.length?(nb.frame=null,!0):(nb.frame=Cb[Cb.length-1],void(nb.frame.depth!=a-1&&L("Stack inconsistent after function exit.")))}function na(a){for(;Cb.length&&Cb[Cb.length-1].framestart>a;)Cb.pop();0==Cb.length&&L("Stack evaporated during throw."),nb.frame=Cb[Cb.length-1],a-=nb.frame.framestart+nb.frame.framelen,0>a&&L("Attempted to throw below the frame value stack."),3&a&&L("Attempted to throw to an unaligned address."),a>>>=2,a>nb.frame.valstack.length&&L("Attempted to throw beyond the frame value stack."),nb.frame.valstack.length=a}function oa(a){var b,c;isNaN(a)&&L("Function returned undefined value.");var d=nb.frame.valstack,e=d.length,f=d[e-1];switch(f!=nb.frame.framestart&&(d.length-=1,L("Call stub frameptr ("+f+") does not match frame ("+nb.frame.framestart+")")),nb.pc=d[e-2],b=d[e-3],c=d[e-4],d.length-=4,c){case 0:return;case 1:return void q(b,a);case 2:return void(nb.frame.locals[b]=a);case 3:return void nb.frame.valstack.push(a);case 17:return void L("String-terminator call stub at end of function call.");case 16:return void Ca(0,nb.pc,225,b);case 18:return void Ba(0,nb.pc,!0,b);case 19:return void Ca(0,nb.pc,224,b);case 20:return void Ca(0,nb.pc,226,b);default:L("Unrecognized desttype in callstub.",c)}}function pa(a,b,c){switch(a){case 0:return;case 1:return void q(b,c);case 2:return void(nb.frame.locals[b]=c);case 3:return void nb.frame.valstack.push(c);default:L("Unrecognized desttype in callstub.",a)}}function qa(a,b){if(a)switch(a.mode){case 8:return void nb.frame.valstack.push(b);case 0:return;case 11:return void(4==a.argsize?nb.frame.locals[a.addr]=b:2==a.argsize?nb.frame.locals[a.addr]=65535&b:nb.frame.locals[a.addr]=255&b);case 15:return void(4==a.argsize?q(a.addr,b):2==a.argsize?p(a.addr,b):o(a.addr,b));default:L("Unknown addressing mode in store func by operand.")}}function ra(){var a=nb.prevpc,b=k(a);return a++,128&b&&(64&b?(b&=63,b=b<<8|k(a),a++,b=b<<8|k(a),a++,b=b<<8|k(a),a++):(b&=127,b=b<<8|k(a),a++)),304!=b?(e("parse_partial_operand: parsed wrong opcode: "+b),null):{selop:15&k(a),argsop:k(a)>>4&15,resop:15&k(a+1)}}function sa(a){0==a?nb.random_func=Math.random:(ta(a),nb.random_func=ua)}function ta(a){var b,c,d,e,f;for(void 0===vb&&(vb=Array(55)),vb[54]=a,tb=0,ub=31,d=1,b=0;55>b;b++)c=21*b%55,vb[c]=d,d=a-d>>>0,a=vb[c];for(f=0;4>f;f++)for(b=0;55>b;b++)e=vb[b]-vb[(1+b+30)%55],vb[b]=e>>>0}function ua(){return tb=(tb+1)%55,ub=(ub+1)%55,vb[tb]=vb[tb]-vb[ub]>>>0,vb[tb]/4294967296}function va(a){return m(a+13+yb[7])==yb[2]}function wa(a,b){var c,d=0;if(4294901760&b){if(d=m(yb[0]+4*(65535&b)),Ab[0]=a,Ab[1]=d,0==zb[5](2,Ab))return 0;b>>=16,a=d}return Ab[0]=a,Ab[1]=b,c=zb[2](2,Ab),0==c?0:va(a)&&0==d&&(b<yb[1]||b>=yb[1]+8)?0:m(yb[6])!=a&&1&k(c+9)?0:c}function xa(a,b){var c,d=0;if(4294901760&b){if(d=m(yb[0]+4*(65535&b)),Ab[0]=a,Ab[1]=d,0==zb[11](2,Ab))return 0;b>>=16,a=d}return Ab[0]=a,Ab[1]=b,c=zb[8](2,Ab),0==c?0:va(a)&&0==d&&(b<yb[1]||b>=yb[1]+8)?0:m(yb[6])!=a&&1&k(c+9)?0:c}function ya(a){if(nb.stringtable!=a&&(Kb=void 0,Lb=void 0,nb.stringtable=a,0!=nb.stringtable)){var b=Jb[nb.stringtable];if(void 0===b){var c=void 0,d=m(nb.stringtable),e=m(nb.stringtable+8),f=nb.stringtable+d<=Mb;if(f){var g=Array(1);Aa(g,e,4,0),c=g[0],void 0===c&&L("Failed to create decoding tree.")}b=new S(nb.stringtable,c),Jb[nb.stringtable]=b}Kb=b.decoding_tree,Lb=b.vmstring_tables[nb.iosysmode]}}function za(a,b){switch(a){case 0:b=0;break;case 1:break;case 2:b=0;break;default:a=0,b=0}nb.iosysmode=a,nb.iosysrock=b;var c=Jb[nb.stringtable];Lb=void 0===c?void 0:c.vmstring_tables[nb.iosysmode]}function Aa(a,b,c,d){var e,f,g,h;if(f=k(b),0==f&&4==c)return g=Array(16),g.type=0,g.depth=4,a[d]=g,void Aa(g,b,0,0);if(0==f){var i=m(b+1),j=m(b+5);return Aa(a,i,c+1,d),void Aa(a,j,c+1,d|1<<c)}switch(b++,g={},g.type=f,g.depth=c,f){case 2:g.value=k(b),g.cchar=H(g.value);break;case 4:g.value=m(b),g.cchar=H(g.value);break;case 3:case 5:g.addr=b;break;case 8:case 9:g.addr=m(b);break;case 10:case 11:g.addr=b;break;case 1:break;default:L("Unknown node type in string table.",f)}for(h=1<<c,e=d;16>e;e+=h)a[e]=g}function Ba(a,b,c,d){var e=(4294967295&b).toString(10);switch(nb.iosysmode){case 2:d&&(e=e.slice(d)),Glk.glk_put_jstring(e,!0);break;case 1:if(c||(nb.frame.valstack.push(17,0,a,nb.frame.framestart),c=!0),d<e.length){var f=e.charCodeAt(d);return nb.frame.valstack.push(18,d+1,b,nb.frame.framestart),nb.tempcallargs[0]=f,la(nb.iosysrock,1),!0}break;case 0:}if(c){var g,h;nb.frame.valstack.pop()!=nb.frame.framestart&&L("Call stub frameptr does not match frame."),nb.pc=nb.frame.valstack.pop(),h=nb.frame.valstack.pop(),g=nb.frame.valstack.pop(),17!=g&&L("String-on-string call stub while printing number.")}}function Ca(a,b,c,d){for(var e,f,g,h,i,j=0!=c;;){if(f=void 0,e=0==c?b:b+"/"+c+"/"+d,void 0!==Lb&&Mb>b?(f=Lb[e],void 0===f&&(f=Da(nb.iosysmode,b,c,d),Lb[e]=f,cc++,bc++)):(f=Da(nb.iosysmode,b,c,d),cc++),f instanceof Function){if(g=f(nb,a,j),g instanceof Array){j=!0,b=g[0],c=g[1],d=g[2];continue}if(g)return!0}else if(Glk.glk_put_jstring(f),!j)return!1;if(nb.frame.valstack.pop()!=nb.frame.framestart&&L("Call stub frameptr does not match frame."),nb.pc=nb.frame.valstack.pop(),i=nb.frame.valstack.pop(),h=nb.frame.valstack.pop(),17==h)return!0;16==h?(j=!0,d=i,c=225,b=nb.pc):L("Function-terminator call stub at end of string.")}}function Da(a,b,c,d){var e,f,g=b,h=d,i=void 0;g||L("Called compile_string with null address.");var j={startaddr:b,startbitnum:d,buffer:[],code:[]};if(0==c?(f=k(g),226==f?g+=4:g++,h=0):f=c,225==f)if(Kb){var l,n,o,p,q,r,s=!1;for(l=k(g),h&&(l>>=h),n=8-h,o=!1,Kb instanceof Array||(s=!0),q=Kb;!s;){if(4>n){var t=k(g+1);l|=t<<n,n+=8,o=!0}if(r=q[15&l],n-=r.depth,l>>=r.depth,h+=r.depth,h>=8)if(g+=1,h-=8,o)o=!1;else{var t=k(g);l|=t<<n,n+=8}if(r instanceof Array)q=r;else switch(r.type){case 1:s=!0;break;case 2:case 4:switch(a){case 2:j.buffer.push(r.cchar);break;case 1:Z(j),X(j),W(j,"0x10,"+h,g),j.code.push("self.tempcallargs[0]="+r.value+";"),j.code.push("self.enter_function(self.iosysrock, 1);"),i=!0,s=!0}q=Kb;break;case 3:switch(a){case 2:for(p=r.addr;;){if(e=k(p),0==e)break;j.buffer.push(H(e)),p++}break;case 1:Z(j),X(j),W(j,"0x10,"+h,g),i="["+r.addr+", 0xE0, 0]",s=!0}q=Kb;break;case 5:switch(a){case 2:for(p=r.addr;;){if(e=m(p),0==e)break;j.buffer.push(H(e)),p+=4}break;case 1:Z(j),X(j),W(j,"0x10,"+h,g),i="["+r.addr+", 0xE2, 0]",s=!0}q=Kb;break;case 8:case 9:case 10:case 11:Z(j),X(j),j.code.push("var otype, retval;"),j.code.push("var oaddr = "+r.addr+";"),r.type>=9&&j.code.push("oaddr = self.Mem4(oaddr);"),11==r.type&&j.code.push("oaddr = self.Mem4(oaddr);"),j.code.push("otype = self.Mem1(oaddr);"),i="retval",s=!0,W(j,"0x10,"+h,g),j.code.push("if (otype >= 0xE0 && otype <= 0xFF) {"),j.code.push("retval = [oaddr, 0, 0];"),j.code.push("}"),j.code.push("else if (otype >= 0xC0 && otype <= 0xDF) {");var u=0;if(10==r.type||11==r.type){u=m(r.addr+4);for(var v=0;u>v;v++)j.code.push("self.tempcallargs["+v+"]="+m(r.addr+8+4*v)+";")}j.code.push("self.enter_function(oaddr, "+u+");"),j.code.push("retval = true;"),j.code.push("}"),j.code.push("else {"),j.code.push("self.fatal_error('Unknown object while decoding string indirect reference.', otype);"),j.code.push("}");break;default:L("Unknown entity in string decoding (cached).")}}}else{var w,x,y,s=!1;for(nb.stringtable||L("Attempted to print a compressed string with no table set."),x=k(g),h&&(x>>=h),w=m(nb.stringtable+8);!s;)switch(y=k(w),w++,y){case 0:w=m(1&x?w+4:w+0),7==h?(h=0,g++,x=k(g)):(h++,x>>=1);break;case 1:i=!1,s=!0;break;case 2:switch(e=k(w),a){case 2:j.buffer.push(H(e));break;case 1:Z(j),X(j),W(j,"0x10,"+h,g),j.code.push("self.tempcallargs[0]="+e+";"),j.code.push("self.enter_function(self.iosysrock, 1);"),i=!0,s=!0}w=m(nb.stringtable+8);break;case 4:switch(e=m(w),a){case 2:j.buffer.push(H(e));break;case 1:Z(j),X(j),W(j,"0x10,"+h,g),j.code.push("self.tempcallargs[0]="+e+";"),j.code.push("self.enter_function(self.iosysrock, 1);"),i=!0,s=!0}w=m(nb.stringtable+8);break;case 3:switch(a){case 2:for(;;){if(e=k(w),0==e)break;j.buffer.push(H(e)),w++}break;case 1:Z(j),X(j),W(j,"0x10,"+h,g),i="["+w+", 0xE0, 0]",s=!0}w=m(nb.stringtable+8);break;case 5:switch(a){case 2:for(;;){if(e=m(w),0==e)break;j.buffer.push(H(e)),w+=4}break;case 1:Z(j),X(j),W(j,"0x10,"+h,g),i="["+w+", 0xE2, 0]",s=!0}w=m(nb.stringtable+8);break;case 8:case 9:case 10:case 11:Z(j),X(j),j.code.push("var otype, retval;"),j.code.push("var oaddr = "+m(w)+";"),(9==y||11==y)&&j.code.push("oaddr = self.Mem4(oaddr);"),j.code.push("otype = self.Mem1(oaddr);"),i="retval",s=!0,W(j,"0x10,"+h,g),j.code.push("if (otype >= 0xE0 && otype <= 0xFF) {"),j.code.push("retval = [oaddr, 0, 0];"),j.code.push("}"),j.code.push("else if (otype >= 0xC0 && otype <= 0xDF) {");var u=0;if(10==y||11==y){u=m(w+4);for(var v=0;u>v;v++)j.code.push("self.tempcallargs["+v+"]="+m(w+8+4*v)+";")}j.code.push("self.enter_function(oaddr, "+u+");"),j.code.push("retval = true;"),j.code.push("}"),j.code.push("else {"),j.code.push("self.fatal_error('Unknown object while decoding string indirect reference.', otype);"),j.code.push("}");break;default:L("Unknown entity in string decoding.",y)}}else if(224==f){var e;switch(a){case 2:for(;;){if(e=k(g),g++,0==e)break;j.buffer.push(H(e))}break;case 1:Z(j),X(j),e=k(g),g++,0!=e?(W(j,"0x13,0",g),j.code.push("self.tempcallargs[0]="+e+";"),j.code.push("self.enter_function(self.iosysrock, 1);"),i=!0):i="false"}}else if(226==f){var e;switch(a){case 2:for(;;){if(e=m(g),g+=4,0==e)break;j.buffer.push(H(e))}break;case 1:Z(j),X(j),e=m(g),g+=4,0!=e?(W(j,"0x14,0",g),j.code.push("self.tempcallargs[0]="+e+";"),j.code.push("self.enter_function(self.iosysrock, 1);"),i=!0):i="false"}}else L(f>=224&&255>=f?"Attempt to print unknown type of string.":"Attempt to print non-string.");return i?(Z(j),j.code.push("return "+i+";"),M(j.code.join("\n"),"_func_str_"+b,"nextcp","substring")):(j.code.length>1&&L("Simple-case string generated code."),j.buffer.join(""))}function Ea(a,b){switch(a){case 0:return 196866;case 1:return 131333;case 2:return 1;case 3:return 1;case 4:switch(b){case 0:return 1;case 1:return 1;case 2:return 1;default:return 0}break;case 5:return 1;case 6:return 1;case 7:return 1;case 8:return eb();case 9:return 1;case 10:return zb[b]?1:0;case 11:return 1;default:return 0}}function Fa(a,b,c){if(1&c)return n(a,b);switch(b){case 4:return[a>>24&255,a>>16&255,a>>8&255,255&a];case 2:return[a>>8&255,255&a];case 1:return[255&a];default:L("Direct search key must hold one, two, or four bytes.")}}function Ga(a,b,c,d,e,f,g){var h,i,j,k,l=0!=(4&g),m=0!=(2&g),o=Fa(a,b,g);for(i=0;e>i;i++,c+=d){for(j=!0,k=n(c+f,b),h=0;j&&b>h;h++)k[h]!=o[h]&&(j=!1);if(j)return l?i:c;if(m){for(j=!0,k=n(c+f,b),h=0;j&&b>h;h++)0!=k[h]&&(j=!1);if(j)break}}return l?4294967295:0}function Ha(a,b,c,d,e,f,g){var h,i,j,l,m,n,o,p,q=0!=(4&g),r=Fa(a,b,g);for(i=0,h=e;h>i;){for(m=0,l=h+i>>1,j=c+l*d,n=0;!m&&b>n;n++)o=k(j+f+n),p=r[n],p>o?m=-1:o>p&&(m=1);if(!m)return q?l:j;0>m?i=l+1:h=l}return q?4294967295:0}function Ia(a,b,c,d,e,f){for(var g,h,i,j=0!=(2&f),l=Fa(a,b,f);0!=c;){for(i=!0,g=0;i&&b>g;g++)h=k(c+d+g),h!=l[g]&&(i=!1);if(i)return c;if(j){for(i=!0,g=0;i&&b>g;g++)h=k(c+d+g),0!=h&&(i=!1);if(i)break}c=m(c+e)}return 0}function Ja(a){var b,c,d;return 2147483648&a?(b=!0,a=2147483647&a):b=!1,0==a?b?-0:0:2139095040==(2139095040&a)?0==(8388607&a)?b?-(1/0):1/0:NaN:(d=a>>23&255,c=d?(8388607&a|8388608)/8388608*Math.pow(2,d-127):(8388607&a)/8388608*Math.pow(2,-126),b?-c:c)}function Ka(a){var b,c,d,e,f;return isNaN(a)?2139095041:isFinite(a)?0==a?0>1/a?2147483648:0:(0>a?(f=!0,b=-a):(f=!1,b=a),e=Math.floor(Math.log(b)/Math.log(2)),d=b/Math.pow(2,e),e>=128?f?4286578688:2139095040:(-126>e?(d*=Math.pow(2,126+e),e=0):(0!=e||0!=d)&&(e+=127,d-=1),d=8388608*d,c=d+.4999999999999999<<0,c>=8388608&&(c=0,e++,e>=255)?f?4286578688:2139095040:f?(2147483648|e<<23|c)>>>0:e<<23|c)):0>a?4286578688:2139095040}function La(){var a,b;if(Db||L("There is no Glulx game file loaded."),nb.vm_started=!0,nb.resumefuncop=null,nb.resumevalue=0,Bb=null,Cb=[],nb.frame=null,nb.pc=0,nb.prevpc=0,Db.length<36&&L("This is too short to be a valid Glulx file."),a=h(Db,0),1198290284!=a&&L("This is not a valid Glulx file."),b=h(Db,4),131072>b&&L("This Glulx file is too old a version to execute."),b>=197120&&L("This Glulx file is too new a version to execute."),Mb=h(Db,8),Nb=h(Db,12),Ob=h(Db,16),Pb=h(Db,20),Qb=h(Db,24),Rb=h(Db,28),Sb=h(Db,32),nb.protectstart=0,nb.protectend=0,(256>Mb||Mb>Nb||Nb>Ob)&&L("The segment boundaries in the header are in an impossible order."),Nb!=Db.length&&L("The game file length does not agree with the header."),nb.done_executing=!1,Ib={},Jb={},Kb=void 0,Lb=void 0,nb.tempcallargs=Array(8),nb.tempglkargs=Array(8),sa(0),nb.endmem=Ob,nb.stringtable=0,Tb=[],Ub=0,Vb=[],Wb=[],Hb&&Dialog.autosave_write(Eb,null),Gb&&!Hb)try{var c=Dialog.autosave_read(Eb);if(c)return e("Found autosave..."),void Ua(c)}catch(f){e("Autorestore failed, deleting it: "+d(f)),f.stack&&e("JS stack dump:\n"+f.stack),Dialog.autosave_write(Eb,null)}Ma()}function Ma(){cb();var a=Ya();Bb=null,Bb=Db.slice(0,Nb),nb.endmem=Bb.length,Xa(Ob,!1),Za(a),Cb=[],nb.frame=null,nb.pc=0,nb.prevpc=0,nb.iosysmode=0,nb.iosysrock=0,ya(Rb),la(Qb,0)}function Na(a){result=[];for(var b=0;b<a.length;){for(var c=0;b<a.length&&0==a[b]&&255>=c;)c++,b++;for(c>0&&(result.push(0),result.push(c-1));b<a.length&&0!=a[b];)result.push(a[b]),b++}return result}function Oa(a){result=[];for(var b=0;b<a.length;){var c=a[b++];if(0==c)for(var d=a[b++]+1,e=0;d>e;e++)result.push(0);else result.push(c)}return result}function Pa(a){bytes=[];for(var b=0;b<a.length;b++){var c=a[b].key,d=a[b].chunk;4!=c.length&&L("Bad chunk ID (must be exactly 4 chars): "+c),void 0==d&&L("Missing chunk data: "+c),r(bytes,c),s(bytes,d.length),bytes=bytes.concat(d),1&bytes.length&&bytes.push(0)}return bytes}function Qa(a){chunks={};for(var b=0;b<a.length;){if(b+8>a.length)return void e("IFF chunk header is truncated");var c=w(a,b,4),d=h(a,b+4);if(b+=8,b+d>a.length)return void e(c+" chunk is truncated ("+d+" bytes needed, "+(a.length-b)+" available");chunks[c]=a.slice(b,b+d),b+=d,1&b&&(b+=1)}return chunks}function Ra(a){Bb.length!=nb.endmem&&L("Memory length was incorrect before save."),2!=nb.iosysmode&&L("Streams are only available in Glk I/O system.");
var b=GiDispa.class_obj_from_id("stream",a);if(!b)return!1;chunks=[],chunks.push({key:"IFhd",chunk:Db.slice(0,128)});for(var c=Bb.slice(Mb),d=Mb;d<Db.length;d++)c[d-Mb]^=Db[d];c=Na(c),c.splice(0,0,0,0,0,0),v(c,0,nb.endmem),chunks.push({key:"CMem",chunk:c});var e=[];chunks.push({key:"Stks",chunk:e});for(var d=0;d<Cb.length;d++)Q(Cb[d],e);if(db()){var f=[];chunks.push({key:"MAll",chunk:f}),s(f,Ub),s(f,Vb.length);for(var d=0;d<Vb.length;d++)s(f,Vb[d].addr),s(f,Vb[d].size)}var g=[];r(g,"IFZS"),g=g.concat(Pa(chunks));var h=Pa([{key:"FORM",chunk:g}]);return Glk.glk_put_buffer_stream(b,h),!0}function Sa(a){2!=nb.iosysmode&&L("Streams are only available in Glk I/O system.");var b=GiDispa.class_obj_from_id("stream",a);if(!b)return!1;for(var c=new Array(0),d=new Array(1024),f=1;f>0;)f=Glk.glk_get_buffer_stream(b,d),c=c.concat(d.slice(0,f));if(c=Qa(c),!c)return e("vm_restore failed: file is not Quetzal"),!1;if(c=c.FORM,!c||"IFZS"!=w(c,0,4))return e("vm_restore failed: file doesn't start with FORM/IFZS header"),!1;var g=Qa(c.slice(4));if(!g.IFhd)return e("vm_restore failed: missing required IFhd chunk"),!1;for(var i=0;128>i;i++)if(g.IFhd[i]!=Db[i])return e("vm_restore failed: this save image is for a different game"),!1;if(!g.CMem)return e("vm_restore failed: missing required CMem chunk"),!1;if(!g.Stks)return e("vm_restore failed: missing required Stks chunk"),!1;var j=Ya();cb();var k=h(g.CMem,0),l=g.CMem.slice(4);for(l=Oa(l);l.length<k-Mb;)l.push(0);Xa(k,!1),Bb=Db.slice(0,Mb).concat(l);for(var i=Mb;i<Db.length;i++)Bb[i]^=Db[i];Bb.length!=nb.endmem&&L("Memory length was incorrect after restore.");var m=g.Stks;for(Cb=[];m.length;)nb.frame=R(m),nb.frame||L("vm_restore failed: bad stack frame"),Cb.unshift(nb.frame);for(var i=0;i<Cb.length;i++)Cb[i].depth=i;nb.frame=Cb[Cb.length-1];var n=g.MAll;if(n&&n.length>=8){Ub=h(n,0);for(var o=h(n,4),i=0;o>i;i++){var p=h(n,8+8*i),q=h(n,12+8*i);Vb.push(new fb(p,q))}Vb.sort(function(a,b){return a.addr-b.addr});for(var r=Ub,i=0;i<Vb.length;i++){var p=Vb[i].addr,q=Vb[i].size;(r>p||p+q>nb.endmem)&&L("vm_restore failed: corrupt dynamic heap"),p>r&&Wb.push(new fb(r,p-r)),r=p+q}r<nb.endmem&&Wb.push(new fb(r,nb.endmem-r))}return jb(),Za(j),!0}function Ta(a){if(0>a)return void Dialog.autosave_write(Eb,null);var b=ra();if(b){var c={},d=nb.frame.valstack,e=d.length;d.push(a),8==b.argsop&&d.push(1),8==b.selop&&d.push(192),d.push(0,0,nb.prevpc,nb.frame.framestart),c.ram=Bb.slice(Mb),c.endmem=nb.endmem,c.pc=nb.pc,c.stack=[];for(var f=0;f<Cb.length;f++)Q(Cb[f],c.stack);if(db()){c.heapstart=Ub,c.usedlist=[];for(var f=0;f<Vb.length;f++)c.usedlist.push(Vb[f].addr),c.usedlist.push(Vb[f].size)}d.length=e,c.stringtable=nb.stringtable,c.iosysmode=nb.iosysmode,c.iosysrock=nb.iosysrock,c.protectstart=nb.protectstart,c.protectend=nb.protectend,nb.random_func==ua&&vb&&(c.srand_table=vb.slice(0),c.srand_index1=tb,c.srand_index2=ub),c.accel_params=yb.slice(0),c.accel_funcnum_map={};for(var g in xb)c.accel_funcnum_map[g]=xb[g];c.glk=Glk.save_allstate(),Dialog.autosave_write(Eb,c)}}function Ua(a){Bb=Db.slice(0,Nb),Bb=Bb.slice(0,Mb).concat(a.ram),nb.endmem=a.endmem,nb.pc=a.pc,Cb=[];for(var b=a.stack.slice(0);b.length;){var c=R(b);c||L("vm_autorestore failed: bad stack frame"),Cb.unshift(c)}for(var d=0;d<Cb.length;d++)Cb[d].depth=d;if(nb.frame=Cb[Cb.length-1],void 0===a.heapstart)Ub=0,Vb=[],Wb=[];else{Ub=a.heapstart,Vb=[];for(var e=0;e<a.usedlist.length;e+=2){var f=a.usedlist[e],g=a.usedlist[e+1];Vb.push(new fb(f,g))}Vb.sort(function(a,b){return a.addr-b.addr}),Wb=[];for(var h=Ub,d=0;d<Vb.length;d++){var f=Vb[d].addr,g=Vb[d].size;(h>f||f+g>nb.endmem)&&L("vm_autorestore failed: corrupt dynamic heap"),f>h&&Wb.push(new fb(h,f-h)),h=f+g}h<nb.endmem&&Wb.push(new fb(h,nb.endmem-h))}jb(),ya(a.stringtable),za(a.iosysmode,a.iosysrock),nb.protectstart=a.protectstart,nb.protectend=a.protectend,void 0===a.srand_table?sa(0):(sa(1),vb=a.srand_table.slice(0),tb=a.srand_index1,ub=a.srand_index2),yb=a.accel_params.slice(0);for(var e in a.accel_funcnum_map)xb[e]=a.accel_funcnum_map[e],wb[e]=nb.accel_func_map[xb[e]];Glk.restore_allstate(a.glk),oa(0)}function Va(){Bb.length!=nb.endmem&&L("Memory length was incorrect before saveundo.");var a={};a.ram=Bb.slice(Mb),a.endmem=nb.endmem,a.pc=nb.pc,a.stack=[];for(var b=0;b<Cb.length;b++)a.stack[b]=P(Cb[b]);a.heapstart=Ub,a.usedlist=Vb.slice(0),a.freelist=Wb.slice(0),Tb.push(a),Tb.length>10&&Tb.shift()}function Wa(){if(0==Tb.length)return!1;var a=Tb.pop(),b=Ya();return Bb=Bb.slice(0,Mb).concat(a.ram),nb.endmem=a.endmem,Cb=a.stack,nb.frame=Cb[Cb.length-1],nb.pc=a.pc,Ub=a.heapstart,Vb=a.usedlist,Wb=a.freelist,Za(b),Bb.length!=nb.endmem&&L("Memory length was incorrect after undo."),jb(),!0}function Xa(a,b){var c;if(a!=nb.endmem){if(!b&&db()&&L("Cannot resize Glulx memory space while heap is active."),Ob>a&&L("Cannot resize Glulx memory space smaller than it started."),255&a&&L("Can only resize Glulx memory space to a 256-byte boundary."),Bb.length=a,a>nb.endmem)for(c=nb.endmem;a>c;c++)Bb[c]=0;nb.endmem=a}}function Ya(){if(nb.protectstart>=nb.protectend)return null;for(var a=nb.protectend-nb.protectstart,b={start:nb.protectstart,end:nb.protectend,len:a},c=Bb.slice(nb.protectstart,nb.protectend);c.length<a;)c.push(0);return b.mem=c,b}function Za(a){if(a){var b,c,d=a.mem,e=a.start,f=a.end;for(f>nb.endmem&&(f=nb.endmem),b=0,c=e;f>c;b++,c++)Bb[c]=d[b]}}function $a(){var a,b,c,d=Db.length;if(256>d||0!=(255&d))return 1;if(d!=h(Db,12))return 1;for(c=h(Db,32),b=-c>>>0,a=0;d>a;a+=4)b=b+h(Db,a)>>>0;return b!=c?1:0}function _a(){return Eb}function ab(){return nb}function bb(){var a={game_image_length:Db.length,total_execution_time:Xb,total_function_calls:Yb,accel_function_calls:Zb,total_path_calls:$b,paths_cached:_b,paths_compiled:ac,strings_cached:bc,strings_compiled:cc};return a}function cb(){Ub=0,Vb=[],Wb=[]}function db(){return Vb.length>0}function eb(){return Ub}function fb(a,b){this.addr=a,this.size=b,this.end=a+b}function gb(a,b){for(var c=0,d=a.length;d>c;){var e=c+d>>1;a[e].addr<b?c=e+1:d=e}return c}function hb(a){db()||(Ub=nb.endmem);for(var b=0,c=Wb.length;c>b;b++){var d=Wb[b];if(d.size>=a){d.size>a?Wb[b]=new fb(d.addr+a,d.size-a):Wb.splice(b,1);var e=gb(Vb,d.addr);return Vb.splice(e,0,new fb(d.addr,a)),d.addr}}var f=nb.endmem,g=a+255&4294967040;return Xa(nb.endmem+g,!0),g>a&&Wb.push(new fb(f+a,g-a)),Vb.push(new fb(f,a)),f}function ib(a){var b=gb(Vb,a),c=Vb[b];if(c&&c.addr==a||L("Tried to free non-existent block"),Vb.splice(b,1),0==Vb.length)return Xa(Ub,!0),void cb();b=gb(Wb,a);var d=Wb[b];d&&d.addr==c.end&&(c=new fb(a,c.size+d.size),Wb.splice(b,1));var e=Wb[b-1];e&&e.end==c.addr&&(c=new fb(e.addr,e.size+c.size),Wb.splice(b-1,1),b-=1),Wb.splice(b,0,c)}function jb(){if(!db())return 0!=Ub&&L("Heap inconsistency: heapstart nonzero"),Vb.length>0&&L("Heap inconsistency: usedlist nonempty"),void(Wb.length>0&&L("Heap inconsistency: usedlist nonempty"));0==Ub&&L("Heap inconsistency: heapstart is zero");for(var a=Ub,b=0,c=0;b<Vb.length||c<Wb.length;){var d=Vb[b],e=Wb[c];d&&d.addr==a?(a+=d.size,b++):e&&e.addr==a?(a+=e.size,c++):L("Heap inconsistency: no block at address "+a)}a!=nb.endmem&&L("Heap inconsistency: overrun at end of heap")}function kb(){return dc}function lb(a){var b=GiLoad.find_data_chunk(a);if(b){var c,d,f,g=b.data;if(222==g[0]&&191==g[1]&&0==g[2]&&0==g[3]){g[4]<<8|g[5];for(d=6,c=!1;!c;){var h=g[d++];switch(h){case 0:case void 0:c=!0;break;case 1:g[d++];for(f=d;g[d];)d++;String.fromCharCode.apply(this,g.slice(f,d));for(d++,f=d;g[d];)d++;String.fromCharCode.apply(this,g.slice(f,d));d++;break;case 2:for(f=d;g[d];)d++;String.fromCharCode.apply(this,g.slice(f,d));d++;g.slice(d,d+4);d+=4;g.slice(d,d+4);d+=4;break;case 3:g[d++]<<8|g[d++];for(f=d;g[d];)d++;String.fromCharCode.apply(this,g.slice(f,d));d++;g.slice(d,d+4);d+=4;g.slice(d,d+4);d+=4;break;case 4:g[d++];for(f=d;g[d];)d++;var i=String.fromCharCode.apply(this,g.slice(f,d));d++;break;case 5:g[d++]<<8|g[d++];for(f=d;g[d];)d++;var i=String.fromCharCode.apply(this,g.slice(f,d));d++;break;case 6:g[d++]<<8|g[d++];for(f=d;g[d];)d++;var i=String.fromCharCode.apply(this,g.slice(f,d));d++;break;case 7:g[d++]<<8|g[d++];for(f=d;g[d];)d++;var i=String.fromCharCode.apply(this,g.slice(f,d));d++;break;case 8:g[d++]<<8|g[d++];for(f=d;g[d];)d++;var i=String.fromCharCode.apply(this,g.slice(f,d));d++;break;case 9:d+=64;break;case 10:var j=g[d++]<<8|g[d++],k=g[d++]<<8|g[d++];d+=6*k;break;case 11:var j=g[d++]<<8|g[d++];g.slice(d,d+4);d+=4;var l=g[d++]<<16|g[d++]<<8|g[d++];for(f=d;g[d];)d++;var m=String.fromCharCode.apply(this,g.slice(f,d));d++;for(var n=[];g[d];){for(f=d;g[d];)d++;var o=String.fromCharCode.apply(this,g.slice(f,d));d++,n.push(o)}d++,dc.functions.push({num:j,name:m,addr:l,locals:n});break;case 12:g[d++]<<8|g[d++];for(f=d;g[d];)d++;var i=String.fromCharCode.apply(this,g.slice(f,d));d++;break;case 13:for(;g[d];){for(f=d;g[d];)d++;var i=String.fromCharCode.apply(this,g.slice(f,d));d++;var p=g[d++]<<16|g[d++]<<8|g[d++];dc.map[i]=p}d++;break;case 14:var j=g[d++]<<8|g[d++];g.slice(d,d+4);d+=4;g[d++]<<16|g[d++]<<8|g[d++];break;default:e("Unknown record type in debug data: "+h),c=!0}}var q=dc.map["code area"];if(q){var r;for(r=0;r<dc.functions.length;r++){var s=dc.functions[r];dc.functionmap[q+s.addr]=s}}}}}function mb(){var a,b,c,d,f;for(nb.resumefuncop&&(qa(nb.resumefuncop,nb.resumevalue),nb.resumefuncop=null,nb.resumevalue=0),d=(new Date).getTime();!nb.done_executing;){a=nb.frame.vmfunc,b=a[nb.iosysmode],c=b[nb.pc],void 0===c&&(a.pathaddrs[nb.pc]=!0,c=ka(a,nb.pc,nb.iosysmode),ac++,nb.pc<Mb&&(b[nb.pc]=c,_b++)),$b++;var g=c(nb);g===nb.VMStopped&&(nb.done_executing=!0,nb.vm_stopped=!0)}f=(new Date).getTime(),Xb+=(f-d)/1e3,nb.vm_stopped&&Glk.glk_exit(),Glk.update(),e("### done executing; path time = "+(f-d)+" ms")}var nb={};void 0===Math.imul&&(e("Polyfilling Math.imul()."),Math.imul=function(a,b){var c=a>>>16&65535,d=65535&a,e=b>>>16&65535,f=65535&b;return d*f+(c*f+d*e<<16>>>0)|0});var ob=Array(256),pb=Array(256);nb.Mem1=k,nb.Mem2=l,nb.Mem4=m,nb.MemSlice=n,nb.MemW1=o,nb.MemW2=p,nb.MemW4=q;var qb=/[^a-zA-Z0-9 .,;:?!=_+()-]/g;nb.fatal_error=L;var rb=null;nb.funcop_cache={};var sb={0:function(a,b){},16:function(a,b){a.code.push(b[2]+"(("+b[0]+")+("+b[1]+")) >>>0);")},17:function(a,b){a.code.push(b[2]+"(("+b[0]+")-("+b[1]+")) >>>0);")},18:function(a,b){var c=$(a,b[0]),d=$(a,b[1]);a.code.push(b[2]+"(Math.imul(("+c+"),("+d+"))) >>>0);")},19:function(a,b){var c=$(a,b[0]),d=$(a,b[1]),e=ba(a);a.code.push(e+"=(("+c+")/("+d+"));"),a.code.push("if (!isFinite("+e+")) self.fatal_error('Division by zero.');"),a.code.push(b[2]+"("+e+">=0)?Math.floor("+e+"):(-Math.floor(-"+e+") >>>0));")},20:function(a,b){var c=$(a,b[0]),d=$(a,b[1]),e=ba(a);a.code.push(e+"=(("+c+")%("+d+"));"),a.code.push("if (!isFinite("+e+")) self.fatal_error('Modulo division by zero.');"),a.code.push(b[2]+e+" >>>0);")},21:function(a,b){a.code.push(b[1]+"(-("+b[0]+")) >>>0);")},24:function(a,b){a.code.push(b[2]+"(("+b[0]+")&("+b[1]+")) >>>0);")},25:function(a,b){a.code.push(b[2]+"(("+b[0]+")|("+b[1]+")) >>>0);")},26:function(a,b){a.code.push(b[2]+"(("+b[0]+")^("+b[1]+")) >>>0);")},27:function(a,b){a.code.push(b[1]+"(~("+b[0]+")) >>>0);")},28:function(a,b){if(ga(b[1])){var c=Number(b[1]);32>c?a.code.push(b[2]+"(("+b[0]+")<<"+c+") >>>0);"):a.code.push(b[2]+"0);")}else a.code.push(b[2]+"("+b[1]+"<32) ? (("+b[0]+"<<"+b[1]+") >>>0) : 0);")},29:function(a,b){if(ga(b[1])){var c=Number(b[1]);32>c?a.code.push(b[2]+"(("+b[0]+")>>"+c+") >>>0);"):a.code.push(b[2]+"(("+b[0]+")&0x80000000) ? 0xffffffff : 0);")}else a.code.push("if ("+b[0]+" & 0x80000000) {"),a.code.push(b[2]+"("+b[1]+"<32) ? (("+b[0]+">>"+b[1]+") >>>0) : 0xffffffff);"),a.code.push("} else {"),a.code.push(b[2]+"("+b[1]+"<32) ? (("+b[0]+">>"+b[1]+") >>>0) : 0);"),a.code.push("}")},30:function(a,b){if(ga(b[1])){var c=Number(b[1]);32>c?a.code.push(b[2]+"("+b[0]+")>>>"+c+");"):a.code.push(b[2]+"0);")}else a.code.push(b[2]+"("+b[1]+"<32) ? ("+b[0]+">>>"+b[1]+") : 0);")},32:function(a,b){aa(a,b[0],!0),a.path_ends=!0},260:function(a,b){if(ga(b[0])){var c=Number(b[0]);a.code.push("self.pc = "+c+";"),a.vmfunc.pathaddrs[c]=!0}else a.code.push("self.pc = "+b[0]+";");Y(a),a.code.push("return;"),a.path_ends=!0},34:function(a,b){a.code.push("if (("+b[0]+")==0) {"),aa(a,b[1]),a.code.push("}")},35:function(a,b){a.code.push("if (("+b[0]+")!=0) {"),aa(a,b[1]),a.code.push("}")},36:function(a,b){a.code.push("if (("+b[0]+")==("+b[1]+")) {"),aa(a,b[2]),a.code.push("}")},37:function(a,b){a.code.push("if (("+b[0]+")!=("+b[1]+")) {"),aa(a,b[2]),a.code.push("}")},38:function(a,b){var c=$(a,b[0]),d=$(a,b[1]);a.code.push("if (("+c+")<("+d+")) {"),aa(a,b[2]),a.code.push("}")},39:function(a,b){var c=$(a,b[0]),d=$(a,b[1]);a.code.push("if (("+c+")>=("+d+")) {"),aa(a,b[2]),a.code.push("}")},40:function(a,b){var c=$(a,b[0]),d=$(a,b[1]);a.code.push("if (("+c+")>("+d+")) {"),aa(a,b[2]),a.code.push("}")},41:function(a,b){var c=$(a,b[0]),d=$(a,b[1]);a.code.push("if (("+c+")<=("+d+")) {"),aa(a,b[2]),a.code.push("}")},42:function(a,b){a.code.push("if (("+b[0]+")<("+b[1]+")) {"),aa(a,b[2]),a.code.push("}")},43:function(a,b){a.code.push("if (("+b[0]+")>=("+b[1]+")) {"),aa(a,b[2]),a.code.push("}")},44:function(a,b){a.code.push("if (("+b[0]+")>("+b[1]+")) {"),aa(a,b[2]),a.code.push("}")},45:function(a,b){a.code.push("if (("+b[0]+")<=("+b[1]+")) {"),aa(a,b[2]),a.code.push("}")},48:function(a,b){if(ga(b[1])){var c,d=Number(b[1]);for(c=0;d>c;c++)if(a.offstack.length){var e=ca(a);a.code.push("self.tempcallargs["+c+"]="+e+";")}else a.code.push("self.tempcallargs["+c+"]=self.frame.valstack.pop();");Y(a)}else a.varsused.ix=!0,Y(a),a.code.push("for (ix=0; ix<"+b[1]+"; ix++) { self.tempcallargs[ix]=self.frame.valstack.pop(); }");W(a,b[2]),a.code.push("self.enter_function("+b[0]+", "+b[1]+");"),a.code.push("return;"),a.path_ends=!0},52:function(a,b){if(ga(b[1])){var c,d=Number(b[1]);for(c=0;d>c;c++)if(a.offstack.length){var e=ca(a);a.code.push("self.tempcallargs["+c+"]="+e+";")}else a.code.push("self.tempcallargs["+c+"]=self.frame.valstack.pop();");Y(a)}else a.varsused.ix=!0,Y(a),a.code.push("for (ix=0; ix<"+b[1]+"; ix++) { self.tempcallargs[ix]=self.frame.valstack.pop(); }");a.code.push("if (self.leave_function()) return self.VMStopped;"),a.code.push("self.enter_function("+b[0]+", "+b[1]+");"),a.code.push("return;"),a.path_ends=!0},352:function(a,b){Y(a),W(a,b[1]),a.code.push("self.enter_function("+b[0]+", 0);"),a.code.push("return;"),a.path_ends=!0},353:function(a,b){Y(a),a.code.push("self.tempcallargs[0]=("+b[1]+");"),W(a,b[2]),a.code.push("self.enter_function("+b[0]+", 1);"),a.code.push("return;"),a.path_ends=!0},354:function(a,b){Y(a),a.code.push("self.tempcallargs[0]=("+b[1]+");"),a.code.push("self.tempcallargs[1]=("+b[2]+");"),W(a,b[3]),a.code.push("self.enter_function("+b[0]+", 2);"),a.code.push("return;"),a.path_ends=!0},355:function(a,b){Y(a),a.code.push("self.tempcallargs[0]=("+b[1]+");"),a.code.push("self.tempcallargs[1]=("+b[2]+");"),a.code.push("self.tempcallargs[2]=("+b[3]+");"),W(a,b[4]),a.code.push("self.enter_function("+b[0]+", 3);"),a.code.push("return;"),a.path_ends=!0},49:function(a,b){a.code.push("// quashing offstack for return: "+a.offstack.length),a.offstack.length=0,a.offloc.length=0,a.offlocdirty.length=0,a.code.push("if (self.leave_function()) return self.VMStopped;"),a.code.push("self.pop_callstub("+b[0]+");"),a.code.push("return;"),a.path_ends=!0},50:function(a,b){Y(a),W(a,b[0]),a.code.push("self.store_operand("+b[0]+",self.frame.framestart+self.frame.framelen+4*self.frame.valstack.length);"),aa(a,b[1],!0),a.path_ends=!0},51:function(a,b){a.code.push("// quashing offstack for throw: "+a.offstack.length),a.offstack.length=0,a.offloc.length=0,a.offlocdirty.length=0,a.code.push("self.pop_stack_to("+b[1]+");"),a.code.push("self.pop_callstub("+b[0]+");"),a.code.push("return;"),a.path_ends=!0},64:function(a,b){V(a,b[1],b[0])},65:function(a,b){V(a,b[1],b[0])},66:function(a,b){V(a,b[1],b[0])},68:function(a,b){var c;ga(b[0])?(c=Number(b[0]),c=32768&c?(4294901760|c)>>>0:65535&c,a.code.push(b[1]+c+");")):a.code.push(b[1]+"("+b[0]+" & 0x8000) ? (("+b[0]+" | 0xffff0000) >>> 0) : ("+b[0]+" & 0xffff));")},69:function(a,b){var c;ga(b[0])?(c=Number(b[0]),c=128&c?(4294967040|c)>>>0:255&c,a.code.push(b[1]+c+");")):a.code.push(b[1]+"("+b[0]+" & 0x80) ? (("+b[0]+" | 0xffffff00) >>> 0) : ("+b[0]+" & 0xff));")},72:function(a,b){var c,d;if(ga(b[1]))if(ga(b[0]))d=Number(b[0])+4*Number(b[1]),c="self.Mem4("+(d>>>0)+")";else{var d=4*Number(b[1]);c=d?"self.Mem4(("+b[0]+"+"+d+") >>>0)":"self.Mem4("+b[0]+")"}else c="self.Mem4(("+b[0]+"+4*"+b[1]+") >>>0)";a.code.push(b[2]+c+");")},73:function(a,b){var c,d;if(ga(b[1]))if(ga(b[0]))d=Number(b[0])+2*Number(b[1]),c="self.Mem2("+(d>>>0)+")";else{var d=2*Number(b[1]);c=d?"self.Mem2(("+b[0]+"+"+d+") >>>0)":"self.Mem2("+b[0]+")"}else c="self.Mem2(("+b[0]+"+2*"+b[1]+") >>>0)";a.code.push(b[2]+c+");")},74:function(a,b){var c,d;if(ga(b[1]))if(ga(b[0]))d=Number(b[0])+Number(b[1]),c="self.Mem1("+(d>>>0)+")";else{var d=Number(b[1]);c=d?"self.Mem1(("+b[0]+"+"+d+") >>>0)":"self.Mem1("+b[0]+")"}else c="self.Mem1(("+b[0]+"+"+b[1]+") >>>0)";a.code.push(b[2]+c+");")},76:function(a,b){var c,d;if(ga(b[1]))if(ga(b[0]))d=Number(b[0])+4*Number(b[1]),c=(d>>>0)+",";else{var d=4*Number(b[1]);c=d?"("+b[0]+"+"+d+") >>>0,":b[0]+","}else c="("+b[0]+"+4*"+b[1]+") >>>0,";a.code.push("self.MemW4("+c+b[2]+");")},77:function(a,b){var c,d;if(ga(b[1]))if(ga(b[0]))d=Number(b[0])+2*Number(b[1]),c=(d>>>0)+",";else{var d=2*Number(b[1]);c=d?"("+b[0]+"+"+d+") >>>0,":b[0]+","}else c="("+b[0]+"+2*"+b[1]+") >>>0,";a.code.push("self.MemW2("+c+b[2]+");")},78:function(a,b){var c,d;if(ga(b[1]))if(ga(b[0]))d=Number(b[0])+Number(b[1]),c=(d>>>0)+",";else{var d=Number(b[1]);c=d?"("+b[0]+"+"+d+") >>>0,":b[0]+","}else c="("+b[0]+"+"+b[1]+") >>>0,";a.code.push("self.MemW1("+c+b[2]+");")},75:function(a,b){if(ga(b[1])){var c,d,e;e=4294967295&Number(b[1]),c=7&e,ga(b[0])?(d=Number(b[0]),e>=0?d+=e>>3:d-=1+(-1-e>>3)):d=e>=0?7>=e?b[0]:b[0]+"+"+(e>>3):b[0]+"-"+(1+(-1-e>>3)),a.code.push(b[2]+"(self.Mem1("+d+") & "+(1<<c)+")?1:0);")}else{a.varsused.bitx=!0,a.varsused.addrx=!0;var f=$(a,b[1],!0);a.code.push("bitx = "+f+"&7;"),a.code.push("if ("+f+">=0) addrx = "+b[0]+" + ("+f+">>3);"),a.code.push("else addrx = "+b[0]+" - (1+((-1-("+f+"))>>3));"),a.code.push(b[2]+"(self.Mem1(addrx) & (1<<bitx))?1:0);")}},79:function(a,b){var c,d,e,f;if(ga(b[1]))f=4294967295&Number(b[1]),c=7&f,ga(b[0])?(d=Number(b[0]),f>=0?d+=f>>3:d-=1+(-1-f>>3)):d=f>=0?7>=f?b[0]:b[0]+"+"+(f>>3):b[0]+"-"+(1+(-1-f>>3)),e=1<<c;else{a.varsused.bitx=!0,a.varsused.addrx=!0;var g=$(a,b[1],!0);a.code.push("bitx = "+g+"&7;"),a.code.push("if ("+g+">=0) addrx = "+b[0]+" + ("+g+">>3);"),a.code.push("else addrx = "+b[0]+" - (1+((-1-("+g+"))>>3));"),d="addrx",e="(1<<bitx)"}ga(b[2])?Number(b[2])?a.code.push("self.MemW1("+d+", self.Mem1("+d+") | "+e+");"):a.code.push("self.MemW1("+d+", self.Mem1("+d+") & ~("+e+"));"):(a.code.push("if ("+b[2]+") self.MemW1("+d+", self.Mem1("+d+") | "+e+");"),a.code.push("else self.MemW1("+d+", self.Mem1("+d+") & ~("+e+"));"))},80:function(a,b){var c,d=a.offstack.length;c=d?"self.frame.valstack.length+"+d:"self.frame.valstack.length",V(a,b[0],c)},81:function(a,b){var c;if(ga(b[0])){var d=Number(b[0]);c=d<a.offstack.length?a.offstack[a.offstack.length-(d+1)]:"self.frame.valstack[self.frame.valstack.length-"+(d+1-a.offstack.length)+"]"}else Y(a),c="self.frame.valstack[self.frame.valstack.length-("+b[0]+"+1)]";V(a,b[1],c)},82:function(a,b){var c,d;a.offstack.length<2&&fa(a,2),d=a.offstack.length,c=a.offstack[d-1],a.offstack[d-1]=a.offstack[d-2],a.offstack[d-2]=c},83:function(a,b){Y(a),a.varsused.ix=!0,a.varsused.pos=!0,a.varsused.roll=!0,a.varsused.vals1=!0;var c=$(a,b[0],!0),d=$(a,b[1],!0);a.code.push("if ("+c+" > 0) {"),a.code.push("if ("+d+" > 0) {"),a.code.push("vals1 = "+d+" % "+c+";"),a.code.push("} else {"),a.code.push("vals1 = "+c+" - (-("+d+")) % "+c+";"),a.code.push("}"),a.code.push("if (vals1) {"),a.code.push("pos = self.frame.valstack.length - "+c+";"),a.code.push("roll = self.frame.valstack.slice(self.frame.valstack.length-vals1, self.frame.valstack.length).concat(self.frame.valstack.slice(pos, self.frame.valstack.length-vals1));"),a.code.push("for (ix=0; ix<"+c+"; ix++) { self.frame.valstack[pos+ix] = roll[ix]; }"),a.code.push("roll = undefined;"),a.code.push("}"),a.code.push("}")},84:function(a,b){if(Y(a),ga(b[0])){var c,d,e=Number(b[0]);for(c=0;e>c;c++)d=ba(a,!0),a.offstack.push(d),a.code.push(d+"=self.frame.valstack[self.frame.valstack.length-"+(e-c)+"];")}else a.varsused.ix=!0,a.varsused.jx=!0,a.code.push("jx = self.frame.valstack.length-("+b[0]+");"),a.code.push("for (ix=0; ix<"+b[0]+"; ix++) { self.frame.valstack.push(self.frame.valstack[jx+ix]); }")},256:function(a,b){var c="self.do_gestalt(("+b[0]+"),("+b[1]+"))";a.code.push(b[2]+c+");")},257:function(a,b){a.code.push("self.fatal_error('User debugtrap encountered.', "+b[0]+");")},258:function(a,b){a.code.push(b[0]+"self.endmem);")},259:function(a,b){a.code.push("self.change_memsize("+b[0]+",false);"),a.code.push(b[1]+"0);")},272:function(a,b){var c;if(ga(b[0])){var d=4294967295&Number(b[0]);c=0==d?"(Math.floor(self.random_func() * 0x10000) | (Math.floor(self.random_func() * 0x10000) << 16)) >>>0":d>0?"Math.floor(self.random_func() * "+d+")":"-Math.floor(self.random_func() * "+-d+")"}else{var e=$(a,b[0],!0),f=ba(a);c=f,a.code.push("if ("+e+" > 0)"),a.code.push(f+" = Math.floor(self.random_func() * "+e+");"),a.code.push("else if ("+e+" < 0)"),a.code.push(f+" = -Math.floor(self.random_func() * -"+e+");"),a.code.push("else"),a.code.push(f+" = (Math.floor(self.random_func() * 0x10000) | (Math.floor(self.random_func() * 0x10000) << 16)) >>>0;")}a.code.push(b[1]+c+");")},273:function(a,b){a.code.push("self.set_random("+b[0]+");")},288:function(a,b){a.code.push("// quashing offstack for quit: "+a.offstack.length),a.offstack.length=0,a.offloc.length=0,a.offlocdirty.length=0,a.code.push("return self.VMStopped;"),a.path_ends=!0},289:function(a,b){a.code.push(b[0]+"self.perform_verify());")},290:function(a,b){a.code.push("// quashing offstack for quit: "+a.offstack.length),a.offstack.length=0,a.offloc.length=0,a.offlocdirty.length=0,a.code.push("self.vm_restart();"),a.code.push("return;"),a.path_ends=!0},291:function(a,b){Y(a),a.varsused.ix=!0,W(a,b[1]),a.code.push("ix = self.vm_save("+b[0]+");"),a.code.push("self.pop_callstub(ix ? 0 : 1);"),a.code.push("return;"),a.path_ends=!0},292:function(a,b){Y(a),a.code.push("if (self.vm_restore("+b[0]+")) {"),a.code.push("self.pop_callstub((-1)>>>0);"),a.code.push("} else {"),V(a,b[1],"1"),Y(a),a.code.push("self.pc = "+a.cp+";"),a.code.push("}"),a.code.push("return;"),a.path_ends=!0},293:function(a,b){Y(a),W(a,b[0]),a.code.push("self.vm_saveundo();"),a.code.push("self.pop_callstub(0);"),a.code.push("return;"),a.path_ends=!0},294:function(a,b){Y(a),a.code.push("if (self.vm_restoreundo()) {"),a.code.push("self.pop_callstub((-1)>>>0);"),a.code.push("} else {"),V(a,b[0],"1"),Y(a),a.code.push("self.pc = "+a.cp+";"),a.code.push("}"),a.code.push("return;"),a.path_ends=!0},295:function(a,b){a.code.push("self.protectstart="+b[0]+";"),a.code.push("self.protectend=self.protectstart+("+b[1]+");"),a.code.push("if (self.protectstart==self.protectend) {"),a.code.push("  self.protectstart=0; self.protectend=0;"),a.code.push("}")},368:function(a,b){a.varsused.maddr=!0,a.varsused.mlen=!0,a.varsused.ix=!0,a.code.push("mlen="+b[0]+";"),a.code.push("maddr="+b[1]+";"),a.code.push("for (ix=0; ix<mlen; ix++, maddr++) self.MemW1(maddr, 0);")},369:function(a,b){a.varsused.msrc=!0,a.varsused.mdest=!0,a.varsused.mlen=!0,a.varsused.ix=!0,a.code.push("mlen="+b[0]+";"),a.code.push("msrc="+b[1]+";"),a.code.push("mdest="+b[2]+";"),a.code.push("if (mdest < msrc) {"),a.code.push("for (ix=0; ix<mlen; ix++, msrc++, mdest++) self.MemW1(mdest, self.Mem1(msrc));"),a.code.push("} else {"),a.code.push("msrc += (mlen-1); mdest += (mlen-1);"),a.code.push("for (ix=0; ix<mlen; ix++, msrc--, mdest--) self.MemW1(mdest, self.Mem1(msrc));"),a.code.push("}")},376:function(a,b){var c="self.heap_malloc("+b[0]+")";a.code.push(b[1]+c+");"),a.code.push("self.assert_heap_valid();")},377:function(a,b){a.code.push("self.heap_free("+b[0]+");"),a.code.push("self.assert_heap_valid();")},384:function(a,b){a.code.push("self.accel_funcnum_map["+b[1]+"] = "+b[0]+";"),a.code.push("self.accel_address_map["+b[1]+"] = self.accel_func_map["+b[0]+"];")},385:function(a,b){a.code.push("if ("+b[0]+" < 9) {"),a.code.push("  self.accel_params["+b[0]+"] = "+b[1]+";"),a.code.push("}")},336:function(a,b){var c="self.linear_search(("+b[0]+"),("+b[1]+"),("+b[2]+"),("+b[3]+"),("+b[4]+"),("+b[5]+"),("+b[6]+"))";a.code.push(b[7]+c+");")},337:function(a,b){var c="self.binary_search(("+b[0]+"),("+b[1]+"),("+b[2]+"),("+b[3]+"),("+b[4]+"),("+b[5]+"),("+b[6]+"))";a.code.push(b[7]+c+");")},338:function(a,b){var c="self.linked_search(("+b[0]+"),("+b[1]+"),("+b[2]+"),("+b[3]+"),("+b[4]+"),("+b[5]+"))";a.code.push(b[6]+c+");")},112:function(a,b){switch(a.curiosys){case 2:if(ga(b[0])){var c=255&Number(b[0]);a.code.push("Glk.glk_put_char("+c+");")}else a.code.push("Glk.glk_put_char(("+b[0]+")&0xff);");break;case 1:Y(a),a.code.push("self.tempcallargs[0]=(("+b[0]+")&0xff);"),W(a,"0,0"),a.code.push("self.enter_function(self.iosysrock, 1);"),a.code.push("return;"),a.path_ends=!0;break;case 0:a.code.push("// null streamchar "+b[0])}},113:function(a,b){switch(a.curiosys){case 2:var c=$(a,b[0]);if(ga(b[0])){var d=Number(c).toString(10);a.code.push("Glk.glk_put_jstring("+K(d)+", true);")}else a.code.push("Glk.glk_put_jstring(("+c+").toString(10), true);");break;case 1:Y(a),a.code.push("self.stream_num("+a.cp+","+b[0]+", false, 0);"),a.code.push("return;"),a.path_ends=!0;break;case 0:a.code.push("// null streamnum "+b[0])}},114:function(a,b){Y(a),a.code.push("if (self.stream_string("+a.cp+","+b[0]+", 0, 0)) return;")},115:function(a,b){switch(a.curiosys){case 2:if(ga(b[0])){var c=Number(b[0]);a.code.push("Glk.glk_put_char_uni("+c+");")}else a.code.push("Glk.glk_put_char_uni("+b[0]+");");break;case 1:Y(a),a.code.push("self.tempcallargs[0]=("+b[0]+");"),W(a,"0,0"),a.code.push("self.enter_function(self.iosysrock, 1);"),a.code.push("return;"),a.path_ends=!0;break;case 0:a.code.push("// null streamchar "+b[0])}},320:function(a,b){a.code.push(b[0]+"self.stringtable)")},321:function(a,b){a.code.push("self.set_string_table("+b[0]+");")},328:function(a,b){a.code.push(b[0]+"self.iosysmode)"),a.code.push(b[1]+"self.iosysrock)")},329:function(a,b){if(a.code.push("self.set_iosys("+b[0]+","+b[1]+");"),ga(b[0])){var c=Number(b[0]);a.curiosys=c}else Y(a),a.code.push("self.pc = "+a.cp+";"),a.code.push("return;"),a.path_ends=!0},400:function(a,b){var c=$(a,b[0]);if(ga(b[0])){var d=Number(c);a.code.push(b[1]+Ka(d)+");")}else a.code.push(b[1]+"self.encode_float("+c+"));")},401:function(a,b){a.varsused.valf=!0,a.varsused.res=!0,a.code.push("valf = "+_(a,b[0])+";"),a.code.push("if (!("+b[0]+" & 0x80000000)) {"),a.code.push("  if (isNaN(valf) || !isFinite(valf) || (valf > 0x7fffffff))"),a.code.push("    res = 0x7fffffff;"),a.code.push("  else"),a.code.push("    res = Math.floor(valf);"),a.code.push("} else {"),a.code.push("  if (isNaN(valf) || !isFinite(valf) || (valf < -0x80000000))"),a.code.push("    res = -0x80000000;"),a.code.push("  else"),a.code.push("    res = Math.ceil(valf);"),a.code.push("}"),a.code.push(b[1]+"res>>>0);")},402:function(a,b){a.varsused.valf=!0,a.varsused.res=!0,a.code.push("valf = "+_(a,b[0])+";"),a.code.push("if (!("+b[0]+" & 0x80000000)) {"),a.code.push("  if (isNaN(valf) || !isFinite(valf))"),a.code.push("    res = 0x7fffffff;"),a.code.push("  else"),a.code.push("    res = Math.round(valf);"),a.code.push("  if (res > 0x7fffffff) res = 0x7fffffff;"),a.code.push("} else {"),a.code.push("  if (isNaN(valf) || !isFinite(valf))"),a.code.push("    res = -0x80000000;"),a.code.push("  else"),a.code.push("    res = Math.round(valf);"),a.code.push("  if (res < -0x80000000) res = -0x80000000;"),a.code.push("}"),a.code.push(b[1]+"res>>>0);")},408:function(a,b){var c=_(a,b[0]);a.code.push(b[1]+"self.encode_float(Math.ceil("+c+")));")},409:function(a,b){var c=_(a,b[0]);a.code.push(b[1]+"self.encode_float(Math.floor("+c+")));")},416:function(a,b){var c=_(a,b[0]),d=_(a,b[1]);a.code.push(b[2]+"self.encode_float("+c+" + "+d+"));")},417:function(a,b){var c=_(a,b[0]),d=_(a,b[1]);a.code.push(b[2]+"self.encode_float("+c+" - "+d+"));")},418:function(a,b){var c=_(a,b[0]),d=_(a,b[1]);a.code.push(b[2]+"self.encode_float("+c+" * "+d+"));")},419:function(a,b){var c=_(a,b[0]),d=_(a,b[1]);a.code.push(b[2]+"self.encode_float("+c+" / "+d+"));")},420:function(a,b){var c=_(a,b[0],!0),d=_(a,b[1],!0);a.varsused.modv=!0,a.varsused.quov=!0,a.code.push("modv=("+c+" % "+d+");"),a.code.push("quov=self.encode_float(("+c+" - modv) / "+d+");"),a.code.push("if (quov == 0x0 || quov == 0x80000000) {"),a.code.push("  quov = (("+b[0]+" ^ "+b[1]+") & 0x80000000) >>>0;"),a.code.push("}"),a.code.push(b[2]+"self.encode_float(modv));"),a.code.push(b[3]+"quov);")},424:function(a,b){var c=_(a,b[0]);a.code.push(b[1]+"self.encode_float(Math.sqrt("+c+")));")},425:function(a,b){var c=_(a,b[0]);a.code.push(b[1]+"self.encode_float(Math.exp("+c+")));")},426:function(a,b){var c=_(a,b[0]);a.code.push(b[1]+"self.encode_float(Math.log("+c+")));")},427:function(a,b){a.varsused.valf=!0;var c=_(a,b[0],!0),d=_(a,b[1],!0);a.code.push("if ("+b[0]+" == 0x3f800000) {"),a.code.push("  valf = 0x3f800000;"),a.code.push("} else if ("+b[0]+" == 0xbf800000 && ("+b[1]+" == 0xff800000 || "+b[1]+" == 0x7f800000)) {"),a.code.push("  valf = 0x3f800000;"),a.code.push("} else {"),a.code.push("  valf=self.encode_float(Math.pow("+c+", "+d+"));"),a.code.push("}"),a.code.push(b[2]+"valf);")},432:function(a,b){var c=_(a,b[0]);a.code.push(b[1]+"self.encode_float(Math.sin("+c+")));")},433:function(a,b){var c=_(a,b[0]);a.code.push(b[1]+"self.encode_float(Math.cos("+c+")));")},434:function(a,b){var c=_(a,b[0]);a.code.push(b[1]+"self.encode_float(Math.tan("+c+")));")},435:function(a,b){var c=_(a,b[0]);a.code.push(b[1]+"self.encode_float(Math.asin("+c+")));")},436:function(a,b){var c=_(a,b[0]);a.code.push(b[1]+"self.encode_float(Math.acos("+c+")));")},437:function(a,b){var c=_(a,b[0]);a.code.push(b[1]+"self.encode_float(Math.atan("+c+")));")},438:function(a,b){var c=_(a,b[0]),d=_(a,b[1]);a.code.push(b[2]+"self.encode_float(Math.atan2("+c+", "+d+")));")},448:function(a,b){var c,d,e,f;a.varsused.fequal=!0,a.varsused.fdiff=!0,a.code.push("if (("+b[2]+" & 0x7f800000) == 0x7f800000 && ("+b[2]+" & 0x007fffff) != 0) {"),a.code.push("  fequal = 0;"),a.code.push("} else if (("+b[0]+" == 0xff800000 || "+b[0]+" == 0x7f800000) && ("+b[1]+" == 0xff800000 || "+b[1]+" == 0x7f800000)) {"),a.code.push("  fequal = ("+b[0]+" == "+b[1]+");"),a.code.push("} else {"),ga(b[2])?(c=Number(b[2]),f=""+Ja(2147483647&c)):(c="self.decode_float(("+b[2]+") & 0x7fffffff)",f=ba(a),a.code.push(f+"="+c+";")),d=_(a,b[0]),e=_(a,b[1]),a.code.push("  fdiff = "+e+" - "+d+";"),a.code.push("  fequal = (fdiff <= "+f+" && fdiff >= -("+f+"));"),a.code.push("}"),a.code.push("if (fequal) {"),aa(a,b[3]),a.code.push("}")},449:function(a,b){var c,d,e,f;a.varsused.fequal=!0,a.varsused.fdiff=!0,a.code.push("if (("+b[2]+" & 0x7f800000) == 0x7f800000 && ("+b[2]+" & 0x007fffff) != 0) {"),a.code.push("  fequal = 0;"),a.code.push("} else if (("+b[0]+" == 0xff800000 || "+b[0]+" == 0x7f800000) && ("+b[1]+" == 0xff800000 || "+b[1]+" == 0x7f800000)) {"),a.code.push("  fequal = ("+b[0]+" == "+b[1]+");"),a.code.push("} else {"),ga(b[2])?(c=Number(b[2]),f=""+Ja(2147483647&c)):(c="self.decode_float(("+b[2]+") & 0x7fffffff)",f=ba(a),a.code.push(f+"="+c+";")),d=_(a,b[0]),e=_(a,b[1]),a.code.push("  fdiff = "+e+" - "+d+";"),a.code.push("  fequal = (fdiff <= "+f+" && fdiff >= -("+f+"));"),a.code.push("}"),a.code.push("if (!fequal) {"),aa(a,b[3]),a.code.push("}")},450:function(a,b){valf0=_(a,b[0]),valf1=_(a,b[1]),a.code.push("if ("+valf0+" < "+valf1+") {"),aa(a,b[2]),a.code.push("}")},
451:function(a,b){valf0=_(a,b[0]),valf1=_(a,b[1]),a.code.push("if ("+valf0+" <= "+valf1+") {"),aa(a,b[2]),a.code.push("}")},452:function(a,b){valf0=_(a,b[0]),valf1=_(a,b[1]),a.code.push("if ("+valf0+" > "+valf1+") {"),aa(a,b[2]),a.code.push("}")},453:function(a,b){valf0=_(a,b[0]),valf1=_(a,b[1]),a.code.push("if ("+valf0+" >= "+valf1+") {"),aa(a,b[2]),a.code.push("}")},456:function(a,b){a.code.push("if (("+b[0]+" & 0x7f800000) == 0x7f800000 && ("+b[0]+" & 0x007fffff) != 0) {"),aa(a,b[1]),a.code.push("}")},457:function(a,b){a.code.push("if ("+b[0]+" == 0xff800000 || "+b[0]+" == 0x7f800000) {"),aa(a,b[1]),a.code.push("}")},304:function(a,b){var c;if(c=ga(b[0])?Glk.call_may_not_return(Number(b[0])):!0,c&&(a.code.push("  self.prevpc = "+a.prevcp+";"),a.code.push("  self.pc = "+a.cp+";")),a.code.push("self.tempglkargs.length = "+b[1]+";"),ga(b[1])){var d,e=Number(b[1]);for(d=0;e>d;d++)if(a.offstack.length){var f=ca(a);a.code.push("self.tempglkargs["+d+"]="+f+";")}else a.code.push("self.tempglkargs["+d+"]=self.frame.valstack.pop();");Y(a)}else a.varsused.ix=!0,Y(a),a.code.push("for (ix=0; ix<"+b[1]+"; ix++) { self.tempglkargs[ix]=self.frame.valstack.pop(); }");a.varsused.glkret=!0,a.code.push("glkret = GiDispa.get_function("+b[0]+")(self.tempglkargs);"),c&&(a.code.push("if (glkret === Glk.DidNotReturn) {"),a.code.push("  self.resumefuncop = "+U(b[2])+";"),a.code.push("  self.resumevalue = 0;"),a.code.push("  self.pc = "+a.cp+";"),a.code.push("  self.done_executing = true;"),a.code.push("  return;"),a.code.push("}")),V(a,b[2],"glkret")}};nb.enter_function=la,nb.leave_function=ma,nb.pop_stack_to=na,nb.pop_callstub=oa,nb.store_operand=pa,nb.set_random=sa;var tb,ub,vb=void 0,wb={},xb={};nb.accel_address_map=wb,nb.accel_funcnum_map=xb;var yb=[0,0,0,0,0,0,0,0,0];nb.accel_params=yb;var zb={1:function(a,b){if(1>a)return 0;var c=b[0];if(36>c)return 0;if(c>=nb.endmem)return 0;var d=k(c);return d>=224?3:d>=192?2:d>=112&&127>=d&&c>=Mb?1:0},2:function(a,b){var c=a>0?b[0]:0,d=a>1?b[1]:0;if(1!=zb[1](a,b))return Glk.glk_put_jstring('\n[** Programming error: tried to find the "." of (something) **]\n'),0;var e=m(c+16);if(!e)return 0;var f=m(e);return e+=4,Ha(d,2,e,10,f,0,0)},3:function(a,b){var c=a>0?b[0]:0,d=a>1?b[1]:0,e=wa(c,d);return 0==e?0:m(e+4)},4:function(a,b){var c=a>0?b[0]:0,d=a>1?b[1]:0,e=wa(c,d);return 0==e?0:4*l(e+2)},5:function(a,b){var c,d,e,f,g,h=a>0?b[0]:0,i=a>1?b[1]:0;if(c=zb[1](a,b),3==c)return i==yb[5]?1:0;if(2==c)return i==yb[4]?1:0;if(1!=c)return 0;if(i==yb[2])return va(h)?1:h==yb[2]?1:h==yb[5]?1:h==yb[4]?1:h==yb[3]?1:0;if(i==yb[3])return va(h)?0:h==yb[2]?0:h==yb[5]?0:h==yb[4]?0:h==yb[3]?0:1;if(i==yb[5]||i==yb[4])return 0;if(!va(i))return Glk.glk_put_jstring("\n[** Programming error: tried to apply 'ofclass' with non-class **]\n"),0;if(d=wa(h,2),0==d)return 0;if(e=m(d+4),0==e)return 0;for(f=l(d+2),g=0;f>g;g++)if(m(e+4*g)==i)return 1;return 0},6:function(a,b){var c,d=a>1?b[1]:0;return c=zb[3](a,b),0==c?d>0&&d<yb[1]?m(yb[8]+4*d):(Glk.glk_put_jstring("\n[** Programming error: tried to read (something) **]\n"),0):m(c)},7:function(a,b){var c=a>0?b[0]:0,d=a>1?b[1]:0,e=yb[1],f=zb[1](a,b);return 3==f?d==e+6?1:d==e+7?1:0:2==f?d==e+5?1:0:1!=f?0:d>=e&&e+8>d&&va(c)?1:zb[3](a,b)?1:0},8:function(a,b){var c=a>0?b[0]:0,d=a>1?b[1]:0;if(1!=zb[1](a,b))return Glk.glk_put_jstring('\n[** Programming error: tried to find the "." of (something) **]\n'),0;var e=m(c+4*(3+(yb[7]>>2)));if(!e)return 0;var f=m(e);return e+=4,Ha(d,2,e,10,f,0,0)},9:function(a,b){var c=a>0?b[0]:0,d=a>1?b[1]:0,e=xa(c,d);return 0==e?0:m(e+4)},10:function(a,b){var c=a>0?b[0]:0,d=a>1?b[1]:0,e=xa(c,d);return 0==e?0:4*l(e+2)},11:function(a,b){var c,d,e,f,g,h=a>0?b[0]:0,i=a>1?b[1]:0;if(c=zb[1](a,b),3==c)return i==yb[5]?1:0;if(2==c)return i==yb[4]?1:0;if(1!=c)return 0;if(i==yb[2])return va(h)?1:h==yb[2]?1:h==yb[5]?1:h==yb[4]?1:h==yb[3]?1:0;if(i==yb[3])return va(h)?0:h==yb[2]?0:h==yb[5]?0:h==yb[4]?0:h==yb[3]?0:1;if(i==yb[5]||i==yb[4])return 0;if(!va(i))return Glk.glk_put_jstring("\n[** Programming error: tried to apply 'ofclass' with non-class **]\n"),0;if(d=xa(h,2),0==d)return 0;if(e=m(d+4),0==e)return 0;for(f=l(d+2),g=0;f>g;g++)if(m(e+4*g)==i)return 1;return 0},12:function(a,b){var c,d=a>1?b[1]:0;return c=zb[9](a,b),0==c?d>0&&d<yb[1]?m(yb[8]+4*d):(Glk.glk_put_jstring("\n[** Programming error: tried to read (something) **]\n"),0):m(c)},13:function(a,b){var c=a>0?b[0]:0,d=a>1?b[1]:0,e=yb[1],f=zb[1](a,b);return 3==f?d==e+6?1:d==e+7?1:0:2==f?d==e+5?1:0:1!=f?0:d>=e&&e+8>d&&va(c)?1:zb[9](a,b)?1:0}};nb.accel_func_map=zb;var Ab=[0,0];nb.set_string_table=ya,nb.set_iosys=za,nb.stream_num=Ba,nb.stream_string=Ca,nb.do_gestalt=Ea,nb.linear_search=Ga,nb.binary_search=Ha,nb.linked_search=Ia,nb.decode_float=Ja,nb.encode_float=Ka;var Bb,Cb,Db=null,Eb=null,Fb=null,Gb=null,Hb=null;nb.frame=null,nb.vm_started=!1,nb.vm_stopped=!1,nb.tempcallargs=null,nb.tempglkargs=null,nb.done_executing=null;var Ib,Jb,Kb,Lb;nb.random_func=null;var Mb,Nb,Ob,Pb,Qb,Rb,Sb;nb.pc=null,nb.stringtable=null,nb.endmem=null,nb.protectstart=null,nb.protectend=null,nb.iosysmode=null,nb.iosysrock=null,nb.prevpc=null;var Tb;nb.resumefuncop=null,nb.resumevalue=null;var Ub,Vb,Wb,Xb=0,Yb=0,Zb=0,$b=0,_b=0,ac=0,bc=0,cc=0;nb.vm_restart=Ma,nb.vm_save=Ra,nb.vm_restore=Sa,nb.vm_saveundo=Va,nb.vm_restoreundo=Wa,nb.change_memsize=Xa,nb.perform_verify=$a,nb.heap_malloc=hb,nb.heap_free=ib,nb.assert_heap_valid=jb;var dc={map:{},functions:[],functionmap:{}};return nb.VMStopped={dummy:"The top-level function has returned."},{version:"2.1.5",prepare:a,init:b,resume:c,get_signature:_a,get_vm_internals:ab,get_statistics:bb,get_debuginfo:kb,ReadByte:A,WriteByte:B,ReadWord:C,WriteWord:D,ReadStructField:E,WriteStructField:F,SetResumeStore:G,do_autosave:Ta}}(),GiDispa=function(){function a(a){E.VM=a}function b(a,b,c){this.id=a,this.name=b,this.proto=c}function c(a,b){this.args=a,this.retarg=b}function d(){this.macro="Byte",this.refsize=1,this.serialize=function(){return{type:"ArgString"}}}function e(){this.macro="Word",this.refsize=4,this.serialize=function(){return{type:"ArgUnicode"}}}function f(a){this.signed=a,this.macro="Byte",this.refsize=1,this.literal=a?"arg_char_signed":"arg_char_unsigned",this.serialize=function(){return{type:"ArgChar",signed:a}}}function g(a){this.signed=a,this.macro="Word",this.refsize=4,this.literal=a?"arg_int_signed":"arg_int_unsigned",this.serialize=function(){return{type:"ArgInt",signed:a}}}function h(a){this.name=a,this.macro="Word",this.refsize=4}function i(a){this.form=a}function j(a,b,c,d){this.arg=a,this.passin=b,this.passout=c,this.nonnull=d}function k(a,b,c,d,e){this.arg=a,this.retained=b,this.passin=c,this.passout=d,this.nonnull=e}function l(a){switch(a.type){case"ArgString":return new d;case"ArgUnicode":return new e;case"ArgInt":return a.signed?H:G;case"ArgChar":return null===a.signed?J:a.signed?K:I}throw new Error("arg_deserialize: unknown type: "+a.type)}function m(a,b,c){return a instanceof g?b?a.signed?c+" & 0xFFFFFFFF":c:"0":a instanceof f?b?a.signed?"self.cast_signed_char("+c+")":c+" & 0xFF":"0":a instanceof h?b?'self.class_obj_from_id("'+a.name+'", '+c+")":"null":"???"}function n(a,b){return a instanceof g?b+" >>> 0":a instanceof f?a.signed?"self.uncast_signed_char("+b+")":b+" & 0xFF":a instanceof h?'self.class_obj_to_id("'+a.name+'", '+b+")":"???"}function o(a){return a=255&a,128&a&&(a-=256),a}function p(a){return a=255&a,128&a&&(a+=4294967040),a}function q(a,b){return b?b.disprock:0}function r(a,b){return 0!=b&&b?X[a][b]:null}function s(a){var b,c,l,o,p,q,r,s,t,u,v,w,x,y,z=[],A={},B=0;for(z.push("// no local vars"),z.push("// "+a.id+": "+a.name),l=a.proto,o=null,l.retarg&&(o=l.retarg.arg),z.push("var self = this;"),y=Glk.call_may_not_return(a.id),p=0,q=[],b=0;b<l.args.length;b++)if(s=l.args[b],u="glka"+b,q.push(u),A[u]=!0,s instanceof g||s instanceof f||s instanceof h)v=m(s,!0,"callargs["+p+"]"),z.push(u+" = "+v+";"),p+=1;else if(s instanceof j){if(t=s.arg,z.push("if (callargs["+p+"] == 0) {"),s.nonnull?z.push('  throw new Error("glk '+a.name+': null argument");'):z.push("  "+u+" = null;"),z.push("} else {"),t instanceof g||t instanceof f||t instanceof h)z.push("  "+u+" = new Glk.RefBox();"),v=m(t,s.passin,"self.VM.ReadWord(callargs["+p+"])"),z.push("  "+u+".set_value("+v+");");else{if(!(t instanceof i))throw new Error("buildfunc: unsupported refarg type: "+a.name);for(r=t.form.args,z.push("  "+u+" = new Glk.RefStruct("+r.length+");"),c=0;c<r.length;c++)v=m(r[c],s.passin,"self.VM.ReadStructField(callargs["+p+"], "+c+")"),z.push("  "+u+".push_field("+v+");")}z.push("}"),p+=1}else if(s instanceof k)A.glklen=!0,t=s.arg,z.push("if (callargs["+p+"] == 0) {"),s.nonnull?z.push('  throw new Error("glk '+a.name+': null argument");'):z.push("  "+u+" = null;"),z.push("} else {"),z.push("  glklen = callargs["+(p+1)+"];"),z.push("  "+u+" = Array(glklen);"),s.passin&&(A.ix=!0,A.jx=!0,z.push("  for (ix=0, jx=callargs["+p+"]; ix<glklen; ix++, jx+="+t.refsize+") {"),v=m(t,!0,"self.VM.Read"+t.macro+"(jx)"),z.push("    "+u+"[ix] = "+v+";"),z.push("  }")),s.retained&&(0==B&&z.push("  self.temp_arg_arrays.length = 0;"),B+=1,z.push("  self.make_arg_array("+u+", callargs["+p+"], glklen, self."+t.literal+");")),z.push("}"),p+=2;else{if(!(s instanceof d||s instanceof e))throw new Error("buildfunc: unsupported arg type: "+a.name);A.ix=!0,A.jx=!0;var C,D;s instanceof d?(D="0xE0",C="byte_array_to_string"):(D="0xE2",C="uni_array_to_string"),z.push(u+" = Array();"),z.push("jx = callargs["+p+"];"),z.push("if (self.VM.ReadByte(jx) != "+D+') throw new Error("glk '+a.name+': string argument must be unencoded");'),z.push("for (jx+="+s.refsize+"; true; jx+="+s.refsize+") {"),z.push("  ix = self.VM.Read"+s.macro+"(jx);"),z.push("  if (ix == 0) break;"),z.push("  "+u+".push(ix);"),z.push("}"),z.push(u+" = Glk."+C+"("+u+");"),p+=1}for(z.push("if (callargs.length != "+p+') throw "glk '+a.name+': wrong number of arguments";'),o||y?(A.glkret=!0,w="glkret = "):w="",z.push(w+"Glk.glk_"+a.name+"("+q.join(", ")+");"),y&&(z.push("if (glkret === Glk.DidNotReturn) {"),z.push("  self.set_blocked_selector("+a.id+", callargs);"),z.push("  return glkret;"),z.push("}")),p=0,b=0;b<l.args.length;b++)if(s=l.args[b],u="glka"+b,s instanceof g||s instanceof f||s instanceof h)p+=1;else if(s instanceof j){if(t=s.arg,s.passout){if(z.push("if ("+u+") {"),t instanceof g||t instanceof f||t instanceof h)v=n(t,u+".get_value()"),z.push("  self.VM.WriteWord(callargs["+p+"], "+v+");");else{if(!(t instanceof i))throw new Error("buildfunc: unsupported refarg type: "+a.name);for(r=t.form.args,c=0;c<r.length;c++)v=n(r[c],u+".get_field("+c+")"),z.push("  self.VM.WriteStructField(callargs["+p+"], "+c+", "+v+");")}z.push("}")}p+=1}else if(s instanceof k)t=s.arg,s.passout&&!s.retained&&(z.push("if ("+u+") {"),A.ix=!0,A.jx=!0,z.push("  for (ix=0, jx=callargs["+p+"]; ix<glklen; ix++, jx+="+t.refsize+") {"),v=n(t,u+"[ix]"),z.push("    self.VM.Write"+t.macro+"(jx, "+v+")"),z.push("  }"),z.push("}")),p+=2;else{if(!(s instanceof d||s instanceof e))throw new Error("buildfunc: unsupported arg type: "+a.name);p+=1}0!=B&&z.push("self.temp_arg_arrays.length = 0;"),o?(v=n(o,"glkret"),z.push("return "+v+";")):z.push("return 0;"),x=[];for(v in A)x.push(v);x.length&&(z[0]="var "+x.join(", ")+";"),v=z.join("\n");var F=new Function("callargs",v);return F.bind(E)}function t(a){var b,c=Q[a];if(void 0===c){if(b=P[a],void 0===b)throw new Error("dispatch: unknown Glk function: "+a);c=s(b),Q[a]=c}return c}function u(a,b){R=a,S=b.slice(0)}function v(){return 192==R&&S&&S.length>0&&(2==T||3==T||4==T||8==T)?S[0]:null}function w(a){192==R?0!=S[0]&&(T=a.get_field(0)>>>0,E.VM.WriteStructField(S[0],0,a.get_field(0)>>>0),E.VM.WriteStructField(S[0],1,q("window",a.get_field(1))),E.VM.WriteStructField(S[0],2,a.get_field(2)>>>0),E.VM.WriteStructField(S[0],3,a.get_field(3)>>>0)):98==R&&E.VM.SetResumeStore(q("fileref",a)),R=null,S=null}function x(a,b,c,d){var e;a&&(e={arr:a,addr:b,len:c,arg:d},U.push(e))}function y(a,b){var c,d;if(a){if(void 0!==b){if(a!==b.arr)throw new Error("retain_array: array does not match useobj");if(d={addr:b.addr,len:b.len,arr:a,arg:l(b.arg)},d.len!=a.length)throw new Error("retain_array: array length from useobj does not match")}else for(d=void 0,c=0;c<U.length;c++)if(U[c].arr===a){d=U[c];break}if(void 0===d)throw new Error("retain_array: array is not an argument");for(c=0;void 0!==V[c];c++);V[c]=d}}function z(a){var b;for(b=0;b<V.length;b++)if(void 0!==V[b]&&V[b].arr===a)return V[b];return null}function A(a){var b,c,d;if(a){for(d=void 0,b=0;b<V.length;b++)if(void 0!==V[b]&&V[b].arr===a){d=V[b],delete V[b];break}if(void 0===d)throw new Error("unretain_array: array was never retained");if(d.arg instanceof g)for(b=0,c=d.addr;b<d.len;b++,c+=4)E.VM.WriteWord(c,d.arr[b]>>>0);else{if(!(d.arg instanceof f))throw new Error("unretain_array: unsupported refarg type");if(d.arg.signed)for(b=0,c=d.addr;b<d.len;b++,c++)E.VM.WriteByte(c,p(d.arr[b]));else for(b=0,c=d.addr;b<d.len;b++,c++)E.VM.WriteByte(c,255&d.arr[b])}}}function B(a,b,c){if(void 0===c){if(b.disprock)throw new Error("class_register: object is already registered");b.disprock=W,W++}else{if(b.disprock!=c)throw new Error("class_register: object is not already registered");c>=W&&(W=c+1)}X[a][b.disprock]=b}function C(a,b){if(!b.disprock||void 0===X[a][b.disprock])throw new Error("class_unregister: object is not registered");delete X[a][b.disprock],b.disprock=void 0}function D(){var a,b;W=1+Math.round(1e3*Math.random());for(a in F)b=F[a],X[b]={}}var E={};E.VM=null;var F={0:"window",1:"stream",2:"fileref",3:"schannel"},G=new g(!1),H=new g(!0),I=new f(!1),J=new f(null),K=new f(!0),L=new h("window"),M=new h("stream"),N=new h("fileref"),O=new h("schannel"),P={1:new b(1,"exit",new c([],null)),3:new b(3,"tick",new c([],null)),4:new b(4,"gestalt",new c([G,G],new j(G,!1,!0,!0))),5:new b(5,"gestalt_ext",new c([G,G,new k(G,!1,!0,!0,!1)],new j(G,!1,!0,!0))),32:new b(32,"window_iterate",new c([L,new j(G,!1,!0,!1)],new j(L,!1,!0,!0))),33:new b(33,"window_get_rock",new c([L],new j(G,!1,!0,!0))),34:new b(34,"window_get_root",new c([],new j(L,!1,!0,!0))),35:new b(35,"window_open",new c([L,G,G,G,G],new j(L,!1,!0,!0))),36:new b(36,"window_close",new c([L,new j(new i(new c([G,G],null)),!1,!0,!1)],null)),37:new b(37,"window_get_size",new c([L,new j(G,!1,!0,!1),new j(G,!1,!0,!1)],null)),38:new b(38,"window_set_arrangement",new c([L,G,G,L],null)),39:new b(39,"window_get_arrangement",new c([L,new j(G,!1,!0,!1),new j(G,!1,!0,!1),new j(L,!1,!0,!1)],null)),40:new b(40,"window_get_type",new c([L],new j(G,!1,!0,!0))),41:new b(41,"window_get_parent",new c([L],new j(L,!1,!0,!0))),42:new b(42,"window_clear",new c([L],null)),43:new b(43,"window_move_cursor",new c([L,G,G],null)),44:new b(44,"window_get_stream",new c([L],new j(M,!1,!0,!0))),45:new b(45,"window_set_echo_stream",new c([L,M],null)),46:new b(46,"window_get_echo_stream",new c([L],new j(M,!1,!0,!0))),47:new b(47,"set_window",new c([L],null)),48:new b(48,"window_get_sibling",new c([L],new j(L,!1,!0,!0))),64:new b(64,"stream_iterate",new c([M,new j(G,!1,!0,!1)],new j(M,!1,!0,!0))),65:new b(65,"stream_get_rock",new c([M],new j(G,!1,!0,!0))),66:new b(66,"stream_open_file",new c([N,G,G],new j(M,!1,!0,!0))),67:new b(67,"stream_open_memory",new c([new k(J,!0,!0,!0,!1),G,G],new j(M,!1,!0,!0))),68:new b(68,"stream_close",new c([M,new j(new i(new c([G,G],null)),!1,!0,!1)],null)),69:new b(69,"stream_set_position",new c([M,H,G],null)),70:new b(70,"stream_get_position",new c([M],new j(G,!1,!0,!0))),71:new b(71,"stream_set_current",new c([M],null)),72:new b(72,"stream_get_current",new c([],new j(M,!1,!0,!0))),73:new b(73,"stream_open_resource",new c([G,G],new j(M,!1,!0,!0))),96:new b(96,"fileref_create_temp",new c([G,G],new j(N,!1,!0,!0))),97:new b(97,"fileref_create_by_name",new c([G,new d,G],new j(N,!1,!0,!0))),98:new b(98,"fileref_create_by_prompt",new c([G,G,G],new j(N,!1,!0,!0))),99:new b(99,"fileref_destroy",new c([N],null)),100:new b(100,"fileref_iterate",new c([N,new j(G,!1,!0,!1)],new j(N,!1,!0,!0))),101:new b(101,"fileref_get_rock",new c([N],new j(G,!1,!0,!0))),102:new b(102,"fileref_delete_file",new c([N],null)),103:new b(103,"fileref_does_file_exist",new c([N],new j(G,!1,!0,!0))),104:new b(104,"fileref_create_from_fileref",new c([G,N,G],new j(N,!1,!0,!0))),128:new b(128,"put_char",new c([I],null)),129:new b(129,"put_char_stream",new c([M,I],null)),130:new b(130,"put_string",new c([new d],null)),131:new b(131,"put_string_stream",new c([M,new d],null)),132:new b(132,"put_buffer",new c([new k(J,!1,!0,!1,!0)],null)),133:new b(133,"put_buffer_stream",new c([M,new k(J,!1,!0,!1,!0)],null)),134:new b(134,"set_style",new c([G],null)),135:new b(135,"set_style_stream",new c([M,G],null)),144:new b(144,"get_char_stream",new c([M],new j(H,!1,!0,!0))),145:new b(145,"get_line_stream",new c([M,new k(J,!1,!1,!0,!0)],new j(G,!1,!0,!0))),146:new b(146,"get_buffer_stream",new c([M,new k(J,!1,!1,!0,!0)],new j(G,!1,!0,!0))),160:new b(160,"char_to_lower",new c([I],new j(I,!1,!0,!0))),161:new b(161,"char_to_upper",new c([I],new j(I,!1,!0,!0))),176:new b(176,"stylehint_set",new c([G,G,G,H],null)),177:new b(177,"stylehint_clear",new c([G,G,G],null)),178:new b(178,"style_distinguish",new c([L,G,G],new j(G,!1,!0,!0))),179:new b(179,"style_measure",new c([L,G,G,new j(G,!1,!0,!1)],new j(G,!1,!0,!0))),192:new b(192,"select",new c([new j(new i(new c([G,L,G,G],null)),!1,!0,!0)],null)),193:new b(193,"select_poll",new c([new j(new i(new c([G,L,G,G],null)),!1,!0,!0)],null)),208:new b(208,"request_line_event",new c([L,new k(J,!0,!0,!0,!0),G],null)),209:new b(209,"cancel_line_event",new c([L,new j(new i(new c([G,L,G,G],null)),!1,!0,!1)],null)),210:new b(210,"request_char_event",new c([L],null)),211:new b(211,"cancel_char_event",new c([L],null)),212:new b(212,"request_mouse_event",new c([L],null)),213:new b(213,"cancel_mouse_event",new c([L],null)),214:new b(214,"request_timer_events",new c([G],null)),224:new b(224,"image_get_info",new c([G,new j(G,!1,!0,!1),new j(G,!1,!0,!1)],new j(G,!1,!0,!0))),225:new b(225,"image_draw",new c([L,G,H,H],new j(G,!1,!0,!0))),226:new b(226,"image_draw_scaled",new c([L,G,H,H,G,G],new j(G,!1,!0,!0))),232:new b(232,"window_flow_break",new c([L],null)),233:new b(233,"window_erase_rect",new c([L,H,H,G,G],null)),234:new b(234,"window_fill_rect",new c([L,G,H,H,G,G],null)),235:new b(235,"window_set_background_color",new c([L,G],null)),240:new b(240,"schannel_iterate",new c([O,new j(G,!1,!0,!1)],new j(O,!1,!0,!0))),241:new b(241,"schannel_get_rock",new c([O],new j(G,!1,!0,!0))),242:new b(242,"schannel_create",new c([G],new j(O,!1,!0,!0))),243:new b(243,"schannel_destroy",new c([O],null)),244:new b(244,"schannel_create_ext",new c([G,G],new j(O,!1,!0,!0))),247:new b(247,"schannel_play_multi",new c([new k(O,!1,!0,!1,!0),new k(G,!1,!0,!1,!0),G],new j(G,!1,!0,!0))),248:new b(248,"schannel_play",new c([O,G],new j(G,!1,!0,!0))),249:new b(249,"schannel_play_ext",new c([O,G,G,G],new j(G,!1,!0,!0))),250:new b(250,"schannel_stop",new c([O],null)),251:new b(251,"schannel_set_volume",new c([O,G],null)),252:new b(252,"sound_load_hint",new c([G,G],null)),253:new b(253,"schannel_set_volume_ext",new c([O,G,G,G],null)),254:new b(254,"schannel_pause",new c([O],null)),255:new b(255,"schannel_unpause",new c([O],null)),256:new b(256,"set_hyperlink",new c([G],null)),257:new b(257,"set_hyperlink_stream",new c([M,G],null)),258:new b(258,"request_hyperlink_event",new c([L],null)),259:new b(259,"cancel_hyperlink_event",new c([L],null)),288:new b(288,"buffer_to_lower_case_uni",new c([new k(G,!1,!0,!0,!0),G],new j(G,!1,!0,!0))),289:new b(289,"buffer_to_upper_case_uni",new c([new k(G,!1,!0,!0,!0),G],new j(G,!1,!0,!0))),290:new b(290,"buffer_to_title_case_uni",new c([new k(G,!1,!0,!0,!0),G,G],new j(G,!1,!0,!0))),291:new b(291,"buffer_canon_decompose_uni",new c([new k(G,!1,!0,!0,!0),G],new j(G,!1,!0,!0))),292:new b(292,"buffer_canon_normalize_uni",new c([new k(G,!1,!0,!0,!0),G],new j(G,!1,!0,!0))),296:new b(296,"put_char_uni",new c([G],null)),297:new b(297,"put_string_uni",new c([new e],null)),298:new b(298,"put_buffer_uni",new c([new k(G,!1,!0,!1,!0)],null)),299:new b(299,"put_char_stream_uni",new c([M,G],null)),300:new b(300,"put_string_stream_uni",new c([M,new e],null)),301:new b(301,"put_buffer_stream_uni",new c([M,new k(G,!1,!0,!1,!0)],null)),304:new b(304,"get_char_stream_uni",new c([M],new j(H,!1,!0,!0))),305:new b(305,"get_buffer_stream_uni",new c([M,new k(G,!1,!1,!0,!0)],new j(G,!1,!0,!0))),306:new b(306,"get_line_stream_uni",new c([M,new k(G,!1,!1,!0,!0)],new j(G,!1,!0,!0))),312:new b(312,"stream_open_file_uni",new c([N,G,G],new j(M,!1,!0,!0))),313:new b(313,"stream_open_memory_uni",new c([new k(G,!0,!0,!0,!1),G,G],new j(M,!1,!0,!0))),314:new b(314,"stream_open_resource_uni",new c([G,G],new j(M,!1,!0,!0))),320:new b(320,"request_char_event_uni",new c([L],null)),321:new b(321,"request_line_event_uni",new c([L,new k(G,!0,!0,!0,!0),G],null)),336:new b(336,"set_echo_line_event",new c([L,G],null)),337:new b(337,"set_terminators_line_event",new c([L,new k(G,!1,!0,!1,!1)],null)),352:new b(352,"current_time",new c([new j(new i(new c([H,G,H],null)),!1,!0,!0)],null)),353:new b(353,"current_simple_time",new c([G],new j(H,!1,!0,!0))),360:new b(360,"time_to_date_utc",new c([new j(new i(new c([H,G,H],null)),!0,!1,!0),new j(new i(new c([H,H,H,H,H,H,H,H],null)),!1,!0,!0)],null)),361:new b(361,"time_to_date_local",new c([new j(new i(new c([H,G,H],null)),!0,!1,!0),new j(new i(new c([H,H,H,H,H,H,H,H],null)),!1,!0,!0)],null)),362:new b(362,"simple_time_to_date_utc",new c([H,G,new j(new i(new c([H,H,H,H,H,H,H,H],null)),!1,!0,!0)],null)),363:new b(363,"simple_time_to_date_local",new c([H,G,new j(new i(new c([H,H,H,H,H,H,H,H],null)),!1,!0,!0)],null)),364:new b(364,"date_to_time_utc",new c([new j(new i(new c([H,H,H,H,H,H,H,H],null)),!0,!1,!0),new j(new i(new c([H,G,H],null)),!1,!0,!0)],null)),365:new b(365,"date_to_time_local",new c([new j(new i(new c([H,H,H,H,H,H,H,H],null)),!0,!1,!0),new j(new i(new c([H,G,H],null)),!1,!0,!0)],null)),366:new b(366,"date_to_simple_time_utc",new c([new j(new i(new c([H,H,H,H,H,H,H,H],null)),!0,!1,!0),G],new j(H,!1,!0,!0))),367:new b(367,"date_to_simple_time_local",new c([new j(new i(new c([H,H,H,H,H,H,H,H],null)),!0,!1,!0),G],new j(H,!1,!0,!0)))};E.arg_int_unsigned=G,E.arg_int_signed=H,E.arg_char_unsigned=I,E.arg_char_native=J,E.arg_char_signed=K,E.cast_signed_char=o,E.uncast_signed_char=p,E.class_obj_to_id=q,E.class_obj_from_id=r;var Q={},R=null,S=null,T=-1;E.set_blocked_selector=u;var U=[];E.temp_arg_arrays=U;var V=[];E.retained_arrays=V,E.make_arg_array=x;var W,X={};return D(),{set_vm:a,get_function:t,prepare_resume:w,check_autosave:v,class_register:B,class_unregister:C,class_obj_to_id:q,class_obj_from_id:r,retain_array:y,unretain_array:A,get_retained_array:z}}();