/*

Quixe
=====

Built: 2013-04-18

Quixe -- a Glulx VM interpreter written in Javascript
GiDispa -- a GlkAPI dispatch layer for Quixe

Designed by Andrew Plotkin <erkyrath@eblong.com>
Copyright (c) 2010-2013 Andrew Plotkin
<http://eblong.com/zarf/glulx/quixe/>

*/
Quixe=function(){function e(e,t){Tn=e;var n,r,s=Tn.slice(0,64);for(n=0;s.length>n;n++)r=s[n].toString(16),2>r.length&&(r="0"+r),s[n]=r;Zn=s.join(""),t&&(Nn=t.rethrow_exceptions)}function t(){if(Un)return Glk.fatal_error("Quixe was inited twice!"),void 0;try{o(),D(),Ut(),sn()}catch(e){if(Glk.fatal_error("Quixe init: "+r(e)),Nn)throw e}}function n(){try{An=On,sn()}catch(e){if(Glk.fatal_error("Quixe run: "+r(e)),Nn)throw e}}function r(e){if("string"==typeof e)return e;var t=""+e;return e.message&&(t=t+" "+e.message),e.fileName&&(t=t+" "+e.fileName),e.lineNumber&&(t=t+" line:"+e.lineNumber),e.name&&(t=t+" "+e.name),e.number&&(t=t+" "+e.number),t}function s(e){window.console&&console.log?console.log(e):window.opera&&opera.postError&&opera.postError(e)}function a(e,t){var n,r;if(e instanceof Array){t&&t--;var s=e.map(function(e){return a(e,t)});return"["+s.join(",")+"]"}if(!(e instanceof Object))return""+e;r=[];for(n in e){var o=e[n];t&&o instanceof Object&&(o=a(o,t-1)),r.push(n+":"+o)}return"{ "+r.join(", ")+" }"}function o(){var e,t;for(e=0;256>e;e++)t=e.toString(16),16>e&&(t="0"+t),an[e]=t;for(e=0;256>e;e++)t=e>=32&&127>e?34==e||39==e||92==e?"\\"+String.fromCharCode(e):String.fromCharCode(e):10==e?"\\n":"\\x"+an[e],on[e]=t}function i(e,t){return 16777216*e[t]+65536*e[t+1]+256*e[t+2]+e[t+3]}function c(e,t){return 256*e[t]+e[t+1]}function u(e,t){return e[t]}function _(e){return zn[e]}function l(e){return 256*zn[e]+zn[e+1]}function h(e){return 16777216*zn[e]+65536*zn[e+1]+256*zn[e+2]+zn[e+3]}function f(e,t){zn[e]=255&t}function d(e,t){zn[e]=255&t>>8,zn[e+1]=255&t}function m(e,t){zn[e]=255&t>>24,zn[e+1]=255&t>>16,zn[e+2]=255&t>>8,zn[e+3]=255&t}function p(e,t){for(var n=0;t.length>n;n++)e.push(t.charCodeAt(n))}function g(e,t){e.push(255&t>>24),e.push(255&t>>16),e.push(255&t>>8),e.push(255&t)}function v(e,t){e.push(255&t>>8),e.push(255&t)}function w(e,t){e.push(255&t)}function b(e,t,n){e[t]=255&n>>24,e[t+1]=255&n>>16,e[t+2]=255&n>>8,e[t+3]=255&n}function k(e,t,n){return String.fromCharCode.apply(this,e.slice(t,t+n))}function y(e){return zn[e]>=128?"0xffffff"+an[zn[e]]:"0x"+an[zn[e]]}function x(e){return zn[e]>=128?"0xffff"+an[zn[e]]+an[zn[e+1]]:zn[e]?"0x"+an[zn[e]]+an[zn[e+1]]:"0x"+an[zn[e+1]]}function F(e){return zn[e]?"0x"+an[zn[e]]+an[zn[e+1]]+an[zn[e+2]]+an[zn[e+3]]:zn[e+1]?"0x"+an[zn[e+1]]+an[zn[e+2]]+an[zn[e+3]]:zn[e+2]?"0x"+an[zn[e+2]]+an[zn[e+3]]:"0x"+an[zn[e+3]]}function C(e){return 4294967295==e?255&Mn.valstack.pop():_(e)}function S(e,t){4294967295==e?Mn.valstack.push(255&t):f(e,t)}function E(e){return 4294967295==e?Mn.valstack.pop():h(e)}function T(e,t){4294967295==e?Mn.valstack.push(t):m(e,t)}function Z(e,t){return 4294967295==e?Mn.valstack.pop():h(e+4*t)}function N(e,t,n){4294967295==e?Mn.valstack.push(n):m(e+4*t,n)}function z(e){or=e}function j(e){return 65536>e?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function M(e){if(256>e)return on[e];if(65536>e){for(e=e.toString(16);4>e.length;)e="0"+e;return"\\u"+e}var t;return e-=65536,t=55296+(e>>10),e=56320+(1023&e),"\\u"+t.toString(16)+"\\u"+e.toString(16)}function U(e){return M(e.charCodeAt(0))}function O(e){return e=e.replace(cn,U),'"'+e+'"'}function G(e){var t,n;if(arguments.length>1){for(e+=" (",t=1;arguments.length>t;t++)n=arguments[t],n="number"==typeof n?n.toString(16):""+n,1!=t&&(e+=" "),e+=n;e+=")"}throw s(e),e}function R(e,t){return void 0===t?eval("function _func() {\n"+e+"\n}"):eval("function _func("+t+") {\n"+e+"\n}"),_func}function A(e,t,n,r){this.funcaddr=e,this.startpc=t,this.functype=_(e),this.pathaddrs={},this[0]={},this[1]={},this[2]={},this.locallen=null,this.localsformat=n,this.rawformat=r,this.localsindex=[];var s,a,o=0;for(s=0;this.localsformat.length>s;s++){var i=this.localsformat[s];if(4==i.size)for(;3&o;)o++;else if(2==i.size)for(;1&o;)o++;for(a=0;i.count>a;a++)this.localsindex.push({size:i.size,pos:o}),o+=i.size}for(;3&o;)o++;this.locallen=o}function W(e){var t;for(this.vmfunc=e,this.depth=null,this.framestart=null,this.framelen=null,this.valstack=[],this.localspos=null,this.localsindex=e.localsindex,this.locals=[],t=0;this.localsindex.length>t;t++){var n=this.localsindex[t];this.locals[n.pos]=0}this.framelen=8+e.rawformat.length+e.locallen}function I(e){var t=new W(e.vmfunc);return t.depth=e.depth,t.framestart=e.framestart,t.framelen=e.framelen,t.valstack=e.valstack.slice(0),t.localspos=e.localspos,t.locals=e.locals.slice(0),t.framelen=e.framelen,t}function L(e,t){g(t,e.framelen);var n=e.vmfunc.rawformat;g(t,8+n.length);for(var r=0;n.length>r;r++)t.push(n[r]);for(var r=0;e.vmfunc.localsindex.length>r;r++){var s=e.vmfunc.localsindex[r];if(4==s.size){for(;3&t.length;)t.push(0);g(t,e.locals[s.pos])}else if(2==s.size){for(;1&t.length;)t.push(0);v(t,e.locals[s.pos])}else w(t,e.locals[s.pos])}for(;3&t.length;)t.push(0);for(var r=0;e.valstack.length>r;r++)g(t,e.valstack[r])}function B(e,t){var n=i(e,e.length-4);if(0>n||n>=e.length)return s("Bad frameptr in serialized stack frame"),void 0;e=e.splice(n,e.length);var r=i(e,0),a=i(e,4);if(a!=8+t.rawformat.length)return s("LocalsPos in save file ("+a+")"+" doesn't match game image ("+(8+t.rawformat.length)+")"),void 0;if(r!=a+t.locallen)return s("FrameLen in save file ("+r+")"+" doesn't match game image ("+(a+t.locallen)+")"),void 0;var o=new W(t);o.framestart=n;for(var _=0;o.vmfunc.localsindex.length>_;_++){var l=o.vmfunc.localsindex[_];o.locals[l.pos]=4==l.size?i(e,4+a+l.pos):2==l.size?c(e,4+a+l.pos):u(e,4+a+l.pos)}for(var h=r;e.length>h;h+=4)o.valstack.push(i(e,h));return o}function P(e,t){0==e&&G("Tried to create a VMTextEnv for address zero."),this.addr=e,this.cacheable=void 0!==t,this.decoding_tree=t,this.vmstring_tables=[],this.cacheable&&(this.vmstring_tables[0]={},this.vmstring_tables[1]={},this.vmstring_tables[2]={})}function D(){function e(e,t){this.argsize=t?t:4,this.numops=e.length;for(var n=[],r=0;e.length>r;r++)n.push(e.charAt(r));this.formlist=n}var t=new e(""),n=new e("L"),r=new e("LL"),s=new e("LLL"),a=new e("LLLL"),o=new e("LS"),i=new e("LLS"),c=new e("LLLLLLS"),u=new e("LLLLLLLS"),_=new e("LLSS"),l=new e("LC"),h=new e("LLC"),f=new e("LLLC"),d=new e("LLLLC"),m=new e("ES"),p=new e("LES"),g=new e("EES"),v=new e("F"),w=new e("LF"),b=new e("LLF"),k=new e("EF"),y=new e("EF",1),x=new e("EF",2),F=new e("S"),C=new e("SS"),S=new e("CL"),E=new e("C");un={0:t,16:g,17:p,18:i,19:i,20:i,21:m,24:g,25:g,26:g,27:m,28:i,29:i,30:i,32:n,34:r,35:r,36:s,37:s,38:s,39:s,40:s,41:s,42:s,43:s,44:s,45:s,48:h,49:n,50:S,51:r,52:r,64:k,65:x,66:y,68:o,69:o,72:i,73:i,74:i,75:i,76:s,77:s,78:s,79:s,80:v,81:w,82:t,83:r,84:n,112:n,113:n,114:n,115:n,256:i,257:n,258:F,259:o,260:n,272:o,273:n,288:t,289:F,290:t,291:l,292:w,293:E,294:v,295:r,304:b,320:F,321:n,328:C,329:r,336:u,337:u,338:c,352:l,353:h,354:f,355:d,368:r,369:s,376:o,377:n,384:r,385:r,400:o,401:o,402:o,408:o,409:o,416:i,417:i,418:i,419:i,420:_,424:o,425:o,426:o,427:i,432:o,433:o,434:o,435:o,436:o,437:o,438:i,448:a,449:a,450:s,451:s,452:s,453:s,456:r,457:r}}function q(e){if(0==e.mode)return"null";var t="m"+e.mode;if(null!=e.argsize&&(t=t+"s"+e.argsize),null!=e.addr&&(t=t+"a"+e.addr),_n.key)return"funcop_cache."+t;var n={key:t,mode:e.mode,argsize:e.argsize,addr:e.addr};return _n[t]=n,"funcop_cache."+t}function V(e,t,n){switch(t.mode){case 8:if(4==t.argsize){var r=n[0];if("0"===r)return e.offstack.push(n),e.code.push("// push to offstack: "+n),void 0;if("_"===r)return nt(e,n),e.code.push("// re-push to offstack: "+n),void 0}return holdvar=et(e,!0),e.offstack.push(holdvar),4==t.argsize?e.code.push(holdvar+"=("+n+");"):2==t.argsize?e.code.push(holdvar+"=0xffff&("+n+");"):e.code.push(holdvar+"=0xff&("+n+");"),void 0;case 0:return e.code.push("("+n+");"),void 0;case 11:if(4==t.argsize){var r=n[0];if("0"===r)return rt(e,t.addr,n,!1),e.code.push("// store to offloc["+t.addr+"]: "+n),void 0;if("_"===r)return rt(e,t.addr,n,!0),e.code.push("// re-store to offloc["+t.addr+"]: "+n),void 0}return rt(e,t.addr,void 0),4==t.argsize?e.code.push("frame.locals["+t.addr+"]=("+n+");"):2==t.argsize?e.code.push("frame.locals["+t.addr+"]=(0xffff &"+n+");"):e.code.push("frame.locals["+t.addr+"]=(0xff &"+n+");"),void 0;case 15:return 4==t.argsize?e.code.push("MemW4("+t.addr+","+n+");"):2==t.argsize?e.code.push("MemW2("+t.addr+","+n+");"):e.code.push("MemW1("+t.addr+","+n+");"),void 0;default:G("Unknown addressing mode in store func operand.")}}function $(e,t,n){void 0===n&&(n=e.cp),e.code.push("frame.valstack.push("+t+","+n+",frame.framestart);")}function Q(e){e.code.push("if (!substring) { substring=true;"),e.code.push("frame.valstack.push(0x11,0,nextcp,frame.framestart);"),e.code.push("}")}function H(e,t){var n;if(e.code.push("// unload offstate: "+e.offstack.length+" stack"+(e.offloc.length?", plus locs":"")+(t?" (conditional)":"")),e.offstack.length&&e.code.push("frame.valstack.push("+e.offstack.join(",")+");"),e.offloc.length)for(n=0;e.offloc.length>n;n++)void 0!==e.offloc[n]&&e.offlocdirty[n]&&e.code.push("frame.locals["+n+"]="+e.offloc[n]+";");if(!t){var r;for(n=0;e.offloc.length>n;n++)r=e.offloc[n],void 0!==r&&void 0!==e.holduse[r]&&(e.holduse[r]=!1);for(e.offloc.length=0,e.offlocdirty.length=0;e.offstack.length;)r=e.offstack.pop(),void 0!==e.holduse[r]&&(e.holduse[r]=!1)}}function Y(e){if(0!=e.buffer.length){var t=e.buffer.join("");e.buffer.length=0,e.code.push("Glk.glk_put_jstring("+O(t)+");")}}function X(e,t,n){var r;if(at(t))return r=Number(t),2147483648&r?""+(r-4294967296):t;if(r="("+t+"&0xffffffff)",n){var s=et(e);return e.code.push(s+"="+r+";"),s}return r}function J(e,t,n){var r;if(at(t))return r=Number(t),2147483648==r?"-0":""+jt(r);if(r="decode_float("+t+")",n){var s=et(e);return e.code.push(s+"="+r+";"),s}return r}function K(e,t,n){if(at(t)){var r=Number(t);if(0==r||1==r)n?(e.code.push("// quashing offstack for unconditional return: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0):e.code.push("// ignoring offstack for conditional return: "+e.offstack.length),e.code.push("leave_function();"),e.code.push("pop_callstub("+r+");");else{H(e,!n);var s=e.cp+r-2>>>0;e.code.push("pc = "+s+";"),e.vmfunc.pathaddrs[s]=!0}}else H(e,!n),e.code.push("if (("+t+")==0 || ("+t+")==1) {"),e.code.push("leave_function();"),e.code.push("pop_callstub("+t+");"),e.code.push("}"),e.code.push("else {"),e.code.push("pc = ("+e.cp+"+("+t+")-2) >>>0;"),e.code.push("}");e.code.push("return;")}function et(e,t){for(var n,r=0;;){if(n="_hold"+r,!e.holduse[n])return e.holduse[n]=t?1:!0,n;r++}}function tt(e){var t=e.offstack.pop();if(at(t))return t;var n=e.holduse[t];return(isNaN(n)||n===!1||n===!0)&&G("Offstack variable not marked as stack.",t),n--,0==n&&(n=!0),e.holduse[t]=n,t}function nt(e,t){e.offstack.push(t);var n=e.holduse[t];n&&n!==!0?n++:n=1,e.holduse[t]=n}function rt(e,t,n,r){var s=e.offloc[t];if(s&&ot(s)){var a=e.holduse[s];a--,0==a&&(a=!0),e.holduse[s]=a}if(void 0===n)return e.offloc[t]=void 0,e.offlocdirty[t]=!1,void 0;if(e.offloc[t]=n,e.offlocdirty[t]=!0,r){var o=n,a=e.holduse[o];a&&a!==!0?a++:a=1,e.holduse[o]=a}}function st(e,t){for(var n;t>e.offstack.length;)n=et(e,!0),e.offstack.unshift(n),e.code.push(n+"=frame.valstack.pop();")}function at(e){return"0"===e[0]}function ot(e){return"_"===e[0]}function it(e,t,n,r){var s,a,o,i,c,u,f;for(r.desttype=0,r.numops=n.numops,s=t,t+=n.numops+1>>1,a=0;n.numops>a;a++){0==(1&a)?(o=_(s),i=15&o):(i=15&o>>4,s++);var d=n.formlist[a];if("L"!=d)if("E"!=d)if("S"!=d)if("F"!=d)if("C"!=d)G("Unknown operand type.",d);else{switch(i){case 8:r[a]="3,0";continue;case 0:r[a]="0,0";continue}if(i>=9&&11>=i){9==i?(u=_(t),t++):10==i?(u=l(t),t+=2):11==i&&(u=h(t),t+=4),r[a]="2,"+u;continue}switch(i){case 15:u=h(t)+Dn,t+=4;break;case 14:u=l(t)+Dn,t+=2;break;case 13:u=_(t)+Dn,t++;break;case 7:u=h(t),t+=4;break;case 6:u=l(t),t+=2;break;case 5:u=_(t),t++;break;default:G("Unknown addressing mode in store operand.")}r[a]="1,"+u}else{var m=r.func_store;switch(i){case 8:m.mode=8,m.argsize=n.argsize,r[a]=m;continue;case 0:m.mode=0,m.argsize=n.argsize,r[a]=m;continue}if(i>=9&&11>=i){9==i?(u=_(t),t++):10==i?(u=l(t),t+=2):11==i&&(u=h(t),t+=4),m.mode=11,m.addr=u,m.argsize=n.argsize,r[a]=m;continue}switch(i){case 15:u=h(t)+Dn,t+=4;break;case 14:u=l(t)+Dn,t+=2;break;case 13:u=_(t)+Dn,t++;break;case 7:u=h(t),t+=4;break;case 6:u=l(t),t+=2;break;case 5:u=_(t),t++;break;default:G("Unknown addressing mode in store operand.")}m.mode=15,m.addr=u,m.argsize=n.argsize,r[a]=m}else{switch(i){case 8:f=et(e,!0),e.offstack.push(f),r[a]=f+"=(";continue;case 0:r[a]="(";continue}if(i>=9&&11>=i){9==i?(u=_(t),t++):10==i?(u=l(t),t+=2):11==i&&(u=h(t),t+=4),4==n.argsize?(f=et(e,!0),rt(e,u,f,!1),r[a]=f+"=("):2==n.argsize?(rt(e,u,void 0),r[a]="frame.locals["+u+"]=(0xffff &"):(rt(e,u,void 0),r[a]="frame.locals["+u+"]=(0xff &");continue}switch(i){case 15:u=h(t)+Dn,t+=4;break;case 14:u=l(t)+Dn,t+=2;break;case 13:u=_(t)+Dn,t++;break;case 7:u=h(t),t+=4;break;case 6:u=l(t),t+=2;break;case 5:u=_(t),t++;break;default:G("Unknown addressing mode in store operand.")}c=4==n.argsize?"MemW4("+u+",":2==n.argsize?"MemW2("+u+",":"MemW1("+u+",",r[a]=c}else{switch(i){case 8:r[a]=e.offstack.length?tt(e):"frame.valstack.pop()";continue;case 0:r[a]="0";continue;case 1:c=y(t),t++,r[a]=c;continue;case 2:c=x(t),t+=2,r[a]=c;continue;case 3:c=F(t),t+=4,r[a]=c;continue}if(i>=9&&11>=i){if(9==i?(u=_(t),t++):10==i?(u=l(t),t+=2):11==i&&(u=h(t),t+=4),void 0!==e.offloc[u]){r[a]=e.offloc[u];continue}c=4==n.argsize?"frame.locals["+u+"]":2==n.argsize?"frame.locals["+u+"] & 0xffff":"frame.locals["+u+"] & 0xff",f=et(e,!0),e.code.push(f+"=("+c+");"),e.offloc[u]=f,e.offlocdirty[u]=!1,r[a]=f;continue}switch(i){case 15:u=h(t)+Dn,t+=4;break;case 14:u=l(t)+Dn,t+=2;break;case 13:u=_(t)+Dn,t++;break;case 7:u=h(t),t+=4;break;case 6:u=l(t),t+=2;break;case 5:u=_(t),t++;break;default:G("Unknown addressing mode in load operand.")}c=4==n.argsize?"Mem4("+u+")":2==n.argsize?"Mem2("+u+")":"Mem1("+u+")",r[a]=c}else{switch(i){case 8:e.offstack.length?r[a]=tt(e):(f=et(e),e.code.push(f+"=frame.valstack.pop();"),r[a]=f);continue;case 0:r[a]="0";continue;case 1:c=y(t),t++,r[a]=c;continue;case 2:c=x(t),t+=2,r[a]=c;continue;case 3:c=F(t),t+=4,r[a]=c;continue}if(i>=9&&11>=i){if(9==i?(u=_(t),t++):10==i?(u=l(t),t+=2):11==i&&(u=h(t),t+=4),void 0!==e.offloc[u]){r[a]=e.offloc[u];continue}c=4==n.argsize?"frame.locals["+u+"]":2==n.argsize?"frame.locals["+u+"] & 0xffff":"frame.locals["+u+"] & 0xff",f=et(e,!0),e.code.push(f+"=("+c+");"),e.offloc[u]=f,e.offlocdirty[u]=!1,r[a]=f;continue}switch(i){case 15:u=h(t)+Dn,t+=4;break;case 14:u=l(t)+Dn,t+=2;break;case 13:u=_(t)+Dn,t++;break;case 7:u=h(t),t+=4;break;case 6:u=l(t),t+=2;break;case 5:u=_(t),t++;break;default:G("Unknown addressing mode in load operand.")}c=4==n.argsize?"Mem4("+u+")":2==n.argsize?"Mem2("+u+")":"Mem1("+u+")",f=et(e),e.code.push(f+"=("+c+");"),r[a]=f}}return t}function ct(e){var t=e,n=_(t);192!=n&&193!=n&&(n>=192&&223>=n?G("Call to unknown type of function.",t):G("Call to non-function.",t)),t++;for(var r=[],s=t;;){var a=_(t);t++;var o=_(t);if(t++,0==a)break;1!=a&&2!=a&&4!=a&&G("Invalid local variable size in function header.",a),r.push({size:a,count:o})}for(var i=zn.slice(s,t);i.length%4;)i.push(0);return new A(e,t,r,i)}function ut(e,t,n){var r,s,a,o=t,i={vmfunc:e,cp:null,curiosys:n,code:[],holduse:{},varsused:{},offstack:[],offloc:[],offlocdirty:[],path_ends:!1},c={};for(c.func_store={},i.code.push("");!i.path_ends;){s=o,r=_(o),void 0===r&&G("Tried to compile nonexistent address",o),o++,128&r&&(64&r?(r&=63,r=256*r|_(o),o++,r=256*r|_(o),o++,r=256*r|_(o),o++):(r&=127,r=256*r|_(o),o++)),i.code.push("// "+s.toString(16)+": opcode "+r.toString(16));var u=un[r];u||G("Encountered unknown opcode.",r),o=it(i,o,u,c),i.cp=o;var l=ln[r];l||G("Encountered unhandled opcode.",r),l(i,c);for(a in i.holduse)i.holduse[a]===!0&&(i.holduse[a]=!1);i.offstack.length&&i.code.push("// offstack: "+i.offstack.join(",")),i.offloc.length&&i.code.push("// offloc: "+i.offloc.join(",")+"; dirty: "+i.offlocdirty.join(",")),e.pathaddrs[o]&&!i.path_ends&&(i.code.push("// reached jump-in point"),i.code.push("pc="+o+";"),H(i),i.code.push("return;"),i.path_ends=!0)}i.offstack.length&&G("Path compilation ended with nonempty offstack.",i.offstack.length),i.offloc.length&&G("Path compilation ended with nonempty offloc.",i.offloc.length);var h=[];for(a in i.holduse)h.push(a);for(a in i.varsused)h.push(a);return h.length&&(i.code[0]="var "+h.join(",")+";"),R(i.code.join("\n"))}function _t(e,t){var n;lr++;var r=pn[e];if(void 0!==r){hr++;var s=r(t,Gn);return ft(s),void 0}var a=Wn[e];void 0===a&&(a=ct(e),Dn>e&&(Wn[e]=a)),Xn=a.startpc;var o=new W(a);if(o.depth=jn.length,o.framestart=0==jn.length?0:Mn.framestart+Mn.framelen+4*Mn.valstack.length,jn.push(o),Mn=o,192==a.functype){for(n=t-1;n>=0;n--)Mn.valstack.push(Gn[n]);Mn.valstack.push(t)}else for(n=0;t>n;n++){var i=a.localsindex[n];if(void 0===i)break;4==i.size?Mn.locals[i.pos]=Gn[n]:2==i.size?Mn.locals[i.pos]=65535&Gn[n]:1==i.size&&(Mn.locals[i.pos]=255&Gn[n])}}function lt(){var e=Mn.depth;if(jn.pop(),0==jn.length)throw Mn=null,hn;Mn=jn[jn.length-1],Mn.depth!=e-1&&G("Stack inconsistent after function exit.")}function ht(e){for(;jn.length&&jn[jn.length-1].framestart>e;)jn.pop();0==jn.length&&G("Stack evaporated during throw."),Mn=jn[jn.length-1],e-=Mn.framestart+Mn.framelen,0>e&&G("Attempted to throw below the frame value stack."),3&e&&G("Attempted to throw to an unaligned address."),e>>>=2,e>Mn.valstack.length&&G("Attempted to throw beyond the frame value stack."),Mn.valstack.length=e}function ft(e){var t,n;isNaN(e)&&G("Function returned undefined value.");var r=Mn.valstack.pop();switch(r!=Mn.framestart&&G("Call stub frameptr ("+r+") "+"does not match frame ("+Mn.framestart+")"),Xn=Mn.valstack.pop(),t=Mn.valstack.pop(),n=Mn.valstack.pop()){case 0:return;case 1:return m(t,e),void 0;case 2:return Mn.locals[t]=e,void 0;case 3:return Mn.valstack.push(e),void 0;case 17:return G("String-terminator call stub at end of function call."),void 0;case 16:return Ct(0,Xn,225,t),void 0;case 18:return Ft(0,Xn,!0,t),void 0;case 19:return Ct(0,Xn,224,t),void 0;case 20:return Ct(0,Xn,226,t),void 0;default:G("Unrecognized desttype in callstub.",n)}}function dt(e,t,n){switch(e){case 0:return;case 1:return m(t,n),void 0;case 2:return Mn.locals[t]=n,void 0;case 3:return Mn.valstack.push(n),void 0;default:G("Unrecognized desttype in callstub.",e)}}function mt(e,t){if(e)switch(e.mode){case 8:return Mn.valstack.push(t),void 0;case 0:return;case 11:return Mn.locals[e.addr]=4==e.argsize?t:2==e.argsize?65535&t:255&t,void 0;case 15:return 4==e.argsize?m(e.addr,t):2==e.argsize?d(e.addr,t):f(e.addr,t),void 0;default:G("Unknown addressing mode in store func by operand.")}}function pt(e){0==e?Pn=Math.random:(gt(e),Pn=vt)}function gt(e){var t,n,r,s,a;for(void 0===fn&&(fn=Array(55)),fn[54]=e,dn=0,mn=31,r=1,t=0;55>t;t++)n=21*t%55,fn[n]=r,r=e-r>>>0,e=fn[n];for(a=0;4>a;a++)for(t=0;55>t;t++)s=fn[t]-fn[(1+t+30)%55],fn[t]=s>>>0}function vt(){return dn=(dn+1)%55,mn=(mn+1)%55,fn[dn]=fn[dn]-fn[mn]>>>0,fn[dn]/4294967296}function wt(e){return h(e+13+gn[7])==gn[2]}function bt(e,t){var n,r=0;if(4294901760&t){if(r=h(gn[0]+4*(65535&t)),Sn[0]=e,Sn[1]=r,0==vn[5](2,Sn))return 0;t>>=16,e=r}return Sn[0]=e,Sn[1]=t,n=vn[2](2,Sn),0==n?0:wt(e)&&0==r&&(gn[1]>t||t>=gn[1]+8)?0:h(gn[6])!=e&&1&_(n+9)?0:n}function kt(e){if(Jn!=e&&(Ln=void 0,Bn=void 0,Jn=e,0!=Jn)){var t=In[Jn];if(void 0===t){var n=void 0,r=h(Jn),s=h(Jn+8),a=Dn>=Jn+r;if(a){var o=Array(1);xt(o,s,4,0),n=o[0],void 0===n&&G("Failed to create decoding tree.")}t=new P(Jn,n),In[Jn]=t}Ln=t.decoding_tree,Bn=t.vmstring_tables[nr]}}function yt(e,t){switch(e){case 0:t=0;break;case 1:break;case 2:t=0;break;default:e=0,t=0}nr=e,rr=t;var n=In[Jn];Bn=void 0===n?void 0:n.vmstring_tables[nr]}function xt(e,t,n,r){var s,a,o,i;if(a=_(t),0==a&&4==n)return o=Array(16),o.type=0,o.depth=4,e[r]=o,xt(o,t,0,0),void 0;if(0==a){var c=h(t+1),u=h(t+5);return xt(e,c,n+1,r),xt(e,u,n+1,r|1<<n),void 0}switch(t++,o={},o.type=a,o.depth=n,a){case 2:o.value=_(t),o.cchar=j(o.value);break;case 4:o.value=h(t),o.cchar=j(o.value);break;case 3:case 5:o.addr=t;break;case 8:case 9:o.addr=h(t);break;case 10:case 11:o.addr=t;break;case 1:break;default:G("Unknown node type in string table.",a)}for(i=1<<n,s=r;16>s;s+=i)e[s]=o}function Ft(e,t,n,r){var s=(4294967295&t).toString(10);switch(nr){case 2:r&&(s=s.slice(r)),Glk.glk_put_jstring(s,!0);break;case 1:if(n||(Mn.valstack.push(17,0,e,Mn.framestart),n=!0),s.length>r){var a=s.charCodeAt(r);return Mn.valstack.push(18,r+1,t,Mn.framestart),Gn[0]=a,_t(rr,1),!0}break;case 0:}if(n){var o,i;Mn.valstack.pop()!=Mn.framestart&&G("Call stub frameptr does not match frame."),Xn=Mn.valstack.pop(),i=Mn.valstack.pop(),o=Mn.valstack.pop(),17!=o&&G("String-on-string call stub while printing number.")}}function Ct(e,t,n,r){for(var s,a,o,i,c,u=0!=n;;){if(a=void 0,s=0==n?t:t+"/"+n+"/"+r,void 0!==Bn?(a=Bn[s],void 0===a&&(a=St(nr,t,n,r),Bn[s]=a,gr++,pr++)):(a=St(nr,t,n,r),gr++),a instanceof Function){if(o=a(e,u),o instanceof Array){u=!0,t=o[0],n=o[1],r=o[2];continue}if(o)return!0}else if(Glk.glk_put_jstring(a),!u)return!1;if(Mn.valstack.pop()!=Mn.framestart&&G("Call stub frameptr does not match frame."),Xn=Mn.valstack.pop(),c=Mn.valstack.pop(),i=Mn.valstack.pop(),17==i)return!0;16==i?(u=!0,r=c,n=225,t=Xn):G("Function-terminator call stub at end of string.")}}function St(e,t,n,r){var s,a,o=t,i=r,c=void 0;o||G("Called compile_string with null address.");var u={startaddr:t,startbitnum:r,buffer:[],code:[]};if(0==n?(a=_(o),226==a?o+=4:o++,i=0):a=n,225==a)if(Ln){var l,f,d,m,p,g,v=!1;for(l=_(o),i&&(l>>=i),f=8-i,d=!1,Ln instanceof Array||(v=!0),p=Ln;!v;){if(4>f){var w=_(o+1);l|=w<<f,f+=8,d=!0}if(g=p[15&l],f-=g.depth,l>>=g.depth,i+=g.depth,i>=8)if(o+=1,i-=8,d)d=!1;else{var w=_(o);l|=w<<f,f+=8}if(g instanceof Array)p=g;else switch(g.type){case 1:v=!0;break;case 2:case 4:switch(e){case 2:u.buffer.push(g.cchar);break;case 1:Y(u),Q(u),$(u,"0x10,"+i,o),u.code.push("tempcallargs[0]="+g.value+";"),u.code.push("enter_function(iosysrock, 1);"),c=!0,v=!0}p=Ln;break;case 3:switch(e){case 2:for(m=g.addr;;){if(s=_(m),0==s)break;u.buffer.push(j(s)),m++}break;case 1:Y(u),Q(u),$(u,"0x10,"+i,o),c="["+g.addr+", 0xE0, 0]",v=!0}p=Ln;break;case 5:switch(e){case 2:for(m=g.addr;;){if(s=h(m),0==s)break;u.buffer.push(j(s)),m+=4}break;case 1:Y(u),Q(u),$(u,"0x10,"+i,o),c="["+g.addr+", 0xE2, 0]",v=!0}p=Ln;break;case 8:case 9:case 10:case 11:Y(u),Q(u),u.code.push("var otype, retval;"),u.code.push("var oaddr = "+g.addr+";"),g.type>=9&&u.code.push("oaddr = Mem4(oaddr);"),11==g.type&&u.code.push("oaddr = Mem4(oaddr);"),u.code.push("otype = Mem1(oaddr);"),c="retval",v=!0,$(u,"0x10,"+i,o),u.code.push("if (otype >= 0xE0 && otype <= 0xFF) {"),u.code.push("retval = [oaddr, 0, 0];"),u.code.push("}"),u.code.push("else if (otype >= 0xC0 && otype <= 0xDF) {");var b=0;if(10==g.type||11==g.type){b=h(g.addr+4);for(var k=0;b>k;k++)u.code.push("tempcallargs["+k+"]="+h(g.addr+8+4*k)+";")}u.code.push("enter_function(oaddr, "+b+");"),u.code.push("retval = true;"),u.code.push("}"),u.code.push("else {"),u.code.push("fatal_error('Unknown object while decoding string indirect reference.', otype);"),u.code.push("}");break;default:G("Unknown entity in string decoding (cached).")}}}else{var y,x,F,v=!1;for(Jn||G("Attempted to print a compressed string with no table set."),x=_(o),i&&(x>>=i),y=h(Jn+8);!v;)switch(F=_(y),y++,F){case 0:y=1&x?h(y+4):h(y+0),7==i?(i=0,o++,x=_(o)):(i++,x>>=1);break;case 1:c=!1,v=!0;break;case 2:switch(s=_(y),e){case 2:u.buffer.push(j(s));break;case 1:Y(u),Q(u),$(u,"0x10,"+i,o),u.code.push("tempcallargs[0]="+s+";"),u.code.push("enter_function(iosysrock, 1);"),c=!0,v=!0}y=h(Jn+8);break;case 4:switch(s=h(y),e){case 2:u.buffer.push(j(s));break;case 1:Y(u),Q(u),$(u,"0x10,"+i,o),u.code.push("tempcallargs[0]="+s+";"),u.code.push("enter_function(iosysrock, 1);"),c=!0,v=!0}y=h(Jn+8);break;case 3:switch(e){case 2:for(;;){if(s=_(y),0==s)break;u.buffer.push(j(s)),y++}break;case 1:Y(u),Q(u),$(u,"0x10,"+i,o),c="["+y+", 0xE0, 0]",v=!0}y=h(Jn+8);break;case 5:switch(e){case 2:for(;;){if(s=h(y),0==s)break;u.buffer.push(j(s)),y+=4}break;case 1:Y(u),Q(u),$(u,"0x10,"+i,o),c="["+y+", 0xE2, 0]",v=!0}y=h(Jn+8);break;case 8:case 9:case 10:case 11:Y(u),Q(u),u.code.push("var otype, retval;"),u.code.push("var oaddr = "+h(y)+";"),(9==F||11==F)&&u.code.push("oaddr = Mem4(oaddr);"),u.code.push("otype = Mem1(oaddr);"),c="retval",v=!0,$(u,"0x10,"+i,o),u.code.push("if (otype >= 0xE0 && otype <= 0xFF) {"),u.code.push("retval = [oaddr, 0, 0];"),u.code.push("}"),u.code.push("else if (otype >= 0xC0 && otype <= 0xDF) {");var b=0;if(10==F||11==F){b=h(y+4);for(var k=0;b>k;k++)u.code.push("tempcallargs["+k+"]="+h(y+8+4*k)+";")}u.code.push("enter_function(oaddr, "+b+");"),u.code.push("retval = true;"),u.code.push("}"),u.code.push("else {"),u.code.push("fatal_error('Unknown object while decoding string indirect reference.', otype);"),u.code.push("}");break;default:G("Unknown entity in string decoding.",F)}}else if(224==a){var s;switch(e){case 2:for(;;){if(s=_(o),o++,0==s)break;u.buffer.push(j(s))}break;case 1:Y(u),Q(u),s=_(o),o++,0!=s?($(u,"0x13,0",o),u.code.push("tempcallargs[0]="+s+";"),u.code.push("enter_function(iosysrock, 1);"),c=!0):c="false"}}else if(226==a){var s;switch(e){case 2:for(;;){if(s=h(o),o+=4,0==s)break;u.buffer.push(j(s))}break;case 1:Y(u),Q(u),s=h(o),o+=4,0!=s?($(u,"0x14,0",o),u.code.push("tempcallargs[0]="+s+";"),u.code.push("enter_function(iosysrock, 1);"),c=!0):c="false"}}else a>=224&&255>=a?G("Attempt to print unknown type of string."):G("Attempt to print non-string.");return c?(Y(u),u.code.push("return "+c+";"),R(u.code.join("\n"),"nextcp,substring")):(u.code.length&&G("Simple-case string generated code."),u.buffer.join(""))}function Et(e,t){switch(e){case 0:return 196866;case 1:return 65793;case 2:return 1;case 3:return 1;case 4:switch(t){case 0:return 1;case 1:return 1;case 2:return 1;default:return 0}break;case 5:return 1;case 6:return 1;case 7:return 1;case 8:return Jt();case 9:return 1;case 10:return vn[t]?1:0;case 11:return 1;default:return 0}}function Tt(e,t,n){var r;if(En.length=t,1&n)for(r=0;t>r;r++)En[r]=_(e+r);else switch(t){case 4:En[0]=255&e>>24,En[1]=255&e>>16,En[2]=255&e>>8,En[3]=255&e;break;case 2:En[0]=255&e>>8,En[1]=255&e;break;case 1:En[0]=255&e;break;default:throw"Direct search key must hold one, two, or four bytes."}return En}function Zt(e,t,n,r,s,a,o){var i,c,u,l,h=0!=(4&o),f=0!=(2&o),d=Tt(e,t,o);for(c=0;s>c;c++,n+=r){for(u=!0,i=0;u&&t>i;i++)l=_(n+a+i),l!=d[i]&&(u=!1);if(u)return h?c:n;if(f){for(u=!0,i=0;u&&t>i;i++)l=_(n+a+i),0!=l&&(u=!1);if(u)break}}return h?4294967295:0}function Nt(e,t,n,r,s,a,o){var i,c,u,l,h,f,d,m,p=0!=(4&o),g=Tt(e,t,o);for(c=0,i=s;i>c;){for(h=0,l=i+c>>1,u=n+l*r,f=0;!h&&t>f;f++)d=_(u+a+f),m=g[f],m>d?h=-1:d>m&&(h=1);if(!h)return p?l:u;0>h?c=l+1:i=l}return p?4294967295:0}function zt(e,t,n,r,s,a){for(var o,i,c,u=0!=(2&a),l=Tt(e,t,a);0!=n;){for(c=!0,o=0;c&&t>o;o++)i=_(n+r+o),i!=l[o]&&(c=!1);if(c)return n;if(u){for(c=!0,o=0;c&&t>o;o++)i=_(n+r+o),0!=i&&(c=!1);if(c)break}n=h(n+s)}return 0}function jt(e){var t,n,r;return 2147483648&e?(t=!0,e=2147483647&e):t=!1,0==e?t?-0:0:2139095040==(2139095040&e)?0==(8388607&e)?t?-1/0:1/0:t?0/0:0/0:(r=255&e>>23,n=r?(8388608|8388607&e)/8388608*Math.pow(2,r-127):(8388607&e)/8388608*Math.pow(2,-126),t?-n:n)}function Mt(e){var t,n,r,s,a;return isNaN(e)?2139095041:isFinite(e)?0==e?0>1/e?2147483648:0:(0>e?(a=!0,t=-e):(a=!1,t=e),s=Math.floor(Math.log(t)/Math.log(2)),r=t/Math.pow(2,s),s>=128?a?4286578688:2139095040:(-126>s?(r*=Math.pow(2,126+s),s=0):(0!=s||0!=r)&&(s+=127,r-=1),r=8388608*r,n=r+.4999999999999999<<0,n>=8388608&&(n=0,s++,s>=255)?a?4286578688:2139095040:a?(2147483648|s<<23|n)>>>0:s<<23|n)):0>e?4286578688:2139095040}function Ut(){var e,t;Tn||G("There is no Glulx game file loaded."),Un=!0,ar=null,or=0,zn=null,jn=[],Mn=null,Xn=0,36>Tn.length&&G("This is too short to be a valid Glulx file."),e=i(Tn,0),1198290284!=e&&G("This is not a valid Glulx file."),t=i(Tn,4),131072>t&&G("This Glulx file is too old a version to execute."),t>=197120&&G("This Glulx file is too new a version to execute."),Dn=i(Tn,8),qn=i(Tn,12),Vn=i(Tn,16),$n=i(Tn,20),Qn=i(Tn,24),Hn=i(Tn,28),Yn=i(Tn,32),er=0,tr=0,(256>Dn||Dn>qn||qn>Vn)&&G("The segment boundaries in the header are in an impossible order."),qn!=Tn.length&&G("The game file length does not agree with the header."),An=!1,Wn={},In={},Ln=void 0,Bn=void 0,Gn=Array(8),Rn=Array(1),pt(0),Kn=Vn,Jn=0,sr=[],ir=0,cr=[],ur=[],Ot()}function Ot(){Yt();var e=qt();zn=null,zn=Tn.slice(0,qn),Kn=zn.length,Dt(Vn,!1),Vt(e),jn=[],Mn=null,Xn=0,nr=0,rr=0,kt(Hn),_t(Qn,0)}function Gt(e){result=[];for(var t=0;e.length>t;){for(var n=0;e.length>t&&0==e[t]&&255>=n;)n++,t++;for(n>0&&(result.push(0),result.push(n-1));e.length>t&&0!=e[t];)result.push(e[t]),t++}return result}function Rt(e){result=[];for(var t=0;e.length>t;){var n=e[t++];if(0==n)for(var r=e[t++]+1,s=0;r>s;s++)result.push(0);else result.push(n)}return result}function At(e){keys=[];for(var t in e)4!=t.length&&G("Bad chunk ID (must be exactly 4 chars): "+t),keys.push(t);keys.sort(),bytes=[];for(var n=0;keys.length>n;n++){var t=keys[n],r=e[t];p(bytes,t),g(bytes,r.length),bytes=bytes.concat(r)}return bytes}function Wt(e){chunks={};for(var t=0;e.length>t;){if(t+8>e.length)return s("IFF chunk header is truncated"),void 0;var n=k(e,t,4),r=i(e,t+4);if(t+=8,t+r>e.length)return s(n+" chunk is truncated "+"("+r+" bytes needed, "+(e.length-t)+" available"),void 0;chunks[n]=e.slice(t,t+r),t+=r}return chunks}function It(e){zn.length!=Kn&&G("Memory length was incorrect before save."),2!=nr&&G("Streams are only available in Glk I/O system.");var t=GiDispa.class_obj_from_id("stream",e);if(!t)return!1;chunks={},chunks.IFhd=Tn.slice(0,128),chunks.CMem=zn.slice(Dn);for(var n=Dn;Tn.length>n;n++)chunks.CMem[n-Dn]^=Tn[n];chunks.CMem=Gt(chunks.CMem),chunks.QFun=[];for(var n=0;jn.length>n;n++)g(chunks.QFun,jn[n].vmfunc.funcaddr);chunks.Stks=[];for(var n=0;jn.length>n;n++)L(jn[n],chunks.Stks);if(Xt()){chunks.MAll=[],g(chunks.MAll,ir),g(chunks.MAll,cr.length);for(var n=0;cr.length>n;n++)g(chunks.MAll,cr[n].addr),g(chunks.MAll,cr[n].size)}var r=[];p(r,"IFZS"),r=r.concat(At(chunks));var s=At({FORM:r});return Glk.glk_put_buffer_stream(t,s),!0}function Lt(e){2!=nr&&G("Streams are only available in Glk I/O system.");var t=GiDispa.class_obj_from_id("stream",e);if(!t)return!1;for(var n=Array(0),r=Array(1024),a=1;a>0;)a=Glk.glk_get_buffer_stream(t,r),n=n.concat(r.slice(0,a));if(n=Wt(n),!n)return s("vm_restore failed: file is not Quetzal"),!1;if(n=n.FORM,!n||"IFZS"!=k(n,0,4))return s("vm_restore failed: file doesn't start with FORM/IFZS header"),!1;var o=Wt(n.slice(4));if(!o.IFhd)return s("vm_restore failed: missing required IFhd chunk"),!1;for(var c=0;128>c;c++)if(o.IFhd[c]!=Tn[c])return s("vm_restore failed: this save image is for a different game"),!1;if(!o.CMem)return s("vm_restore failed: missing required CMem chunk"),!1;o.QFun||s("vm_restore failed: missing required QFun chunk"),o.Stks||s("vm_restore failed: missing required Stks chunk");var u=qt();Yt();var _=Rt(o.CMem);Dt(Dn+_.length,!1),zn=Tn.slice(0,Dn).concat(_);for(var c=Dn;Tn.length>c;c++)zn[c]^=Tn[c];for(var l=[],h=0;o.QFun.length>h;h+=4){var f=i(o.QFun,h),d=Wn[f];void 0===d&&(d=ct(f),Dn>f&&(Wn[f]=d)),l.push(d)}jn=[];for(var c=l.length-1;c>=0;c--)Mn=B(o.Stks,l[c]),Mn||G("vm_restore failed: bad stack frame"),jn.unshift(Mn);for(var c=0;jn.length>c;c++)jn[c].depth=c;if(Mn=jn[jn.length-1],o.MAll){ir=i(o.MAll,0);for(var m=i(o.MAll,4),p=ir,c=0;m>c;c++){var f=i(o.MAll,8+4*c),g=i(o.MAll,12+4*c);(p>f||f+g>Kn)&&G("vm_restore failed: corrupt dynamic heap"),cr.push(new Kt(f,g)),f>p&&ur.push(new Kt(p,f-p)),p=f+g}Kn>p&&ur.push(new Kt(p,Kn-p))}return Vt(u),!0}function Bt(){zn.length!=Kn&&G("Memory length was incorrect before saveundo.");var e={};e.ram=zn.slice(Dn),e.endmem=Kn,e.pc=Xn,e.stack=[];for(var t=0;jn.length>t;t++)e.stack[t]=I(jn[t]);e.heapstart=ir,e.usedlist=cr.slice(0),e.freelist=ur.slice(0),sr.push(e),sr.length>10&&sr.shift()}function Pt(){if(0==sr.length)return!1;
var e=sr.pop(),t=qt();return zn=zn.slice(0,Dn).concat(e.ram),Kn=e.endmem,jn=e.stack,Mn=jn[jn.length-1],Xn=e.pc,ir=e.heapstart,cr=e.usedlist,ur=e.freelist,Vt(t),zn.length!=Kn&&G("Memory length was incorrect after undo."),!0}function Dt(e,t){var n;if(e!=Kn){if(!t&&Xt()&&G("Cannot resize Glulx memory space while heap is active."),Vn>e&&G("Cannot resize Glulx memory space smaller than it started."),255&e&&G("Can only resize Glulx memory space to a 256-byte boundary."),zn.length=e,e>Kn)for(n=Kn;e>n;n++)zn[n]=0;Kn=e}}function qt(){if(er>=tr)return null;for(var e=tr-er,t={start:er,end:tr,len:e},n=zn.slice(er,tr);e>n.length;)n.push(0);return t.mem=n,t}function Vt(e){if(e){var t,n,r=e.mem,s=e.start,a=e.end;for(a>Kn&&(a=Kn),t=0,n=s;a>n;t++,n++)zn[n]=r[t]}}function $t(){var e,t,n,r=Tn.length;if(256>r||0!=(255&r))return 1;if(r!=i(Tn,12))return 1;for(n=i(Tn,32),t=-n>>>0,e=0;r>e;e+=4)t=t+i(Tn,e)>>>0;return t!=n?1:0}function Qt(){return Zn}function Ht(){var e={game_image_length:Tn.length,total_execution_time:_r,total_function_calls:lr,accel_function_calls:hr,total_path_calls:fr,paths_cached:dr,paths_compiled:mr,strings_cached:pr,strings_compiled:gr};return e}function Yt(){ir=0,cr=[],ur=[]}function Xt(){return cr.length>0}function Jt(){return ir}function Kt(e,t){this.addr=e,this.size=t,this.end=e+t}function en(e,t){for(var n=0,r=e.length;r>n;){var s=n+r>>1;t>e[s].addr?n=s+1:r=s}return n}function tn(e){Xt()||(ir=Kn);for(var t=0,n=ur.length;n>t;t++){var r=ur[t];if(r.size>=e){r.size>e?ur[t]=new Kt(r.addr+e,r.size-e):ur.splice(t,1);var s=en(cr,r.addr);return cr.splice(s,0,new Kt(r.addr,e)),r.addr}}var a=Kn,o=4294967040&e+255;return Dt(Kn+o,!0),o>e&&ur.push(new Kt(a+e,o-e)),cr.push(new Kt(a,e)),a}function nn(e){var t=en(cr,e),n=cr[t];if(n&&n.addr==e||G("Tried to free non-existent block"),cr.splice(t,1),0==cr.length)return Dt(ir,!0),Yt(),void 0;t=en(ur,e);var r=ur[t];r&&r.addr==n.end&&(n=new Kt(e,n.size+r.size),ur.splice(t,1));var s=ur[t-1];s&&s.end==n.addr&&(n=new Kt(s.addr,s.size+n.size),ur.splice(t-1,1),t-=1),ur.splice(t,0,n)}function rn(){if(!Xt())return 0!=ir&&G("Heap inconsistency: heapstart nonzero"),cr.length>0&&G("Heap inconsistency: usedlist nonempty"),ur.length>0&&G("Heap inconsistency: usedlist nonempty"),void 0;0==ir&&G("Heap inconsistency: heapstart is zero");for(var e=ir,t=0,n=0;cr.length>t||ur.length>n;){var r=cr[t],s=ur[n];r&&r.addr==e?(e+=r.size,t++):s&&s.addr==e?(e+=s.size,n++):G("Heap inconsistency: no block at address "+e)}e!=Kn&&G("Heap inconsistency: overrun at end of heap")}function sn(){var e,t,n,r,a;for(ar&&(mt(ar,or),ar=null,or=0),r=(new Date).getTime();!An;){e=Mn.vmfunc,t=e[nr],n=t[Xn],void 0===n&&(e.pathaddrs[Xn]=!0,n=ut(e,Xn,nr),mr++,Dn>Xn&&(t[Xn]=n,dr++)),fr++;try{n()}catch(o){if(o!==hn)throw o;An=!0,On=!0}}a=(new Date).getTime(),_r+=(a-r)/1e3,On&&Glk.glk_exit(),Glk.update(),s("### done executing; path time = "+(a-r)+" ms")}var an=Array(256),on=Array(256),cn=/[^a-zA-Z0-9 .,;:?!=_+()-]/g,un=null,_n={},ln={0:function(){},16:function(e,t){e.code.push(t[2]+"(("+t[0]+")+("+t[1]+")) >>>0);")},17:function(e,t){e.code.push(t[2]+"(("+t[0]+")-("+t[1]+")) >>>0);")},18:function(e,t){var n=X(e,t[0]),r=X(e,t[1]);e.code.push(t[2]+"(("+n+")*("+r+")) >>>0);")},19:function(e,t){var n=X(e,t[0]),r=X(e,t[1]),s=et(e);e.code.push(s+"=(("+n+")/("+r+"));"),e.code.push("if (!isFinite("+s+")) fatal_error('Division by zero.');"),e.code.push(t[2]+"("+s+">=0)?Math.floor("+s+"):(-Math.floor(-"+s+") >>>0));")},20:function(e,t){var n=X(e,t[0]),r=X(e,t[1]),s=et(e);e.code.push(s+"=(("+n+")%("+r+"));"),e.code.push("if (!isFinite("+s+")) fatal_error('Modulo division by zero.');"),e.code.push(t[2]+s+" >>>0);")},21:function(e,t){e.code.push(t[1]+"(-("+t[0]+")) >>>0);")},24:function(e,t){e.code.push(t[2]+"(("+t[0]+")&("+t[1]+")) >>>0);")},25:function(e,t){e.code.push(t[2]+"(("+t[0]+")|("+t[1]+")) >>>0);")},26:function(e,t){e.code.push(t[2]+"(("+t[0]+")^("+t[1]+")) >>>0);")},27:function(e,t){e.code.push(t[1]+"(~("+t[0]+")) >>>0);")},28:function(e,t){if(at(t[1])){var n=Number(t[1]);32>n?e.code.push(t[2]+"(("+t[0]+")<<"+n+") >>>0);"):e.code.push(t[2]+"0);")}else e.code.push(t[2]+"("+t[1]+"<32) ? (("+t[0]+"<<"+t[1]+") >>>0) : 0);")},29:function(e,t){if(at(t[1])){var n=Number(t[1]);32>n?e.code.push(t[2]+"(("+t[0]+")>>"+n+") >>>0);"):e.code.push(t[2]+"(("+t[0]+")&0x80000000) ? 0xffffffff : 0);")}else e.code.push("if ("+t[0]+" & 0x80000000) {"),e.code.push(t[2]+"("+t[1]+"<32) ? (("+t[0]+">>"+t[1]+") >>>0) : 0xffffffff);"),e.code.push("} else {"),e.code.push(t[2]+"("+t[1]+"<32) ? (("+t[0]+">>"+t[1]+") >>>0) : 0);"),e.code.push("}")},30:function(e,t){if(at(t[1])){var n=Number(t[1]);32>n?e.code.push(t[2]+"("+t[0]+")>>>"+n+");"):e.code.push(t[2]+"0);")}else e.code.push(t[2]+"("+t[1]+"<32) ? ("+t[0]+">>>"+t[1]+") : 0);")},32:function(e,t){K(e,t[0],!0),e.path_ends=!0},260:function(e,t){if(at(t[0])){var n=Number(t[0]);e.code.push("pc = "+n+";"),e.vmfunc.pathaddrs[n]=!0}else e.code.push("pc = "+t[0]+";");H(e),e.code.push("return;"),e.path_ends=!0},34:function(e,t){e.code.push("if (("+t[0]+")==0) {"),K(e,t[1]),e.code.push("}")},35:function(e,t){e.code.push("if (("+t[0]+")!=0) {"),K(e,t[1]),e.code.push("}")},36:function(e,t){e.code.push("if (("+t[0]+")==("+t[1]+")) {"),K(e,t[2]),e.code.push("}")},37:function(e,t){e.code.push("if (("+t[0]+")!=("+t[1]+")) {"),K(e,t[2]),e.code.push("}")},38:function(e,t){var n=X(e,t[0]),r=X(e,t[1]);e.code.push("if (("+n+")<("+r+")) {"),K(e,t[2]),e.code.push("}")},39:function(e,t){var n=X(e,t[0]),r=X(e,t[1]);e.code.push("if (("+n+")>=("+r+")) {"),K(e,t[2]),e.code.push("}")},40:function(e,t){var n=X(e,t[0]),r=X(e,t[1]);e.code.push("if (("+n+")>("+r+")) {"),K(e,t[2]),e.code.push("}")},41:function(e,t){var n=X(e,t[0]),r=X(e,t[1]);e.code.push("if (("+n+")<=("+r+")) {"),K(e,t[2]),e.code.push("}")},42:function(e,t){e.code.push("if (("+t[0]+")<("+t[1]+")) {"),K(e,t[2]),e.code.push("}")},43:function(e,t){e.code.push("if (("+t[0]+")>=("+t[1]+")) {"),K(e,t[2]),e.code.push("}")},44:function(e,t){e.code.push("if (("+t[0]+")>("+t[1]+")) {"),K(e,t[2]),e.code.push("}")},45:function(e,t){e.code.push("if (("+t[0]+")<=("+t[1]+")) {"),K(e,t[2]),e.code.push("}")},48:function(e,t){if(at(t[1])){var n,r=Number(t[1]);for(n=0;r>n;n++)if(e.offstack.length){var s=tt(e);e.code.push("tempcallargs["+n+"]="+s+";")}else e.code.push("tempcallargs["+n+"]=frame.valstack.pop();");H(e)}else e.varsused.ix=!0,H(e),e.code.push("for (ix=0; ix<"+t[1]+"; ix++) { tempcallargs[ix]=frame.valstack.pop(); }");$(e,t[2]),e.code.push("enter_function("+t[0]+", "+t[1]+");"),e.code.push("return;"),e.path_ends=!0},52:function(e,t){if(at(t[1])){var n,r=Number(t[1]);for(n=0;r>n;n++)if(e.offstack.length){var s=tt(e);e.code.push("tempcallargs["+n+"]="+s+";")}else e.code.push("tempcallargs["+n+"]=frame.valstack.pop();");H(e)}else e.varsused.ix=!0,H(e),e.code.push("for (ix=0; ix<"+t[1]+"; ix++) { tempcallargs[ix]=frame.valstack.pop(); }");e.code.push("leave_function();"),e.code.push("enter_function("+t[0]+", "+t[1]+");"),e.code.push("return;"),e.path_ends=!0},352:function(e,t){H(e),$(e,t[1]),e.code.push("enter_function("+t[0]+", 0);"),e.code.push("return;"),e.path_ends=!0},353:function(e,t){H(e),e.code.push("tempcallargs[0]=("+t[1]+");"),$(e,t[2]),e.code.push("enter_function("+t[0]+", 1);"),e.code.push("return;"),e.path_ends=!0},354:function(e,t){H(e),e.code.push("tempcallargs[0]=("+t[1]+");"),e.code.push("tempcallargs[1]=("+t[2]+");"),$(e,t[3]),e.code.push("enter_function("+t[0]+", 2);"),e.code.push("return;"),e.path_ends=!0},355:function(e,t){H(e),e.code.push("tempcallargs[0]=("+t[1]+");"),e.code.push("tempcallargs[1]=("+t[2]+");"),e.code.push("tempcallargs[2]=("+t[3]+");"),$(e,t[4]),e.code.push("enter_function("+t[0]+", 3);"),e.code.push("return;"),e.path_ends=!0},49:function(e,t){e.code.push("// quashing offstack for return: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0,e.code.push("leave_function();"),e.code.push("pop_callstub("+t[0]+");"),e.code.push("return;"),e.path_ends=!0},50:function(e,t){H(e),$(e,t[0]),e.code.push("store_operand("+t[0]+",frame.framestart+frame.framelen+4*frame.valstack.length);"),K(e,t[1],!0),e.path_ends=!0},51:function(e,t){e.code.push("// quashing offstack for throw: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0,e.code.push("pop_stack_to("+t[1]+");"),e.code.push("pop_callstub("+t[0]+");"),e.code.push("return;"),e.path_ends=!0},64:function(e,t){V(e,t[1],t[0])},65:function(e,t){V(e,t[1],t[0])},66:function(e,t){V(e,t[1],t[0])},68:function(e,t){var n;at(t[0])?(n=Number(t[0]),n=32768&n?(4294901760|n)>>>0:65535&n,e.code.push(t[1]+n+");")):e.code.push(t[1]+"("+t[0]+" & 0x8000) ? (("+t[0]+" | 0xffff0000) >>> 0) : ("+t[0]+" & 0xffff));")},69:function(e,t){var n;at(t[0])?(n=Number(t[0]),n=128&n?(4294967040|n)>>>0:255&n,e.code.push(t[1]+n+");")):e.code.push(t[1]+"("+t[0]+" & 0x80) ? (("+t[0]+" | 0xffffff00) >>> 0) : ("+t[0]+" & 0xff));")},72:function(e,t){var n,r;if(at(t[1]))if(at(t[0]))r=Number(t[0])+4*Number(t[1]),n="Mem4("+(r>>>0)+")";else{var r=4*Number(t[1]);n=r?"Mem4(("+t[0]+"+"+r+") >>>0)":"Mem4("+t[0]+")"}else n="Mem4(("+t[0]+"+4*"+t[1]+") >>>0)";e.code.push(t[2]+n+");")},73:function(e,t){var n,r;if(at(t[1]))if(at(t[0]))r=Number(t[0])+2*Number(t[1]),n="Mem2("+(r>>>0)+")";else{var r=2*Number(t[1]);n=r?"Mem2(("+t[0]+"+"+r+") >>>0)":"Mem2("+t[0]+")"}else n="Mem2(("+t[0]+"+2*"+t[1]+") >>>0)";e.code.push(t[2]+n+");")},74:function(e,t){var n,r;if(at(t[1]))if(at(t[0]))r=Number(t[0])+Number(t[1]),n="Mem1("+(r>>>0)+")";else{var r=Number(t[1]);n=r?"Mem1(("+t[0]+"+"+r+") >>>0)":"Mem1("+t[0]+")"}else n="Mem1(("+t[0]+"+"+t[1]+") >>>0)";e.code.push(t[2]+n+");")},76:function(e,t){var n,r;if(at(t[1]))if(at(t[0]))r=Number(t[0])+4*Number(t[1]),n=(r>>>0)+",";else{var r=4*Number(t[1]);n=r?"("+t[0]+"+"+r+") >>>0"+",":t[0]+","}else n="("+t[0]+"+4*"+t[1]+") >>>0"+",";e.code.push("MemW4("+n+t[2]+")"+";")},77:function(e,t){var n,r;if(at(t[1]))if(at(t[0]))r=Number(t[0])+2*Number(t[1]),n=(r>>>0)+",";else{var r=2*Number(t[1]);n=r?"("+t[0]+"+"+r+") >>>0"+",":t[0]+","}else n="("+t[0]+"+2*"+t[1]+") >>>0"+",";e.code.push("MemW2("+n+t[2]+")"+";")},78:function(e,t){var n,r;if(at(t[1]))if(at(t[0]))r=Number(t[0])+Number(t[1]),n=(r>>>0)+",";else{var r=Number(t[1]);n=r?"("+t[0]+"+"+r+") >>>0"+",":t[0]+","}else n="("+t[0]+"+"+t[1]+") >>>0"+",";e.code.push("MemW1("+n+t[2]+")"+";")},75:function(e,t){if(at(t[1])){var n,r,s;s=4294967295&Number(t[1]),n=7&s,at(t[0])?(r=Number(t[0]),s>=0?r+=s>>3:r-=1+(-1-s>>3)):r=s>=0?7>=s?t[0]:t[0]+"+"+(s>>3):t[0]+"-"+(1+(-1-s>>3)),e.code.push(t[2]+"(Mem1("+r+") & "+(1<<n)+")?1:0);")}else{e.varsused.bitx=!0,e.varsused.addrx=!0;var a=X(e,t[1],!0);e.code.push("bitx = "+a+"&7;"),e.code.push("if ("+a+">=0) addrx = "+t[0]+" + ("+a+">>3);"),e.code.push("else addrx = "+t[0]+" - (1+((-1-("+a+"))>>3));"),e.code.push(t[2]+"(Mem1(addrx) & (1<<bitx))?1:0);")}},79:function(e,t){var n,r,s,a;if(at(t[1]))a=4294967295&Number(t[1]),n=7&a,at(t[0])?(r=Number(t[0]),a>=0?r+=a>>3:r-=1+(-1-a>>3)):r=a>=0?7>=a?t[0]:t[0]+"+"+(a>>3):t[0]+"-"+(1+(-1-a>>3)),s=1<<n;else{e.varsused.bitx=!0,e.varsused.addrx=!0;var o=X(e,t[1],!0);e.code.push("bitx = "+o+"&7;"),e.code.push("if ("+o+">=0) addrx = "+t[0]+" + ("+o+">>3);"),e.code.push("else addrx = "+t[0]+" - (1+((-1-("+o+"))>>3));"),r="addrx",s="(1<<bitx)"}at(t[2])?Number(t[2])?e.code.push("MemW1("+r+", Mem1("+r+") | "+s+");"):e.code.push("MemW1("+r+", Mem1("+r+") & ~("+s+"));"):(e.code.push("if ("+t[2]+") MemW1("+r+", Mem1("+r+") | "+s+");"),e.code.push("else MemW1("+r+", Mem1("+r+") & ~("+s+"));"))},80:function(e,t){var n,r=e.offstack.length;n=r?"frame.valstack.length+"+r:"frame.valstack.length",V(e,t[0],n)},81:function(e,t){var n;if(at(t[0])){var r=Number(t[0]);n=e.offstack.length>r?e.offstack[e.offstack.length-(r+1)]:"frame.valstack[frame.valstack.length-"+(r+1-e.offstack.length)+"]"}else H(e),n="frame.valstack[frame.valstack.length-("+t[0]+"+1)]";V(e,t[1],n)},82:function(e){var t,n;2>e.offstack.length&&st(e,2),n=e.offstack.length,t=e.offstack[n-1],e.offstack[n-1]=e.offstack[n-2],e.offstack[n-2]=t},83:function(e,t){H(e),e.varsused.ix=!0,e.varsused.pos=!0,e.varsused.roll=!0,e.varsused.vals1=!0;var n=X(e,t[0],!0),r=X(e,t[1],!0);e.code.push("if ("+n+" > 0) {"),e.code.push("if ("+r+" > 0) {"),e.code.push("vals1 = "+r+" % "+n+";"),e.code.push("} else {"),e.code.push("vals1 = "+n+" - (-("+r+")) % "+n+";"),e.code.push("}"),e.code.push("if (vals1) {"),e.code.push("pos = frame.valstack.length - "+n+";"),e.code.push("roll = frame.valstack.slice(frame.valstack.length-vals1, frame.valstack.length).concat(frame.valstack.slice(pos, frame.valstack.length-vals1));"),e.code.push("for (ix=0; ix<"+n+"; ix++) { frame.valstack[pos+ix] = roll[ix]; }"),e.code.push("roll = undefined;"),e.code.push("}"),e.code.push("}")},84:function(e,t){if(H(e),at(t[0])){var n,r,s=Number(t[0]);for(n=0;s>n;n++)r=et(e,!0),e.offstack.push(r),e.code.push(r+"=frame.valstack[frame.valstack.length-"+(s-n)+"];")}else e.varsused.ix=!0,e.varsused.jx=!0,e.code.push("jx = frame.valstack.length-("+t[0]+");"),e.code.push("for (ix=0; ix<"+t[0]+"; ix++) { frame.valstack.push(frame.valstack[jx+ix]); }")},256:function(e,t){var n="do_gestalt(("+t[0]+"),("+t[1]+"))";e.code.push(t[2]+n+");")},257:function(e,t){e.code.push("fatal_error('User debugtrap encountered.', "+t[0]+");")},258:function(e,t){e.code.push(t[0]+"endmem);")},259:function(e,t){e.code.push("change_memsize("+t[0]+",false);"),e.code.push(t[1]+"0);")},272:function(e,t){var n;if(at(t[0])){var r=4294967295&Number(t[0]);n=0==r?"(Math.floor(random_func() * 0x10000) | (Math.floor(random_func() * 0x10000) << 16)) >>>0":r>0?"Math.floor(random_func() * "+r+")":"-Math.floor(random_func() * "+-r+")"}else{var s=X(e,t[0],!0),a=et(e);n=a,e.code.push("if ("+s+" > 0)"),e.code.push(a+" = Math.floor(random_func() * "+s+");"),e.code.push("else if ("+s+" < 0)"),e.code.push(a+" = -Math.floor(random_func() * -"+s+");"),e.code.push("else"),e.code.push(a+" = (Math.floor(random_func() * 0x10000) | (Math.floor(random_func() * 0x10000) << 16)) >>>0;")}e.code.push(t[1]+n+");")},273:function(e,t){e.code.push("set_random("+t[0]+");")},288:function(e){e.code.push("// quashing offstack for quit: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0,e.code.push("done_executing = true; vm_stopped = true;"),e.code.push("return;"),e.path_ends=!0},289:function(e,t){e.code.push(t[0]+"perform_verify());")},290:function(e){e.code.push("// quashing offstack for quit: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0,e.code.push("vm_restart();"),e.code.push("return;"),e.path_ends=!0},291:function(e,t){H(e),e.varsused.ix=!0,$(e,t[1]),e.code.push("ix = vm_save("+t[0]+");"),e.code.push("pop_callstub(ix ? 0 : 1);"),e.code.push("return;"),e.path_ends=!0},292:function(e,t){H(e),e.code.push("if (vm_restore("+t[0]+")) {"),e.code.push("pop_callstub((-1)>>>0);"),e.code.push("} else {"),V(e,t[1],"1"),H(e),e.code.push("pc = "+e.cp+";"),e.code.push("}"),e.code.push("return;"),e.path_ends=!0},293:function(e,t){H(e),$(e,t[0]),e.code.push("vm_saveundo();"),e.code.push("pop_callstub(0);"),e.code.push("return;"),e.path_ends=!0},294:function(e,t){H(e),e.code.push("if (vm_restoreundo()) {"),e.code.push("pop_callstub((-1)>>>0);"),e.code.push("} else {"),V(e,t[0],"1"),H(e),e.code.push("pc = "+e.cp+";"),e.code.push("}"),e.code.push("return;"),e.path_ends=!0},295:function(e,t){e.code.push("protectstart="+t[0]+";"),e.code.push("protectend=protectstart+("+t[1]+");"),e.code.push("if (protectstart==protectend) {"),e.code.push("  protectstart=0; protectend=0;"),e.code.push("}")},368:function(e,t){e.varsused.maddr=!0,e.varsused.mlen=!0,e.varsused.ix=!0,e.code.push("mlen="+t[0]+";"),e.code.push("maddr="+t[1]+";"),e.code.push("for (ix=0; ix<mlen; ix++, maddr++) MemW1(maddr, 0);")},369:function(e,t){e.varsused.msrc=!0,e.varsused.mdest=!0,e.varsused.mlen=!0,e.varsused.ix=!0,e.code.push("mlen="+t[0]+";"),e.code.push("msrc="+t[1]+";"),e.code.push("mdest="+t[2]+";"),e.code.push("if (mdest < msrc) {"),e.code.push("for (ix=0; ix<mlen; ix++, msrc++, mdest++) MemW1(mdest, Mem1(msrc));"),e.code.push("} else {"),e.code.push("msrc += (mlen-1); mdest += (mlen-1);"),e.code.push("for (ix=0; ix<mlen; ix++, msrc--, mdest--) MemW1(mdest, Mem1(msrc));"),e.code.push("}")},376:function(e,t){var n="heap_malloc("+t[0]+")";e.code.push(t[1]+n+");"),e.code.push("assert_heap_valid();")},377:function(e,t){e.code.push("heap_free("+t[0]+");"),e.code.push("assert_heap_valid();")},384:function(e,t){e.code.push("accel_address_map["+t[1]+"] = accel_func_map["+t[0]+"];")},385:function(e,t){e.code.push("if ("+t[0]+" < 9) {"),e.code.push("  accel_params["+t[0]+"] = "+t[1]+";"),e.code.push("}")},336:function(e,t){var n="linear_search(("+t[0]+"),("+t[1]+"),("+t[2]+"),("+t[3]+"),("+t[4]+"),("+t[5]+"),("+t[6]+"))";e.code.push(t[7]+n+");")},337:function(e,t){var n="binary_search(("+t[0]+"),("+t[1]+"),("+t[2]+"),("+t[3]+"),("+t[4]+"),("+t[5]+"),("+t[6]+"))";e.code.push(t[7]+n+");")},338:function(e,t){var n="linked_search(("+t[0]+"),("+t[1]+"),("+t[2]+"),("+t[3]+"),("+t[4]+"),("+t[5]+"))";e.code.push(t[6]+n+");")},112:function(e,t){switch(e.curiosys){case 2:if(at(t[0])){var n=255&Number(t[0]);e.code.push("Glk.glk_put_char("+n+");")}else e.code.push("Glk.glk_put_char(("+t[0]+")&0xff);");break;case 1:H(e),e.code.push("tempcallargs[0]=(("+t[0]+")&0xff);"),$(e,"0,0"),e.code.push("enter_function(iosysrock, 1);"),e.code.push("return;"),e.path_ends=!0;break;case 0:e.code.push("// null streamchar "+t[0])}},113:function(e,t){switch(e.curiosys){case 2:var n=X(e,t[0]);if(at(t[0])){var r=Number(n).toString(10);e.code.push("Glk.glk_put_jstring("+O(r)+", true);")}else e.code.push("Glk.glk_put_jstring(("+n+").toString(10), true);");break;case 1:H(e),e.code.push("stream_num("+e.cp+","+t[0]+", false, 0);"),e.code.push("return;"),e.path_ends=!0;break;case 0:e.code.push("// null streamnum "+t[0])}},114:function(e,t){H(e),e.code.push("if (stream_string("+e.cp+","+t[0]+", 0, 0)) return;")},115:function(e,t){switch(e.curiosys){case 2:if(at(t[0])){var n=Number(t[0]);e.code.push("Glk.glk_put_char_uni("+n+");")}else e.code.push("Glk.glk_put_char_uni("+t[0]+");");break;case 1:H(e),e.code.push("tempcallargs[0]=("+t[0]+");"),$(e,"0,0"),e.code.push("enter_function(iosysrock, 1);"),e.code.push("return;"),e.path_ends=!0;break;case 0:e.code.push("// null streamchar "+t[0])}},320:function(e,t){e.code.push(t[0]+"stringtable)")},321:function(e,t){e.code.push("set_string_table("+t[0]+");")},328:function(e,t){e.code.push(t[0]+"iosysmode)"),e.code.push(t[1]+"iosysrock)")},329:function(e,t){if(e.code.push("set_iosys("+t[0]+","+t[1]+");"),at(t[0])){var n=Number(t[0]);e.curiosys=n}else H(e),e.code.push("pc = "+e.cp+";"),e.code.push("return;"),e.path_ends=!0},400:function(e,t){var n=X(e,t[0]);if(at(t[0])){var r=Number(n);e.code.push(t[1]+Mt(r)+");")}else e.code.push(t[1]+"encode_float("+n+"));")},401:function(e,t){e.varsused.valf=!0,e.varsused.res=!0,e.code.push("valf = "+J(e,t[0])+";"),e.code.push("if (!("+t[0]+" & 0x80000000)) {"),e.code.push("  if (isNaN(valf) || !isFinite(valf) || (valf > 0x7fffffff))"),e.code.push("    res = 0x7fffffff;"),e.code.push("  else"),e.code.push("    res = Math.floor(valf);"),e.code.push("} else {"),e.code.push("  if (isNaN(valf) || !isFinite(valf) || (valf < -0x80000000))"),e.code.push("    res = -0x80000000;"),e.code.push("  else"),e.code.push("    res = Math.ceil(valf);"),e.code.push("}"),e.code.push(t[1]+"res>>>0);")},402:function(e,t){e.varsused.valf=!0,e.varsused.res=!0,e.code.push("valf = "+J(e,t[0])+";"),e.code.push("if (!("+t[0]+" & 0x80000000)) {"),e.code.push("  if (isNaN(valf) || !isFinite(valf))"),e.code.push("    res = 0x7fffffff;"),e.code.push("  else"),e.code.push("    res = Math.round(valf);"),e.code.push("  if (res > 0x7fffffff) res = 0x7fffffff;"),e.code.push("} else {"),e.code.push("  if (isNaN(valf) || !isFinite(valf))"),e.code.push("    res = -0x80000000;"),e.code.push("  else"),e.code.push("    res = Math.round(valf);"),e.code.push("  if (res < -0x80000000) res = -0x80000000;"),e.code.push("}"),e.code.push(t[1]+"res>>>0);")},408:function(e,t){var n=J(e,t[0]);e.code.push(t[1]+"encode_float(Math.ceil("+n+")));")},409:function(e,t){var n=J(e,t[0]);e.code.push(t[1]+"encode_float(Math.floor("+n+")));")},416:function(e,t){var n=J(e,t[0]),r=J(e,t[1]);e.code.push(t[2]+"encode_float("+n+" + "+r+"));")},417:function(e,t){var n=J(e,t[0]),r=J(e,t[1]);e.code.push(t[2]+"encode_float("+n+" - "+r+"));")},418:function(e,t){var n=J(e,t[0]),r=J(e,t[1]);e.code.push(t[2]+"encode_float("+n+" * "+r+"));")},419:function(e,t){var n=J(e,t[0]),r=J(e,t[1]);e.code.push(t[2]+"encode_float("+n+" / "+r+"));")},420:function(e,t){var n=J(e,t[0],!0),r=J(e,t[1],!0);e.varsused.modv=!0,e.varsused.quov=!0,e.code.push("modv=("+n+" % "+r+");"),e.code.push("quov=encode_float(("+n+" - modv) / "+r+");"),e.code.push("if (quov == 0x0 || quov == 0x80000000) {"),e.code.push("  quov = (("+t[0]+" ^ "+t[1]+") & 0x80000000) >>>0;"),e.code.push("}"),e.code.push(t[2]+"encode_float(modv));"),e.code.push(t[3]+"quov);")},424:function(e,t){var n=J(e,t[0]);e.code.push(t[1]+"encode_float(Math.sqrt("+n+")));")},425:function(e,t){var n=J(e,t[0]);e.code.push(t[1]+"encode_float(Math.exp("+n+")));")},426:function(e,t){var n=J(e,t[0]);e.code.push(t[1]+"encode_float(Math.log("+n+")));")},427:function(e,t){e.varsused.valf=!0;var n=J(e,t[0],!0),r=J(e,t[1],!0);e.code.push("if ("+t[0]+" == 0x3f800000) {"),e.code.push("  valf = 0x3f800000;"),e.code.push("} else if ("+t[0]+" == 0xbf800000 && ("+t[1]+" == 0xff800000 || "+t[1]+" == 0x7f800000)) {"),e.code.push("  valf = 0x3f800000;"),e.code.push("} else {"),e.code.push("  valf=encode_float(Math.pow("+n+", "+r+"));"),e.code.push("}"),e.code.push(t[2]+"valf);")},432:function(e,t){var n=J(e,t[0]);e.code.push(t[1]+"encode_float(Math.sin("+n+")));")},433:function(e,t){var n=J(e,t[0]);e.code.push(t[1]+"encode_float(Math.cos("+n+")));")},434:function(e,t){var n=J(e,t[0]);e.code.push(t[1]+"encode_float(Math.tan("+n+")));")},435:function(e,t){var n=J(e,t[0]);e.code.push(t[1]+"encode_float(Math.asin("+n+")));")},436:function(e,t){var n=J(e,t[0]);e.code.push(t[1]+"encode_float(Math.acos("+n+")));")},437:function(e,t){var n=J(e,t[0]);e.code.push(t[1]+"encode_float(Math.atan("+n+")));")},438:function(e,t){var n=J(e,t[0]),r=J(e,t[1]);e.code.push(t[2]+"encode_float(Math.atan2("+n+", "+r+")));")},448:function(e,t){var n,r,s,a;e.varsused.fequal=!0,e.varsused.fdiff=!0,e.code.push("if (("+t[2]+" & 0x7f800000) == 0x7f800000 && ("+t[2]+" & 0x007fffff) != 0) {"),e.code.push("  fequal = 0;"),e.code.push("} else if (("+t[0]+" == 0xff800000 || "+t[0]+" == 0x7f800000) && ("+t[1]+" == 0xff800000 || "+t[1]+" == 0x7f800000)) {"),e.code.push("  fequal = ("+t[0]+" == "+t[1]+");"),e.code.push("} else {"),at(t[2])?(n=Number(t[2]),a=""+jt(2147483647&n)):(n="decode_float(("+t[2]+") & 0x7fffffff)",a=et(e),e.code.push(a+"="+n+";")),r=J(e,t[0]),s=J(e,t[1]),e.code.push("  fdiff = "+s+" - "+r+";"),e.code.push("  fequal = (fdiff <= "+a+" && fdiff >= -("+a+"));"),e.code.push("}"),e.code.push("if (fequal) {"),K(e,t[3]),e.code.push("}")},449:function(e,t){var n,r,s,a;e.varsused.fequal=!0,e.varsused.fdiff=!0,e.code.push("if (("+t[2]+" & 0x7f800000) == 0x7f800000 && ("+t[2]+" & 0x007fffff) != 0) {"),e.code.push("  fequal = 0;"),e.code.push("} else if (("+t[0]+" == 0xff800000 || "+t[0]+" == 0x7f800000) && ("+t[1]+" == 0xff800000 || "+t[1]+" == 0x7f800000)) {"),e.code.push("  fequal = ("+t[0]+" == "+t[1]+");"),e.code.push("} else {"),at(t[2])?(n=Number(t[2]),a=""+jt(2147483647&n)):(n="decode_float(("+t[2]+") & 0x7fffffff)",a=et(e),e.code.push(a+"="+n+";")),r=J(e,t[0]),s=J(e,t[1]),e.code.push("  fdiff = "+s+" - "+r+";"),e.code.push("  fequal = (fdiff <= "+a+" && fdiff >= -("+a+"));"),e.code.push("}"),e.code.push("if (!fequal) {"),K(e,t[3]),e.code.push("}")},450:function(e,t){valf0=J(e,t[0]),valf1=J(e,t[1]),e.code.push("if ("+valf0+" < "+valf1+") {"),K(e,t[2]),e.code.push("}")},451:function(e,t){valf0=J(e,t[0]),valf1=J(e,t[1]),e.code.push("if ("+valf0+" <= "+valf1+") {"),K(e,t[2]),e.code.push("}")},452:function(e,t){valf0=J(e,t[0]),valf1=J(e,t[1]),e.code.push("if ("+valf0+" > "+valf1+") {"),K(e,t[2]),e.code.push("}")},453:function(e,t){valf0=J(e,t[0]),valf1=J(e,t[1]),e.code.push("if ("+valf0+" >= "+valf1+") {"),K(e,t[2]),e.code.push("}")},456:function(e,t){e.code.push("if (("+t[0]+" & 0x7f800000) == 0x7f800000 && ("+t[0]+" & 0x007fffff) != 0) {"),K(e,t[1]),e.code.push("}")},457:function(e,t){e.code.push("if ("+t[0]+" == 0xff800000 || "+t[0]+" == 0x7f800000) {"),K(e,t[1]),e.code.push("}")},304:function(e,t){var n;if(n=at(t[0])?Glk.call_may_not_return(Number(t[0])):!0,e.code.push("tempglkargs.length = "+t[1]+";"),at(t[1])){var r,s=Number(t[1]);for(r=0;s>r;r++)if(e.offstack.length){var a=tt(e);e.code.push("tempglkargs["+r+"]="+a+";")}else e.code.push("tempglkargs["+r+"]=frame.valstack.pop();");H(e)}else e.varsused.ix=!0,H(e),e.code.push("for (ix=0; ix<"+t[1]+"; ix++) { tempglkargs[ix]=frame.valstack.pop(); }");e.varsused.glkret=!0,e.code.push("glkret = GiDispa.get_function("+t[0]+")(tempglkargs);"),n&&(e.code.push("if (glkret === Glk.DidNotReturn) {"),e.code.push("  resumefuncop = "+q(t[2])+";"),e.code.push("  resumevalue = 0;"),e.code.push("  pc = "+e.cp+";"),e.code.push("  done_executing = true;"),e.code.push("  return;"),e.code.push("}")),V(e,t[2],"glkret")}},hn={dummy:"The top-level function has returned."},fn=void 0,dn,mn,pn={},gn=[0,0,0,0,0,0,0,0,0],vn={1:function wn(e,t){if(1>e)return 0;var n=t[0];if(36>n)return 0;if(n>=Kn)return 0;var r=_(n);return r>=224?3:r>=192?2:r>=112&&127>=r&&n>=Dn?1:0},2:function bn(e,t){var n=e>0?t[0]:0,r=e>1?t[1]:0;if(1!=vn[1](e,t))return Glk.glk_put_jstring('\n[** Programming error: tried to find the "." of (something) **]\n'),0;var s=h(n+16);if(!s)return 0;var a=h(s);return s+=4,Nt(r,2,s,10,a,0,0)},3:function kn(e,t){var n=e>0?t[0]:0,r=e>1?t[1]:0,s=bt(n,r);return 0==s?0:h(s+4)},4:function yn(e,t){var n=e>0?t[0]:0,r=e>1?t[1]:0,s=bt(n,r);return 0==s?0:4*l(s+2)},5:function xn(e,t){var n,r,s,a,o,i=e>0?t[0]:0,c=e>1?t[1]:0;if(n=vn[1](e,t),3==n)return c==gn[5]?1:0;if(2==n)return c==gn[4]?1:0;if(1!=n)return 0;if(c==gn[2])return wt(i)?1:i==gn[2]?1:i==gn[5]?1:i==gn[4]?1:i==gn[3]?1:0;if(c==gn[3])return wt(i)?0:i==gn[2]?0:i==gn[5]?0:i==gn[4]?0:i==gn[3]?0:1;if(c==gn[5]||c==gn[4])return 0;if(!wt(c))return Glk.glk_put_jstring("\n[** Programming error: tried to apply 'ofclass' with non-class **]\n"),0;if(r=bt(i,2),0==r)return 0;if(s=h(r+4),0==s)return 0;for(a=l(r+2),o=0;a>o;o++)if(h(s+4*o)==c)return 1;return 0},6:function Fn(e,t){var n,r=e>1?t[1]:0;return n=vn[3](e,t),0==n?r>0&&gn[1]>r?h(gn[8]+4*r):(Glk.glk_put_jstring("\n[** Programming error: tried to read (something) **]\n"),0):h(n)},7:function Cn(e,t){var n=e>0?t[0]:0,r=e>1?t[1]:0,s=gn[1],a=vn[1](e,t);return 3==a?r==s+6?1:r==s+7?1:0:2==a?r==s+5?1:0:1!=a?0:r>=s&&s+8>r&&wt(n)?1:vn[3](e,t)?1:0}},Sn=[0,0],En=[],Tn=null,Zn=null,Nn=null,zn,jn,Mn,Un=!1,On=!1,Gn,Rn,An,Wn,In,Ln,Bn,Pn,Dn,qn,Vn,$n,Qn,Hn,Yn,Xn,Jn,Kn,er,tr,nr,rr,sr,ar,or,ir,cr,ur,_r=0,lr=0,hr=0,fr=0,dr=0,mr=0,pr=0,gr=0;return{version:"1.1.1",prepare:e,init:t,resume:n,get_signature:Qt,get_statistics:Ht,ReadByte:C,WriteByte:S,ReadWord:E,WriteWord:T,ReadStructField:Z,WriteStructField:N,SetResumeStore:z}}(),GiDispa=function(){function e(e){E=e}function t(e,t,n){this.id=e,this.name=t,this.proto=n}function n(e,t){this.args=e,this.retarg=t}function r(){this.macro="Byte",this.refsize=1}function s(){this.macro="Word",this.refsize=4}function a(e){this.signed=e,this.macro="Byte",this.refsize=1,this.literal=e?"arg_char_signed":"arg_char_unsigned"}function o(e){this.signed=e,this.macro="Word",this.refsize=4,this.literal=e?"arg_int_signed":"arg_int_unsigned"}function i(e){this.name=e,this.macro="Word",this.refsize=4}function c(e){this.form=e}function u(e,t,n,r){this.arg=e,this.passin=t,this.passout=n,this.nonnull=r}function _(e,t,n,r,s){this.arg=e,this.retained=t,this.passin=n,this.passout=r,this.nonnull=s}function l(e,t,n){return e instanceof o?t?e.signed?n+" & 0xFFFFFFFF":n:"0":e instanceof a?t?e.signed?"cast_signed_char("+n+")":n+" & 0xFF":"0":e instanceof i?t?'class_obj_from_id("'+e.name+'", '+n+")":"null":"???"}function h(e,t){return e instanceof o?t+" >>> 0":e instanceof a?e.signed?"uncast_signed_char("+t+")":t+" & 0xFF":e instanceof i?'class_obj_to_id("'+e.name+'", '+t+")":"???"}function f(e){return e=255&e,128&e&&(e-=256),e}function d(e){return e=255&e,128&e&&(e+=4294967040),e}function m(e,t){return t?t.disprock:0}function p(e,t){return 0==t?null:D[e][t]}function g(e){var t,n,f,d,m,p,g,v,w,b,k,y,x,F,C=[],S={},E=0;for(C.push("// no local vars"),C.push("// "+e.id+": "+e.name),f=e.proto,d=null,f.retarg&&(d=f.retarg.arg),F=Glk.call_may_not_return(e.id),m=0,p=[],t=0;f.args.length>t;t++)if(v=f.args[t],b="glka"+t,p.push(b),S[b]=!0,v instanceof o||v instanceof a||v instanceof i)k=l(v,!0,"callargs["+m+"]"),C.push(b+" = "+k+";"),m+=1;else if(v instanceof u){if(w=v.arg,C.push("if (callargs["+m+"] == 0) {"),v.nonnull?C.push('  throw("glk '+e.name+': null argument");'):C.push("  "+b+" = null;"),C.push("} else {"),w instanceof o||w instanceof a||w instanceof i)C.push("  "+b+" = new Glk.RefBox();"),k=l(w,v.passin,"VM.ReadWord(callargs["+m+"])"),C.push("  "+b+".set_value("+k+");");else{if(!(w instanceof c))throw"buildfunc: unsupported refarg type: "+e.name;for(g=w.form.args,C.push("  "+b+" = new Glk.RefStruct("+g.length+");"),n=0;g.length>n;n++)k=l(g[n],v.passin,"VM.ReadStructField(callargs["+m+"], "+n+")"),C.push("  "+b+".push_field("+k+");")}C.push("}"),m+=1}else if(v instanceof _)S.glklen=!0,w=v.arg,C.push("if (callargs["+m+"] == 0) {"),v.nonnull?C.push('  throw("glk '+e.name+': null argument");'):C.push("  "+b+" = null;"),C.push("} else {"),C.push("  glklen = callargs["+(m+1)+"];"),C.push("  "+b+" = Array(glklen);"),v.passin&&(S.ix=!0,S.jx=!0,C.push("  for (ix=0, jx=callargs["+m+"]; ix<glklen; ix++, jx+="+w.refsize+") {"),k=l(w,!0,"VM.Read"+w.macro+"(jx)"),C.push("    "+b+"[ix] = "+k+";"),C.push("  }")),v.retained&&(0==E&&C.push("  temp_arg_arrays.length = 0;"),E+=1,C.push("  make_arg_array("+b+", callargs["+m+"], glklen, "+w.literal+");")),C.push("}"),m+=2;else{if(!(v instanceof r||v instanceof s))throw"buildfunc: unsupported arg type: "+e.name;S.ix=!0,S.jx=!0;var T,Z;v instanceof r?(Z="0xE0",T="byte_array_to_string"):(Z="0xE2",T="uni_array_to_string"),C.push(b+" = Array();"),C.push("jx = callargs["+m+"];"),C.push("if (VM.ReadByte(jx) != "+Z+') throw("glk '+e.name+': string argument must be unencoded");'),C.push("for (jx+="+v.refsize+"; true; jx+="+v.refsize+") {"),C.push("  ix = VM.Read"+v.macro+"(jx);"),C.push("  if (ix == 0) break;"),C.push("  "+b+".push(ix);"),C.push("}"),C.push(b+" = Glk."+T+"("+b+");"),m+=1}for(C.push("if (callargs.length != "+m+') throw "glk '+e.name+': wrong number of arguments";'),d||F?(S.glkret=!0,y="glkret = "):y="",C.push(y+"Glk.glk_"+e.name+"("+p.join(", ")+");"),F&&(C.push("if (glkret === Glk.DidNotReturn) {"),C.push("  set_blocked_selector("+e.id+", callargs);"),C.push("  return glkret;"),C.push("}")),m=0,t=0;f.args.length>t;t++)if(v=f.args[t],b="glka"+t,v instanceof o||v instanceof a||v instanceof i)m+=1;else if(v instanceof u){if(w=v.arg,v.passout){if(C.push("if ("+b+") {"),w instanceof o||w instanceof a||w instanceof i)k=h(w,b+".get_value()"),C.push("  VM.WriteWord(callargs["+m+"], "+k+");");else{if(!(w instanceof c))throw"buildfunc: unsupported refarg type: "+e.name;for(g=w.form.args,n=0;g.length>n;n++)k=h(g[n],b+".get_field("+n+")"),C.push("  VM.WriteStructField(callargs["+m+"], "+n+", "+k+");")}C.push("}")}m+=1}else if(v instanceof _)w=v.arg,v.passout&&!v.retained&&(C.push("if ("+b+") {"),S.ix=!0,S.jx=!0,C.push("  for (ix=0, jx=callargs["+m+"]; ix<glklen; ix++, jx+="+w.refsize+") {"),k=h(w,b+"[ix]"),C.push("    VM.Write"+w.macro+"(jx, "+k+")"),C.push("  }"),C.push("}")),m+=2;else{if(!(v instanceof r||v instanceof s))throw"buildfunc: unsupported arg type: "+e.name;m+=1}0!=E&&C.push("temp_arg_arrays.length = 0;"),d?(k=h(d,"glkret"),C.push("return "+k+";")):C.push("return 0;"),x=[];
for(k in S)x.push(k);return x.length&&(C[0]="var "+x.join(", ")+";"),k=C.join("\n"),eval("function _func(callargs) {\n"+k+"\n}"),_func}function v(e){var t,n=W[e];if(void 0===n){if(t=A[e],void 0===t)throw"dispatch: unknown Glk function: "+e;n=g(t),W[e]=n}return n}function w(e,t){I=e,L=t.slice(0)}function b(e){192==I?0!=L[0]&&(E.WriteStructField(L[0],0,e.get_field(0)>>>0),E.WriteStructField(L[0],1,m("window",e.get_field(1))),E.WriteStructField(L[0],2,e.get_field(2)>>>0),E.WriteStructField(L[0],3,e.get_field(3)>>>0)):98==I&&E.SetResumeStore(m("fileref",e)),I=null,L=null}function k(e,t,n,r){var s;e&&(s={arr:e,addr:t,len:n,arg:r},B.push(s))}function y(e){var t,n;if(e){for(n=void 0,t=0;B.length>t;t++)if(B[t].arr===e){n=B[t];break}if(void 0===n)throw"retain_array: array is not an argument";for(t=0;void 0!==P[t];t++);P[t]=n}}function x(e){var t,n,r;if(e){for(r=void 0,t=0;P.length>t;t++)if(void 0!==P[t]&&P[t].arr===e){r=P[t],delete P[t];break}if(void 0===r)throw"unretain_array: array was never retained";if(r.arg instanceof o)for(t=0,n=r.addr;r.len>t;t++,n+=4)E.WriteWord(n,r.arr[t]>>>0);else{if(!(r.arg instanceof a))throw"unretain_array: unsupported refarg type";if(r.arg.signed)for(t=0,n=r.addr;r.len>t;t++,n++)E.WriteByte(n,d(r.arr[t]));else for(t=0,n=r.addr;r.len>t;t++,n++)E.WriteByte(n,255&r.arr[t])}}}function F(e,t){if(t.disprock)throw"class_register: object is already registered";t.disprock=q,q++,D[e][t.disprock]=t}function C(e,t){if(!t.disprock||void 0===D[e][t.disprock])throw"class_unregister: object is not registered";delete D[e][t.disprock],t.disprock=void 0}function S(){var e,t;q=1+Math.round(1e3*Math.random());for(e in T)t=T[e],D[t]={}}var E=null,T={0:"window",1:"stream",2:"fileref",3:"schannel"},Z=new o(!1),N=new o(!0),z=new a(!1),j=new a(null),M=new a(!0),U=new i("window"),O=new i("stream"),G=new i("fileref"),R=new i("schannel"),A={1:new t(1,"exit",new n([],null)),3:new t(3,"tick",new n([],null)),4:new t(4,"gestalt",new n([Z,Z],new u(Z,!1,!0,!0))),5:new t(5,"gestalt_ext",new n([Z,Z,new _(Z,!1,!0,!0,!1)],new u(Z,!1,!0,!0))),32:new t(32,"window_iterate",new n([U,new u(Z,!1,!0,!1)],new u(U,!1,!0,!0))),33:new t(33,"window_get_rock",new n([U],new u(Z,!1,!0,!0))),34:new t(34,"window_get_root",new n([],new u(U,!1,!0,!0))),35:new t(35,"window_open",new n([U,Z,Z,Z,Z],new u(U,!1,!0,!0))),36:new t(36,"window_close",new n([U,new u(new c(new n([Z,Z],null)),!1,!0,!1)],null)),37:new t(37,"window_get_size",new n([U,new u(Z,!1,!0,!1),new u(Z,!1,!0,!1)],null)),38:new t(38,"window_set_arrangement",new n([U,Z,Z,U],null)),39:new t(39,"window_get_arrangement",new n([U,new u(Z,!1,!0,!1),new u(Z,!1,!0,!1),new u(U,!1,!0,!1)],null)),40:new t(40,"window_get_type",new n([U],new u(Z,!1,!0,!0))),41:new t(41,"window_get_parent",new n([U],new u(U,!1,!0,!0))),42:new t(42,"window_clear",new n([U],null)),43:new t(43,"window_move_cursor",new n([U,Z,Z],null)),44:new t(44,"window_get_stream",new n([U],new u(O,!1,!0,!0))),45:new t(45,"window_set_echo_stream",new n([U,O],null)),46:new t(46,"window_get_echo_stream",new n([U],new u(O,!1,!0,!0))),47:new t(47,"set_window",new n([U],null)),48:new t(48,"window_get_sibling",new n([U],new u(U,!1,!0,!0))),64:new t(64,"stream_iterate",new n([O,new u(Z,!1,!0,!1)],new u(O,!1,!0,!0))),65:new t(65,"stream_get_rock",new n([O],new u(Z,!1,!0,!0))),66:new t(66,"stream_open_file",new n([G,Z,Z],new u(O,!1,!0,!0))),67:new t(67,"stream_open_memory",new n([new _(j,!0,!0,!0,!0),Z,Z],new u(O,!1,!0,!0))),68:new t(68,"stream_close",new n([O,new u(new c(new n([Z,Z],null)),!1,!0,!1)],null)),69:new t(69,"stream_set_position",new n([O,N,Z],null)),70:new t(70,"stream_get_position",new n([O],new u(Z,!1,!0,!0))),71:new t(71,"stream_set_current",new n([O],null)),72:new t(72,"stream_get_current",new n([],new u(O,!1,!0,!0))),96:new t(96,"fileref_create_temp",new n([Z,Z],new u(G,!1,!0,!0))),97:new t(97,"fileref_create_by_name",new n([Z,new r,Z],new u(G,!1,!0,!0))),98:new t(98,"fileref_create_by_prompt",new n([Z,Z,Z],new u(G,!1,!0,!0))),99:new t(99,"fileref_destroy",new n([G],null)),100:new t(100,"fileref_iterate",new n([G,new u(Z,!1,!0,!1)],new u(G,!1,!0,!0))),101:new t(101,"fileref_get_rock",new n([G],new u(Z,!1,!0,!0))),102:new t(102,"fileref_delete_file",new n([G],null)),103:new t(103,"fileref_does_file_exist",new n([G],new u(Z,!1,!0,!0))),104:new t(104,"fileref_create_from_fileref",new n([Z,G,Z],new u(G,!1,!0,!0))),128:new t(128,"put_char",new n([z],null)),129:new t(129,"put_char_stream",new n([O,z],null)),130:new t(130,"put_string",new n([new r],null)),131:new t(131,"put_string_stream",new n([O,new r],null)),132:new t(132,"put_buffer",new n([new _(j,!1,!0,!1,!0)],null)),133:new t(133,"put_buffer_stream",new n([O,new _(j,!1,!0,!1,!0)],null)),134:new t(134,"set_style",new n([Z],null)),135:new t(135,"set_style_stream",new n([O,Z],null)),144:new t(144,"get_char_stream",new n([O],new u(N,!1,!0,!0))),145:new t(145,"get_line_stream",new n([O,new _(j,!1,!1,!0,!0)],new u(Z,!1,!0,!0))),146:new t(146,"get_buffer_stream",new n([O,new _(j,!1,!1,!0,!0)],new u(Z,!1,!0,!0))),160:new t(160,"char_to_lower",new n([z],new u(z,!1,!0,!0))),161:new t(161,"char_to_upper",new n([z],new u(z,!1,!0,!0))),176:new t(176,"stylehint_set",new n([Z,Z,Z,N],null)),177:new t(177,"stylehint_clear",new n([Z,Z,Z],null)),178:new t(178,"style_distinguish",new n([U,Z,Z],new u(Z,!1,!0,!0))),179:new t(179,"style_measure",new n([U,Z,Z,new u(Z,!1,!0,!1)],new u(Z,!1,!0,!0))),192:new t(192,"select",new n([new u(new c(new n([Z,U,Z,Z],null)),!1,!0,!0)],null)),193:new t(193,"select_poll",new n([new u(new c(new n([Z,U,Z,Z],null)),!1,!0,!0)],null)),208:new t(208,"request_line_event",new n([U,new _(j,!0,!0,!0,!0),Z],null)),209:new t(209,"cancel_line_event",new n([U,new u(new c(new n([Z,U,Z,Z],null)),!1,!0,!1)],null)),210:new t(210,"request_char_event",new n([U],null)),211:new t(211,"cancel_char_event",new n([U],null)),212:new t(212,"request_mouse_event",new n([U],null)),213:new t(213,"cancel_mouse_event",new n([U],null)),214:new t(214,"request_timer_events",new n([Z],null)),224:new t(224,"image_get_info",new n([Z,new u(Z,!1,!0,!1),new u(Z,!1,!0,!1)],new u(Z,!1,!0,!0))),225:new t(225,"image_draw",new n([U,Z,N,N],new u(Z,!1,!0,!0))),226:new t(226,"image_draw_scaled",new n([U,Z,N,N,Z,Z],new u(Z,!1,!0,!0))),232:new t(232,"window_flow_break",new n([U],null)),233:new t(233,"window_erase_rect",new n([U,N,N,Z,Z],null)),234:new t(234,"window_fill_rect",new n([U,Z,N,N,Z,Z],null)),235:new t(235,"window_set_background_color",new n([U,Z],null)),240:new t(240,"schannel_iterate",new n([R,new u(Z,!1,!0,!1)],new u(R,!1,!0,!0))),241:new t(241,"schannel_get_rock",new n([R],new u(Z,!1,!0,!0))),242:new t(242,"schannel_create",new n([Z],new u(R,!1,!0,!0))),243:new t(243,"schannel_destroy",new n([R],null)),248:new t(248,"schannel_play",new n([R,Z],new u(Z,!1,!0,!0))),249:new t(249,"schannel_play_ext",new n([R,Z,Z,Z],new u(Z,!1,!0,!0))),250:new t(250,"schannel_stop",new n([R],null)),251:new t(251,"schannel_set_volume",new n([R,Z],null)),252:new t(252,"sound_load_hint",new n([Z,Z],null)),256:new t(256,"set_hyperlink",new n([Z],null)),257:new t(257,"set_hyperlink_stream",new n([O,Z],null)),258:new t(258,"request_hyperlink_event",new n([U],null)),259:new t(259,"cancel_hyperlink_event",new n([U],null)),288:new t(288,"buffer_to_lower_case_uni",new n([new _(Z,!1,!0,!0,!0),Z],new u(Z,!1,!0,!0))),289:new t(289,"buffer_to_upper_case_uni",new n([new _(Z,!1,!0,!0,!0),Z],new u(Z,!1,!0,!0))),290:new t(290,"buffer_to_title_case_uni",new n([new _(Z,!1,!0,!0,!0),Z,Z],new u(Z,!1,!0,!0))),291:new t(291,"buffer_canon_decompose_uni",new n([new _(Z,!1,!0,!0,!0),Z],new u(Z,!1,!0,!0))),292:new t(292,"buffer_canon_normalize_uni",new n([new _(Z,!1,!0,!0,!0),Z],new u(Z,!1,!0,!0))),296:new t(296,"put_char_uni",new n([Z],null)),297:new t(297,"put_string_uni",new n([new s],null)),298:new t(298,"put_buffer_uni",new n([new _(Z,!1,!0,!1,!0)],null)),299:new t(299,"put_char_stream_uni",new n([O,Z],null)),300:new t(300,"put_string_stream_uni",new n([O,new s],null)),301:new t(301,"put_buffer_stream_uni",new n([O,new _(Z,!1,!0,!1,!0)],null)),304:new t(304,"get_char_stream_uni",new n([O],new u(N,!1,!0,!0))),305:new t(305,"get_buffer_stream_uni",new n([O,new _(Z,!1,!1,!0,!0)],new u(Z,!1,!0,!0))),306:new t(306,"get_line_stream_uni",new n([O,new _(Z,!1,!1,!0,!0)],new u(Z,!1,!0,!0))),312:new t(312,"stream_open_file_uni",new n([G,Z,Z],new u(O,!1,!0,!0))),313:new t(313,"stream_open_memory_uni",new n([new _(Z,!0,!0,!0,!0),Z,Z],new u(O,!1,!0,!0))),320:new t(320,"request_char_event_uni",new n([U],null)),321:new t(321,"request_line_event_uni",new n([U,new _(Z,!0,!0,!0,!0),Z],null)),336:new t(336,"set_echo_line_event",new n([U,Z],null)),337:new t(337,"set_terminators_line_event",new n([U,new _(Z,!1,!0,!1,!1)],null)),352:new t(352,"current_time",new n([new u(new c(new n([N,Z,N],null)),!1,!0,!0)],null)),353:new t(353,"current_simple_time",new n([Z],new u(N,!1,!0,!0))),360:new t(360,"time_to_date_utc",new n([new u(new c(new n([N,Z,N],null)),!0,!1,!0),new u(new c(new n([N,N,N,N,N,N,N,N],null)),!1,!0,!0)],null)),361:new t(361,"time_to_date_local",new n([new u(new c(new n([N,Z,N],null)),!0,!1,!0),new u(new c(new n([N,N,N,N,N,N,N,N],null)),!1,!0,!0)],null)),362:new t(362,"simple_time_to_date_utc",new n([N,Z,new u(new c(new n([N,N,N,N,N,N,N,N],null)),!1,!0,!0)],null)),363:new t(363,"simple_time_to_date_local",new n([N,Z,new u(new c(new n([N,N,N,N,N,N,N,N],null)),!1,!0,!0)],null)),364:new t(364,"date_to_time_utc",new n([new u(new c(new n([N,N,N,N,N,N,N,N],null)),!0,!1,!0),new u(new c(new n([N,Z,N],null)),!1,!0,!0)],null)),365:new t(365,"date_to_time_local",new n([new u(new c(new n([N,N,N,N,N,N,N,N],null)),!0,!1,!0),new u(new c(new n([N,Z,N],null)),!1,!0,!0)],null)),366:new t(366,"date_to_simple_time_utc",new n([new u(new c(new n([N,N,N,N,N,N,N,N],null)),!0,!1,!0),Z],new u(N,!1,!0,!0))),367:new t(367,"date_to_simple_time_local",new n([new u(new c(new n([N,N,N,N,N,N,N,N],null)),!0,!1,!0),Z],new u(N,!1,!0,!0)))},W={},I=null,L=null,B=[],P=[],D={},q;return S(),{set_vm:e,get_function:v,prepare_resume:b,class_register:F,class_unregister:C,class_obj_to_id:m,class_obj_from_id:p,retain_array:y,unretain_array:x}}();