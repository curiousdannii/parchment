<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Parchment</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
    <script src="dist/web/jquery.min.js"></script>
    <script src="dist/web/ie.js" nomodule></script>
    <script src="dist/web/main.js" type="module"></script>
<script>navigator.serviceWorker.register("service-worker.js")</script>
<link rel="manifest" href="manifest.json" />    <link rel="stylesheet" href="dist/web/web.css">
</head>
<body>
    <div id="gameport">
        <div id="about">
            <h1>Parchment</h1>
            <p>is an interpreter for Interactive Fiction. <a href="https://github.com/curiousdannii/parchment">Find out more.</a></p>
            <p>Find stories to play at the <a href="https://ifdb.org/">Interactive Fiction Database</a>.</p>
            <p id="play-url">
                <input id="play-url-input" placeholder="Enter a URL of a story file" type="url">
                <button id="play-url-button">Go</button>
            </p>
            <p id="play-url-error"></p>
            <label id="custom-file-upload" for="file-upload" tabindex="0" role="button">
                <p>Or, click here to play a story file on your device</p>
            </label>
            <input id="file-upload" type="file" style="display: none"/>
            <button id="pwainstallbutton" type="button">
                Install
            </button>
            <noscript><p>Parchment requires Javascript. Please enable it in your browser.</p></noscript>
        </div>
        <div id="windowport"></div>
        <div id="loadingpane" style="display:none;">
            <img src="dist/web/waiting.gif" alt="LOADING"><br>
            <em>&nbsp;&nbsp;&nbsp;Loading...</em>
        </div>
        <div id="errorpane" style="display:none;"><div id="errorcontent">...</div></div>
    </div>
</body>

<!-- This allows us to display an on-screen Install button in addition to the automatic browser prompt 
     Feel free to move this script elsewhere -->
<script>
    // Initialize deferredPrompt for use later to show browser install prompt.
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  // Prevent the mini-infobar from appearing on mobile
  e.preventDefault();
  // Stash the event so it can be triggered later.
  deferredPrompt = e;
});

const pwainstallbutton = document.getElementById('pwainstallbutton');

pwainstallbutton.addEventListener('click', async () => {
  const promptEvent = deferredPrompt;
  if (!promptEvent) {
    // The deferred prompt isn't available.
    console.log("no event available")
    return;
  }
  // Show the install prompt.
  promptEvent.prompt();
  // Log the result
  const result = await promptEvent.userChoice;

  window.deferredPrompt = null;
});
</script>

</html>