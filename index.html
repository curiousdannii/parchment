<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Parchment</title>
    <meta name="viewport" content="width=device-width,user-scalable=no">
    <script src="dist/web/jquery.min.js"></script>
    <script src="dist/web/ie.js" nomodule></script>
    <script src="dist/web/main.js" type="module"></script>
    <link rel="stylesheet" href="dist/web/web.css">
</head>
<body>
    <div id="gameport">
        <div id="about">
            <h1>Parchment</h1>
            <p>is an interpreter for Interactive Fiction. <a href="https://github.com/curiousdannii/parchment">Find out more.</a></p>
            <p>Find stories to play at the <a href="https://ifdb.org/">Interactive Fiction Database</a>.</p>
            <label id="custom-file-upload" for="file-upload" tabindex="0" role="button">
                Or, click here to play a story file on your device
            </label>
            <input id="file-upload" type="file" style="display: none"/>
            <p>
              <form id="game_url_form">
                <label for="game_url" style="display:block;">Or, enter the URL of a web-accessible game file to generate the parchment URL</label>
                <input type="text" id="game_url" size="80"><input class="button" type="submit" value="Generate" style="margin: 1rem;">
              </form>
            </p>
            <div id="convert-error"></div>
            <div style="display: inline-block;" id="convert_output"><a id="output_link"></a></div>
            <svg id="copy" class="inline" aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy" style="display: none;">
              <path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path>
            </svg>
            <noscript><p>Parchment requires Javascript. Please enable it in your browser.</p></noscript>
        </div>
        <div id="windowport"></div>
        <div id="loadingpane" style="display:none;">
            <img src="dist/web/waiting.gif" alt="LOADING"><br>
            <em>&nbsp;&nbsp;&nbsp;Loading...</em>
        </div>
        <div id="errorpane" style="display:none;"><div id="errorcontent">...</div></div>
    </div>
    <script>
      let base_url = ((window.location.origin == "null") ? 'file://' : window.location.origin) + window.location.pathname;
      document.querySelector('form').addEventListener('submit', function(e) {
          e.preventDefault();
          try {
              let url = new URL(decodeURIComponent(document.getElementById('game_url').value));
              let link = document.getElementById('output_link');
              link.textContent = link.href = base_url + '?story=' + encodeURIComponent(url.href);
              try {
                  history.replaceState(window.history[window.history.length-1], null, link.href);
              }
              catch(error) {
                  console.log(error);
              }
              document.getElementById('convert-error').textContent = '';
              if (navigator.clipboard) { document.getElementById('copy').setAttribute('style','display:inline;'); }
          }
          catch(error) {
              console.log(error);
              document.getElementById('convert-error').textContent = 'Invalid URL.';
              let link = document.getElementById('output_link');
              link.href = "";
              link.textContent = "";
              document.getElementById('copy').setAttribute('style','display:none;');
          }
      });
      if (navigator.clipboard) {
          document.getElementById('copy').addEventListener("click", function () { navigator.clipboard.writeText(document.getElementById('convert_output').textContent); });
      }
    </script>
</body>
</html>
