var rf=Object.create;var ms=Object.defineProperty;var sf=Object.getOwnPropertyDescriptor;var ff=Object.getOwnPropertyNames;var af=Object.getPrototypeOf,uf=Object.prototype.hasOwnProperty;var Vr=(a,W)=>()=>(W||a((W={exports:{}}).exports,W),W.exports);var lf=(a,W,we,le)=>{if(W&&typeof W=="object"||typeof W=="function")for(let ke of ff(W))!uf.call(a,ke)&&ke!==we&&ms(a,ke,{get:()=>W[ke],enumerable:!(le=sf(W,ke))||le.enumerable});return a};var Rr=(a,W,we)=>(we=a!=null?rf(af(a)):{},lf(W||!a||!a.__esModule?ms(we,"default",{value:a,enumerable:!0}):we,a));var ps=Vr(Ir=>{"use strict";var vs=function(){var a={};function W(e,r){a.GiDispa=r.GiDispa,a.GiLoad=r.GiLoad,a.Glk=r.io,Z=e;var s=Z.slice(0,64),f,i;for(f=0;f<s.length;f++)i=s[f].toString(16),i.length<2&&(i="0"+i),s[f]=i;Ze=s.join(""),r&&(Jr=r.log_execution_time,Xr=r.rethrow_exceptions,Yr=r.do_vm_autosave,jr=r.clear_vm_autosave),r&&r.debug_info_chunk&&ef()}function we(){return Z!=null}function le(e){switch(e){case"GiDispa":return a.GiDispa;case"GiLoad":return a.GiLoad;case"Glk":return a.Glk;case"GlkOte":return a.Glk.getlibrary("GlkOte");case"Dialog":return a.Glk.getlibrary("Dialog")}return null}function ke(){if(a.vm_started){a.Glk.fatal_error("Quixe was inited twice!");return}try{F(),p(),Ws(),os()}catch(e){throw e.stack&&I(`JS stack dump A:
`+e.stack),se(),a.Glk.fatal_error("Quixe init: "+o(e)),e}}function d(e){try{a.done_executing=a.vm_stopped,os()}catch(r){if(r.stack&&I(`JS stack dump B:
`+r.stack),se(),a.Glk.fatal_error("Quixe run: "+o(r)),Xr)throw r}}function o(e){if(typeof e=="string")return e;var r=e.toString();return e.message&&(r=r+" "+e.message),e.fileName&&(r=r+" "+e.fileName),e.lineNumber&&(r=r+" line:"+e.lineNumber),e.name&&(r=r+" "+e.name),e.number&&(r=r+" "+e.number),r}function I(e){window.console&&console.log?console.log(e):window.opera&&opera.postError&&opera.postError(e)}function _e(e,r){var s,f;if(jQuery.type(e)==="array"){r&&r--;var i=jQuery.map(e,function(t,c){return _e(t,r)});return"["+i.join(",")+"]"}if(jQuery.type(e)!=="object")return""+e;f=[];for(s in e){var u=e[s];r&&jQuery.type(u)==="object"&&(u=_e(u,r-1)),f.push(s+":"+u)}return"{ "+f.join(", ")+" }"}function se(){if(!(!q||!q.length)){var e,r,s,f,i=[];for(e=0;e<q.length;e++){if(f=q[e],!f.vmfunc.funcaddr){i.push("(anonymous)");continue}r="0x"+f.vmfunc.funcaddr.toString(16),s=Re.functionmap[f.vmfunc.funcaddr],s&&(r=r+(' "'+s.name+'"')),i.push(r)}I("VM stack dump: "+i.join(", "))}}Math.imul===void 0&&(I("Polyfilling Math.imul()."),Math.imul=function(e,r){var s=e>>>16&65535,f=e&65535,i=r>>>16&65535,u=r&65535;return f*u+(s*u+f*i<<16>>>0)|0});var O=Array(256),oe=Array(256);function F(){var e,r;for(e=0;e<256;e++)r=e.toString(16),e<16&&(r="0"+r),O[e]=r;for(e=0;e<256;e++)e>=32&&e<127?e==34||e==39||e==92?r="\\"+String.fromCharCode(e):r=String.fromCharCode(e):e==10?r="\\n":r="\\x"+O[e],oe[e]=r}function h(e,r){return e[r]*16777216+e[r+1]*65536+e[r+2]*256+e[r+3]}function G(e,r){return e[r]*256+e[r+1]}function P(e,r){return e[r]}function l(e){return y[e]}function _(e){return y[e]*256+y[e+1]}function g(e){return y[e]*16777216+y[e+1]*65536+y[e+2]*256+y[e+3]}function te(e,r){return y.slice(e,e+r)}function Ne(e,r){y[e]=r&255}function S(e,r){y[e]=r>>8&255,y[e+1]=r&255}function j(e,r){y[e]=r>>24&255,y[e+1]=r>>16&255,y[e+2]=r>>8&255,y[e+3]=r&255}a.Mem1=l,a.Mem2=_,a.Mem4=g,a.MemSlice=te,a.MemW1=Ne,a.MemW2=S,a.MemW4=j;function ie(e,r){for(var s=0;s<r.length;s++)e.push(r.charCodeAt(s))}function H(e,r){e.push(r>>24&255),e.push(r>>16&255),e.push(r>>8&255),e.push(r&255)}function De(e,r){e.push(r>>8&255),e.push(r&255)}function Ee(e,r){e.push(r&255)}function be(e,r,s){e[r]=s>>24&255,e[r+1]=s>>16&255,e[r+2]=s>>8&255,e[r+3]=s&255}function Qe(e,r,s){return String.fromCharCode.apply(this,e.slice(r,r+s))}function ze(e){return y[e]>=128?"0xffffff"+O[y[e]]:"0x"+O[y[e]]}function Ae(e){return y[e]>=128?"0xffff"+O[y[e]]+O[y[e+1]]:y[e]?"0x"+O[y[e]]+O[y[e+1]]:"0x"+O[y[e+1]]}function ue(e){return y[e]?"0x"+O[y[e]]+O[y[e+1]]+O[y[e+2]]+O[y[e+3]]:y[e+1]?"0x"+O[y[e+1]]+O[y[e+2]]+O[y[e+3]]:y[e+2]?"0x"+O[y[e+2]]+O[y[e+3]]:"0x"+O[y[e+3]]}function ye(e){return e==4294967295?a.frame.valstack.pop()&255:l(e)}function me(e,r){e==4294967295?a.frame.valstack.push(r&255):Ne(e,r)}function kr(e){return e==4294967295?a.frame.valstack.pop():g(e)}function Ie(e,r){e==4294967295?a.frame.valstack.push(r):j(e,r)}function xe(e,r){return e==4294967295?a.frame.valstack.pop():g(e+4*r)}function Ue(e,r,s){e==4294967295?a.frame.valstack.push(s):j(e+4*r,s)}function br(e){a.resumevalue=e}function Fe(e){return e<65536?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(e&1023)))}function yr(e){if(e<256)return oe[e];if(e<65536){for(e=e.toString(16);e.length<4;)e="0"+e;return"\\u"+e}else{var r;return e-=65536,r=55296+(e>>10),e=56320+(e&1023),"\\u"+r.toString(16)+"\\u"+e.toString(16)}}function Oe(e){return yr(e.charCodeAt(0))}var ve=/[^a-zA-Z0-9 .,;:?!=_+()-]/g;function nr(e){return e=e.replace(ve,Oe),'"'+e+'"'}function w(e){var r,s;if(arguments.length>1){for(e+=" (",r=1;r<arguments.length;r++)s=arguments[r],typeof s=="number"?s=s.toString(16):s=""+s,r!=1&&(e+=" "),e+=s;e+=")"}throw I(e),new Error(e)}a.fatal_error=w;function tr(e,r,s,f){var i;return r===void 0&&(r="_func"),s===void 0?i=new Function("self",e):f===void 0?i=new Function("self",s,e):i=new Function("self",s,f,e),i}function cr(e,r,s,f){e?(this.funcaddr=e,this.startpc=r,this.functype=l(e)):(this.funcaddr=null,this.startpc=null,this.functype=null),this.pathaddrs={},this[0]={},this[1]={},this[2]={},this.locallen=null,this.localsformat=s,this.rawformat=f,this.localsindex=[];var i,u,t=0;for(i=0;i<this.localsformat.length;i++){var c=this.localsformat[i];if(c.size==4)for(;t&3;)t++;else if(c.size==2)for(;t&1;)t++;for(u=0;u<c.count;u++)this.localsindex.push({size:c.size,pos:t}),t+=c.size}for(;t&3;)t++;this.locallen=t}function qe(e){var r;for(this.vmfunc=e,this.depth=null,this.framestart=null,this.framelen=null,this.valstack=[],this.localspos=null,this.localsindex=e.localsindex,this.locals=[],r=0;r<this.localsindex.length;r++){var s=this.localsindex[r];this.locals[s.pos]=0}this.framelen=8+e.rawformat.length+e.locallen}function Pe(e){var r=new qe(e.vmfunc);return r.depth=e.depth,r.framestart=e.framestart,r.framelen=e.framelen,r.valstack=e.valstack.slice(0),r.localspos=e.localspos,r.locals=e.locals.slice(0),r.framelen=e.framelen,r}function or(e,r){H(r,e.framelen);var s=e.vmfunc.rawformat;H(r,8+s.length);for(var f=0;f<s.length;f++)r.push(s[f]);for(var f=0;f<e.vmfunc.localsindex.length;f++){var i=e.vmfunc.localsindex[f];if(i.size==4){for(;r.length&3;)r.push(0);H(r,e.locals[i.pos])}else if(i.size==2){for(;r.length&1;)r.push(0);De(r,e.locals[i.pos])}else Ee(r,e.locals[i.pos])}for(;r.length&3;)r.push(0);for(var f=0;f<e.valstack.length;f++)H(r,e.valstack[f])}function hr(e){var r=h(e,e.length-4);if(r<0||r>=e.length){I("Bad frameptr in serialized stack frame");return}e=e.splice(r,e.length);for(var s=h(e,0),f=h(e,4),i=e.slice(8,f),u=[],t=8;;){var c=P(e,t);t++;var v=P(e,t);if(t++,c==0)break;c!=1&&c!=2&&c!=4&&w("Invalid local variable size in function header.",c),u.push({size:c,count:v})}var n=new cr(null,null,u,i),x=new qe(n);x.framestart=r;for(var N=0;N<x.vmfunc.localsindex.length;N++){var E=x.vmfunc.localsindex[N];E.size==4?x.locals[E.pos]=h(e,f+E.pos):E.size==2?x.locals[E.pos]=G(e,f+E.pos):x.locals[E.pos]=P(e,f+E.pos)}for(var J=s;J<e.length;J+=4)x.valstack.push(h(e,J));return x}function xr(e,r){e==0&&w("Tried to create a VMTextEnv for address zero."),this.addr=e,this.cacheable=r!==void 0,this.decoding_tree=r,this.vmstring_tables=[],this.cacheable&&(this.vmstring_tables[0]={},this.vmstring_tables[1]={},this.vmstring_tables[2]={})}var m=null;function p(){function e(Ye,ds){this.argsize=ds||4,this.numops=Ye.length;for(var _s=[],Tr=0;Tr<Ye.length;Tr++)_s.push(Ye.charAt(Tr));this.formlist=_s}var r=new e(""),s=new e("L"),f=new e("LL"),i=new e("LLL"),u=new e("LLLL"),t=new e("LS"),c=new e("LLS"),v=new e("LLLLLLS"),n=new e("LLLLLLLS"),x=new e("LLSS"),N=new e("LC"),E=new e("LLC"),J=new e("LLLC"),re=new e("LLLLC"),D=new e("ES"),K=new e("LES"),Le=new e("EES"),ge=new e("F"),pe=new e("LF"),X=new e("LLF"),de=new e("EF"),Ge=new e("EF",1),ur=new e("EF",2),lr=new e("S"),hs=new e("SS"),wr=new e("CL"),Xe=new e("C");m={0:r,16:Le,17:K,18:c,19:c,20:c,21:D,24:Le,25:Le,26:Le,27:D,28:c,29:c,30:c,32:s,34:f,35:f,36:i,37:i,38:i,39:i,40:i,41:i,42:i,43:i,44:i,45:i,48:E,49:s,50:wr,51:f,52:f,64:de,65:ur,66:Ge,68:t,69:t,72:c,73:c,74:c,75:c,76:i,77:i,78:i,79:i,80:ge,81:pe,82:r,83:f,84:s,112:s,113:s,114:s,115:s,256:c,257:s,258:lr,259:t,260:s,272:t,273:s,288:r,289:lr,290:r,291:N,292:pe,293:Xe,294:ge,295:f,304:X,320:lr,321:s,328:hs,329:f,336:n,337:n,338:v,352:N,353:E,354:J,355:re,368:f,369:i,376:t,377:s,384:f,385:f,400:t,401:t,402:t,408:t,409:t,416:c,417:c,418:c,419:c,420:x,424:t,425:t,426:t,427:c,432:t,433:t,434:t,435:t,436:t,437:t,438:c,448:u,449:u,450:i,451:i,452:i,453:i,456:f,457:f}}a.funcop_cache={};function M(e){if(e.mode==0)return"null";var r="m"+e.mode;if(e.argsize!=null&&(r=r+"s"+e.argsize),e.addr!=null&&(r=r+"a"+e.addr),a.funcop_cache.key)return"self.funcop_cache."+r;var s={key:r,mode:e.mode,argsize:e.argsize,addr:e.addr};return a.funcop_cache[r]=s,"self.funcop_cache."+r}function A(e,r,s){var f;switch(r.mode){case 8:if(r.argsize==4){var i=s[0];if(i==="0"){e.offstack.push(s),e.code.push("// push to offstack: "+s);return}if(i==="_"){Ke(e,s),e.code.push("// re-push to offstack: "+s);return}}f=ae(e,!0),e.offstack.push(f),r.argsize==4?e.code.push(f+"=("+s+");"):r.argsize==2?e.code.push(f+"=0xffff&("+s+");"):e.code.push(f+"=0xff&("+s+");");return;case 0:e.code.push("("+s+");");return;case 11:if(r.argsize==4){var i=s[0];if(i==="0"){b(e,r.addr,s,!1),e.code.push("// store to offloc["+r.addr+"]: "+s);return}if(i==="_"){b(e,r.addr,s,!0),e.code.push("// re-store to offloc["+r.addr+"]: "+s);return}}b(e,r.addr,void 0),r.argsize==4?e.code.push("self.frame.locals["+r.addr+"]=("+s+");"):r.argsize==2?e.code.push("self.frame.locals["+r.addr+"]=(0xffff &"+s+");"):e.code.push("self.frame.locals["+r.addr+"]=(0xff &"+s+");");return;case 15:r.argsize==4?e.code.push("self.MemW4("+r.addr+","+s+");"):r.argsize==2?e.code.push("self.MemW2("+r.addr+","+s+");"):e.code.push("self.MemW1("+r.addr+","+s+");");return;default:w("Unknown addressing mode in store func operand.")}}function U(e,r,s){s===void 0&&(s=e.cp),e.code.push("self.frame.valstack.push("+r+","+s+",self.frame.framestart);")}function Q(e){e.code.push("if (!substring) { substring=true;"),e.code.push("self.frame.valstack.push(0x11,0,nextcp,self.frame.framestart);"),e.code.push("}")}function V(e,r){var s;if(e.code.push("// unload offstate: "+e.offstack.length+" stack"+(e.offloc.length?", plus locs":"")+(r?" (conditional)":"")),e.offstack.length&&e.code.push("self.frame.valstack.push("+e.offstack.join(",")+");"),e.offloc.length)for(s=0;s<e.offloc.length;s++)e.offloc[s]!==void 0&&e.offlocdirty[s]&&e.code.push("self.frame.locals["+s+"]="+e.offloc[s]+";");if(!r){var f;for(s=0;s<e.offloc.length;s++)f=e.offloc[s],f!==void 0&&e.holduse[f]!==void 0&&(e.holduse[f]=!1);for(e.offloc.length=0,e.offlocdirty.length=0;e.offstack.length;)f=e.offstack.pop(),e.holduse[f]!==void 0&&(e.holduse[f]=!1)}}function fe(e){if(e.buffer.length!=0){var r=e.buffer.join("");e.buffer.length=0,e.code.push("self.Glk.glk_put_jstring("+nr(r)+");")}}function C(e,r,s){var f;if(B(r))return f=Number(r),f&2147483648?""+(f-4294967296):r;if(f="("+r+"&0xffffffff)",s){var i=ae(e);return e.code.push(i+"="+f+";"),i}else return f}function k(e,r,s){var f;if(B(r))return f=Number(r),f==2147483648?"-0":""+vr(f);if(f="self.decode_float("+r+")",s){var i=ae(e);return e.code.push(i+"="+f+";"),i}else return f}function z(e,r,s){if(B(r)){var f=Number(r);if(f==0||f==1)s?(e.code.push("// quashing offstack for unconditional return: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0):e.code.push("// ignoring offstack for conditional return: "+e.offstack.length),e.code.push("if (self.leave_function()) return self.VMStopped;"),e.code.push("self.pop_callstub("+f+");");else{V(e,!s);var i=e.cp+f-2>>>0;e.code.push("self.pc = "+i+";"),e.vmfunc.pathaddrs[i]=!0}}else V(e,!s),e.code.push("if (("+r+")==0 || ("+r+")==1) {"),e.code.push("if (self.leave_function()) return self.VMStopped;"),e.code.push("self.pop_callstub("+r+");"),e.code.push("}"),e.code.push("else {"),e.code.push("self.pc = ("+e.cp+"+("+r+")-2) >>>0;"),e.code.push("}");e.code.push("return;")}var ee={0:function(e,r){},16:function(e,r){e.code.push(r[2]+"(("+r[0]+")+("+r[1]+")) >>>0);")},17:function(e,r){e.code.push(r[2]+"(("+r[0]+")-("+r[1]+")) >>>0);")},18:function(e,r){var s=C(e,r[0]),f=C(e,r[1]);e.code.push(r[2]+"(Math.imul(("+s+"),("+f+"))) >>>0);")},19:function(e,r){var s=C(e,r[0]),f=C(e,r[1]),i=ae(e);e.code.push(i+"=(("+s+")/("+f+"));"),e.code.push("if (!isFinite("+i+")) self.fatal_error('Division by zero.');"),e.code.push(r[2]+"("+i+">=0)?Math.floor("+i+"):(-Math.floor(-"+i+") >>>0));")},20:function(e,r){var s=C(e,r[0]),f=C(e,r[1]),i=ae(e);e.code.push(i+"=(("+s+")%("+f+"));"),e.code.push("if (!isFinite("+i+")) self.fatal_error('Modulo division by zero.');"),e.code.push(r[2]+i+" >>>0);")},21:function(e,r){e.code.push(r[1]+"(-("+r[0]+")) >>>0);")},24:function(e,r){e.code.push(r[2]+"(("+r[0]+")&("+r[1]+")) >>>0);")},25:function(e,r){e.code.push(r[2]+"(("+r[0]+")|("+r[1]+")) >>>0);")},26:function(e,r){e.code.push(r[2]+"(("+r[0]+")^("+r[1]+")) >>>0);")},27:function(e,r){e.code.push(r[1]+"(~("+r[0]+")) >>>0);")},28:function(e,r){if(B(r[1])){var s=Number(r[1]);s<32?e.code.push(r[2]+"(("+r[0]+")<<"+s+") >>>0);"):e.code.push(r[2]+"0);")}else e.code.push(r[2]+"("+r[1]+"<32) ? (("+r[0]+"<<"+r[1]+") >>>0) : 0);")},29:function(e,r){if(B(r[1])){var s=Number(r[1]);s<32?e.code.push(r[2]+"(("+r[0]+")>>"+s+") >>>0);"):e.code.push(r[2]+"(("+r[0]+")&0x80000000) ? 0xffffffff : 0);")}else e.code.push("if ("+r[0]+" & 0x80000000) {"),e.code.push(r[2]+"("+r[1]+"<32) ? (("+r[0]+">>"+r[1]+") >>>0) : 0xffffffff);"),e.code.push("} else {"),e.code.push(r[2]+"("+r[1]+"<32) ? (("+r[0]+">>"+r[1]+") >>>0) : 0);"),e.code.push("}")},30:function(e,r){if(B(r[1])){var s=Number(r[1]);s<32?e.code.push(r[2]+"("+r[0]+")>>>"+s+");"):e.code.push(r[2]+"0);")}else e.code.push(r[2]+"("+r[1]+"<32) ? ("+r[0]+">>>"+r[1]+") : 0);")},32:function(e,r){z(e,r[0],!0),e.path_ends=!0},260:function(e,r){if(B(r[0])){var s=Number(r[0]);e.code.push("self.pc = "+s+";"),e.vmfunc.pathaddrs[s]=!0}else e.code.push("self.pc = "+r[0]+";");V(e),e.code.push("return;"),e.path_ends=!0},34:function(e,r){e.code.push("if (("+r[0]+")==0) {"),z(e,r[1]),e.code.push("}")},35:function(e,r){e.code.push("if (("+r[0]+")!=0) {"),z(e,r[1]),e.code.push("}")},36:function(e,r){e.code.push("if (("+r[0]+")==("+r[1]+")) {"),z(e,r[2]),e.code.push("}")},37:function(e,r){e.code.push("if (("+r[0]+")!=("+r[1]+")) {"),z(e,r[2]),e.code.push("}")},38:function(e,r){var s=C(e,r[0]),f=C(e,r[1]);e.code.push("if (("+s+")<("+f+")) {"),z(e,r[2]),e.code.push("}")},39:function(e,r){var s=C(e,r[0]),f=C(e,r[1]);e.code.push("if (("+s+")>=("+f+")) {"),z(e,r[2]),e.code.push("}")},40:function(e,r){var s=C(e,r[0]),f=C(e,r[1]);e.code.push("if (("+s+")>("+f+")) {"),z(e,r[2]),e.code.push("}")},41:function(e,r){var s=C(e,r[0]),f=C(e,r[1]);e.code.push("if (("+s+")<=("+f+")) {"),z(e,r[2]),e.code.push("}")},42:function(e,r){e.code.push("if (("+r[0]+")<("+r[1]+")) {"),z(e,r[2]),e.code.push("}")},43:function(e,r){e.code.push("if (("+r[0]+")>=("+r[1]+")) {"),z(e,r[2]),e.code.push("}")},44:function(e,r){e.code.push("if (("+r[0]+")>("+r[1]+")) {"),z(e,r[2]),e.code.push("}")},45:function(e,r){e.code.push("if (("+r[0]+")<=("+r[1]+")) {"),z(e,r[2]),e.code.push("}")},48:function(e,r){if(B(r[1])){var s,f=Number(r[1]);for(s=0;s<f;s++)if(e.offstack.length){var i=Be(e);e.code.push("self.tempcallargs["+s+"]="+i+";")}else e.code.push("self.tempcallargs["+s+"]=self.frame.valstack.pop();");V(e)}else e.varsused.ix=!0,V(e),e.code.push("for (ix=0; ix<"+r[1]+"; ix++) { self.tempcallargs[ix]=self.frame.valstack.pop(); }");U(e,r[2]),e.code.push("self.enter_function("+r[0]+", "+r[1]+");"),e.code.push("return;"),e.path_ends=!0},52:function(e,r){if(B(r[1])){var s,f=Number(r[1]);for(s=0;s<f;s++)if(e.offstack.length){var i=Be(e);e.code.push("self.tempcallargs["+s+"]="+i+";")}else e.code.push("self.tempcallargs["+s+"]=self.frame.valstack.pop();");V(e)}else e.varsused.ix=!0,V(e),e.code.push("for (ix=0; ix<"+r[1]+"; ix++) { self.tempcallargs[ix]=self.frame.valstack.pop(); }");e.code.push("if (self.leave_function()) return self.VMStopped;"),e.code.push("self.enter_function("+r[0]+", "+r[1]+");"),e.code.push("return;"),e.path_ends=!0},352:function(e,r){V(e),U(e,r[1]),e.code.push("self.enter_function("+r[0]+", 0);"),e.code.push("return;"),e.path_ends=!0},353:function(e,r){V(e),e.code.push("self.tempcallargs[0]=("+r[1]+");"),U(e,r[2]),e.code.push("self.enter_function("+r[0]+", 1);"),e.code.push("return;"),e.path_ends=!0},354:function(e,r){V(e),e.code.push("self.tempcallargs[0]=("+r[1]+");"),e.code.push("self.tempcallargs[1]=("+r[2]+");"),U(e,r[3]),e.code.push("self.enter_function("+r[0]+", 2);"),e.code.push("return;"),e.path_ends=!0},355:function(e,r){V(e),e.code.push("self.tempcallargs[0]=("+r[1]+");"),e.code.push("self.tempcallargs[1]=("+r[2]+");"),e.code.push("self.tempcallargs[2]=("+r[3]+");"),U(e,r[4]),e.code.push("self.enter_function("+r[0]+", 3);"),e.code.push("return;"),e.path_ends=!0},49:function(e,r){e.code.push("// quashing offstack for return: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0,e.code.push("if (self.leave_function()) return self.VMStopped;"),e.code.push("self.pop_callstub("+r[0]+");"),e.code.push("return;"),e.path_ends=!0},50:function(e,r){V(e),U(e,r[0]),e.code.push("self.store_operand("+r[0]+",self.frame.framestart+self.frame.framelen+4*self.frame.valstack.length);"),z(e,r[1],!0),e.path_ends=!0},51:function(e,r){e.code.push("// quashing offstack for throw: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0,e.code.push("self.pop_stack_to("+r[1]+");"),e.code.push("self.pop_callstub("+r[0]+");"),e.code.push("return;"),e.path_ends=!0},64:function(e,r){A(e,r[1],r[0])},65:function(e,r){A(e,r[1],r[0])},66:function(e,r){A(e,r[1],r[0])},68:function(e,r){var s;B(r[0])?(s=Number(r[0]),s=s&32768?(s|4294901760)>>>0:s&65535,e.code.push(r[1]+s+");")):e.code.push(r[1]+"("+r[0]+" & 0x8000) ? (("+r[0]+" | 0xffff0000) >>> 0) : ("+r[0]+" & 0xffff));")},69:function(e,r){var s;B(r[0])?(s=Number(r[0]),s=s&128?(s|4294967040)>>>0:s&255,e.code.push(r[1]+s+");")):e.code.push(r[1]+"("+r[0]+" & 0x80) ? (("+r[0]+" | 0xffffff00) >>> 0) : ("+r[0]+" & 0xff));")},72:function(e,r){var s,f;if(B(r[1]))if(B(r[0]))f=Number(r[0])+Number(r[1])*4,s="self.Mem4("+(f>>>0)+")";else{var f=Number(r[1])*4;f?s="self.Mem4(("+r[0]+"+"+f+") >>>0)":s="self.Mem4("+r[0]+")"}else s="self.Mem4(("+r[0]+"+4*"+r[1]+") >>>0)";e.code.push(r[2]+s+");")},73:function(e,r){var s,f;if(B(r[1]))if(B(r[0]))f=Number(r[0])+Number(r[1])*2,s="self.Mem2("+(f>>>0)+")";else{var f=Number(r[1])*2;f?s="self.Mem2(("+r[0]+"+"+f+") >>>0)":s="self.Mem2("+r[0]+")"}else s="self.Mem2(("+r[0]+"+2*"+r[1]+") >>>0)";e.code.push(r[2]+s+");")},74:function(e,r){var s,f;if(B(r[1]))if(B(r[0]))f=Number(r[0])+Number(r[1]),s="self.Mem1("+(f>>>0)+")";else{var f=Number(r[1]);f?s="self.Mem1(("+r[0]+"+"+f+") >>>0)":s="self.Mem1("+r[0]+")"}else s="self.Mem1(("+r[0]+"+"+r[1]+") >>>0)";e.code.push(r[2]+s+");")},76:function(e,r){var s,f;if(B(r[1]))if(B(r[0]))f=Number(r[0])+Number(r[1])*4,s=(f>>>0)+",";else{var f=Number(r[1])*4;f?s="("+r[0]+"+"+f+") >>>0,":s=r[0]+","}else s="("+r[0]+"+4*"+r[1]+") >>>0,";e.code.push("self.MemW4("+s+r[2]+");")},77:function(e,r){var s,f;if(B(r[1]))if(B(r[0]))f=Number(r[0])+Number(r[1])*2,s=(f>>>0)+",";else{var f=Number(r[1])*2;f?s="("+r[0]+"+"+f+") >>>0,":s=r[0]+","}else s="("+r[0]+"+2*"+r[1]+") >>>0,";e.code.push("self.MemW2("+s+r[2]+");")},78:function(e,r){var s,f;if(B(r[1]))if(B(r[0]))f=Number(r[0])+Number(r[1]),s=(f>>>0)+",";else{var f=Number(r[1]);f?s="("+r[0]+"+"+f+") >>>0,":s=r[0]+","}else s="("+r[0]+"+"+r[1]+") >>>0,";e.code.push("self.MemW1("+s+r[2]+");")},75:function(e,r){if(B(r[1])){var s,f,i;i=Number(r[1])&4294967295,s=i&7,B(r[0])?(f=Number(r[0]),i>=0?f+=i>>3:f-=1+(-1-i>>3)):i>=0?i<=7?f=r[0]:f=r[0]+"+"+(i>>3):f=r[0]+"-"+(1+(-1-i>>3)),e.code.push(r[2]+"(self.Mem1("+f+") & "+(1<<s)+")?1:0);")}else{e.varsused.bitx=!0,e.varsused.addrx=!0;var u=C(e,r[1],!0);e.code.push("bitx = "+u+"&7;"),e.code.push("if ("+u+">=0) addrx = "+r[0]+" + ("+u+">>3);"),e.code.push("else addrx = "+r[0]+" - (1+((-1-("+u+"))>>3));"),e.code.push(r[2]+"(self.Mem1(addrx) & (1<<bitx))?1:0);")}},79:function(e,r){var s,f,i,u;if(B(r[1]))u=Number(r[1])&4294967295,s=u&7,B(r[0])?(f=Number(r[0]),u>=0?f+=u>>3:f-=1+(-1-u>>3)):u>=0?u<=7?f=r[0]:f=r[0]+"+"+(u>>3):f=r[0]+"-"+(1+(-1-u>>3)),i=1<<s;else{e.varsused.bitx=!0,e.varsused.addrx=!0;var t=C(e,r[1],!0);e.code.push("bitx = "+t+"&7;"),e.code.push("if ("+t+">=0) addrx = "+r[0]+" + ("+t+">>3);"),e.code.push("else addrx = "+r[0]+" - (1+((-1-("+t+"))>>3));"),f="addrx",i="(1<<bitx)"}B(r[2])?Number(r[2])?e.code.push("self.MemW1("+f+", self.Mem1("+f+") | "+i+");"):e.code.push("self.MemW1("+f+", self.Mem1("+f+") & ~("+i+"));"):(e.code.push("if ("+r[2]+") self.MemW1("+f+", self.Mem1("+f+") | "+i+");"),e.code.push("else self.MemW1("+f+", self.Mem1("+f+") & ~("+i+"));"))},80:function(e,r){var s,f=e.offstack.length;f?s="self.frame.valstack.length+"+f:s="self.frame.valstack.length",A(e,r[0],s)},81:function(e,r){var s;if(B(r[0])){var f=Number(r[0]);f<e.offstack.length?s=e.offstack[e.offstack.length-(f+1)]:s="self.frame.valstack[self.frame.valstack.length-"+(f+1-e.offstack.length)+"]"}else V(e),s="self.frame.valstack[self.frame.valstack.length-("+r[0]+"+1)]";A(e,r[1],s)},82:function(e,r){var s,f;e.offstack.length<2&&Me(e,2),f=e.offstack.length,s=e.offstack[f-1],e.offstack[f-1]=e.offstack[f-2],e.offstack[f-2]=s},83:function(e,r){V(e),e.varsused.ix=!0,e.varsused.pos=!0,e.varsused.roll=!0,e.varsused.vals1=!0;var s=C(e,r[0],!0),f=C(e,r[1],!0);e.code.push("if ("+s+" > 0) {"),e.code.push("if ("+f+" > 0) {"),e.code.push("vals1 = "+f+" % "+s+";"),e.code.push("} else {"),e.code.push("vals1 = "+s+" - (-("+f+")) % "+s+";"),e.code.push("}"),e.code.push("if (vals1) {"),e.code.push("pos = self.frame.valstack.length - "+s+";"),e.code.push("roll = self.frame.valstack.slice(self.frame.valstack.length-vals1, self.frame.valstack.length).concat(self.frame.valstack.slice(pos, self.frame.valstack.length-vals1));"),e.code.push("for (ix=0; ix<"+s+"; ix++) { self.frame.valstack[pos+ix] = roll[ix]; }"),e.code.push("roll = undefined;"),e.code.push("}"),e.code.push("}")},84:function(e,r){if(V(e),B(r[0])){var s,f,i=Number(r[0]);for(s=0;s<i;s++)f=ae(e,!0),e.offstack.push(f),e.code.push(f+"=self.frame.valstack[self.frame.valstack.length-"+(i-s)+"];")}else e.varsused.ix=!0,e.varsused.jx=!0,e.code.push("jx = self.frame.valstack.length-("+r[0]+");"),e.code.push("for (ix=0; ix<"+r[0]+"; ix++) { self.frame.valstack.push(self.frame.valstack[jx+ix]); }")},256:function(e,r){var s="self.do_gestalt(("+r[0]+"),("+r[1]+"))";e.code.push(r[2]+s+");")},257:function(e,r){e.code.push("self.fatal_error('User debugtrap encountered.', "+r[0]+");")},258:function(e,r){e.code.push(r[0]+"self.endmem);")},259:function(e,r){e.code.push("self.change_memsize("+r[0]+",false);"),e.code.push(r[1]+"0);")},272:function(e,r){var s;if(B(r[0])){var f=Number(r[0])&4294967295;f==0?s="(Math.floor(self.random_func() * 0x10000) | (Math.floor(self.random_func() * 0x10000) << 16)) >>>0":f>0?s="Math.floor(self.random_func() * "+f+")":s="-Math.floor(self.random_func() * "+-f+")"}else{var i=C(e,r[0],!0),u=ae(e);s=u,e.code.push("if ("+i+" > 0)"),e.code.push(u+" = Math.floor(self.random_func() * "+i+");"),e.code.push("else if ("+i+" < 0)"),e.code.push(u+" = -Math.floor(self.random_func() * -"+i+");"),e.code.push("else"),e.code.push(u+" = (Math.floor(self.random_func() * 0x10000) | (Math.floor(self.random_func() * 0x10000) << 16)) >>>0;")}e.code.push(r[1]+s+");")},273:function(e,r){e.code.push("self.set_random("+r[0]+");")},288:function(e,r){e.code.push("// quashing offstack for quit: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0,e.code.push("return self.VMStopped;"),e.path_ends=!0},289:function(e,r){e.code.push(r[0]+"self.perform_verify());")},290:function(e,r){e.code.push("// quashing offstack for quit: "+e.offstack.length),e.offstack.length=0,e.offloc.length=0,e.offlocdirty.length=0,e.code.push("self.vm_restart();"),e.code.push("return;"),e.path_ends=!0},291:function(e,r){V(e),e.varsused.ix=!0,U(e,r[1]),e.code.push("ix = self.vm_save("+r[0]+");"),e.code.push("self.pop_callstub(ix ? 0 : 1);"),e.code.push("return;"),e.path_ends=!0},292:function(e,r){V(e),e.code.push("if (self.vm_restore("+r[0]+")) {"),e.code.push("self.pop_callstub((-1)>>>0);"),e.code.push("} else {"),A(e,r[1],"1"),V(e),e.code.push("self.pc = "+e.cp+";"),e.code.push("}"),e.code.push("return;"),e.path_ends=!0},293:function(e,r){V(e),U(e,r[0]),e.code.push("self.vm_saveundo();"),e.code.push("self.pop_callstub(0);"),e.code.push("return;"),e.path_ends=!0},294:function(e,r){V(e),e.code.push("if (self.vm_restoreundo()) {"),e.code.push("self.pop_callstub((-1)>>>0);"),e.code.push("} else {"),A(e,r[0],"1"),V(e),e.code.push("self.pc = "+e.cp+";"),e.code.push("}"),e.code.push("return;"),e.path_ends=!0},295:function(e,r){e.code.push("self.protectstart="+r[0]+";"),e.code.push("self.protectend=self.protectstart+("+r[1]+");"),e.code.push("if (self.protectstart==self.protectend) {"),e.code.push("  self.protectstart=0; self.protectend=0;"),e.code.push("}")},368:function(e,r){e.varsused.maddr=!0,e.varsused.mlen=!0,e.varsused.ix=!0,e.code.push("mlen="+r[0]+";"),e.code.push("maddr="+r[1]+";"),e.code.push("for (ix=0; ix<mlen; ix++, maddr++) self.MemW1(maddr, 0);")},369:function(e,r){e.varsused.msrc=!0,e.varsused.mdest=!0,e.varsused.mlen=!0,e.varsused.ix=!0,e.code.push("mlen="+r[0]+";"),e.code.push("msrc="+r[1]+";"),e.code.push("mdest="+r[2]+";"),e.code.push("if (mdest < msrc) {"),e.code.push("for (ix=0; ix<mlen; ix++, msrc++, mdest++) self.MemW1(mdest, self.Mem1(msrc));"),e.code.push("} else {"),e.code.push("msrc += (mlen-1); mdest += (mlen-1);"),e.code.push("for (ix=0; ix<mlen; ix++, msrc--, mdest--) self.MemW1(mdest, self.Mem1(msrc));"),e.code.push("}")},376:function(e,r){var s="self.heap_malloc("+r[0]+")";e.code.push(r[1]+s+");"),e.code.push("self.assert_heap_valid();")},377:function(e,r){e.code.push("self.heap_free("+r[0]+");"),e.code.push("self.assert_heap_valid();")},384:function(e,r){e.code.push("self.accel_funcnum_map["+r[1]+"] = "+r[0]+";"),e.code.push("self.accel_address_map["+r[1]+"] = self.accel_func_map["+r[0]+"];")},385:function(e,r){e.code.push("if ("+r[0]+" < 9) {"),e.code.push("  self.accel_params["+r[0]+"] = "+r[1]+";"),e.code.push("}")},336:function(e,r){var s="self.linear_search(("+r[0]+"),("+r[1]+"),("+r[2]+"),("+r[3]+"),("+r[4]+"),("+r[5]+"),("+r[6]+"))";e.code.push(r[7]+s+");")},337:function(e,r){var s="self.binary_search(("+r[0]+"),("+r[1]+"),("+r[2]+"),("+r[3]+"),("+r[4]+"),("+r[5]+"),("+r[6]+"))";e.code.push(r[7]+s+");")},338:function(e,r){var s="self.linked_search(("+r[0]+"),("+r[1]+"),("+r[2]+"),("+r[3]+"),("+r[4]+"),("+r[5]+"))";e.code.push(r[6]+s+");")},112:function(e,r){switch(e.curiosys){case 2:if(B(r[0])){var s=Number(r[0])&255;e.code.push("self.Glk.glk_put_char("+s+");")}else e.code.push("self.Glk.glk_put_char(("+r[0]+")&0xff);");break;case 1:V(e),e.code.push("self.tempcallargs[0]=(("+r[0]+")&0xff);"),U(e,"0,0"),e.code.push("self.enter_function(self.iosysrock, 1);"),e.code.push("return;"),e.path_ends=!0;break;case 0:e.code.push("// null streamchar "+r[0]);break}},113:function(e,r){switch(e.curiosys){case 2:var s=C(e,r[0]);if(B(r[0])){var f=Number(s).toString(10);e.code.push("self.Glk.glk_put_jstring("+nr(f)+", true);")}else e.code.push("self.Glk.glk_put_jstring(("+s+").toString(10), true);");break;case 1:V(e),e.code.push("self.stream_num("+e.cp+","+r[0]+", false, 0);"),e.code.push("return;"),e.path_ends=!0;break;case 0:e.code.push("// null streamnum "+r[0]);break}},114:function(e,r){V(e),e.code.push("if (self.stream_string("+e.cp+","+r[0]+", 0, 0)) return;")},115:function(e,r){switch(e.curiosys){case 2:if(B(r[0])){var s=Number(r[0]);e.code.push("self.Glk.glk_put_char_uni("+s+");")}else e.code.push("self.Glk.glk_put_char_uni("+r[0]+");");break;case 1:V(e),e.code.push("self.tempcallargs[0]=("+r[0]+");"),U(e,"0,0"),e.code.push("self.enter_function(self.iosysrock, 1);"),e.code.push("return;"),e.path_ends=!0;break;case 0:e.code.push("// null streamchar "+r[0]);break}},320:function(e,r){e.code.push(r[0]+"self.stringtable)")},321:function(e,r){e.code.push("self.set_string_table("+r[0]+");")},328:function(e,r){e.code.push(r[0]+"self.iosysmode)"),e.code.push(r[1]+"self.iosysrock)")},329:function(e,r){if(e.code.push("self.set_iosys("+r[0]+","+r[1]+");"),B(r[0])){var s=Number(r[0]);e.curiosys=s}else V(e),e.code.push("self.pc = "+e.cp+";"),e.code.push("return;"),e.path_ends=!0},400:function(e,r){var s=C(e,r[0]);if(B(r[0])){var f=Number(s);e.code.push(r[1]+$r(f)+");")}else e.code.push(r[1]+"self.encode_float("+s+"));")},401:function(e,r){e.varsused.valf=!0,e.varsused.res=!0,e.code.push("valf = "+k(e,r[0])+";"),e.code.push("if (!("+r[0]+" & 0x80000000)) {"),e.code.push("  if (isNaN(valf) || !isFinite(valf) || (valf > 0x7fffffff))"),e.code.push("    res = 0x7fffffff;"),e.code.push("  else"),e.code.push("    res = Math.floor(valf);"),e.code.push("} else {"),e.code.push("  if (isNaN(valf) || !isFinite(valf) || (valf < -0x80000000))"),e.code.push("    res = -0x80000000;"),e.code.push("  else"),e.code.push("    res = Math.ceil(valf);"),e.code.push("}"),e.code.push(r[1]+"res>>>0);")},402:function(e,r){e.varsused.valf=!0,e.varsused.res=!0,e.code.push("valf = "+k(e,r[0])+";"),e.code.push("if (!("+r[0]+" & 0x80000000)) {"),e.code.push("  if (isNaN(valf) || !isFinite(valf))"),e.code.push("    res = 0x7fffffff;"),e.code.push("  else"),e.code.push("    res = Math.round(valf);"),e.code.push("  if (res > 0x7fffffff) res = 0x7fffffff;"),e.code.push("} else {"),e.code.push("  if (isNaN(valf) || !isFinite(valf))"),e.code.push("    res = -0x80000000;"),e.code.push("  else"),e.code.push("    res = Math.round(valf);"),e.code.push("  if (res < -0x80000000) res = -0x80000000;"),e.code.push("}"),e.code.push(r[1]+"res>>>0);")},408:function(e,r){var s=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.ceil("+s+")));")},409:function(e,r){var s=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.floor("+s+")));")},416:function(e,r){var s=k(e,r[0]),f=k(e,r[1]);e.code.push(r[2]+"self.encode_float("+s+" + "+f+"));")},417:function(e,r){var s=k(e,r[0]),f=k(e,r[1]);e.code.push(r[2]+"self.encode_float("+s+" - "+f+"));")},418:function(e,r){var s=k(e,r[0]),f=k(e,r[1]);e.code.push(r[2]+"self.encode_float("+s+" * "+f+"));")},419:function(e,r){var s=k(e,r[0]),f=k(e,r[1]);e.code.push(r[2]+"self.encode_float("+s+" / "+f+"));")},420:function(e,r){var s=k(e,r[0],!0),f=k(e,r[1],!0);e.varsused.modv=!0,e.varsused.quov=!0,e.code.push("modv=("+s+" % "+f+");"),e.code.push("quov=self.encode_float(("+s+" - modv) / "+f+");"),e.code.push("if (quov == 0x0 || quov == 0x80000000) {"),e.code.push("  quov = (("+r[0]+" ^ "+r[1]+") & 0x80000000) >>>0;"),e.code.push("}"),e.code.push(r[2]+"self.encode_float(modv));"),e.code.push(r[3]+"quov);")},424:function(e,r){var s=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.sqrt("+s+")));")},425:function(e,r){var s=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.exp("+s+")));")},426:function(e,r){var s=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.log("+s+")));")},427:function(e,r){e.varsused.valf=!0;var s=k(e,r[0],!0),f=k(e,r[1],!0);e.code.push("if ("+r[0]+" == 0x3f800000) {"),e.code.push("  valf = 0x3f800000;"),e.code.push("} else if ("+r[0]+" == 0xbf800000 && ("+r[1]+" == 0xff800000 || "+r[1]+" == 0x7f800000)) {"),e.code.push("  valf = 0x3f800000;"),e.code.push("} else {"),e.code.push("  valf=self.encode_float(Math.pow("+s+", "+f+"));"),e.code.push("}"),e.code.push(r[2]+"valf);")},432:function(e,r){var s=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.sin("+s+")));")},433:function(e,r){var s=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.cos("+s+")));")},434:function(e,r){var s=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.tan("+s+")));")},435:function(e,r){var s=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.asin("+s+")));")},436:function(e,r){var s=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.acos("+s+")));")},437:function(e,r){var s=k(e,r[0]);e.code.push(r[1]+"self.encode_float(Math.atan("+s+")));")},438:function(e,r){var s=k(e,r[0]),f=k(e,r[1]);e.code.push(r[2]+"self.encode_float(Math.atan2("+s+", "+f+")));")},448:function(e,r){var s,f,i,u;e.varsused.fequal=!0,e.varsused.fdiff=!0,e.code.push("if (("+r[2]+" & 0x7f800000) == 0x7f800000 && ("+r[2]+" & 0x007fffff) != 0) {"),e.code.push("  fequal = 0;"),e.code.push("} else if (("+r[0]+" == 0xff800000 || "+r[0]+" == 0x7f800000) && ("+r[1]+" == 0xff800000 || "+r[1]+" == 0x7f800000)) {"),e.code.push("  fequal = ("+r[0]+" == "+r[1]+");"),e.code.push("} else {"),B(r[2])?(s=Number(r[2]),u=""+vr(s&2147483647)):(s="self.decode_float(("+r[2]+") & 0x7fffffff)",u=ae(e),e.code.push(u+"="+s+";")),f=k(e,r[0]),i=k(e,r[1]),e.code.push("  fdiff = "+i+" - "+f+";"),e.code.push("  fequal = (fdiff <= "+u+" && fdiff >= -("+u+"));"),e.code.push("}"),e.code.push("if (fequal) {"),z(e,r[3]),e.code.push("}")},449:function(e,r){var s,f,i,u;e.varsused.fequal=!0,e.varsused.fdiff=!0,e.code.push("if (("+r[2]+" & 0x7f800000) == 0x7f800000 && ("+r[2]+" & 0x007fffff) != 0) {"),e.code.push("  fequal = 0;"),e.code.push("} else if (("+r[0]+" == 0xff800000 || "+r[0]+" == 0x7f800000) && ("+r[1]+" == 0xff800000 || "+r[1]+" == 0x7f800000)) {"),e.code.push("  fequal = ("+r[0]+" == "+r[1]+");"),e.code.push("} else {"),B(r[2])?(s=Number(r[2]),u=""+vr(s&2147483647)):(s="self.decode_float(("+r[2]+") & 0x7fffffff)",u=ae(e),e.code.push(u+"="+s+";")),f=k(e,r[0]),i=k(e,r[1]),e.code.push("  fdiff = "+i+" - "+f+";"),e.code.push("  fequal = (fdiff <= "+u+" && fdiff >= -("+u+"));"),e.code.push("}"),e.code.push("if (!fequal) {"),z(e,r[3]),e.code.push("}")},450:function(e,r){var s,f;s=k(e,r[0]),f=k(e,r[1]),e.code.push("if ("+s+" < "+f+") {"),z(e,r[2]),e.code.push("}")},451:function(e,r){var s,f;s=k(e,r[0]),f=k(e,r[1]),e.code.push("if ("+s+" <= "+f+") {"),z(e,r[2]),e.code.push("}")},452:function(e,r){var s,f;s=k(e,r[0]),f=k(e,r[1]),e.code.push("if ("+s+" > "+f+") {"),z(e,r[2]),e.code.push("}")},453:function(e,r){var s,f;s=k(e,r[0]),f=k(e,r[1]),e.code.push("if ("+s+" >= "+f+") {"),z(e,r[2]),e.code.push("}")},456:function(e,r){e.code.push("if (("+r[0]+" & 0x7f800000) == 0x7f800000 && ("+r[0]+" & 0x007fffff) != 0) {"),z(e,r[1]),e.code.push("}")},457:function(e,r){e.code.push("if ("+r[0]+" == 0xff800000 || "+r[0]+" == 0x7f800000) {"),z(e,r[1]),e.code.push("}")},304:function(e,r){var s;if(B(r[0])?s=a.Glk.call_may_not_return(Number(r[0])):s=!0,s&&(e.code.push("  self.prevpc = "+e.prevcp+";"),e.code.push("  self.pc = "+e.cp+";")),e.code.push("self.tempglkargs.length = "+r[1]+";"),B(r[1])){var f,i=Number(r[1]);for(f=0;f<i;f++)if(e.offstack.length){var u=Be(e);e.code.push("self.tempglkargs["+f+"]="+u+";")}else e.code.push("self.tempglkargs["+f+"]=self.frame.valstack.pop();");V(e)}else e.varsused.ix=!0,V(e),e.code.push("for (ix=0; ix<"+r[1]+"; ix++) { self.tempglkargs[ix]=self.frame.valstack.pop(); }");e.varsused.glkret=!0,e.code.push("glkret = self.GiDispa.get_function("+r[0]+")(self.tempglkargs);"),s&&(e.code.push("if (glkret === self.Glk.DidNotReturn) {"),e.code.push("  self.resumefuncop = "+M(r[2])+";"),e.code.push("  self.resumevalue = 0;"),e.code.push("  self.pc = "+e.cp+";"),e.code.push("  self.done_executing = true;"),e.code.push("  return;"),e.code.push("}")),A(e,r[2],"glkret")}};function ae(e,r){for(var s=0,f;;){if(f="_hold"+s,!e.holduse[f])return e.holduse[f]=r?1:!0,f;s++}}function Be(e){var r=e.offstack.pop();if(B(r))return r;var s=e.holduse[r];return(isNaN(s)||s===!1||s===!0)&&w("Offstack variable not marked as stack.",r),s--,s==0&&(s=!0),e.holduse[r]=s,r}function Ke(e,r){e.offstack.push(r);var s=e.holduse[r];!s||s===!0?s=1:s++,e.holduse[r]=s}function b(e,r,s,f){var i=e.offloc[r];if(i&&er(i)){var u=e.holduse[i];u--,u==0&&(u=!0),e.holduse[i]=u}if(s===void 0){e.offloc[r]=void 0,e.offlocdirty[r]=!1;return}if(e.offloc[r]=s,e.offlocdirty[r]=!0,f){var t=s,u=e.holduse[t];!u||u===!0?u=1:u++,e.holduse[t]=u}}function Me(e,r){for(var s;e.offstack.length<r;)s=ae(e,!0),e.offstack.unshift(s),e.code.push(s+"=self.frame.valstack.pop();")}function B(e){return e[0]==="0"}function er(e){return e[0]==="_"}function rr(e,r,s,f){var i,u,t,c,v,n,x;for(f.desttype=0,f.numops=s.numops,i=r,r+=s.numops+1>>1,u=0;u<s.numops;u++){(u&1)==0?(t=l(i),c=t&15):(c=t>>4&15,i++);var N=s.formlist[u];if(N=="L"){switch(c){case 8:e.offstack.length?f[u]=Be(e):(x=ae(e),e.code.push(x+"=self.frame.valstack.pop();"),f[u]=x);continue;case 0:f[u]="0";continue;case 1:v=ze(r),r++,f[u]=v;continue;case 2:v=Ae(r),r+=2,f[u]=v;continue;case 3:v=ue(r),r+=4,f[u]=v;continue}if(c>=9&&c<=11){if(c==9?(n=l(r),r++):c==10?(n=_(r),r+=2):c==11&&(n=g(r),r+=4),e.offloc[n]!==void 0){f[u]=e.offloc[n];continue}s.argsize==4?v="self.frame.locals["+n+"]":s.argsize==2?v="self.frame.locals["+n+"] & 0xffff":v="self.frame.locals["+n+"] & 0xff",x=ae(e,!0),e.code.push(x+"=("+v+");"),e.offloc[n]=x,e.offlocdirty[n]=!1,f[u]=x;continue}switch(c){case 15:n=g(r)+R,r+=4;break;case 14:n=_(r)+R,r+=2;break;case 13:n=l(r)+R,r++;break;case 7:n=g(r),r+=4;break;case 6:n=_(r),r+=2;break;case 5:n=l(r),r++;break;default:w("Unknown addressing mode in load operand.")}s.argsize==4?v="self.Mem4("+n+")":s.argsize==2?v="self.Mem2("+n+")":v="self.Mem1("+n+")",x=ae(e),e.code.push(x+"=("+v+");"),f[u]=x;continue}else if(N=="E"){switch(c){case 8:e.offstack.length?f[u]=Be(e):f[u]="self.frame.valstack.pop()";continue;case 0:f[u]="0";continue;case 1:v=ze(r),r++,f[u]=v;continue;case 2:v=Ae(r),r+=2,f[u]=v;continue;case 3:v=ue(r),r+=4,f[u]=v;continue}if(c>=9&&c<=11){if(c==9?(n=l(r),r++):c==10?(n=_(r),r+=2):c==11&&(n=g(r),r+=4),e.offloc[n]!==void 0){f[u]=e.offloc[n];continue}s.argsize==4?v="self.frame.locals["+n+"]":s.argsize==2?v="self.frame.locals["+n+"] & 0xffff":v="self.frame.locals["+n+"] & 0xff",x=ae(e,!0),e.code.push(x+"=("+v+");"),e.offloc[n]=x,e.offlocdirty[n]=!1,f[u]=x;continue}switch(c){case 15:n=g(r)+R,r+=4;break;case 14:n=_(r)+R,r+=2;break;case 13:n=l(r)+R,r++;break;case 7:n=g(r),r+=4;break;case 6:n=_(r),r+=2;break;case 5:n=l(r),r++;break;default:w("Unknown addressing mode in load operand.")}s.argsize==4?v="self.Mem4("+n+")":s.argsize==2?v="self.Mem2("+n+")":v="self.Mem1("+n+")",f[u]=v;continue}else if(N=="S"){switch(c){case 8:x=ae(e,!0),e.offstack.push(x),f[u]=x+"=(";continue;case 0:f[u]="(";continue}if(c>=9&&c<=11){c==9?(n=l(r),r++):c==10?(n=_(r),r+=2):c==11&&(n=g(r),r+=4),s.argsize==4?(x=ae(e,!0),b(e,n,x,!1),f[u]=x+"=("):s.argsize==2?(b(e,n,void 0),f[u]="self.frame.locals["+n+"]=(0xffff &"):(b(e,n,void 0),f[u]="self.frame.locals["+n+"]=(0xff &");continue}switch(c){case 15:n=g(r)+R,r+=4;break;case 14:n=_(r)+R,r+=2;break;case 13:n=l(r)+R,r++;break;case 7:n=g(r),r+=4;break;case 6:n=_(r),r+=2;break;case 5:n=l(r),r++;break;default:w("Unknown addressing mode in store operand.")}s.argsize==4?v="self.MemW4("+n+",":s.argsize==2?v="self.MemW2("+n+",":v="self.MemW1("+n+",",f[u]=v;continue}else if(N=="F"){var E=f.func_store;switch(c){case 8:E.mode=8,E.argsize=s.argsize,f[u]=E;continue;case 0:E.mode=0,E.argsize=s.argsize,f[u]=E;continue}if(c>=9&&c<=11){c==9?(n=l(r),r++):c==10?(n=_(r),r+=2):c==11&&(n=g(r),r+=4),E.mode=11,E.addr=n,E.argsize=s.argsize,f[u]=E;continue}switch(c){case 15:n=g(r)+R,r+=4;break;case 14:n=_(r)+R,r+=2;break;case 13:n=l(r)+R,r++;break;case 7:n=g(r),r+=4;break;case 6:n=_(r),r+=2;break;case 5:n=l(r),r++;break;default:w("Unknown addressing mode in store operand.")}E.mode=15,E.addr=n,E.argsize=s.argsize,f[u]=E;continue}else if(N=="C"){switch(c){case 8:f[u]="3,0";continue;case 0:f[u]="0,0";continue}if(c>=9&&c<=11){c==9?(n=l(r),r++):c==10?(n=_(r),r+=2):c==11&&(n=g(r),r+=4),f[u]="2,"+n;continue}switch(c){case 15:n=g(r)+R,r+=4;break;case 14:n=_(r)+R,r+=2;break;case 13:n=l(r)+R,r++;break;case 7:n=g(r),r+=4;break;case 6:n=_(r),r+=2;break;case 5:n=l(r),r++;break;default:w("Unknown addressing mode in store operand.")}f[u]="1,"+n;continue}else w("Unknown operand type.",N)}return r}function Fr(e){var r=e,s=l(r);s!=192&&s!=193&&(s>=192&&s<=223?w("Call to unknown type of function.",r):w("Call to non-function.",r)),r++;for(var f=[],i=r,u=0;;){var t=l(r);r++;var c=l(r);if(r++,t==0)break;t!=1&&t!=2&&t!=4&&w("Invalid local variable size in function header.",t),f.push({size:t,count:c})}for(var v=y.slice(i,r);v.length%4;)v.push(0);return new cr(e,r,f,v)}function Ms(e,r,s){var f=r,i,u,t,c={vmfunc:e,cp:null,prevcp:null,curiosys:s,code:[],holduse:{},varsused:{},offstack:[],offloc:[],offlocdirty:[],path_ends:!1},v={};for(v.func_store={},c.code.push("");!c.path_ends;){c.prevcp=f,u=f,i=l(f),i===void 0&&w("Tried to compile nonexistent address",f),f++,i&128&&(i&64?(i&=63,i=i*256|l(f),f++,i=i*256|l(f),f++,i=i*256|l(f),f++):(i&=127,i=i*256|l(f),f++)),c.code.push("// "+u.toString(16)+": opcode "+i.toString(16));var n=m[i];n||w("Encountered unknown opcode.",i),f=rr(c,f,n,v),c.cp=f;var x=ee[i];x||w("Encountered unhandled opcode.",i),x(c,v);for(t in c.holduse)c.holduse[t]===!0&&(c.holduse[t]=!1);c.offstack.length&&c.code.push("// offstack: "+c.offstack.join(",")),c.offloc.length&&c.code.push("// offloc: "+c.offloc.join(",")+"; dirty: "+c.offlocdirty.join(",")),e.pathaddrs[f]&&!c.path_ends&&(c.code.push("// reached jump-in point"),c.code.push("self.pc="+f+";"),V(c),c.code.push("return;"),c.path_ends=!0)}c.offstack.length&&w("Path compilation ended with nonempty offstack.",c.offstack.length),c.offloc.length&&w("Path compilation ended with nonempty offloc.",c.offloc.length);{var N=[];for(t in c.holduse)N.push(t);for(t in c.varsused)N.push(t);N.length&&(c.code[0]="var "+N.join(",")+";")}return tr(c.code.join(`
`),"_func_path_"+r)}function Mr(e,r){var s;ss++;var f=Sr[e];if(f!==void 0){fs++;var i=f(r,a.tempcallargs);Cr(i);return}var u=Nr[e];u===void 0&&(u=Fr(e),e<R&&(Nr[e]=u)),a.pc=u.startpc;var t=new qe(u);if(t.depth=q.length,q.length==0?t.framestart=0:t.framestart=a.frame.framestart+a.frame.framelen+4*a.frame.valstack.length,q.push(t),a.frame=t,u.functype==192){for(s=r-1;s>=0;s--)a.frame.valstack.push(a.tempcallargs[s]);a.frame.valstack.push(r)}else for(s=0;s<r;s++){var c=u.localsindex[s];if(c===void 0)break;c.size==4?a.frame.locals[c.pos]=a.tempcallargs[s]:c.size==2?a.frame.locals[c.pos]=a.tempcallargs[s]&65535:c.size==1&&(a.frame.locals[c.pos]=a.tempcallargs[s]&255)}}a.enter_function=Mr;function Cs(){var e=a.frame.depth;if(q.pop(),q.length==0)return a.frame=null,!0;a.frame=q[q.length-1],a.frame.depth!=e-1&&w("Stack inconsistent after function exit.")}a.leave_function=Cs;function Ss(e){for(;q.length&&q[q.length-1].framestart>e;)q.pop();q.length==0&&w("Stack evaporated during throw."),a.frame=q[q.length-1],e-=a.frame.framestart+a.frame.framelen,e<0&&w("Attempted to throw below the frame value stack."),e&3&&w("Attempted to throw to an unaligned address."),e>>>=2,e>a.frame.valstack.length&&w("Attempted to throw beyond the frame value stack."),a.frame.valstack.length=e}a.pop_stack_to=Ss;function Cr(e){var r,s;isNaN(e)&&w("Function returned undefined value.");var f=a.frame.valstack,i=f.length,u=f[i-1];switch(u!=a.frame.framestart&&(f.length-=1,w("Call stub frameptr ("+u+") does not match frame ("+a.frame.framestart+")")),a.pc=f[i-2],r=f[i-3],s=f[i-4],f.length-=4,s){case 0:return;case 1:j(r,e);return;case 2:a.frame.locals[r]=e;return;case 3:a.frame.valstack.push(e);return;case 17:w("String-terminator call stub at end of function call.");return;case 16:mr(0,a.pc,225,r);return;case 18:Zr(0,a.pc,!0,r);return;case 19:mr(0,a.pc,224,r);return;case 20:mr(0,a.pc,226,r);return;default:w("Unrecognized desttype in callstub.",s)}}a.pop_callstub=Cr;function Ls(e,r,s){switch(e){case 0:return;case 1:j(r,s);return;case 2:a.frame.locals[r]=s;return;case 3:a.frame.valstack.push(s);return;default:w("Unrecognized desttype in callstub.",e)}}a.store_operand=Ls;function Gs(e,r){if(!!e)switch(e.mode){case 8:a.frame.valstack.push(r);return;case 0:return;case 11:e.argsize==4?a.frame.locals[e.addr]=r:e.argsize==2?a.frame.locals[e.addr]=65535&r:a.frame.locals[e.addr]=255&r;return;case 15:e.argsize==4?j(e.addr,r):e.argsize==2?S(e.addr,r):Ne(e.addr,r);return;default:w("Unknown addressing mode in store func by operand.")}}function zs(){var e=a.prevpc,r=l(e);return e++,r&128&&(r&64?(r&=63,r=r<<8|l(e),e++,r=r<<8|l(e),e++,r=r<<8|l(e),e++):(r&=127,r=r<<8|l(e),e++)),r!=304?(I("parse_partial_operand: parsed wrong opcode: "+r),null):{selop:l(e)&15,argsop:l(e)>>4&15,resop:l(e+1)&15}}function dr(e){e==0?a.random_func=Math.random:(As(e),a.random_func=Or)}a.set_random=dr;var he=void 0,Te,He;function As(e){var r,s,f,i,u;for(he===void 0&&(he=Array(55)),he[54]=e,Te=0,He=31,f=1,r=0;r<55;r++)s=21*r%55,he[s]=f,f=e-f>>>0,e=he[s];for(u=0;u<4;u++)for(r=0;r<55;r++)i=he[r]-he[(1+r+30)%55],he[r]=i>>>0}function Or(){return Te=(Te+1)%55,He=(He+1)%55,he[Te]=he[Te]-he[He]>>>0,he[Te]/4294967296}var Sr={},sr={};a.accel_address_map=Sr,a.accel_funcnum_map=sr;var L=[0,0,0,0,0,0,0,0,0];a.accel_params=L;var ce={1:function(r,s){if(r<1)return 0;var f=s[0];if(f<36||f>=a.endmem)return 0;var i=l(f);return i>=224?3:i>=192?2:i>=112&&i<=127&&f>=R?1:0},2:function(r,s){var f=r>0?s[0]:0,i=r>1?s[1]:0;if(ce[1](r,s)!=1)return a.Glk.glk_put_jstring(`
[** Programming error: tried to find the "." of (something) **]
`),0;var u=g(f+16);if(!u)return 0;var t=g(u);return u+=4,Br(i,2,u,10,t,0,0)},3:function(r,s){var f=r>0?s[0]:0,i=r>1?s[1]:0,u=Lr(f,i);return u==0?0:g(u+4)},4:function(r,s){var f=r>0?s[0]:0,i=r>1?s[1]:0,u=Lr(f,i);return u==0?0:4*_(u+2)},5:function(r,s){var f,i,u,t,c,v=r>0?s[0]:0,n=r>1?s[1]:0;if(f=ce[1](r,s),f==3)return n==L[5]?1:0;if(f==2)return n==L[4]?1:0;if(f!=1)return 0;if(n==L[2])return je(v)||v==L[2]||v==L[5]||v==L[4]||v==L[3]?1:0;if(n==L[3])return je(v)||v==L[2]||v==L[5]||v==L[4]||v==L[3]?0:1;if(n==L[5]||n==L[4])return 0;if(!je(n))return a.Glk.glk_put_jstring(`
[** Programming error: tried to apply 'ofclass' with non-class **]
`),0;if(i=Lr(v,2),i==0||(u=g(i+4),u==0))return 0;for(t=_(i+2),c=0;c<t;c++)if(g(u+4*c)==n)return 1;return 0},6:function(r,s){var f=r>1?s[1]:0,i;return i=ce[3](r,s),i==0?f>0&&f<L[1]?g(L[8]+4*f):(a.Glk.glk_put_jstring(`
[** Programming error: tried to read (something) **]
`),0):g(i)},7:function(r,s){var f=r>0?s[0]:0,i=r>1?s[1]:0,u=L[1],t=ce[1](r,s);return t==3?i==u+6||i==u+7?1:0:t==2?i==u+5?1:0:t!=1?0:i>=u&&i<u+8&&je(f)||ce[3](r,s)?1:0},8:function(r,s){var f=r>0?s[0]:0,i=r>1?s[1]:0;if(ce[1](r,s)!=1)return a.Glk.glk_put_jstring(`
[** Programming error: tried to find the "." of (something) **]
`),0;var u=g(f+4*(3+(L[7]>>2)));if(!u)return 0;var t=g(u);return u+=4,Br(i,2,u,10,t,0,0)},9:function(r,s){var f=r>0?s[0]:0,i=r>1?s[1]:0,u=Gr(f,i);return u==0?0:g(u+4)},10:function(r,s){var f=r>0?s[0]:0,i=r>1?s[1]:0,u=Gr(f,i);return u==0?0:4*_(u+2)},11:function(r,s){var f,i,u,t,c,v=r>0?s[0]:0,n=r>1?s[1]:0;if(f=ce[1](r,s),f==3)return n==L[5]?1:0;if(f==2)return n==L[4]?1:0;if(f!=1)return 0;if(n==L[2])return je(v)||v==L[2]||v==L[5]||v==L[4]||v==L[3]?1:0;if(n==L[3])return je(v)||v==L[2]||v==L[5]||v==L[4]||v==L[3]?0:1;if(n==L[5]||n==L[4])return 0;if(!je(n))return a.Glk.glk_put_jstring(`
[** Programming error: tried to apply 'ofclass' with non-class **]
`),0;if(i=Gr(v,2),i==0||(u=g(i+4),u==0))return 0;for(t=_(i+2),c=0;c<t;c++)if(g(u+4*c)==n)return 1;return 0},12:function(r,s){var f=r>1?s[1]:0,i;return i=ce[9](r,s),i==0?f>0&&f<L[1]?g(L[8]+4*f):(a.Glk.glk_put_jstring(`
[** Programming error: tried to read (something) **]
`),0):g(i)},13:function(r,s){var f=r>0?s[0]:0,i=r>1?s[1]:0,u=L[1],t=ce[1](r,s);return t==3?i==u+6||i==u+7?1:0:t==2?i==u+5?1:0:t!=1?0:i>=u&&i<u+8&&je(f)||ce[9](r,s)?1:0}};a.accel_func_map=ce;var Ce=[0,0];function je(e){return g(e+13+L[7])==L[2]}function Lr(e,r){var s=0,f;if(r&4294901760){if(s=g(L[0]+(r&65535)*4),Ce[0]=e,Ce[1]=s,ce[5](2,Ce)==0)return 0;r=r>>16,e=s}return Ce[0]=e,Ce[1]=r,f=ce[2](2,Ce),f==0||je(e)&&s==0&&(r<L[1]||r>=L[1]+8)||g(L[6])!=e&&l(f+9)&1?0:f}function Gr(e,r){var s=0,f;if(r&4294901760){if(s=g(L[0]+(r&65535)*4),Ce[0]=e,Ce[1]=s,ce[11](2,Ce)==0)return 0;r=r>>16,e=s}return Ce[0]=e,Ce[1]=r,f=ce[8](2,Ce),f==0||je(e)&&s==0&&(r<L[1]||r>=L[1]+8)||g(L[6])!=e&&l(f+9)&1?0:f}function zr(e){if(a.stringtable!=e&&(We=void 0,Ve=void 0,a.stringtable=e,a.stringtable!=0)){var r=pr[a.stringtable];if(r===void 0){var s=void 0,f=g(a.stringtable),i=g(a.stringtable+8),u=a.stringtable+f<=R;if(u){var t=Array(1);_r(t,i,4,0),s=t[0],s===void 0&&w("Failed to create decoding tree.")}r=new xr(a.stringtable,s),pr[a.stringtable]=r}We=r.decoding_tree,Ve=r.vmstring_tables[a.iosysmode]}}a.set_string_table=zr;function Pr(e,r){switch(e){case 0:r=0;break;case 1:break;case 2:r=0;break;default:e=0,r=0;break}a.iosysmode=e,a.iosysrock=r;var s=pr[a.stringtable];s===void 0?Ve=void 0:Ve=s.vmstring_tables[a.iosysmode]}a.set_iosys=Pr;function _r(e,r,s,f){var i,u,t,c;if(u=l(r),u==0&&s==4){t=Array(16),t.type=0,t.depth=4,e[f]=t,_r(t,r,0,0);return}if(u==0){var v=g(r+1),n=g(r+5);_r(e,v,s+1,f),_r(e,n,s+1,f|1<<s);return}switch(r++,t={},t.type=u,t.depth=s,u){case 2:t.value=l(r),t.cchar=Fe(t.value);break;case 4:t.value=g(r),t.cchar=Fe(t.value);break;case 3:case 5:t.addr=r;break;case 8:case 9:t.addr=g(r);break;case 10:case 11:t.addr=r;break;case 1:break;default:w("Unknown node type in string table.",u)}for(c=1<<s,i=f;i<16;i+=c)e[i]=t}function Zr(e,r,s,f){var i=(r&4294967295).toString(10);switch(a.iosysmode){case 2:f&&(i=i.slice(f)),a.Glk.glk_put_jstring(i,!0);break;case 1:if(s||(a.frame.valstack.push(17,0,e,a.frame.framestart),s=!0),f<i.length){var u=i.charCodeAt(f);return a.frame.valstack.push(18,f+1,r,a.frame.framestart),a.tempcallargs[0]=u,Mr(a.iosysrock,1),!0}break;case 0:break}if(s){var t,c;a.frame.valstack.pop()!=a.frame.framestart&&w("Call stub frameptr does not match frame."),a.pc=a.frame.valstack.pop(),c=a.frame.valstack.pop(),t=a.frame.valstack.pop(),t!=17&&w("String-on-string call stub while printing number.")}}a.stream_num=Zr;function mr(e,r,s,f){for(var i=s!=0,u,t,c,v,n;;){if(t=void 0,s==0?u=r:u=r+"/"+s+"/"+f,Ve!==void 0&&r<R?(t=Ve[u],t===void 0&&(t=Hr(a.iosysmode,r,s,f),Ve[u]=t,Er++,ls++)):(t=Hr(a.iosysmode,r,s,f),Er++),t instanceof Function){if(c=t(a,e,i),c instanceof Array){i=!0,r=c[0],s=c[1],f=c[2];continue}if(c)return!0}else if(a.Glk.glk_put_jstring(t),!i)return!1;if(a.frame.valstack.pop()!=a.frame.framestart&&w("Call stub frameptr does not match frame."),a.pc=a.frame.valstack.pop(),n=a.frame.valstack.pop(),v=a.frame.valstack.pop(),v==17)return!0;v==16?(i=!0,f=n,s=225,r=a.pc):w("Function-terminator call stub at end of string.")}}a.stream_string=mr;function Hr(e,r,s,f){var i=r,u=f,t=void 0,c,v;i||w("Called compile_string with null address.");var n={startaddr:r,startbitnum:f,buffer:[],code:[]};if(s==0?(v=l(i),v==226?i+=4:i++,u=0):v=s,v==225)if(We){var x,N,E,J,re,D,K=!1;for(x=l(i),u&&(x>>=u),N=8-u,E=!1,We instanceof Array||(K=!0),re=We;!K;){if(N<4){var Le=l(i+1);x|=Le<<N,N+=8,E=!0}if(D=re[x&15],N-=D.depth,x>>=D.depth,u+=D.depth,u>=8)if(i+=1,u-=8,E)E=!1;else{var Le=l(i);x|=Le<<N,N+=8}if(D instanceof Array){re=D;continue}switch(D.type){case 1:K=!0;break;case 2:case 4:switch(e){case 2:n.buffer.push(D.cchar);break;case 1:fe(n),Q(n),U(n,"0x10,"+u,i),n.code.push("self.tempcallargs[0]="+D.value+";"),n.code.push("self.enter_function(self.iosysrock, 1);"),t=!0,K=!0;break}re=We;break;case 3:switch(e){case 2:for(J=D.addr;c=l(J),c!=0;)n.buffer.push(Fe(c)),J++;break;case 1:fe(n),Q(n),U(n,"0x10,"+u,i),t="["+D.addr+", 0xE0, 0]",K=!0;break}re=We;break;case 5:switch(e){case 2:for(J=D.addr;c=g(J),c!=0;)n.buffer.push(Fe(c)),J+=4;break;case 1:fe(n),Q(n),U(n,"0x10,"+u,i),t="["+D.addr+", 0xE2, 0]",K=!0;break}re=We;break;case 8:case 9:case 10:case 11:fe(n),Q(n),n.code.push("var otype, retval;"),n.code.push("var oaddr = "+D.addr+";"),D.type>=9&&n.code.push("oaddr = self.Mem4(oaddr);"),D.type==11&&n.code.push("oaddr = self.Mem4(oaddr);"),n.code.push("otype = self.Mem1(oaddr);"),t="retval",K=!0,U(n,"0x10,"+u,i),n.code.push("if (otype >= 0xE0 && otype <= 0xFF) {"),n.code.push("retval = [oaddr, 0, 0];"),n.code.push("}"),n.code.push("else if (otype >= 0xC0 && otype <= 0xDF) {");var ge=0;if(D.type==10||D.type==11){ge=g(D.addr+4);for(var pe=0;pe<ge;pe++)n.code.push("self.tempcallargs["+pe+"]="+g(D.addr+8+4*pe)+";")}n.code.push("self.enter_function(oaddr, "+ge+");"),n.code.push("retval = true;"),n.code.push("}"),n.code.push("else {"),n.code.push("self.fatal_error('Unknown object while decoding string indirect reference.', otype);"),n.code.push("}");break;default:w("Unknown entity in string decoding (cached).");break}}}else{var X,de,Ge,K=!1;for(a.stringtable||w("Attempted to print a compressed string with no table set."),de=l(i),u&&(de>>=u),X=g(a.stringtable+8);!K;)switch(Ge=l(X),X++,Ge){case 0:de&1?X=g(X+4):X=g(X+0),u==7?(u=0,i++,de=l(i)):(u++,de>>=1);break;case 1:t=!1,K=!0;break;case 2:switch(c=l(X),e){case 2:n.buffer.push(Fe(c));break;case 1:fe(n),Q(n),U(n,"0x10,"+u,i),n.code.push("self.tempcallargs[0]="+c+";"),n.code.push("self.enter_function(self.iosysrock, 1);"),t=!0,K=!0;break}X=g(a.stringtable+8);break;case 4:switch(c=g(X),e){case 2:n.buffer.push(Fe(c));break;case 1:fe(n),Q(n),U(n,"0x10,"+u,i),n.code.push("self.tempcallargs[0]="+c+";"),n.code.push("self.enter_function(self.iosysrock, 1);"),t=!0,K=!0;break}X=g(a.stringtable+8);break;case 3:switch(e){case 2:for(;c=l(X),c!=0;)n.buffer.push(Fe(c)),X++;break;case 1:fe(n),Q(n),U(n,"0x10,"+u,i),t="["+X+", 0xE0, 0]",K=!0;break}X=g(a.stringtable+8);break;case 5:switch(e){case 2:for(;c=g(X),c!=0;)n.buffer.push(Fe(c)),X+=4;break;case 1:fe(n),Q(n),U(n,"0x10,"+u,i),t="["+X+", 0xE2, 0]",K=!0;break}X=g(a.stringtable+8);break;case 8:case 9:case 10:case 11:fe(n),Q(n),n.code.push("var otype, retval;"),n.code.push("var oaddr = "+g(X)+";"),(Ge==9||Ge==11)&&n.code.push("oaddr = self.Mem4(oaddr);"),n.code.push("otype = self.Mem1(oaddr);"),t="retval",K=!0,U(n,"0x10,"+u,i),n.code.push("if (otype >= 0xE0 && otype <= 0xFF) {"),n.code.push("retval = [oaddr, 0, 0];"),n.code.push("}"),n.code.push("else if (otype >= 0xC0 && otype <= 0xDF) {");var ge=0;if(Ge==10||Ge==11){ge=g(X+4);for(var pe=0;pe<ge;pe++)n.code.push("self.tempcallargs["+pe+"]="+g(X+8+4*pe)+";")}n.code.push("self.enter_function(oaddr, "+ge+");"),n.code.push("retval = true;"),n.code.push("}"),n.code.push("else {"),n.code.push("self.fatal_error('Unknown object while decoding string indirect reference.', otype);"),n.code.push("}");break;default:w("Unknown entity in string decoding.",Ge);break}}else if(v==224){var c;switch(e){case 2:for(;c=l(i),i++,c!=0;)n.buffer.push(Fe(c));break;case 1:fe(n),Q(n),c=l(i),i++,c!=0?(U(n,"0x13,0",i),n.code.push("self.tempcallargs[0]="+c+";"),n.code.push("self.enter_function(self.iosysrock, 1);"),t=!0):t="false";break}}else if(v==226){var c;switch(e){case 2:for(;c=g(i),i+=4,c!=0;)n.buffer.push(Fe(c));break;case 1:fe(n),Q(n),c=g(i),i+=4,c!=0?(U(n,"0x14,0",i),n.code.push("self.tempcallargs[0]="+c+";"),n.code.push("self.enter_function(self.iosysrock, 1);"),t=!0):t="false";break}}else v>=224&&v<=255?w("Attempt to print unknown type of string."):w("Attempt to print non-string.");return t?(fe(n),n.code.push("return "+t+";"),tr(n.code.join(`
`),"_func_str_"+r,"nextcp","substring")):(n.code.length>1&&w("Simple-case string generated code."),n.buffer.join(""))}function Bs(e,r){var s;switch(e){case 0:return 196866;case 1:return 131584;case 2:return 1;case 3:return 1;case 4:switch(r){case 0:return 1;case 1:return 1;case 2:return 1;default:return 0}break;case 5:return 1;case 6:return 1;case 7:return 1;case 8:return Js();case 9:return 1;case 10:return ce[r]?1:0;case 11:return 1;default:return 0}}a.do_gestalt=Bs;function Ar(e,r,s){var f;if(s&1)return te(e,r);switch(r){case 4:return[e>>24&255,e>>16&255,e>>8&255,e&255];case 2:return[e>>8&255,e&255];case 1:return[e&255];default:w("Direct search key must hold one, two, or four bytes.")}}function js(e,r,s,f,i,u,t){var c,v,n,x,N=(t&4)!=0,E=(t&2)!=0,J=Ar(e,r,t);for(v=0;v<i;v++,s+=f){for(n=!0,x=te(s+u,r),c=0;n&&c<r;c++)x[c]!=J[c]&&(n=!1);if(n)return N?v:s;if(E){for(n=!0,x=te(s+u,r),c=0;n&&c<r;c++)x[c]!=0&&(n=!1);if(n)break}}return N?4294967295:0}function Br(e,r,s,f,i,u,t){var c,v,n,x,N,E,J,re,D=(t&4)!=0,K=Ar(e,r,t);for(v=0,c=i;v<c;){for(N=0,x=c+v>>1,n=s+x*f,E=0;!N&&E<r;E++)J=l(n+u+E),re=K[E],J<re?N=-1:J>re&&(N=1);if(!N)return D?x:n;N<0?v=x+1:c=x}return D?4294967295:0}function Ns(e,r,s,f,i,u){for(var t,c,v,n=(u&2)!=0,x=Ar(e,r,u);s!=0;){for(v=!0,t=0;v&&t<r;t++)c=l(s+f+t),c!=x[t]&&(v=!1);if(v)return s;if(n){for(v=!0,t=0;v&&t<r;t++)c=l(s+f+t),c!=0&&(v=!1);if(v)break}s=g(s+i)}return 0}a.linear_search=js,a.binary_search=Br,a.linked_search=Ns;function vr(e){var r,s,f;return e&2147483648?(r=!0,e=e&2147483647):r=!1,e==0?r?-0:0:(e&2139095040)==2139095040?(e&8388607)==0?r?-1/0:1/0:r?NaN:NaN:(f=e>>23&255,f?s=(e&8388607|8388608)/8388608*Math.pow(2,f-127):s=(e&8388607)/8388608*Math.pow(2,-126),r?-s:s)}function $r(e){var r,s,f,i,u;return isNaN(e)?2139095041:isFinite(e)?e==0?1/e<0?2147483648:0:(e<0?(u=!0,r=-e):(u=!1,r=e),i=Math.floor(Math.log(r)/Math.log(2)),f=r/Math.pow(2,i),i>=128||(i<-126?(f=f*Math.pow(2,126+i),i=0):i==0&&f==0||(i+=127,f-=1),f=f*8388608,s=f+.4999999999999999<<0,s>=8388608&&(s=0,i++,i>=255))?u?4286578688:2139095040:u?(2147483648|i<<23|s)>>>0:i<<23|s):e<0?4286578688:2139095040}a.decode_float=vr,a.encode_float=$r;var Z=null,Ze=null,Jr=null,Xr=null,Yr=null,jr=null,y,q;a.frame=null,a.vm_started=!1,a.vm_stopped=!1,a.tempcallargs=null,a.tempglkargs=null,a.done_executing=null;var Nr,pr,We,Ve;a.random_func=null;var R,$e,fr,Es,Kr,es,qs;a.pc=null,a.stringtable=null,a.endmem=null,a.protectstart=null,a.protectend=null,a.iosysmode=null,a.iosysrock=null,a.prevpc=null;var Je;a.resumefuncop=null,a.resumevalue=null;var ne,T,Y,rs=0,ss=0,fs=0,as=0,is=0,us=0,ls=0,Er=0;function Ws(){var e,r;Z||w("There is no Glulx game file loaded.");var s=a.Glk.getlibrary("Dialog");if(a.vm_started=!0,a.resumefuncop=null,a.resumevalue=0,y=null,q=[],a.frame=null,a.pc=0,a.prevpc=0,Z.length<36&&w("This is too short to be a valid Glulx file."),e=h(Z,0),e!=1198290284&&w("This is not a valid Glulx file."),r=h(Z,4),r<131072&&w("This Glulx file is too old a version to execute."),r>=197120&&w("This Glulx file is too new a version to execute."),R=h(Z,8),$e=h(Z,12),fr=h(Z,16),Es=h(Z,20),Kr=h(Z,24),es=h(Z,28),qs=h(Z,32),a.protectstart=0,a.protectend=0,(R<256||$e<R||fr<$e)&&w("The segment boundaries in the header are in an impossible order."),$e!=Z.length&&w("The game file length does not agree with the header."),a.done_executing=!1,Nr={},pr={},We=void 0,Ve=void 0,a.tempcallargs=Array(8),a.tempglkargs=Array(8),dr(0),a.endmem=fr,a.stringtable=0,Je=[],ne=0,T=[],Y=[],jr&&s.autosave_write(Ze,null),Yr&&!jr)try{var f=s.autosave_read(Ze);if(f){I("Found autosave..."),Is(f);return}}catch(i){I("Autorestore failed, deleting it: "+o(i)),i.stack&&I(`JS stack dump C:
`+i.stack),s.autosave_write(Ze,null)}ns()}function ns(){var e;Dr();var r=qr();y=null,y=Z.slice(0,$e),a.endmem=y.length,ar(fr,!1),Wr(r),q=[],a.frame=null,a.pc=0,a.prevpc=0,a.iosysmode=0,a.iosysrock=0,zr(es),Mr(Kr,0)}a.vm_restart=ns;function Ds(e){for(var r=[],s=0;s<e.length;){for(var f=0;s<e.length&&e[s]==0&&f<=255;)f++,s++;for(f>0&&(r.push(0),r.push(f-1));s<e.length&&e[s]!=0;)r.push(e[s]),s++}return r}function Qs(e){for(var r=[],s=0;s<e.length;){var f=e[s++];if(f==0)for(var i=e[s++]+1,u=0;u<i;u++)r.push(0);else r.push(f)}return r}function ts(e){for(var r=[],s=0;s<e.length;s++){var f=e[s].key,i=e[s].chunk;f.length!=4&&w("Bad chunk ID (must be exactly 4 chars): "+f),i==null&&w("Missing chunk data: "+f),ie(r,f),H(r,i.length),r=r.concat(i),r.length&1&&r.push(0)}return r}function cs(e){for(var r={},s=0;s<e.length;){if(s+8>e.length){I("IFF chunk header is truncated");return}var f=Qe(e,s,4),i=h(e,s+4);if(s+=8,s+i>e.length){I(f+" chunk is truncated ("+i+" bytes needed, "+(e.length-s)+" available");return}r[f]=e.slice(s,s+i),s+=i,s&1&&(s+=1)}return r}function Ts(e){y.length!=a.endmem&&w("Memory length was incorrect before save."),a.iosysmode!=2&&w("Streams are only available in Glk I/O system.");var r=a.GiDispa.class_obj_from_id("stream",e);if(!r)return!1;var s=[];s.push({key:"IFhd",chunk:Z.slice(0,128)});for(var f=y.slice(R),i=R;i<Z.length;i++)f[i-R]^=Z[i];f=Ds(f),f.splice(0,0,0,0,0,0),be(f,0,a.endmem),s.push({key:"CMem",chunk:f});var u=[];s.push({key:"Stks",chunk:u});for(var i=0;i<q.length;i++)or(q[i],u);if(ir()){var t=[];s.push({key:"MAll",chunk:t}),H(t,ne),H(t,T.length);for(var i=0;i<T.length;i++)H(t,T[i].addr),H(t,T[i].size)}var c=[];ie(c,"IFZS"),c=c.concat(ts(s));var v=ts([{key:"FORM",chunk:c}]);return a.Glk.glk_put_buffer_stream(r,v),!0}function Vs(e){a.iosysmode!=2&&w("Streams are only available in Glk I/O system.");var r=a.GiDispa.class_obj_from_id("stream",e);if(!r)return!1;for(var s=new Array(0),f=new Array(1024),i=1;i>0;)i=a.Glk.glk_get_buffer_stream(r,f),s=s.concat(f.slice(0,i));if(s=cs(s),!s)return I("vm_restore failed: file is not Quetzal"),!1;if(s=s.FORM,!s||Qe(s,0,4)!="IFZS")return I("vm_restore failed: file doesn't start with FORM/IFZS header"),!1;var u=cs(s.slice(4));if(!u.IFhd)return I("vm_restore failed: missing required IFhd chunk"),!1;for(var t=0;t<128;t++)if(u.IFhd[t]!=Z[t])return I("vm_restore failed: this save image is for a different game"),!1;if(!u.CMem)return I("vm_restore failed: missing required CMem chunk"),!1;if(!u.Stks)return I("vm_restore failed: missing required Stks chunk"),!1;var c=qr();Dr();var v=h(u.CMem,0),n=u.CMem.slice(4);for(n=Qs(n);n.length<v-R;)n.push(0);ar(v,!1),y=Z.slice(0,R).concat(n);for(var t=R;t<Z.length;t++)y[t]^=Z[t];y.length!=a.endmem&&w("Memory length was incorrect after restore.");var x=u.Stks;for(q=[];x.length;)a.frame=hr(x),a.frame||w("vm_restore failed: bad stack frame"),q.unshift(a.frame);for(var t=0;t<q.length;t++)q[t].depth=t;a.frame=q[q.length-1];var N=u.MAll;if(N&&N.length>=8){ne=h(N,0);for(var E=h(N,4),t=0;t<E;t++){var J=h(N,8+8*t),re=h(N,12+8*t);T.push(new Se(J,re))}T.sort(function(K,Le){return K.addr-Le.addr});for(var D=ne,t=0;t<T.length;t++){var J=T[t].addr,re=T[t].size;(J<D||J+re>a.endmem)&&w("vm_restore failed: corrupt dynamic heap"),J>D&&Y.push(new Se(D,J-D)),D=J+re}D<a.endmem&&Y.push(new Se(D,a.endmem-D))}return gr(),Wr(c),!0}function Rs(e){var r=a.Glk.getlibrary("Dialog");if(e<0){r.autosave_write(Ze,null);return}var s=zs();if(!!s){var f={},i=a.frame.valstack,u=i.length;i.push(e),s.argsop==8&&i.push(1),s.selop==8&&i.push(192),i.push(0,0,a.prevpc,a.frame.framestart),f.ram=y.slice(R),f.endmem=a.endmem,f.pc=a.pc,f.stack=[];for(var t=0;t<q.length;t++)or(q[t],f.stack);if(ir()){f.heapstart=ne,f.usedlist=[];for(var t=0;t<T.length;t++)f.usedlist.push(T[t].addr),f.usedlist.push(T[t].size)}i.length=u,f.stringtable=a.stringtable,f.iosysmode=a.iosysmode,f.iosysrock=a.iosysrock,f.protectstart=a.protectstart,f.protectend=a.protectend,a.random_func==Or&&he&&(f.srand_table=he.slice(0),f.srand_index1=Te,f.srand_index2=He),f.accel_params=L.slice(0),f.accel_funcnum_map={};for(var c in sr)f.accel_funcnum_map[c]=sr[c];f.glk=a.Glk.save_allstate(),r.autosave_write(Ze,f)}}function Is(e){y=Z.slice(0,$e),y=y.slice(0,R).concat(e.ram),a.endmem=e.endmem,a.pc=e.pc,q=[];for(var r=e.stack.slice(0);r.length;){var s=hr(r);s||w("vm_autorestore failed: bad stack frame"),q.unshift(s)}for(var f=0;f<q.length;f++)q[f].depth=f;if(a.frame=q[q.length-1],e.heapstart===void 0)ne=0,T=[],Y=[];else{ne=e.heapstart,T=[];for(var i=0;i<e.usedlist.length;i+=2){var u=e.usedlist[i],t=e.usedlist[i+1];T.push(new Se(u,t))}T.sort(function(v,n){return v.addr-n.addr}),Y=[];for(var c=ne,f=0;f<T.length;f++){var u=T[f].addr,t=T[f].size;(u<c||u+t>a.endmem)&&w("vm_autorestore failed: corrupt dynamic heap"),u>c&&Y.push(new Se(c,u-c)),c=u+t}c<a.endmem&&Y.push(new Se(c,a.endmem-c))}gr(),zr(e.stringtable),Pr(e.iosysmode,e.iosysrock),a.protectstart=e.protectstart,a.protectend=e.protectend,e.srand_table===void 0?dr(0):(dr(1),he=e.srand_table.slice(0),Te=e.srand_index1,He=e.srand_index2),L=e.accel_params.slice(0);for(var i in e.accel_funcnum_map)sr[i]=e.accel_funcnum_map[i],Sr[i]=a.accel_func_map[sr[i]];a.Glk.restore_allstate(e.glk),Cr(0)}function Us(){y.length!=a.endmem&&w("Memory length was incorrect before saveundo.");var e={};e.ram=y.slice(R),e.endmem=a.endmem,e.pc=a.pc,e.stack=[];for(var r=0;r<q.length;r++)e.stack[r]=Pe(q[r]);e.heapstart=ne,e.usedlist=T.slice(0),e.freelist=Y.slice(0),Je.push(e),Je.length>10&&Je.shift()}function Os(){if(Je.length==0)return!1;var e=Je.pop(),r=qr();return y=y.slice(0,R).concat(e.ram),a.endmem=e.endmem,q=e.stack,a.frame=q[q.length-1],a.pc=e.pc,ne=e.heapstart,T=e.usedlist,Y=e.freelist,Wr(r),y.length!=a.endmem&&w("Memory length was incorrect after undo."),gr(),!0}a.vm_save=Ts,a.vm_restore=Vs,a.vm_saveundo=Us,a.vm_restoreundo=Os;function ar(e,r){var s;if(e!=a.endmem){if(!r&&ir()&&w("Cannot resize Glulx memory space while heap is active."),e<fr&&w("Cannot resize Glulx memory space smaller than it started."),e&255&&w("Can only resize Glulx memory space to a 256-byte boundary."),y.length=e,e>a.endmem)for(s=a.endmem;s<e;s++)y[s]=0;a.endmem=e}}a.change_memsize=ar;function qr(){if(a.protectstart>=a.protectend)return null;for(var e=a.protectend-a.protectstart,r={start:a.protectstart,end:a.protectend,len:e},s=y.slice(a.protectstart,a.protectend);s.length<e;)s.push(0);return r.mem=s,r}function Wr(e){if(!!e){var r,s,f=e.mem,i=e.start,u=e.end;for(u>a.endmem&&(u=a.endmem),r=0,s=i;s<u;r++,s++)y[s]=f[r]}}function Ps(){var e=Z.length,r,s,f;if(e<256||(e&255)!=0||e!=h(Z,12))return 1;for(f=h(Z,32),s=-f>>>0,r=0;r<e;r+=4)s=s+h(Z,r)>>>0;return s!=f?1:0}a.perform_verify=Ps;function Zs(){return Ze}function Hs(){return a}function $s(){var e={game_image_length:Z.length,total_execution_time:rs,total_function_calls:ss,accel_function_calls:fs,total_path_calls:as,paths_cached:is,paths_compiled:us,strings_cached:ls,strings_compiled:Er};return e}function Dr(){ne=0,T=[],Y=[]}function ir(){return T.length>0}function Js(){return ne}function Se(e,r){this.addr=e,this.size=r,this.end=e+r}function Qr(e,r){for(var s=0,f=e.length;s<f;){var i=s+f>>1;e[i].addr<r?s=i+1:f=i}return s}function Xs(e){ir()||(ne=a.endmem);for(var r=0,s=Y.length;r<s;r++){var f=Y[r];if(f.size>=e){f.size>e?Y[r]=new Se(f.addr+e,f.size-e):Y.splice(r,1);var i=Qr(T,f.addr);return T.splice(i,0,new Se(f.addr,e)),f.addr}}var u=a.endmem,t=e+255&4294967040;return ar(a.endmem+t,!0),t>e&&Y.push(new Se(u+e,t-e)),T.push(new Se(u,e)),u}a.heap_malloc=Xs;function Ys(e){var r=Qr(T,e),s=T[r];if((!s||s.addr!=e)&&w("Tried to free non-existent block"),T.splice(r,1),T.length==0){ar(ne,!0),Dr();return}r=Qr(Y,e);var f=Y[r];f&&f.addr==s.end&&(s=new Se(e,s.size+f.size),Y.splice(r,1));var i=Y[r-1];i&&i.end==s.addr&&(s=new Se(i.addr,i.size+s.size),Y.splice(r-1,1),r-=1),Y.splice(r,0,s)}a.heap_free=Ys;function gr(){if(!ir()){ne!=0&&w("Heap inconsistency: heapstart nonzero"),T.length>0&&w("Heap inconsistency: usedlist nonempty"),Y.length>0&&w("Heap inconsistency: usedlist nonempty");return}ne==0&&w("Heap inconsistency: heapstart is zero");for(var e=ne,r=0,s=0;r<T.length||s<Y.length;){var f=T[r],i=Y[s];f&&f.addr==e?(e+=f.size,r++):i&&i.addr==e?(e+=i.size,s++):w("Heap inconsistency: no block at address "+e)}e!=a.endmem&&w("Heap inconsistency: overrun at end of heap")}a.assert_heap_valid=gr;var Re={map:{},functions:[],functionmap:{}};function Ks(){return Re}function ef(){if(!!a.GiLoad){var e=a.GiLoad.get_debug_info();if(!!e){var r,s,f;if(!(e[0]==222&&e[1]==191&&e[2]==0&&e[3]==0)){I("Dbug chunk did not contain an (old-style) Inform gameinfo.dbg file");return}var i=e[4]<<8|e[5];for(s=6,r=!1;!r;){var u=e[s++];switch(u){case 0:case void 0:r=!0;break;case 1:var t=e[s++];for(f=s;e[s];)s++;var c=String.fromCharCode.apply(this,e.slice(f,s));for(s++,f=s;e[s];)s++;var v=String.fromCharCode.apply(this,e.slice(f,s));s++;break;case 2:for(f=s;e[s];)s++;var n=String.fromCharCode.apply(this,e.slice(f,s));s++;var E=e.slice(s,s+4);s+=4;var J=e.slice(s,s+4);s+=4;break;case 3:var x=e[s++]<<8|e[s++];for(f=s;e[s];)s++;var N=String.fromCharCode.apply(this,e.slice(f,s));s++;var E=e.slice(s,s+4);s+=4;var J=e.slice(s,s+4);s+=4;break;case 4:var re=e[s++];for(f=s;e[s];)s++;var de=String.fromCharCode.apply(this,e.slice(f,s));s++;break;case 5:var re=e[s++]<<8|e[s++];for(f=s;e[s];)s++;var de=String.fromCharCode.apply(this,e.slice(f,s));s++;break;case 6:var re=e[s++]<<8|e[s++];for(f=s;e[s];)s++;var de=String.fromCharCode.apply(this,e.slice(f,s));s++;break;case 7:var re=e[s++]<<8|e[s++];for(f=s;e[s];)s++;var de=String.fromCharCode.apply(this,e.slice(f,s));s++;break;case 8:var re=e[s++]<<8|e[s++];for(f=s;e[s];)s++;var de=String.fromCharCode.apply(this,e.slice(f,s));s++;break;case 9:s+=64;break;case 10:var ur=e[s++]<<8|e[s++],D=e[s++]<<8|e[s++];s+=D*6;break;case 11:var ur=e[s++]<<8|e[s++],lr=e.slice(s,s+4);s+=4;var K=e[s++]<<16|e[s++]<<8|e[s++];for(f=s;e[s];)s++;var Le=String.fromCharCode.apply(this,e.slice(f,s));s++;for(var ge=[];e[s];){for(f=s;e[s];)s++;var pe=String.fromCharCode.apply(this,e.slice(f,s));s++,ge.push(pe)}s++,Re.functions.push({num:ur,name:Le,addr:K,locals:ge});break;case 12:var X=e[s++]<<8|e[s++];for(f=s;e[s];)s++;var de=String.fromCharCode.apply(this,e.slice(f,s));s++;break;case 13:for(;e[s];){for(f=s;e[s];)s++;var de=String.fromCharCode.apply(this,e.slice(f,s));s++;var Ge=e[s++]<<16|e[s++]<<8|e[s++];Re.map[de]=Ge}s++;break;case 14:var ur=e[s++]<<8|e[s++],lr=e.slice(s,s+4);s+=4;var hs=e[s++]<<16|e[s++]<<8|e[s++];break;default:I("Unknown record type in debug data: "+u),r=!0;break}}var wr=Re.map["code area"];if(wr){var Xe;for(Xe=0;Xe<Re.functions.length;Xe++){var Ye=Re.functions[Xe];Re.functionmap[wr+Ye.addr]=Ye}}}}}a.VMStopped={dummy:"The top-level function has returned."};function os(){var e,r,s,f,i;for(a.resumefuncop&&(Gs(a.resumefuncop,a.resumevalue),a.resumefuncop=null,a.resumevalue=0),f=new Date().getTime();!a.done_executing;){e=a.frame.vmfunc,r=e[a.iosysmode],s=r[a.pc],s===void 0&&(e.pathaddrs[a.pc]=!0,s=Ms(e,a.pc,a.iosysmode),us++,a.pc<R&&(r[a.pc]=s,is++)),as++;var u=s(a);u===a.VMStopped&&(a.done_executing=!0,a.vm_stopped=!0)}i=new Date().getTime(),rs+=(i-f)/1e3,a.vm_stopped&&a.Glk.glk_exit(),a.Glk.update(),Jr&&I("event executed in "+(i-f)+" ms")}return{classname:"Quixe",version:"2.2.0",init:W,inited:we,getlibrary:le,start:ke,resume:d,get_signature:Zs,get_vm_internals:Hs,get_statistics:$s,get_debuginfo:Ks,ReadByte:ye,WriteByte:me,ReadWord:kr,WriteWord:Ie,ReadStructField:xe,WriteStructField:Ue,SetResumeStore:br,do_autosave:Rs}},nf=new vs;try{Ir.Quixe=nf,Ir.QuixeClass=vs}catch{}});var ws=Vr(gs=>{"use strict";var tf=function(){var a={};a.VM=null,a.Glk=null;function W(m){a.VM=m.vm,a.Glk=m.io}function we(){return a.VM!=null}function le(m){switch(m){case"VM":return a.VM;case"Glk":return a.Glk}return null}var ke={0:"window",1:"stream",2:"fileref",3:"schannel"};function d(m,p,M){this.id=m,this.name=p,this.proto=M}function o(m,p){this.args=m,this.retarg=p}function I(){this.macro="Byte",this.refsize=1,this.serialize=function(){return{type:"ArgString"}}}function _e(){this.macro="Word",this.refsize=4,this.serialize=function(){return{type:"ArgUnicode"}}}function se(m){this.signed=m,this.macro="Byte",this.refsize=1,this.literal=m?"arg_char_signed":"arg_char_unsigned",this.serialize=function(){return{type:"ArgChar",signed:m}}}function O(m){this.signed=m,this.macro="Word",this.refsize=4,this.literal=m?"arg_int_signed":"arg_int_unsigned",this.serialize=function(){return{type:"ArgInt",signed:m}}}function oe(m){this.name=m,this.macro="Word",this.refsize=4}function F(m){this.form=m}function h(m,p,M,A){this.arg=m,this.passin=p,this.passout=M,this.nonnull=A}function G(m,p,M,A,U){this.arg=m,this.retained=p,this.passin=M,this.passout=A,this.nonnull=U}function P(m){switch(m.type){case"ArgString":return new I;case"ArgUnicode":return new _e;case"ArgInt":return m.signed?_:l;case"ArgChar":return m.signed===null?te:m.signed?Ne:g}throw new Error("arg_deserialize: unknown type: "+m.type)}var l=new O(!1),_=new O(!0),g=new se(!1),te=new se(null),Ne=new se(!0),S=new oe("window"),j=new oe("stream"),ie=new oe("fileref"),H=new oe("schannel"),De={1:new d(1,"exit",new o([],null)),3:new d(3,"tick",new o([],null)),4:new d(4,"gestalt",new o([l,l],new h(l,!1,!0,!0))),5:new d(5,"gestalt_ext",new o([l,l,new G(l,!1,!0,!0,!1)],new h(l,!1,!0,!0))),32:new d(32,"window_iterate",new o([S,new h(l,!1,!0,!1)],new h(S,!1,!0,!0))),33:new d(33,"window_get_rock",new o([S],new h(l,!1,!0,!0))),34:new d(34,"window_get_root",new o([],new h(S,!1,!0,!0))),35:new d(35,"window_open",new o([S,l,l,l,l],new h(S,!1,!0,!0))),36:new d(36,"window_close",new o([S,new h(new F(new o([l,l],null)),!1,!0,!1)],null)),37:new d(37,"window_get_size",new o([S,new h(l,!1,!0,!1),new h(l,!1,!0,!1)],null)),38:new d(38,"window_set_arrangement",new o([S,l,l,S],null)),39:new d(39,"window_get_arrangement",new o([S,new h(l,!1,!0,!1),new h(l,!1,!0,!1),new h(S,!1,!0,!1)],null)),40:new d(40,"window_get_type",new o([S],new h(l,!1,!0,!0))),41:new d(41,"window_get_parent",new o([S],new h(S,!1,!0,!0))),42:new d(42,"window_clear",new o([S],null)),43:new d(43,"window_move_cursor",new o([S,l,l],null)),44:new d(44,"window_get_stream",new o([S],new h(j,!1,!0,!0))),45:new d(45,"window_set_echo_stream",new o([S,j],null)),46:new d(46,"window_get_echo_stream",new o([S],new h(j,!1,!0,!0))),47:new d(47,"set_window",new o([S],null)),48:new d(48,"window_get_sibling",new o([S],new h(S,!1,!0,!0))),64:new d(64,"stream_iterate",new o([j,new h(l,!1,!0,!1)],new h(j,!1,!0,!0))),65:new d(65,"stream_get_rock",new o([j],new h(l,!1,!0,!0))),66:new d(66,"stream_open_file",new o([ie,l,l],new h(j,!1,!0,!0))),67:new d(67,"stream_open_memory",new o([new G(te,!0,!0,!0,!1),l,l],new h(j,!1,!0,!0))),68:new d(68,"stream_close",new o([j,new h(new F(new o([l,l],null)),!1,!0,!1)],null)),69:new d(69,"stream_set_position",new o([j,_,l],null)),70:new d(70,"stream_get_position",new o([j],new h(l,!1,!0,!0))),71:new d(71,"stream_set_current",new o([j],null)),72:new d(72,"stream_get_current",new o([],new h(j,!1,!0,!0))),73:new d(73,"stream_open_resource",new o([l,l],new h(j,!1,!0,!0))),96:new d(96,"fileref_create_temp",new o([l,l],new h(ie,!1,!0,!0))),97:new d(97,"fileref_create_by_name",new o([l,new I,l],new h(ie,!1,!0,!0))),98:new d(98,"fileref_create_by_prompt",new o([l,l,l],new h(ie,!1,!0,!0))),99:new d(99,"fileref_destroy",new o([ie],null)),100:new d(100,"fileref_iterate",new o([ie,new h(l,!1,!0,!1)],new h(ie,!1,!0,!0))),101:new d(101,"fileref_get_rock",new o([ie],new h(l,!1,!0,!0))),102:new d(102,"fileref_delete_file",new o([ie],null)),103:new d(103,"fileref_does_file_exist",new o([ie],new h(l,!1,!0,!0))),104:new d(104,"fileref_create_from_fileref",new o([l,ie,l],new h(ie,!1,!0,!0))),128:new d(128,"put_char",new o([g],null)),129:new d(129,"put_char_stream",new o([j,g],null)),130:new d(130,"put_string",new o([new I],null)),131:new d(131,"put_string_stream",new o([j,new I],null)),132:new d(132,"put_buffer",new o([new G(te,!1,!0,!1,!0)],null)),133:new d(133,"put_buffer_stream",new o([j,new G(te,!1,!0,!1,!0)],null)),134:new d(134,"set_style",new o([l],null)),135:new d(135,"set_style_stream",new o([j,l],null)),144:new d(144,"get_char_stream",new o([j],new h(_,!1,!0,!0))),145:new d(145,"get_line_stream",new o([j,new G(te,!1,!1,!0,!0)],new h(l,!1,!0,!0))),146:new d(146,"get_buffer_stream",new o([j,new G(te,!1,!1,!0,!0)],new h(l,!1,!0,!0))),160:new d(160,"char_to_lower",new o([g],new h(g,!1,!0,!0))),161:new d(161,"char_to_upper",new o([g],new h(g,!1,!0,!0))),176:new d(176,"stylehint_set",new o([l,l,l,_],null)),177:new d(177,"stylehint_clear",new o([l,l,l],null)),178:new d(178,"style_distinguish",new o([S,l,l],new h(l,!1,!0,!0))),179:new d(179,"style_measure",new o([S,l,l,new h(l,!1,!0,!1)],new h(l,!1,!0,!0))),192:new d(192,"select",new o([new h(new F(new o([l,S,l,l],null)),!1,!0,!0)],null)),193:new d(193,"select_poll",new o([new h(new F(new o([l,S,l,l],null)),!1,!0,!0)],null)),208:new d(208,"request_line_event",new o([S,new G(te,!0,!0,!0,!0),l],null)),209:new d(209,"cancel_line_event",new o([S,new h(new F(new o([l,S,l,l],null)),!1,!0,!1)],null)),210:new d(210,"request_char_event",new o([S],null)),211:new d(211,"cancel_char_event",new o([S],null)),212:new d(212,"request_mouse_event",new o([S],null)),213:new d(213,"cancel_mouse_event",new o([S],null)),214:new d(214,"request_timer_events",new o([l],null)),224:new d(224,"image_get_info",new o([l,new h(l,!1,!0,!1),new h(l,!1,!0,!1)],new h(l,!1,!0,!0))),225:new d(225,"image_draw",new o([S,l,_,_],new h(l,!1,!0,!0))),226:new d(226,"image_draw_scaled",new o([S,l,_,_,l,l],new h(l,!1,!0,!0))),232:new d(232,"window_flow_break",new o([S],null)),233:new d(233,"window_erase_rect",new o([S,_,_,l,l],null)),234:new d(234,"window_fill_rect",new o([S,l,_,_,l,l],null)),235:new d(235,"window_set_background_color",new o([S,l],null)),240:new d(240,"schannel_iterate",new o([H,new h(l,!1,!0,!1)],new h(H,!1,!0,!0))),241:new d(241,"schannel_get_rock",new o([H],new h(l,!1,!0,!0))),242:new d(242,"schannel_create",new o([l],new h(H,!1,!0,!0))),243:new d(243,"schannel_destroy",new o([H],null)),244:new d(244,"schannel_create_ext",new o([l,l],new h(H,!1,!0,!0))),247:new d(247,"schannel_play_multi",new o([new G(H,!1,!0,!1,!0),new G(l,!1,!0,!1,!0),l],new h(l,!1,!0,!0))),248:new d(248,"schannel_play",new o([H,l],new h(l,!1,!0,!0))),249:new d(249,"schannel_play_ext",new o([H,l,l,l],new h(l,!1,!0,!0))),250:new d(250,"schannel_stop",new o([H],null)),251:new d(251,"schannel_set_volume",new o([H,l],null)),252:new d(252,"sound_load_hint",new o([l,l],null)),253:new d(253,"schannel_set_volume_ext",new o([H,l,l,l],null)),254:new d(254,"schannel_pause",new o([H],null)),255:new d(255,"schannel_unpause",new o([H],null)),256:new d(256,"set_hyperlink",new o([l],null)),257:new d(257,"set_hyperlink_stream",new o([j,l],null)),258:new d(258,"request_hyperlink_event",new o([S],null)),259:new d(259,"cancel_hyperlink_event",new o([S],null)),288:new d(288,"buffer_to_lower_case_uni",new o([new G(l,!1,!0,!0,!0),l],new h(l,!1,!0,!0))),289:new d(289,"buffer_to_upper_case_uni",new o([new G(l,!1,!0,!0,!0),l],new h(l,!1,!0,!0))),290:new d(290,"buffer_to_title_case_uni",new o([new G(l,!1,!0,!0,!0),l,l],new h(l,!1,!0,!0))),291:new d(291,"buffer_canon_decompose_uni",new o([new G(l,!1,!0,!0,!0),l],new h(l,!1,!0,!0))),292:new d(292,"buffer_canon_normalize_uni",new o([new G(l,!1,!0,!0,!0),l],new h(l,!1,!0,!0))),296:new d(296,"put_char_uni",new o([l],null)),297:new d(297,"put_string_uni",new o([new _e],null)),298:new d(298,"put_buffer_uni",new o([new G(l,!1,!0,!1,!0)],null)),299:new d(299,"put_char_stream_uni",new o([j,l],null)),300:new d(300,"put_string_stream_uni",new o([j,new _e],null)),301:new d(301,"put_buffer_stream_uni",new o([j,new G(l,!1,!0,!1,!0)],null)),304:new d(304,"get_char_stream_uni",new o([j],new h(_,!1,!0,!0))),305:new d(305,"get_buffer_stream_uni",new o([j,new G(l,!1,!1,!0,!0)],new h(l,!1,!0,!0))),306:new d(306,"get_line_stream_uni",new o([j,new G(l,!1,!1,!0,!0)],new h(l,!1,!0,!0))),312:new d(312,"stream_open_file_uni",new o([ie,l,l],new h(j,!1,!0,!0))),313:new d(313,"stream_open_memory_uni",new o([new G(l,!0,!0,!0,!1),l,l],new h(j,!1,!0,!0))),314:new d(314,"stream_open_resource_uni",new o([l,l],new h(j,!1,!0,!0))),320:new d(320,"request_char_event_uni",new o([S],null)),321:new d(321,"request_line_event_uni",new o([S,new G(l,!0,!0,!0,!0),l],null)),336:new d(336,"set_echo_line_event",new o([S,l],null)),337:new d(337,"set_terminators_line_event",new o([S,new G(l,!1,!0,!1,!1)],null)),352:new d(352,"current_time",new o([new h(new F(new o([_,l,_],null)),!1,!0,!0)],null)),353:new d(353,"current_simple_time",new o([l],new h(_,!1,!0,!0))),360:new d(360,"time_to_date_utc",new o([new h(new F(new o([_,l,_],null)),!0,!1,!0),new h(new F(new o([_,_,_,_,_,_,_,_],null)),!1,!0,!0)],null)),361:new d(361,"time_to_date_local",new o([new h(new F(new o([_,l,_],null)),!0,!1,!0),new h(new F(new o([_,_,_,_,_,_,_,_],null)),!1,!0,!0)],null)),362:new d(362,"simple_time_to_date_utc",new o([_,l,new h(new F(new o([_,_,_,_,_,_,_,_],null)),!1,!0,!0)],null)),363:new d(363,"simple_time_to_date_local",new o([_,l,new h(new F(new o([_,_,_,_,_,_,_,_],null)),!1,!0,!0)],null)),364:new d(364,"date_to_time_utc",new o([new h(new F(new o([_,_,_,_,_,_,_,_],null)),!0,!1,!0),new h(new F(new o([_,l,_],null)),!1,!0,!0)],null)),365:new d(365,"date_to_time_local",new o([new h(new F(new o([_,_,_,_,_,_,_,_],null)),!0,!1,!0),new h(new F(new o([_,l,_],null)),!1,!0,!0)],null)),366:new d(366,"date_to_simple_time_utc",new o([new h(new F(new o([_,_,_,_,_,_,_,_],null)),!0,!1,!0),l],new h(_,!1,!0,!0))),367:new d(367,"date_to_simple_time_local",new o([new h(new F(new o([_,_,_,_,_,_,_,_],null)),!0,!1,!0),l],new h(_,!1,!0,!0))),4352:new d(4352,"garglk_set_zcolors",new o([l,l],null)),4353:new d(4353,"garglk_set_zcolors_stream",new o([j,l,l],null)),4354:new d(4354,"garglk_set_reversevideo",new o([l],null)),4355:new d(4355,"garglk_set_reversevideo_stream",new o([j,l],null))};a.arg_int_unsigned=l,a.arg_int_signed=_,a.arg_char_unsigned=g,a.arg_char_native=te,a.arg_char_signed=Ne;function Ee(m,p,M){return m instanceof O?p?m.signed?M+" & 0xFFFFFFFF":M:"0":m instanceof se?p?m.signed?"self.cast_signed_char("+M+")":M+" & 0xFF":"0":m instanceof oe?p?'self.class_obj_from_id("'+m.name+'", '+M+")":"null":"???"}function be(m,p){return m instanceof O?p+" >>> 0":m instanceof se?m.signed?"self.uncast_signed_char("+p+")":p+" & 0xFF":m instanceof oe?'self.class_obj_to_id("'+m.name+'", '+p+")":"???"}function Qe(m){return m=m&255,m&128&&(m-=256),m}a.cast_signed_char=Qe;function ze(m){return m=m&255,m&128&&(m+=4294967040),m}a.uncast_signed_char=ze;function Ae(m,p){return p?p.disprock:0}a.class_obj_to_id=Ae;function ue(m,p){return p==0||!p?null:qe[m][p]}a.class_obj_from_id=ue;function ye(m){var p,M,A,U,Q,V,fe,C,k,z,ee,ae,Be,Ke,b=[],Me={},B=0;for(b.push("// no local vars"),b.push("// "+m.id+": "+m.name),A=m.proto,U=null,A.retarg&&(U=A.retarg.arg),b.push("var self = this;"),Ke=a.Glk.call_may_not_return(m.id),Q=0,V=[],p=0;p<A.args.length;p++)if(C=A.args[p],z="glka"+p,V.push(z),Me[z]=!0,C instanceof O||C instanceof se||C instanceof oe)ee=Ee(C,!0,"callargs["+Q+"]"),b.push(z+" = "+ee+";"),Q+=1;else if(C instanceof h){if(k=C.arg,b.push("if (callargs["+Q+"] == 0) {"),C.nonnull?b.push('  throw new Error("glk '+m.name+': null argument");'):b.push("  "+z+" = null;"),b.push("} else {"),k instanceof O||k instanceof se||k instanceof oe)b.push("  "+z+" = new self.Glk.RefBox();"),ee=Ee(k,C.passin,"self.VM.ReadWord(callargs["+Q+"])"),b.push("  "+z+".set_value("+ee+");");else if(k instanceof F)for(fe=k.form.args,b.push("  "+z+" = new self.Glk.RefStruct("+fe.length+");"),M=0;M<fe.length;M++)ee=Ee(fe[M],C.passin,"self.VM.ReadStructField(callargs["+Q+"], "+M+")"),b.push("  "+z+".push_field("+ee+");");else throw new Error("buildfunc: unsupported refarg type: "+m.name);b.push("}"),Q+=1}else if(C instanceof G)Me.glklen=!0,k=C.arg,b.push("if (callargs["+Q+"] == 0) {"),C.nonnull?b.push('  throw new Error("glk '+m.name+': null argument");'):b.push("  "+z+" = null;"),b.push("} else {"),b.push("  glklen = callargs["+(Q+1)+"];"),b.push("  "+z+" = Array(glklen);"),C.passin&&(Me.ix=!0,Me.jx=!0,b.push("  for (ix=0, jx=callargs["+Q+"]; ix<glklen; ix++, jx+="+k.refsize+") {"),ee=Ee(k,!0,"self.VM.Read"+k.macro+"(jx)"),b.push("    "+z+"[ix] = "+ee+";"),b.push("  }")),C.retained&&(B==0&&b.push("  self.temp_arg_arrays.length = 0;"),B+=1,b.push("  self.make_arg_array("+z+", callargs["+Q+"], glklen, self."+k.literal+");")),b.push("}"),Q+=2;else if(C instanceof I||C instanceof _e){Me.ix=!0,Me.jx=!0;var er,rr;C instanceof I?(rr="0xE0",er="byte_array_to_string"):(rr="0xE2",er="uni_array_to_string"),b.push(z+" = Array();"),b.push("jx = callargs["+Q+"];"),b.push("if (self.VM.ReadByte(jx) != "+rr+') throw new Error("glk '+m.name+': string argument must be unencoded");'),b.push("for (jx+="+C.refsize+"; true; jx+="+C.refsize+") {"),b.push("  ix = self.VM.Read"+C.macro+"(jx);"),b.push("  if (ix == 0) break;"),b.push("  "+z+".push(ix);"),b.push("}"),b.push(z+" = self.Glk."+er+"("+z+");"),Q+=1}else throw new Error("buildfunc: unsupported arg type: "+m.name);for(b.push("if (callargs.length != "+Q+') throw "glk '+m.name+': wrong number of arguments";'),U||Ke?(Me.glkret=!0,ae="glkret = "):ae="",b.push(ae+("self.Glk.glk_"+m.name).replace("glk_gar","gar")+"("+V.join(", ")+");"),Ke&&(b.push("if (glkret === self.Glk.DidNotReturn) {"),b.push("  self.set_blocked_selector("+m.id+", callargs);"),b.push("  return glkret;"),b.push("}")),Q=0,p=0;p<A.args.length;p++)if(C=A.args[p],z="glka"+p,C instanceof O||C instanceof se||C instanceof oe)Q+=1;else if(C instanceof h){if(k=C.arg,C.passout){if(b.push("if ("+z+") {"),k instanceof O||k instanceof se||k instanceof oe)ee=be(k,z+".get_value()"),b.push("  self.VM.WriteWord(callargs["+Q+"], "+ee+");");else if(k instanceof F)for(fe=k.form.args,M=0;M<fe.length;M++)ee=be(fe[M],z+".get_field("+M+")"),b.push("  self.VM.WriteStructField(callargs["+Q+"], "+M+", "+ee+");");else throw new Error("buildfunc: unsupported refarg type: "+m.name);b.push("}")}Q+=1}else if(C instanceof G)k=C.arg,C.passout&&!C.retained&&(b.push("if ("+z+") {"),Me.ix=!0,Me.jx=!0,b.push("  for (ix=0, jx=callargs["+Q+"]; ix<glklen; ix++, jx+="+k.refsize+") {"),ee=be(k,z+"[ix]"),b.push("    self.VM.Write"+k.macro+"(jx, "+ee+")"),b.push("  }"),b.push("}")),Q+=2;else if(C instanceof I||C instanceof _e)Q+=1;else throw new Error("buildfunc: unsupported arg type: "+m.name);B!=0&&b.push("self.temp_arg_arrays.length = 0;"),U?(ee=be(U,"glkret"),b.push("return "+ee+";")):b.push("return 0;"),Be=[];for(ee in Me)Be.push(ee);Be.length&&(b[0]="var "+Be.join(", ")+";"),ee=b.join(`
`);var Fr=new Function("callargs",ee);return Fr.bind(a)}var me={};function kr(m){var p,M=me[m];if(M===void 0){if(p=De[m],p===void 0)throw new Error("dispatch: unknown Glk function: "+m);M=ye(p),me[m]=M}return M}var Ie=null,xe=null,Ue=-1;function br(m,p){Ie=m,xe=p.slice(0)}a.set_blocked_selector=br;function Fe(){return Ie==192&&xe&&xe.length>0&&(Ue==2||Ue==3||Ue==4||Ue==8)?xe[0]:null}function yr(m){Ie==192?xe[0]!=0&&(Ue=m.get_field(0)>>>0,a.VM.WriteStructField(xe[0],0,m.get_field(0)>>>0),a.VM.WriteStructField(xe[0],1,Ae("window",m.get_field(1))),a.VM.WriteStructField(xe[0],2,m.get_field(2)>>>0),a.VM.WriteStructField(xe[0],3,m.get_field(3)>>>0)):Ie==98&&a.VM.SetResumeStore(Ae("fileref",m)),Ie=null,xe=null}var Oe=[];a.temp_arg_arrays=Oe;var ve=[];a.retained_arrays=ve;function nr(m,p,M,A){var U;!m||(U={arr:m,addr:p,len:M,arg:A},Oe.push(U))}a.make_arg_array=nr;function w(m,p){var M,A;if(!!m){if(p!==void 0){if(m!==p.arr)throw new Error("retain_array: array does not match useobj");if(A={addr:p.addr,len:p.len,arr:m,arg:P(p.arg)},A.len!=m.length)throw new Error("retain_array: array length from useobj does not match")}else for(A=void 0,M=0;M<Oe.length;M++)if(Oe[M].arr===m){A=Oe[M];break}if(A===void 0)throw new Error("retain_array: array is not an argument");for(M=0;ve[M]!==void 0;M++);ve[M]=A}}function tr(m){var p;for(p=0;p<ve.length;p++)if(ve[p]!==void 0&&ve[p].arr===m)return ve[p];return null}function cr(m){var p,M,A;if(!!m){for(A=void 0,p=0;p<ve.length;p++)if(ve[p]!==void 0&&ve[p].arr===m){A=ve[p],delete ve[p];break}if(A===void 0)throw new Error("unretain_array: array was never retained");if(A.arg instanceof O)for(p=0,M=A.addr;p<A.len;p++,M+=4)a.VM.WriteWord(M,A.arr[p]>>>0);else if(A.arg instanceof se)if(A.arg.signed)for(p=0,M=A.addr;p<A.len;p++,M++)a.VM.WriteByte(M,ze(A.arr[p]));else for(p=0,M=A.addr;p<A.len;p++,M++)a.VM.WriteByte(M,A.arr[p]&255);else throw new Error("unretain_array: unsupported refarg type")}}var qe={},Pe;function or(m,p,M){if(M===void 0){if(p.disprock)throw new Error("class_register: object is already registered");p.disprock=Pe,Pe++}else{if(p.disprock!=M)throw new Error("class_register: object is not already registered");Pe<=M&&(Pe=M+1)}qe[m][p.disprock]=p}function hr(m,p){if(!p.disprock||qe[m][p.disprock]===void 0)throw new Error("class_unregister: object is not registered");delete qe[m][p.disprock],p.disprock=void 0}function xr(){var m,p;Pe=1+Math.round(Math.random()*1e3);for(m in ke)p=ke[m],qe[p]={}}return xr(),{classname:"GiDispa",init:W,inited:we,getlibrary:le,get_function:kr,prepare_resume:yr,check_autosave:Fe,class_register:or,class_unregister:hr,class_obj_to_id:Ae,class_obj_from_id:ue,retain_array:w,unretain_array:cr,get_retained_array:tr}};try{gs.GiDispaClass=tf}catch{}});var bs=Vr(Ur=>{"use strict";var ks=function(){var a={vm:null,io:null,spacing:4,use_query_story:!0,default_story:null,set_page_title:!0,default_page_title:"Game",game_format_name:"",exit_warning:"The game session has ended.",resources:null,image_info_map:null,proxy_url:"https://zcode.appspot.com/proxy/"},W=null,we=!1,le=null;function ke(F,h,G){G?typeof G=="string"&&(G={format:G}):G={};var P=G.format;if(P||(P="array"),a.io=window.Glk,a.vm=window.Quixe,a.GiLoad=this,a.GlkOte=null,a.GiDispa=null,a.Blorb=null,F||(F=window.game_options),F&&window.Quixe&&(!F.vm||F.vm===window.Quixe)&&(a.engine_name="Quixe",a.blorb_gamechunk_type="GLUL",a.game_format_name="Glulx"),F&&jQuery.extend(a,F),!a.GlkOte&&window.GlkOteClass&&(a.GlkOte=new window.GlkOteClass),!a.GiDispa&&window.GiDispaClass&&(a.GiDispa=new window.GiDispaClass),!a.Blorb&&window.BlorbClass&&(a.Blorb=new window.BlorbClass),le=a.GlkOte,a.resources!=null&&jQuery.type(a.resources)==="string"&&(window[a.resources]?a.resources=window[a.resources]:delete a.resources),a.image_info_map!=null&&jQuery.type(a.image_info_map)==="string"&&(window[a.image_info_map]?a.image_info_map=window[a.image_info_map]:delete a.image_info_map),W=null,a.use_query_story){var l=d();W=l.story}if(!W&&h){switch(le.log("GiLoad: trying pre-loaded load ("+P+")..."),P){case"base64":h=_e(h);break;case"raw":h=I(h);break;case"array":break;default:a.io.fatal_error("Could not decode story file data: "+P);return}se(h);return}if(W||(W=a.default_story),!W){a.io.fatal_error("No story file specified!");return}h=null;var _=new XMLHttpRequest,g=_.overrideMimeType!==void 0,te=_.withCredentials!==void 0;_=null;var Ne=/^(file:|(\w+:)?\/\/[^\/?#]+)/,S=Ne.exec(location)[0],j=Ne.exec(W),ie=!j,H=j?j[0]:S,De=S==H;navigator.userAgent.match(/chrome/i)&&H=="file:"&&(De=!1);var Ee=W.match(/[.]js$/i);if(le.log("GiLoad: is_relative="+ie+", same_origin="+De+", binary_supported="+g+", crossorigin_supported="+te),Ee&&De){le.log("GiLoad: trying old-fashioned load..."),window.processBase64Zcode=function(ue){se(_e(ue))},jQuery.ajax(W,{type:"GET",dataType:"script",cache:!0,error:function(ue,ye,me){a.io.fatal_error("The story could not be loaded. ("+W+"): Error "+ye+": "+me)}});return}if(Ee){le.log("GiLoad: trying script load..."),window.processBase64Zcode=function(ue){se(_e(ue))};var be=$("head");if(!be.length){a.io.fatal_error("This page has no <head> element!");return}var Qe=$("<script>",{src:W,type:"text/javascript"});be.get(0).appendChild(Qe.get(0));return}if(g&&De){le.log("GiLoad: trying binary load..."),jQuery.ajax(W,{type:"GET",beforeSend:function(ue,ye){ue.overrideMimeType("text/plain; charset=x-user-defined")},success:function(ue,ye,me){se(I(ue))},error:function(ue,ye,me){a.io.fatal_error("The story could not be loaded. ("+W+"): Error "+ye+": "+me)}});return}if(H=="file:"){a.io.fatal_error("The story could not be loaded. ("+W+"): A local file cannot be sent to the proxy.");return}var ze=W;if(ie&&(ze=o(W),le.log("GiLoad: absolutize "+W+" to "+ze)),te){le.log("GiLoad: trying proxy load... ("+a.proxy_url+")"),jQuery.ajax(a.proxy_url,{type:"GET",data:{encode:"base64",url:ze},error:function(ue,ye,me){a.io.fatal_error("The story could not be loaded. ("+W+"): Error "+ye+": "+me)},success:function(ue,ye,me){se(_e(ue))}});return}var Ae=a.proxy_url+"?encode=base64&callback=processBase64Zcode&url="+ze;le.log("GiLoad: trying proxy-script load... ("+Ae+")"),window.processBase64Zcode=function(me){se(_e(me))};var be=$("head");if(!be.length){a.io.fatal_error("This page has no <head> element!");return}var Qe=$("<script>",{src:Ae,type:"text/javascript"});be.append(Qe)}function d(){var F={},h=location.search.substring(1,location.search.length);if(h.length){var G=h.split("&");h=h.replace(/\+/g," ");for(var P=0;P<G.length;P++){var l=G[P].split("="),_=decodeURIComponent(l[0]),g=l.length==2?decodeURIComponent(l[1]):_;F[_]=g}}return F}function o(F){var h=new URL(F,document.location.href);return h.href}function I(F){var h=Array(F.length),G;for(G=0;G<F.length;G++)h[G]=F.charCodeAt(G)&255;return h}function _e(F){var h=atob(F),G=Array(h.length),P;for(P=0;P<h.length;P++)G[P]=h.charCodeAt(P);return G}function se(F){if(F.length==0){a.io.fatal_error("No game file was loaded. (Zero-length response.)");return}if(F[0]==70&&F[1]==79&&F[2]==82&&F[3]==77){var h=String.fromCharCode(F[8],F[9],F[10],F[11]);if(h=="IFZS"){a.io.fatal_error("This is a saved-game file, not a "+a.game_format_name+" game file. You must launch the game first, then restore your save.");return}if(h!="IFRS"){a.io.fatal_error("This IFF file is not a Blorb file!");return}if(a.blorb_gamechunk_type){if(!a.Blorb){a.io.fatal_error("Blorb file could not be parsed because no BlorbClass is available.");return}try{var G={exec:!0,pict:!0,data:!0};a.retainuses!==void 0&&(G=a.retainuses),a.Blorb.init(F,{format:"blorbbytes",retainuses:G}),F=a.Blorb.get_exec_data(a.blorb_gamechunk_type)}catch(_){a.io.fatal_error("Blorb file could not be parsed: "+_);return}}if(!F){a.io.fatal_error("Blorb file contains no "+a.game_format_name+" game!");return}}a.Blorb&&!a.Blorb.inited()&&(a.image_info_map?a.Blorb.init(a.image_info_map,{format:"infomap"}):a.resources?a.Blorb.init(a.resource_array):a.Blorb.init([]));{var P=null;a.Blorb&&(P=a.Blorb.get_metadata("title")),!P&&W&&(P=W.slice(W.lastIndexOf("/")+1)),P||(P=a.default_page_title),P||(P="Game"),a.recording_label||(a.recording_label=P),a.set_page_title&&(document.title=P+" - "+a.engine_name)}let l=Array.from(F);a.vm.init(l,a),we=!0,a.io.init(a)}function O(){return we}function oe(F){switch(F){case"GlkOte":return le;case"GiDispa":return a.GiDispa;case"Blorb":return a.Blorb;case"VM":return a.vm;case"IO":return a.io}return null}return{classname:"GiLoad",load_run:ke,inited:O,getlibrary:oe}},cf=new ks;try{Ur.GiLoad=cf,Ur.GiLoadClass=ks}catch{}});var ys=Rr(ps(),1),xs=Rr(ws(),1),Fs=Rr(bs(),1),mf=ys.default.Quixe,vf=xs.default.GiDispaClass,pf=Fs.default.GiLoad;export{vf as GiDispa,pf as GiLoad,mf as Quixe};
//# sourceMappingURL=quixe.js.map
