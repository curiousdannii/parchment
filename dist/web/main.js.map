{
  "version": 3,
  "sources": ["../../node_modules/js-cookie/dist/js.cookie.mjs", "../../src/upstream/asyncglk/src/common/misc.ts", "../../src/upstream/asyncglk/src/blorb/iff.ts", "../../src/upstream/asyncglk/src/blorb/blorb.ts", "../../src/upstream/asyncglk/src/common/constants.ts", "../../node_modules/lodash-es/_freeGlobal.js", "../../node_modules/lodash-es/_root.js", "../../node_modules/lodash-es/_Symbol.js", "../../node_modules/lodash-es/_getRawTag.js", "../../node_modules/lodash-es/_objectToString.js", "../../node_modules/lodash-es/_baseGetTag.js", "../../node_modules/lodash-es/isObjectLike.js", "../../node_modules/lodash-es/isSymbol.js", "../../node_modules/lodash-es/_trimmedEndIndex.js", "../../node_modules/lodash-es/_baseTrim.js", "../../node_modules/lodash-es/isObject.js", "../../node_modules/lodash-es/toNumber.js", "../../node_modules/lodash-es/now.js", "../../node_modules/lodash-es/debounce.js", "../../node_modules/lodash-es/throttle.js", "../../src/upstream/asyncglk/src/glkote/common/glkote.ts", "../../src/upstream/asyncglk/src/glkote/web/shared.ts", "../../src/upstream/asyncglk/src/glkote/web/metrics.ts", "../../src/upstream/asyncglk/src/glkote/web/transcript-recorder.ts", "../../src/upstream/asyncglk/src/glkote/web/input.ts", "../../src/upstream/asyncglk/src/glkote/web/windows.ts", "../../src/upstream/asyncglk/src/glkote/web/web.ts", "../../node_modules/base32768/src/index.js", "../../src/upstream/glkote/dialog.js", "../../src/common/options.ts", "../../src/common/file.ts", "../../src/upstream/glkote/glkapi.js", "../../src/common/formats.js", "../../src/common/launcher.js"],
  "sourcesContent": ["/*! js-cookie v3.0.5 | MIT */\n/* eslint-disable no-var */\nfunction assign (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      target[key] = source[key];\n    }\n  }\n  return target\n}\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\nvar defaultConverter = {\n  read: function (value) {\n    if (value[0] === '\"') {\n      value = value.slice(1, -1);\n    }\n    return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n  },\n  write: function (value) {\n    return encodeURIComponent(value).replace(\n      /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n      decodeURIComponent\n    )\n  }\n};\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\n\nfunction init (converter, defaultAttributes) {\n  function set (name, value, attributes) {\n    if (typeof document === 'undefined') {\n      return\n    }\n\n    attributes = assign({}, defaultAttributes, attributes);\n\n    if (typeof attributes.expires === 'number') {\n      attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n    }\n    if (attributes.expires) {\n      attributes.expires = attributes.expires.toUTCString();\n    }\n\n    name = encodeURIComponent(name)\n      .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n      .replace(/[()]/g, escape);\n\n    var stringifiedAttributes = '';\n    for (var attributeName in attributes) {\n      if (!attributes[attributeName]) {\n        continue\n      }\n\n      stringifiedAttributes += '; ' + attributeName;\n\n      if (attributes[attributeName] === true) {\n        continue\n      }\n\n      // Considers RFC 6265 section 5.2:\n      // ...\n      // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n      //     character:\n      // Consume the characters of the unparsed-attributes up to,\n      // not including, the first %x3B (\";\") character.\n      // ...\n      stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n    }\n\n    return (document.cookie =\n      name + '=' + converter.write(value, name) + stringifiedAttributes)\n  }\n\n  function get (name) {\n    if (typeof document === 'undefined' || (arguments.length && !name)) {\n      return\n    }\n\n    // To prevent the for loop in the first place assign an empty array\n    // in case there are no cookies at all.\n    var cookies = document.cookie ? document.cookie.split('; ') : [];\n    var jar = {};\n    for (var i = 0; i < cookies.length; i++) {\n      var parts = cookies[i].split('=');\n      var value = parts.slice(1).join('=');\n\n      try {\n        var found = decodeURIComponent(parts[0]);\n        jar[found] = converter.read(value, found);\n\n        if (name === found) {\n          break\n        }\n      } catch (e) {}\n    }\n\n    return name ? jar[name] : jar\n  }\n\n  return Object.create(\n    {\n      set,\n      get,\n      remove: function (name, attributes) {\n        set(\n          name,\n          '',\n          assign({}, attributes, {\n            expires: -1\n          })\n        );\n      },\n      withAttributes: function (attributes) {\n        return init(this.converter, assign({}, this.attributes, attributes))\n      },\n      withConverter: function (converter) {\n        return init(assign({}, this.converter, converter), this.attributes)\n      }\n    },\n    {\n      attributes: { value: Object.freeze(defaultAttributes) },\n      converter: { value: Object.freeze(converter) }\n    }\n  )\n}\n\nvar api = init(defaultConverter, { path: '/' });\n/* eslint-enable no-var */\n\nexport { api as default };\n", "/*\n\nMiscellaneous common things\n===========================\n\nCopyright (c) 2023 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nexport type GlkTypedArray = Uint8Array | Uint32Array\nexport type GlkTypedArrayConstructor = Uint8ArrayConstructor | Uint32ArrayConstructor\n\n/** A DataView with support for getting and setting arrays and four character codes */\nexport class FileView extends DataView {\n    constructor(array: Uint8Array);\n    constructor(buffer: ArrayBuffer, byteOffset?: number, byteLength?: number);\n    constructor(data: Uint8Array | ArrayBuffer, byteOffset?: number, byteLength?: number) {\n        if (data instanceof Uint8Array) {\n            super(data.buffer, data.byteOffset, data.byteLength)\n        }\n        else {\n            super(data, byteOffset, byteLength)\n        }\n    }\n\n    getFourCC(index: number) {\n        return String.fromCharCode(this.getUint8(index), this.getUint8(index + 1), this.getUint8(index + 2), this.getUint8(index + 3))\n    }\n\n    getUint8Subarray(index?: number, length?: number): Uint8Array {\n        return new Uint8Array(this.buffer, this.byteOffset + (index || 0), length)\n    }\n\n    setFourCC(index: number, text: string) {\n        this.setUint8(index, text.charCodeAt(0) )\n        this.setUint8(index + 1, text.charCodeAt(1))\n        this.setUint8(index + 2, text.charCodeAt(2))\n        this.setUint8(index + 3, text.charCodeAt(3))\n    }\n\n    setUint8Array(index: number, data: Uint8Array) {\n        const subarray = this.getUint8Subarray(index, data.length)\n        subarray.set(data)\n    }\n}\n\n/** Write a Uint32Array as a big-endian Uint8Array */\nexport function Array_to_BEBuffer(arr: Uint32Array) {\n    const buf = new Uint8Array(arr.length * 4)\n    const dv = new DataView(buf.buffer)\n    for (let i = 0; i < arr.length; i++) {\n        dv.setUint32(i * 4, arr[i])\n    }\n    return buf\n}\n\n/** Read a big-endian Uint8Array into a Uint32Array */\nexport function BEBuffer_to_Array(buf: Uint8Array) {\n    const dv = new DataView(buf.buffer, buf.byteOffset, buf.length)\n    const arr = new Uint32Array(buf.length / 4)\n    for (let i = 0; i < buf.length; i += 4) {\n        arr[i / 4] = dv.getUint32(i)\n    }\n    return arr\n}\n\nexport function is_unicode_array(arr: GlkTypedArray) {\n    return arr.BYTES_PER_ELEMENT === 4\n}\n\nexport const utf8decoder = new TextDecoder()\nexport const utf8encoder = new TextEncoder()", "/*\n\nInterchange File Format\n=======================\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {FileView} from '../common/misc.js'\n\nexport interface IFFChunk {\n    data: Uint8Array,\n    offset: number,\n    type: string,\n}\n\n/** An Interchange File Format reader and writer */\nexport class IFF {\n    type = ''\n    chunks: IFFChunk[] = []\n\n    parse(data: Uint8Array) {\n        const view = new FileView(data)\n\n        // Check this is actually an IFF file\n        if (view.getFourCC(0) !== 'FORM') {\n            throw new Error('Not an IFF file')\n        }\n\n        // Parse the file\n        this.type = view.getFourCC(8)\n        let i = 12\n        const length = view.getUint32(4) + 8\n        while (i < length) {\n            const chunk_length = view.getUint32(i + 4)\n            if (chunk_length < 0 || (chunk_length + i) > length) {\n                throw new Error('IFF chunk out of range')\n            }\n            this.chunks.push({\n                data: view.getUint8Subarray(i + 8, chunk_length),\n                offset: i,\n                type: view.getFourCC(i),\n            })\n            i += 8 + chunk_length\n            if (i % 2) {\n                i++\n            }\n        }\n    }\n\n    write(): Uint8Array {\n        // First calculate the required buffer length\n        let buffer_length = 12\n        for (const chunk of this.chunks) {\n            buffer_length += 8 + chunk.data.length\n            if (buffer_length % 2) {\n                buffer_length++\n            }\n        }\n\n        // Now make the IFF file and return it\n        const view = new FileView(new ArrayBuffer(buffer_length))\n        view.setFourCC(0, 'FORM')\n        view.setUint32(4, buffer_length - 8)\n        view.setFourCC(8, this.type)\n        let i = 12\n        for (const chunk of this.chunks) {\n            view.setFourCC(i, chunk.type)\n            view.setUint32(i + 4, chunk.data.length)\n            view.setUint8Array(i + 8, chunk.data)\n            i += 8 + chunk.data.length\n            if (i % 2) {\n                i++\n            }\n        }\n        return view.getUint8Subarray()\n    }\n}", "/*\n\nBlorb Files and functions\n=========================\n\nCopyright (c) 2023 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {FileView, utf8decoder} from '../common/misc.js'\n\nimport {IFF} from './iff.js'\n\nexport interface ImageSize {\n    height: number,\n    width: number,\n}\n\nexport interface BlorbChunk {\n    /** Resource descriptions */\n    alttext?: string,\n    /** Whether a data chunk is binary */\n    binary?: boolean,\n    /** The original Chunk ID FourCC */\n    blorbtype?: string,\n    content?: Uint8Array,\n    /** Cached image dimensions */\n    imagesize?: ImageSize,\n    /** Image type */\n    type?: string,\n    /** External URL for image */\n    url?: string,\n    /** Resource usage */\n    usage: 'data' | 'exec' | 'pict' | 'sound',\n}\n\nexport interface ImageInfo extends BlorbChunk {\n    height?: number,\n    /** The resource number */\n    image: number,\n    width?: number,\n}\n\nexport interface BlorbDataChunk {\n    binary: boolean,\n    data: Uint8Array,\n}\n\n// The infomap format\nexport interface InfoMapResource {\n    height: number,\n    image: number,\n    url: string,\n    width: number,\n}\nexport type InfoMap = Record<string, InfoMapResource>\n\nconst BLORB_RESOURCE_INDEX_USAGES: Record<string, string> = {\n    Data: 'data',\n    Exec: 'exec',\n    Pict: 'pict',\n    'Snd ': 'sound',\n}\n\nconst UNKNOWN_IMAGE_TYPE = '????'\n\nexport class Blorb {\n    classname = 'Blorb'\n    /** Chunks are indexed with \"USE:NUMBER\" keys */\n    chunks: Record<string, BlorbChunk> = {}\n    private coverimagenum?: number\n    private debugdata?: Uint8Array\n    private is_inited = false\n    private metadata: Record<string, string> = {}\n\n    // The original Blorb library requires you to call init(), but I think it's better to pass the data into the constructor\n    constructor(data?: Uint8Array);\n    constructor(data?: Uint8Array) {\n        if (data) {\n            this.init(data)\n        }\n    }\n\n    init(data: Array<any>): void;\n    init(data: InfoMap, options: {format: 'infomap'}): void;\n    init(data: Uint8Array): void;\n    init(data: Array<any> | InfoMap | Uint8Array, options?: any) {\n        if (this.is_inited) {\n            return\n        }\n        if (data instanceof Uint8Array) {\n            const iff = new IFF()\n            iff.parse(data)\n            if (iff.type !== 'IFRS') {\n                throw new Error('Not a Blorb file')\n            }\n            if (iff.chunks[0].type !== 'RIdx') {\n                throw new Error('Malformed blorb: chunk 1 is not RIdx')\n            }\n\n            // Process the chunks\n            for (const iff_chunk of iff.chunks) {\n                switch (iff_chunk.type) {\n                    case 'Dbug': {\n                        // Process the debug chunk\n                        this.debugdata = iff_chunk.data\n                        break\n                    }\n                    case 'Fspc': {\n                        // Process the frontispiece chunk\n                        const view = new FileView(iff_chunk.data)\n                        this.coverimagenum = view.getUint32(0)\n                        break\n                    }\n                    case 'IFmd': {\n                        const html = utf8decoder.decode(iff_chunk.data)\n                        // TODO: Handle this in some way that doesn't rely on jQuery.\n                        const met = $('<metadata>').html(html)\n                        const bibels = met.find('bibliographic').children()\n                        for (const el of bibels) {\n                            this.metadata[el.tagName.toLowerCase()] = el.textContent!\n                        }\n                        break\n                    }\n                    case 'RDes': {\n                        // Process the resource description chunk\n                        const view = new FileView(iff_chunk.data)\n                        let i = 4\n                        while (i < view.byteLength) {\n                            const usage = BLORB_RESOURCE_INDEX_USAGES[view.getFourCC(i)]\n                            const resource_number = view.getUint32(i + 4)\n                            const text_length = view.getUint32(i + 8)\n                            const chunk = this.chunks[`${usage}:${resource_number}`]\n                            if (chunk) {\n                                chunk.alttext = utf8decoder.decode(view.getUint8Subarray(i + 12, text_length))\n                            }\n                            i += 12 + text_length\n                        }\n                        break\n                    }\n                    case 'RIdx': {\n                        // Process the resource index chunk\n                        const view = new FileView(iff_chunk.data)\n                        let i = 4\n                        while (i < view.byteLength) {\n                            const usage = view.getFourCC(i)\n                            const resource_number = view.getUint32(i + 4)\n                            const resource_offset = view.getUint32(i + 8)\n                            i += 12\n                            const resource_chunk = iff.chunks.filter(chunk => chunk.offset === resource_offset)[0]\n                            if (!resource_chunk) {\n                                throw new Error(`No Blorb chunk at offset ${resource_offset}`)\n                            }\n                            const type = resource_chunk.type\n                            const chunk: BlorbChunk = {\n                                blorbtype: type,\n                                // Embedded FORM chunks need to include the chunk headers for resource streams, so patch them now\n                                content: type === 'FORM' ? data.subarray(resource_chunk.offset, resource_chunk.offset + 8 + resource_chunk.data.length) : resource_chunk.data,\n                                usage: BLORB_RESOURCE_INDEX_USAGES[usage] as BlorbChunk['usage'],\n                            }\n                            if (usage === 'Pict') {\n                                if (type === 'JPEG') {\n                                    chunk.type = 'jpeg'\n                                }\n                                else if (type === 'PNG ') {\n                                    chunk.type = 'png'\n                                }\n                                else {\n                                    chunk.type = UNKNOWN_IMAGE_TYPE\n                                }\n                            }\n                            if (usage === 'Data') {\n                                chunk.binary = type === 'BINA' || type === 'FORM'\n                            }\n                            this.chunks[`${chunk.usage}:${resource_number}`] = chunk\n                        }\n                        break\n                    }\n                }\n            }\n        }\n        // Process the infomap format\n        else if (options?.format === 'infomap') {\n            for (const key in data) {\n                if (!Number.isInteger(+key)) {\n                    continue\n                }\n                const chunk: any = Object.assign({}, (data as InfoMap)[key])\n                delete chunk.image\n                if (chunk.height && chunk.width) {\n                    chunk.imagesize = {\n                        height: chunk.height,\n                        width: chunk.width,\n                    }\n                    delete chunk.height\n                    delete chunk.width\n                }\n                chunk.type = chunk.url.endsWith('.png') ? 'png' : 'jpeg'\n                chunk.usage = 'pict'\n                this.chunks[`pict:${key}`] = chunk\n            }\n        }\n        else if (Array.isArray(data) && data.length === 0) {\n            // Empty data, do nothing\n        }\n        else {\n            throw new Error('Unsupported Blorb.init data format')\n        }\n\n        this.is_inited = true\n    }\n\n    getlibrary(): null {\n        return null\n    }\n\n    get_chunk(usage: string, num: number): BlorbChunk | null {\n        return this.chunks[`${usage}:${num}`] || null\n    }\n\n    get_cover_pict(): number | null {\n        return this.coverimagenum ?? null\n    }\n\n    get_data_chunk(num: number): BlorbDataChunk | null {\n        const chunk = this.chunks[`data:${num}`]\n        if (!chunk?.content) {\n            return null\n        }\n        return {\n            binary: chunk.binary!,\n            data: chunk.content,\n        }\n    }\n    \n    get_debug_info(): Uint8Array | undefined {\n        return this.debugdata\n    }\n\n    /** Return the game file chunk, or null if there isn't one.\n     * If type is provided (GLUL or ZCOD) then the game file is checked to ensure it matches\n     */\n    get_exec_data(gametype?: 'GLUL' | 'ZCOD'): Uint8Array | null {\n        const chunk = this.chunks['exec:0']\n        if (!chunk?.content || (gametype && chunk.blorbtype !== gametype)) {\n            return null\n        }\n        return chunk.content\n    }\n\n    get_image_info(num: number): ImageInfo | null {\n        const chunk = this.chunks[`pict:${num}`]\n        if (!chunk) {\n            return null\n        }\n\n        // Try to extract the image sizes\n        if (!chunk.imagesize && chunk.content) {\n            if (chunk.type === 'jpeg') {\n                chunk.imagesize = get_jpeg_dimensions(chunk.content)\n            }\n            else if (chunk.type === 'png') {\n                chunk.imagesize = get_png_dimensions(chunk.content)\n            }\n        }\n\n        const img: ImageInfo = Object.assign({image: num}, chunk)\n        if (img.imagesize) {\n            img.height = img.imagesize.height\n            img.width = img.imagesize.width\n        }\n        return img\n    }\n\n    get_image_url(num: number): string | null {\n        const chunk = this.chunks[`pict:${num}`]\n        if (!chunk) {\n            return null\n        }\n\n        if (chunk.url) {\n            return chunk.url\n        }\n\n        if (chunk.type !== UNKNOWN_IMAGE_TYPE && chunk.content) {\n            chunk.url = URL.createObjectURL(new Blob([chunk.content], {type: `image/${chunk.type}`}))\n            return chunk.url\n        }\n\n        return null\n    }\n\n    get_metadata(field: string): string {\n        return this.metadata[field]\n    }\n\n    inited(): boolean {\n        return this.is_inited\n    }\n}\n\nexport function is_blorb(data: Uint8Array): boolean {\n    const view = new FileView(data)\n    return view.getFourCC(0) === 'FORM' && view.getFourCC(8) === 'IFRS'\n}\n\nfunction get_jpeg_dimensions(data: Uint8Array): ImageSize | undefined {\n    const view = new FileView(data)\n    let i = 0\n    while (i < view.byteLength) {\n        if (view.getUint8(i) !== 0xFF) {\n            return\n        }\n        while (view.getUint8(i) === 0xFF) {\n            i++\n        }\n        const marker = view.getUint8(i++)\n        // Markers with no data\n        if (marker === 0x01 || (marker >= 0xD0 && marker <= 0xD9)) {\n            continue\n        }\n        const chunklength = view.getUint16(i)\n        if (marker >= 0xC0 && marker <= 0xCF && marker !== 0xC8) {\n            if (chunklength < 7) {\n                // SOF block is too small\n                return\n            }\n            return {\n                height: view.getUint16(i + 3),\n                width: view.getUint16(i + 5),\n            }\n        }\n        i += chunklength\n    }\n}\n\nfunction get_png_dimensions(data: Uint8Array): ImageSize | undefined {\n    const view = new FileView(data)\n    if (view.getFourCC(0) !== '\\x89PNG') {\n        return\n    }\n\n    let i = 8\n    while (i < view.byteLength) {\n        const chunklength = view.getUint32(i)\n        const chunktype = view.getFourCC(i + 4)\n        i += 8\n        if (chunktype === 'IHDR') {\n            return {\n                height: view.getInt32(i + 4),\n                width: view.getInt32(i),\n            }\n        }\n        // Skip CRC\n        i += chunklength + 4\n    }\n}", "/*\n\nConstants\n=========\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport * as protocol from './protocol.js'\n\nexport const DEFAULT_METRICS: protocol.NormalisedMetrics = {\n    buffercharheight: 1,\n    buffercharwidth: 1,\n    buffermarginx: 0,\n    buffermarginy: 0,\n    graphicsmarginx: 0,\n    graphicsmarginy: 0,\n    gridcharheight: 1,\n    gridcharwidth: 1,\n    gridmarginx: 0,\n    gridmarginy: 0,\n    height: 50,\n    inspacingx: 0,\n    inspacingy: 0,\n    outspacingx: 0,\n    outspacingy: 0,\n    width: 80,\n}\n\nexport const KEY_CODES_TO_NAMES: Record<number, protocol.SpecialKeyCode> = {\n    8: 'delete', // Backspace to be precise\n    9: 'tab',\n    13: 'return',\n    27: 'escape',\n    33: 'pageup',\n    34: 'pagedown',\n    35: 'end',\n    36: 'home',\n    37: 'left',\n    38: 'up',\n    39: 'right',\n    40: 'down',\n    112: 'func1',\n    113: 'func2',\n    114: 'func3',\n    115: 'func4',\n    116: 'func5',\n    117: 'func6',\n    118: 'func7',\n    119: 'func8',\n    120: 'func9',\n    121: 'func10',\n    122: 'func11',\n    123: 'func12',\n}\n\nexport const KEY_CODE_DOWN = 40\nexport const KEY_CODE_RETURN = 13\nexport const KEY_CODE_UP = 38\n\nexport const NBSP = '\\xa0'\nexport const THINSPACE = '\\u2009'\n\nexport const OFFSCREEN_OFFSET = '-10000px'\n\nexport const PACKAGE_VERSION = '0.1.0'", "/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n", "import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n", "import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n", "import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n", "/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n", "import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n", "/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n", "import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nexport default isSymbol;\n", "/** Used to match a single whitespace character. */\nvar reWhitespace = /\\s/;\n\n/**\n * Used by `_.trim` and `_.trimEnd` to get the index of the last non-whitespace\n * character of `string`.\n *\n * @private\n * @param {string} string The string to inspect.\n * @returns {number} Returns the index of the last non-whitespace character.\n */\nfunction trimmedEndIndex(string) {\n  var index = string.length;\n\n  while (index-- && reWhitespace.test(string.charAt(index))) {}\n  return index;\n}\n\nexport default trimmedEndIndex;\n", "import trimmedEndIndex from './_trimmedEndIndex.js';\n\n/** Used to match leading whitespace. */\nvar reTrimStart = /^\\s+/;\n\n/**\n * The base implementation of `_.trim`.\n *\n * @private\n * @param {string} string The string to trim.\n * @returns {string} Returns the trimmed string.\n */\nfunction baseTrim(string) {\n  return string\n    ? string.slice(0, trimmedEndIndex(string) + 1).replace(reTrimStart, '')\n    : string;\n}\n\nexport default baseTrim;\n", "/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n", "import baseTrim from './_baseTrim.js';\nimport isObject from './isObject.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = baseTrim(value);\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nexport default toNumber;\n", "import root from './_root.js';\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nexport default now;\n", "import isObject from './isObject.js';\nimport now from './now.js';\nimport toNumber from './toNumber.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nexport default debounce;\n", "import debounce from './debounce.js';\nimport isObject from './isObject.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a throttled function that only invokes `func` at most once per\n * every `wait` milliseconds. The throttled function comes with a `cancel`\n * method to cancel delayed `func` invocations and a `flush` method to\n * immediately invoke them. Provide `options` to indicate whether `func`\n * should be invoked on the leading and/or trailing edge of the `wait`\n * timeout. The `func` is invoked with the last arguments provided to the\n * throttled function. Subsequent calls to the throttled function return the\n * result of the last `func` invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the throttled function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.throttle` and `_.debounce`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to throttle.\n * @param {number} [wait=0] The number of milliseconds to throttle invocations to.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=true]\n *  Specify invoking on the leading edge of the timeout.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new throttled function.\n * @example\n *\n * // Avoid excessively updating the position while scrolling.\n * jQuery(window).on('scroll', _.throttle(updatePosition, 100));\n *\n * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.\n * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });\n * jQuery(element).on('click', throttled);\n *\n * // Cancel the trailing throttled invocation.\n * jQuery(window).on('popstate', throttled.cancel);\n */\nfunction throttle(func, wait, options) {\n  var leading = true,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  if (isObject(options)) {\n    leading = 'leading' in options ? !!options.leading : leading;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n  return debounce(func, wait, {\n    'leading': leading,\n    'maxWait': wait,\n    'trailing': trailing\n  });\n}\n\nexport default throttle;\n", "/*\n\nGeneric GlkOte implementation\n=============================\n\nCopyright (c) 2023 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {Blorb} from '../../blorb/blorb.js'\nimport * as Constants from '../../common/constants.js'\nimport * as protocol from '../../common/protocol.js'\nimport {Dialog} from '../../dialog/common/interface.js'\n\nexport interface GlkOte {\n    classname: string,\n    error(msg: any): void,\n    extevent(val: any): void,\n    getdomcontext(): HTMLElement | undefined,\n    getdomid(name: string): string,\n    getinterface(): GlkOteOptions,\n    getlibrary(name: string): Blorb | Dialog | null | undefined,\n    init(options: GlkOteOptions): void,\n    inited(): boolean,\n    log(msg: string): void,\n    save_allstate(): any,\n    setdomcontext(val: HTMLElement): void,\n    update(data: protocol.Update): void,\n    version: string,\n    warning(msg: any): void,\n}\n\nexport interface GlkOteOptions {\n    accept(event: protocol.Event): void,\n    Blorb?: Blorb,\n    debug_commands?: boolean,\n    detect_external_links?: string | boolean,\n    Dialog?: Dialog,\n    dialog_dom_prefix?: string,\n    dom_prefix?: string,\n    errorcontent?: string,\n    errorpane?: string,\n    gameport?: string,\n    Glk?: any,\n    loadingpane?: string,\n    max_buffer_length?: number,\n    /** Cookie name to opt out of transcript recording. Default: `transcript_recording_opt_out` */\n    recording_cookie?: string,\n    /** Transcript recording service protocol format. Only `simple` is supported by AsyncGlk */\n    recording_format?: string,\n    /** Custom transcript recording handler function */\n    recording_handler?: (state: TranscriptRecordingData) => void,\n    /** Transcript recording label for this story */\n    recording_label?: string,\n    /** URL for the transcript recording service */\n    recording_url?: string,\n    regex_external_links?: RegExp,\n    /** Whether or not to set the <body> background colour to the page_margin_bg */\n    set_body_to_page_bg?: boolean | number,\n    windowport?: string,\n}\n\n/** Format of the transcript recorder data */\nexport interface TranscriptRecordingData {\n    /** The transcript record format is always 'simple */\n    format: 'simple',\n    /** Player input for char and line events */\n    input: string,\n    /** The label given to this story at the beginning */\n    label: string,\n    /** Combined output from buffer windows */\n    output: string,\n    /** Timestamp from when output returned to GlkOte (milliseconds) */\n    outtimestamp: number,\n    /** Session ID */\n    sessionId: string,\n    /** Timestamp from when GlkOte event was sent to VM (milliseconds) */\n    timestamp: number,\n}\n\nexport abstract class GlkOteBase implements GlkOte {\n    classname = 'GlkOte'\n    version = Constants.PACKAGE_VERSION\n\n    protected accept_func: (event: protocol.Event) => void = () => {}\n    protected autorestoring = false\n    protected Blorb?: Blorb\n    current_metrics = Object.assign({}, Constants.DEFAULT_METRICS)\n    protected Dialog?: Dialog\n    disabled = false\n    protected generation = 0\n    protected is_inited = false\n    protected options: GlkOteOptions = {} as GlkOteOptions\n    protected timer: ReturnType<typeof setTimeout> | null = null\n    protected waiting_for_update = false\n\n    async init(options: GlkOteOptions) {\n        if (!options) {\n            return this.error('no options provided')\n        }\n        if (!options.accept) {\n            return this.error('an accept function was not given to GlkOte')\n        }\n\n        this.options = options\n        this.accept_func = options.accept\n\n        if (options.Blorb) {\n            this.Blorb = options.Blorb\n        }\n        if (options.Dialog) {\n            this.Dialog = options.Dialog\n        }\n\n        this.is_inited = true\n\n        // Send an init event, which if is received by GlkApi, will then result in VM.start() being called\n        this.send_event({type: 'init'})\n    }\n\n    error(error: Error | string) {\n        throw (typeof error === 'string' ? new Error(error) : error)\n    }\n\n    extevent(value: any) {\n        this.send_event({\n            type: 'external',\n            value,\n        })\n    }\n\n    getdomcontext(): HTMLElement | undefined {\n        throw new Error('getdomcontext is not applicable to this GlkOte library')\n    }\n\n    getdomid(name: string): string {\n        throw new Error('getdomid is not applicable to this GlkOte library')\n    }\n\n    getinterface(): GlkOteOptions {\n        return this.options\n    }\n\n    getlibrary(name: string): Blorb | Dialog | null | undefined {\n        switch (name) {\n            case 'Blorb': return this.Blorb\n            case 'Dialog': return this.Dialog\n            default: return null\n        }\n    }\n\n    inited(): boolean {\n        return this.is_inited\n    }\n\n    log(msg: string) {\n        console.log(msg)\n    }\n\n    setdomcontext(val: HTMLElement) {\n        throw new Error('setdomcontext is not applicable to this GlkOte library')\n    }\n\n    update(data: protocol.Update) {\n        try {\n            this.autorestoring = false\n            this.waiting_for_update = false\n\n            if (data.type === 'error') {\n                return this.error(data.message)\n            }\n            if (data.type === 'pass') {\n                return\n            }\n            if (data.type === 'retry') {\n                setTimeout(() => this.send_event({type: 'refresh'}), 2000)\n                return\n            }\n            if (data.type !== 'update') {\n                return this.error(`Unknown update type: ${(data as any).type}`)\n            }\n\n            if (data.gen === this.generation) {\n                this.log(`Ignoring repeated generation number: ${data.gen}`)\n                return\n            }\n            this.generation = data.gen\n\n            if (this.disabled) {\n                this.disable(false)\n            }\n\n            // Now handle all the state updates\n            if (data.input) {\n                this.cancel_inputs(data.input)\n            }\n            if (data.windows) {\n                this.update_windows(data.windows)\n            }\n            if (data.content) {\n                this.update_content(data.content)\n            }\n            if (data.input) {\n                this.update_inputs(data.input)\n            }\n\n            if (data.timer !== undefined) {\n                if (this.timer) {\n                    clearInterval(this.timer)\n                    this.timer = null\n                }\n                if (data.timer) {\n                    this.timer = setInterval(() => this.ontimer(), data.timer)\n                }\n            }\n\n            if (data.specialinput) {\n                this.handle_specialinput(data.specialinput)\n            }\n\n            // Disable everything if requested\n            this.disabled = false\n            if (data.disable || data.specialinput) {\n                this.disable(true)\n            }\n\n            if (data.autorestore) {\n                this.autorestoring = true\n                this.autorestore(data.autorestore)\n            }\n\n            // Page background colour\n            if (typeof data.page_margin_bg !== 'undefined' && this.options.set_body_to_page_bg) {\n                this.set_page_bg(data.page_margin_bg)\n            }\n\n            if (data.disable) {\n                this.exit()\n            }\n        }\n        catch (err) {\n            this.error(err as Error)\n        }\n    }\n\n    warning(msg: any) {\n        console.warn(msg)\n    }\n\n    // AsyncGlk specific implementation methods\n    protected autorestore(data: any) {}\n\n    protected capabilities(): string[] {\n        return ['timer']\n    }\n\n    protected exit() {}\n\n    protected handle_specialinput(data: protocol.SpecialInput) {\n        if (data.type === 'fileref_prompt') {\n            const replyfunc = (ref: protocol.FileRef | null) => this.send_event({\n                type: 'specialresponse',\n                response: 'fileref_prompt',\n                value: ref,\n            })\n\n            try {\n                if (!this.Dialog) {\n                    setTimeout(() => replyfunc(null), 0)\n                }\n                else {\n                    this.Dialog.open(data.filemode !== 'read', data.filetype, data.gameid, replyfunc)\n                }\n            }\n            catch (ex) {\n                this.log(`Unable to open file dialog: ${ex}`)\n                /* Return a failure. But we don't want to call send_response before\n                glkote_update has finished, so we defer the reply slightly. */\n                setTimeout(() => replyfunc(null), 0)\n            }\n        }\n        else {\n            this.error( `Request for unknown special input type: ${data.type}` )\n        }\n    }\n\n    protected ontimer() {\n        if (!this.disabled) {\n            this.send_event({type: 'timer'})\n        }\n    }\n\n    save_allstate(): any {}\n\n    send_event(ev: Partial<protocol.Event>) {\n        if (this.disabled && ev.type !== 'specialresponse') {\n            return\n        }\n        if (this.waiting_for_update) {\n            console.log('Trying to send event when waiting for input', ev)\n            return\n        }\n        this.waiting_for_update = true\n        ev.gen = this.generation\n        switch (ev.type) {\n            case 'arrange':\n                ev.metrics = this.current_metrics\n                break\n            case 'init':\n                ev.metrics = this.current_metrics\n                ev.support = this.capabilities()\n                break\n            case 'specialresponse':\n                ev.response = 'fileref_prompt'\n                break\n        }\n        this.accept_func(ev as Required<protocol.Event>)\n    }\n\n    protected set_page_bg(colour: string) {}\n\n    // Functions to be implemented in a subclass\n    protected abstract cancel_inputs(windows: protocol.InputUpdate[]): void\n    protected abstract disable(disable: boolean): void\n    protected abstract update_content(content: protocol.ContentUpdate[]): void\n    protected abstract update_inputs(windows: protocol.InputUpdate[]): void\n    protected abstract update_windows(windows: protocol.WindowUpdate[]): void\n}", "/*\n\nWeb GlkOte shared things\n========================\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport * as protocol from '../../common/protocol.js'\n\n/** Create an element with specified classes */\nexport function create(tag: string, className:string): JQuery<HTMLElement> {\n    return $(`<${tag}>`, {'class': className})\n}\n\n/** Manage the DOM elements used by GlkOte */\nexport class DOM {\n    context_element?: HTMLElement\n    errorcontent_id: string\n    errorpane_id: string\n    gameport_id: string\n    loadingpane_id: string\n    prefix: string\n    windowport_id: string\n\n    constructor(options: {\n        context_element?: HTMLElement,\n        errorcontent_id: string,\n        errorpane_id: string,\n        gameport_id: string,\n        loadingpane_id: string,\n        prefix: string,\n        windowport_id: string,\n    }) {\n        this.context_element = options.context_element\n        this.errorcontent_id = options.errorcontent_id\n        this.errorpane_id = options.errorpane_id\n        this.gameport_id = options.gameport_id\n        this.loadingpane_id = options.loadingpane_id\n        this.prefix = options.prefix\n        this.windowport_id = options.windowport_id\n    }\n\n    /** Create an element, adding prefix to the ID */\n    create(tag: string, id: string, props?: string | any): JQuery<HTMLElement> {\n        props ??= {}\n        // Handle class name as props\n        if (typeof props === 'string') {\n            props = {\n                class: props,\n            }\n        }\n        props.id = this.prefix + id\n        return $(`<${tag}>`, props)\n    }\n\n    gameport(): JQuery<HTMLElement> {\n        return $(`#${this.gameport_id}`, this.context_element)\n    }\n\n    /** Return a jQuery search for an element ID, using prefix and context_element */\n    id(id: string): JQuery<HTMLElement> {\n        return $(`#${this.prefix}${id}`, this.context_element)\n    }\n\n    windowport(): JQuery<HTMLElement> {\n        return $(`#${this.windowport_id}`, this.context_element)\n    }\n}\n\nexport type EventFunc = (event: Partial<protocol.Event>) => void\n\n/** If we can determine that the browser is currently pinch zoomed */\nexport function is_pinch_zoomed() {\n    if (visualViewport) {\n        return visualViewport.scale !== 1\n    }\n    return false\n}", "/*\n\nMetrics and resize handlers\n===========================\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {throttle} from 'lodash-es'\n\nimport * as protocol from '../../common/protocol.js'\n\nimport {create, is_pinch_zoomed} from './shared.js'\nimport WebGlkOte from './web.js'\nimport {Window} from './windows.js'\n\nfunction get_size(el: JQuery<HTMLElement>): {height: number, width: number} {\n    return {\n        height: el.outerHeight()!,\n        width: el.outerWidth()!,\n    }\n}\n\n/** Compare two metrics to see if they differ enough to send an arrange event */\nfunction metrics_differ(newmetrics: protocol.NormalisedMetrics, oldmetrics: protocol.NormalisedMetrics): boolean {\n    return (oldmetrics.buffercharheight !== newmetrics.buffercharheight ||\n        oldmetrics.buffercharwidth !== newmetrics.buffercharwidth ||\n        oldmetrics.gridcharheight !== newmetrics.gridcharheight ||\n        oldmetrics.gridcharwidth !== newmetrics.gridcharwidth ||\n        oldmetrics.height !== newmetrics.height ||\n        oldmetrics.width !== newmetrics.width)\n}\n\nconst ios15_0 = /(iPad; CPU|iPhone) OS 15_0/i.test(navigator.userAgent)\n\nexport default class Metrics {\n    // Shares the current_metrics and DOM of WebGlkOte\n    private metrics: protocol.NormalisedMetrics\n    private loaded: Promise<void>\n    private glkote: WebGlkOte\n    private observer?: ResizeObserver\n\n    constructor(glkote: WebGlkOte) {\n        this.glkote = glkote\n        this.metrics = glkote.current_metrics\n\n        // AsyncGlk may have started after a DOMContentLoaded event, but Metrics needs the page to be fully loaded so that the CSS and fonts are in use\n        // If the page is fast and already loaded by the time we get here (or, apparently, always for file: pages) then just use an auto-resolved promise\n        if (document.readyState === 'complete') {\n            this.loaded = Promise.resolve()\n        }\n        else {\n            this.loaded = new Promise((resolve: any) => {\n                window.addEventListener('load', resolve, {once: true})\n            })\n        }\n\n        // Use a resize observer on #gameport, or else a resize handler on window\n        if (window.ResizeObserver) {\n            this.observer = new ResizeObserver(this.on_gameport_resize)\n            this.observer.observe(this.glkote.dom.gameport()[0])\n        }\n        else {\n            $(window).on('resize', this.on_gameport_resize)\n        }\n        if (visualViewport) {\n            $(visualViewport).on('resize', this.on_visualViewport_resize)\n        }\n    }\n\n    destroy() {\n        if (this.observer) {\n            this.observer.disconnect()\n        }\n        else {\n            $(window).off('resize', this.on_gameport_resize)\n        }\n        if (visualViewport) {\n            $(visualViewport).off('resize', this.on_visualViewport_resize)\n        }\n    }\n\n    async measure() {\n        // Ensure #gameport exists\n        const dom = this.glkote.dom\n        const gameport = dom.gameport()\n        if (!gameport.length) {\n            throw new Error(`Cannot find gameport element #${dom.gameport_id}`)\n        }\n\n        // Old versions of GlkOte used a pre-existing #layouttestpane, remove it if it exists\n        dom.id('layouttestpane').remove()\n\n        // Create a layout test pane\n        const layout_test_pane = dom.create('div', 'layout_test_pane')\n        layout_test_pane.text('This should not be visible')\n\n        // Create the test windows\n        const line = $('<div>')\n        create('span', 'Style_normal').text('12345678').appendTo(line)\n\n        const bufwin = create('div', 'WindowFrame BufferWindow')\n        const bufline1 = line.clone().addClass('BufferLine').appendTo(bufwin)\n        const bufline2 = line.clone().addClass('BufferLine').appendTo(bufwin)\n        create('span', 'InvisibleCursor').appendTo(bufline2)\n        const bufspan = bufline1.children('span')\n        layout_test_pane.append(bufwin)\n\n        const graphwin = create('div', 'WindowFrame GraphicsWindow')\n        const graphcanvas = $('<canvas>', {\n            height: 32,\n            width: 64,\n        }).appendTo(graphwin)\n        layout_test_pane.append(graphwin)\n\n        const gridwin = create('div', 'WindowFrame GridWindow')\n        const gridline1 = line.clone().addClass('GridLine').appendTo(gridwin)\n        const gridline2 = line.clone().addClass('GridLine').appendTo(gridwin)\n        const gridspan = gridline1.children('span')\n        layout_test_pane.append(gridwin)\n\n        gameport.append(layout_test_pane)\n\n        // Wait first for the load event for the CSS to be loaded\n        await this.loaded\n        // And then for the actual font(s) to be loaded\n        const font_family = getComputedStyle(gridwin[0]).getPropertyValue('--glkote-grid-mono-family').split(',')[0].replace(/\"/g, '')\n        await document.fonts.load(`14px ${font_family}`)\n\n        // Measure the gameport height/width, excluding border and padding\n        this.metrics.height = gameport.height()!\n        this.metrics.width = gameport.width()!\n\n        // Measure the buffer window\n        const bufwinsize = get_size(bufwin)\n        const bufspansize = get_size(bufspan)\n        const bufline1size = get_size(bufline1)\n        const bufline2size = get_size(bufline2)\n        // A minimum of 1, but not necessarily an integer\n        this.metrics.buffercharheight = Math.max(1, bufline2.position().top - bufline1.position().top)\n        this.metrics.buffercharwidth = Math.max(1, bufspan.width()! / 8)\n        this.metrics.buffermarginx = bufwinsize.width - bufspansize.width\n        this.metrics.buffermarginy = bufwinsize.height - (bufline1size.height + bufline2size.height)\n\n        // Measure the graphics window\n        const graphicswinsize = get_size(graphwin)\n        const canvassize = get_size(graphcanvas)\n        this.metrics.graphicsmarginx = graphicswinsize.width - canvassize.width\n        this.metrics.graphicsmarginy = graphicswinsize.height - canvassize.height\n\n        // Measure the grid window\n        const gridwinsize = get_size(gridwin)\n        const gridspansize = get_size(gridspan)\n        const gridline1size = get_size(gridline1)\n        const gridline2size = get_size(gridline2)\n        // A minimum of 1, but not necessarily an integer\n        this.metrics.gridcharheight = Math.max(1, gridline2.position().top - gridline1.position().top)\n        this.metrics.gridcharwidth = Math.max(1, gridspan.width()! / 8)\n        this.metrics.gridmarginx = gridwinsize.width - gridspansize.width\n        this.metrics.gridmarginy = gridwinsize.height - (gridline1size.height + gridline2size.height)\n\n        // Clean up\n        layout_test_pane.remove()\n    }\n\n    on_gameport_resize = throttle(async () => {\n        // Delay again if not yet inited or disabled\n        if (this.glkote.disabled || !this.glkote.inited()) {\n            this.on_gameport_resize()\n            return\n        }\n        const oldmetrics = Object.assign({}, this.metrics)\n        await this.measure()\n        if (metrics_differ(this.metrics, oldmetrics)) {\n            this.glkote.send_event({type: 'arrange'})\n        }\n    }, 200, {leading: false})\n\n    on_visualViewport_resize = () => {\n        // Don't do anything if the window is pinch zoomed\n        if (is_pinch_zoomed()){\n            return\n        }\n\n        // The iOS virtual keyboard does not change the gameport height, but it does change the viewport\n        // Try to account for this by setting the gameport to the viewport height\n        const gameport = this.glkote.dom.gameport()\n        const input_is_active = document.activeElement?.tagName === 'INPUT'\n\n        // But first...\n        // iOS 15: When the virtual keyboard is active, the URL bar is not correctly accounted for in visualViewport.height\n        // https://bugs.webkit.org/show_bug.cgi?id=229876\n        // Should be fixed in iOS 15.1\n        // Account for it by adding some padding to the #gameport\n        if (ios15_0) {\n            gameport.toggleClass('ios15fix', input_is_active)\n        }\n        // And then set the outer height to the viewport height, accounting for any padding or margin\n        gameport.outerHeight(visualViewport!.height, true)\n\n        // Safari might have scrolled weirdly, so try to put it right\n        window.scrollTo(0, 0)\n        if (input_is_active) {\n            const window: Window = $(document.activeElement!).data('window')\n            if (window && window.type === 'buffer') {\n                window.frameel.scrollTop(window.innerel.height()!)\n            }\n        }\n\n        // Measure and send the new metrics\n        this.on_gameport_resize()\n    }\n}", "/*\n\nGlkOte transcript recording handler\n===================================\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport * as protocol from '../../common/protocol.js'\nimport {GlkOteOptions, TranscriptRecordingData} from '../common/glkote.js'\n\nimport Windows from './windows.js'\n\nexport default class TranscriptRecorder {\n    enabled = false\n    handler: (state: TranscriptRecordingData) => void = state => this.web_handler(state)\n    event?: Partial<protocol.Event>\n    label = ''\n    session = Date.now() + Math.ceil(Math.random() * 10000).toString(16)\n    timestamp?: number\n    url = ''\n    private windows: Windows\n\n    constructor(options: GlkOteOptions, windows: Windows) {\n        this.windows = windows\n        if (options.recording_handler) {\n            this.enabled = true\n            this.handler = options.recording_handler\n            this.url = '(custom handler)'\n        }\n        if (options.recording_url) {\n            this.enabled = true\n            this.url = options.recording_url\n        }\n        this.label = options.recording_label ?? ''\n        if (this.enabled) {\n            console.log(`Transcript recording active: session ${this.session} \"${this.label}\", destination ${this.url}`)\n        }\n    }\n\n    // Store the event for later\n    record_event(ev: Partial<protocol.Event>) {\n        this.event = ev\n        this.timestamp = Date.now()\n    }\n\n    // Record an event-output pair\n    record_update(state: protocol.StateUpdate) {\n        if (!state.content) {\n            return\n        }\n\n        // Check the event type\n        const event = this.event!\n        const eventtype = event.type\n        let input = ''\n        if (eventtype === 'char' || eventtype === 'line') {\n            input = (event as protocol.CharEvent | protocol.LineEvent).value\n        }\n        else if (!(!eventtype || eventtype === 'external' || eventtype === 'init' || eventtype === 'specialresponse')) {\n            return\n        }\n\n        // Collect the buffer window outputs\n        let output = ''\n        for (const update of state.content) {\n            const win = this.windows.get(update.id)\n            if (!win || win.type !== 'buffer') {\n                continue\n            }\n            const textdata = (update as protocol.BufferWindowContentUpdate).text || []\n            for (const data of textdata) {\n                if (!data.append) {\n                    output += '\\n'\n                }\n                const content = data.content\n                if (!content?.length) {\n                    continue\n                }\n                for (let run_index = 0; run_index < content.length; run_index++) {\n                    const instruction = content[run_index]\n                    if (typeof instruction === 'string') {\n                        output += content[++run_index]\n                    }\n                    else if ('text' in instruction) {\n                        output += instruction.text\n                    }\n                }\n            }\n        }\n\n        this.handler({\n            format: 'simple',\n            input,\n            label: this.label,\n            output,\n            outtimestamp: Date.now(),\n            sessionId: this.session,\n            timestamp: this.timestamp!,\n        })\n    }\n\n    async web_handler(state: TranscriptRecordingData) {\n        try {\n            const response = await fetch(this.url, {\n                body: JSON.stringify(state),\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                method: 'POST',\n            })\n\n            if (!response.ok) {\n                throw new Error(`Could not submit transcript update, got ${response.status}`)\n            }\n        }\n        catch (err: any) {\n            this.enabled = false\n            console.log(`Transcript recording failed; disabling. Error: ${err as Error}`)\n        }\n    }\n}", "/*\n\nGlkOte input handlers\n=====================\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\nimport {throttle} from 'lodash-es'\n\nimport {KEY_CODE_DOWN, KEY_CODE_RETURN, KEY_CODE_UP, KEY_CODES_TO_NAMES, OFFSCREEN_OFFSET} from '../../common/constants.js'\nimport * as protocol from '../../common/protocol.js'\n\nimport {is_pinch_zoomed} from './shared.js'\nimport {Window, apply_text_run_styles} from './windows.js'\n\nconst MAX_HISTORY_LENGTH = 25\n\nexport class TextInput {\n    el: JQuery<HTMLElement>\n    history_index = 0\n    is_line = false\n    window: Window\n\n    constructor(window: Window) {\n        this.window = window\n\n        this.el = $('<input>', {\n            'aria-hidden': 'true',\n            autocapitalize: 'off',\n            blur: () => this.onblur(),\n            class: 'Input',\n            data: {\n                window,\n            },\n            on: {\n                focus: () => this.onfocus(),\n                input: (ev: any) => this.oninput(ev),\n                keydown: (ev: JQuery.KeyDownEvent) => this.onkeydown(ev),\n                keypress: (ev: JQuery.KeyPressEvent) => this.onkeypress(ev),\n            },\n            type: 'text',\n        })\n            .prop('disabled', true)\n            .appendTo(window.frameel)\n    }\n\n    destroy() {\n        this.el.remove()\n    }\n\n    private onblur() {\n        scroll_window()\n    }\n\n    private onfocus() {\n        // Ensure a buffer window is scrolled down\n        if (this.window.type === 'buffer' && !is_pinch_zoomed()) {\n            this.window.frameel.scrollTop(this.window.innerel.height()!)\n        }\n        // Scroll the browser window over the next 600ms\n        scroll_window()\n    }\n\n    /** The keydown and keypress inputs are unreliable in mobile browsers with virtual keyboards. This handler can handle character input for printable characters, but not function/arrow keys */\n    private oninput(ev: any) {\n        // This input shouldn't be active\n        if (!this.window.inputs?.type) {\n            this.el.trigger('blur')\n            return false\n        }\n\n        if (this.window.inputs.type === 'char') {\n            const char = ev.target.value[0]\n            this.submit_char(char)\n            // Even though we have reset and emptied the input, Android acts as though it still has spaces within it, and won't send backspace keydown events until the phantom spaces have all been deleted. Refocusing seems to fix it.\n            if (char === ' ') {\n                this.el.trigger('blur').trigger('focus')\n            }\n            return false\n        }\n    }\n\n    private onkeydown(ev: JQuery.KeyDownEvent) {\n        // This input shouldn't be active\n        if (!this.window.inputs?.type) {\n            this.el.trigger('blur')\n            return false\n        }\n\n        const keycode = ev.which\n        if (!keycode) {\n            return\n        }\n\n        if (this.is_line) {\n            // History\n            if (keycode === KEY_CODE_DOWN || keycode === KEY_CODE_UP) {\n                const history = this.window.manager.history\n                let changed\n                if (keycode === KEY_CODE_DOWN && this.history_index > 0) {\n                    this.history_index--\n                    changed = 1\n                }\n                else if (keycode === KEY_CODE_UP && this.history_index < history.length) {\n                    this.history_index++\n                    changed = 1\n                }\n                if (changed) {\n                    this.el.val(this.history_index === 0 ? '' : history[this.history_index - 1])\n                }\n                return false\n            }\n\n            // Terminator for this input\n            else if (this.window.inputs!.terminators) {\n                const terminator = KEY_CODES_TO_NAMES[keycode] as protocol.TerminatorCode\n                if (this.window.inputs!.terminators.includes(terminator)) {\n                    this.submit_line(ev.target.value, terminator)\n                    return false\n                }\n            }\n        }\n        // Character input\n        else {\n            const code = KEY_CODES_TO_NAMES[keycode]\n            if (code) {\n                this.submit_char(code)\n                return false\n            }\n        }\n\n        // Don't propagate, so that document.keydown doesn't trigger\n        ev.stopPropagation()\n    }\n\n    private onkeypress(ev: JQuery.KeyPressEvent) {\n        // This input shouldn't be active\n        if (!this.window.inputs?.type) {\n            this.el.trigger('blur')\n            return false\n        }\n\n        const keycode = ev.which\n        if (!keycode) {\n            return\n        }\n\n        // Submit line input\n        if (this.is_line) {\n            if (keycode === KEY_CODE_RETURN) {\n                this.submit_line(ev.target.value)\n                return false\n            }\n        }\n        // Character input\n        else {\n            const code = keycode === KEY_CODE_RETURN ? 'return' : String.fromCharCode(keycode)\n            this.submit_char(code)\n            return false\n        }\n    }\n\n    /** Refocus the input, if it wouldn't obscure part of the update */\n    // On Android this forces the window to be scrolled down to the bottom, so only refocus if the virtual keyboard doesn't make the window too small for the full update text to be seen\n    refocus() {\n        if (this.window.type === 'buffer') {\n            const updateheight = this.window.innerel.outerHeight()! - this.window.updatescrolltop\n            if (updateheight > this.window.visibleheight) {\n                return\n            }\n        }\n        this.el[0].focus({preventScroll: true})\n    }\n\n    reset() {\n        this.history_index = 0\n        this.el\n            .attr({\n                'aria-hidden': 'true',\n                class: 'Input',\n            })\n            .css({\n                'background-color': '',\n                color: '',\n                left: OFFSCREEN_OFFSET,\n                top: '',\n                width: '',\n            })\n            .prop('disabled', true)\n            .val('')\n        const inputparent = this.window.type === 'buffer' ? this.window.innerel : this.window.frameel\n        if (!this.el.parent().is(inputparent)) {\n            this.el.appendTo(inputparent)\n        }\n    }\n\n    private submit_char(val: string) {\n        this.window.send_text_event({\n            type: 'char',\n            value: val,\n        })\n    }\n\n    private submit_line(val: string, terminator?: protocol.TerminatorCode) {\n        // Insert a history item if it's not blank and also not the same as the last one\n        const history = this.window.manager.history\n        if (val && val !== history[0]) {\n            history.unshift(val)\n            if (history.length > MAX_HISTORY_LENGTH) {\n                history.length = MAX_HISTORY_LENGTH\n            }\n        }\n\n        this.window.send_text_event({\n            type: 'line',\n            terminator,\n            value: val,\n        })\n    }\n\n    update() {\n        // Start from a clean slate\n        this.reset()\n\n        const update = this.window.inputs!\n        if (update.type !== 'char' && update.type !== 'line') {\n            return\n        }\n        this.is_line = update.type === 'line'\n\n        // Common options for both character and line input\n        this.el\n            .attr({\n                'aria-hidden': 'false',\n                maxlength: this.is_line ? update.maxlen! : 1,\n            })\n            .prop('disabled', false)\n            .val(update.initial || '')\n\n        if (this.is_line) {\n            if (this.window.type === 'graphics') {\n                throw new Error(`Cannot request line input in graphics window ${this.window.id}`)\n            }\n            this.el.addClass('LineInput')\n        }\n\n        // Position the input element within the window\n        switch (this.window.type) {\n            case 'buffer':\n                (this.window.lastline || this.window.innerel).append(this.el)\n                break\n            case 'grid': {\n                const metrics = this.window.metrics\n                this.el.css({\n                    left: update.xpos! * metrics.gridcharwidth + (metrics.gridmarginx / 2),\n                    top: update.ypos! * metrics.gridcharheight + (metrics.gridmarginy / 2),\n                    width: (update.maxlen || 1) * metrics.gridcharwidth,\n                })\n                break\n            }\n        }\n\n        // Set text style\n        if (this.window.type !== 'graphics') {\n            const css_styles = this.window.last_run_styles\n            if (css_styles) {\n                const reverse = !!css_styles.reverse\n                this.el.toggleClass('reverse', reverse)\n                apply_text_run_styles(css_styles, reverse, this.el)\n            }\n        }\n    }\n}\n\n/* A little helper function to repeatedly scroll the window, because iOS sometimes scrolls badly\n   On iOS, when focusing the soft keyboard, the keyboard animates in over 500ms\n   This would normally cover up the focused input, so iOS cleverly tries to\n   scroll the top-level window down to bring the input into the view\n   But we know better: we want to scroll the input's window frame to the bottom,\n   without scrolling the top-level window at all. */\nconst scroll_window = throttle(() => {\n    function do_scroll(count: number) {\n        window.scrollTo(0, 0)\n        if (count > 0) {\n            setTimeout(do_scroll, 50, count - 1)\n        }\n    }\n    do_scroll(12)\n}, 1000)", "/*\n\nGlkOte windows\n==============\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {debounce} from 'lodash-es'\n\nimport {Blorb} from '../../blorb/blorb.js'\nimport {NBSP} from '../../common/constants.js'\nimport * as protocol from '../../common/protocol.js'\n\nimport {TextInput} from './input.js'\nimport {create, DOM, EventFunc, is_pinch_zoomed} from './shared.js'\nimport WebGlkOte from './web.js'\n\nexport type Window = BufferWindow | GraphicsWindow | GridWindow\ntype WindowCodes = 'buffer' | 'graphics' | 'grid'\n\nfunction no_text_selected(): boolean {\n    return (window.getSelection() + '') === ''\n}\n\ninterface WindowConstructorOptions {\n    blorb?: Blorb\n    dom: DOM,\n    id: number,\n    manager: Windows,\n    metrics: protocol.NormalisedMetrics,\n    rock: number,\n    styles?: protocol.WindowStyles,\n    type: WindowCodes,\n}\n\nabstract class WindowBase {\n    blorb?: Blorb\n    desired = true\n    dom: DOM\n    frameel: JQuery<HTMLElement>\n    id: number\n    inputs?: protocol.InputUpdate\n    manager: Windows\n    metrics: protocol.NormalisedMetrics\n    textinput: TextInput\n    type: WindowCodes\n\n    constructor(options: WindowConstructorOptions) {\n        this.blorb = options.blorb\n        this.dom = options.dom\n        this.id = options.id\n        this.manager = options.manager\n        this.metrics = options.metrics\n        this.type = options.type\n\n        this.frameel = this.dom.create('div', `window${options.id}`, {\n            class: `WindowFrame ${window_types[this.type]} WindowRock_${options.rock}`,\n            click: (ev: JQuery.ClickEvent) => this.onclick(ev),\n        })\n            .appendTo(this.dom.windowport())\n\n        // (this as any as Window) is a silly hack to work around Typescript's abstract class rules\n        this.textinput = new TextInput(this as any as Window)\n    }\n\n    destroy(remove_frame: boolean) {\n        this.textinput.destroy()\n        if (remove_frame) {\n            this.frameel.remove()\n        }\n        else {\n            this.inputs = undefined\n        }\n    }\n\n    // Dummy function which is only needed for buffer windows\n    measure_height() {}\n\n    protected onclick(ev: JQuery.ClickEvent) {\n        if (this.inputs?.type && no_text_selected()) {\n            this.textinput.el.trigger('focus')\n            return false\n        }\n    }\n\n    send_text_event(ev: Partial<protocol.CharEvent | protocol.LineEvent>) {\n        // Measure the height of the window, which should account for a virtual keyboard\n        this.measure_height()\n        this.textinput.reset()\n        // Clear the input type so we won't accidentally send it again\n        this.inputs!.type = undefined\n        // We're the last active window\n        this.manager.active_window = this as any as Window\n        // Set the event's window prop and send it\n        ev.window = this.id\n        this.manager.send_event(ev)\n    }\n\n    update_textinput() {\n        this.textinput.update()\n    }\n}\n\n// Apply text run styles, accounting for reverse mode\nexport function apply_text_run_styles(orig_styles: protocol.CSSProperties, reverse: boolean, el: JQuery<HTMLElement>) {\n    // Make a copy of the styles, I'm not sure this is strictly necessary but better to be safe\n    const styles = Object.assign({}, orig_styles)\n    // Swap colours if reverse mode\n    if (reverse) {\n        const bg = styles['background-color']\n        const fg = styles.color\n        if (bg) {\n            styles.color = bg\n        }\n        else {\n            delete styles.color\n        }\n        if (fg) {\n            styles['background-color'] = fg\n        }\n        else {\n            delete styles['background-color']\n        }\n        delete styles.reverse\n    }\n    el.css(styles)\n}\n\n// Split a string into words, with whitespace included after the words it follows\nfunction split_after_spaces(text: string): string[] {\n    const res: string[] = ['']\n    const whitespace = /\\s/\n    let prev_whitespace = false\n    for (const c of text) {\n        const is_whitespace = whitespace.test(c)\n        if (!is_whitespace && prev_whitespace) {\n            res.unshift('')\n        }\n        res[0] += c\n        prev_whitespace = is_whitespace\n    }\n    res.reverse()\n    return res\n}\n\nabstract class TextualWindow extends WindowBase {\n    bg?: string\n    fg?: string\n    last_run_styles?: protocol.CSSProperties\n    styles?: protocol.WindowStyles\n\n    constructor(options: WindowConstructorOptions) {\n        super(options)\n\n        // We need the `this` object provided by jQuery, so we can't use an arrow function handler like we normally do\n        const onlink = (target: HTMLElement) => this.onlink(target)\n        this.frameel.on('click', 'a', function() {onlink(this)})\n\n        // Add stylehints\n        if (options.styles) {\n            this.styles = options.styles\n            this.add_stylehints()\n        }\n    }\n\n    /** Format CSS rules and add to the window */\n    add_stylehints() {\n        const windowid = `#window${this.id}`\n        const styles: protocol.WindowStyles = {}\n        if (this.styles) {\n            // Copy all the styles\n            for (const [selector, original_styles] of Object.entries(this.styles)) {\n                const full_selector = `${windowid} ${selector}`.trim()\n                const css_styles = styles[full_selector] = Object.assign({}, original_styles)\n\n                // Create a .reverse rule for when text runs are reverse mode\n                if (selector) {\n                    const bg = css_styles['background-color']\n                    const fg = css_styles.color\n                    if (bg || fg) {\n                        const reverse_styles: protocol.CSSProperties = styles[`${full_selector}.reverse`] = {}\n                        if (bg) {\n                            reverse_styles.color = bg\n                        }\n                        if (fg) {\n                            reverse_styles['background-color'] = fg\n                        }\n                    }\n\n                    // Monospace mode - handled in create_text_run\n                    delete css_styles.monospace\n\n                    // In reverse mode don't set colour styles\n                    if (css_styles.reverse) {\n                        delete css_styles['background-color']\n                        delete css_styles.color\n                    }\n                    delete css_styles.reverse\n\n                    // Check if we have any properties left\n                    if (Object.keys(css_styles).length === 0) {\n                        delete styles[full_selector]\n                    }\n                }\n            }\n\n            // Copy styles for the <input>\n            // May not play nice with reverse\n            if (styles[`${windowid} span.Style_input`]) {\n                styles[`${windowid} .LineInput`] = styles[`${windowid} span.Style_input`]\n            }\n        }\n\n        // Set window background colour, for normal and reverse mode\n        const normal_styles = styles[`${windowid} span.Style_normal`]\n        const bg = this.bg || normal_styles?.['background-color']\n        const fg = this.fg || normal_styles?.color\n        if (bg || fg) {\n            if (!styles[windowid]) {\n                styles[windowid] = {}\n            }\n            styles[windowid]['background-color'] = bg || `var(--glkote-${this.type}-bg)`\n            styles[`${windowid}.reverse`] = {\n                'background-color': fg || `var(--glkote-${this.type}-reverse-bg)`,\n            }\n        }\n\n        // Finally output the styles\n        if (Object.keys(styles).length) {\n            this.frameel.children('style').remove()\n            this.frameel.prepend(`<style>${Object.entries(styles).map(rule => {\n                const [selector, properties] = rule\n                return `${selector} {${Object.entries(properties).map(property => {\n                    const [name, value] = property\n                    return `${name}: ${value}`\n                }).join('; ')}}`\n            }).join('\\n')}</style>`)\n        }\n    }\n\n    create_text_run(run: protocol.TextRun, split_words?: boolean): JQuery<HTMLElement> {\n        const run_style = run.style\n        // Is this run or this style monospace mode?\n        const monospace_val = run.css_styles?.monospace ?? this.styles?.[`span.Style_${run_style}`]?.monospace\n        let monospace_class = ''\n        // Only add the class if we're changing the default font-family for this style\n        if (typeof monospace_val !== 'undefined') {\n            if (run_style === 'preformatted') {\n                if (!monospace_val) {\n                    monospace_class = ' proportional'\n                }\n            }\n            else if (monospace_val) {\n                monospace_class = ' monospace'\n            }\n        }\n        // Is this run or this style reverse mode?\n        const reverse = run.css_styles?.reverse ?? this.styles?.[`span.Style_${run_style}`]?.reverse\n        // Create a template span and apply classes and styles\n        const el = create('span', `Style_${run_style}${reverse ? ' reverse' : ''}${monospace_class}`)\n        if (run.css_styles) {\n            apply_text_run_styles(run.css_styles, !!reverse, el)\n        }\n        // Split words if instructed to, or if this text run is monospaced\n        if (typeof split_words === 'undefined') {\n            split_words = !!monospace_val || run_style === 'preformatted'\n        }\n        const els = split_words\n            ? $(split_after_spaces(run.text).map(text => el.clone().text(text)[0]))\n            : el.text(run.text)\n        // Wrap in a link\n        if (run.hyperlink) {\n            return $('<a>', {\n                data: {\n                    glklink: run.hyperlink,\n                },\n                href: '#',\n            })\n                .append(els)\n        }\n        return els\n    }\n\n    onlink(target: HTMLElement) {\n        const linkval = $(target).data('glklink')\n        if (linkval) {\n            if (this.inputs?.hyperlink) {\n                this.manager.send_event({\n                    type: 'hyperlink',\n                    value: linkval,\n                    window: this.id,\n                })\n            }\n            return false\n        }\n    }\n\n    /** Refresh styles after a cleared window */\n    refresh_styles(bg?: string, fg?: string) {\n        let styles_need_refreshing\n        if (typeof bg !== undefined && bg !== this.bg) {\n            this.bg = bg\n            styles_need_refreshing = 1\n        }\n        if (typeof fg !== undefined && fg !== this.fg) {\n            this.fg = fg\n            styles_need_refreshing = 1\n        }\n        if (styles_need_refreshing) {\n            this.add_stylehints()\n        }\n    }\n}\n\nconst inline_alignment_classes: Record<string, string> = {\n    inlinecenter: 'ImageInlineCenter',\n    inlinedown: 'ImageInlineDown',\n    inlineup: 'ImageInlineUp',\n    marginleft: 'ImageMarginLeft',\n    marginright: 'ImageMarginRight',\n}\n\nclass BufferWindow extends TextualWindow {\n    type = 'buffer' as const\n    innerel: JQuery<HTMLElement>\n    lastline?: JQuery<HTMLElement>\n    updatescrolltop = 0\n    visibleheight: number\n\n    constructor(options: WindowConstructorOptions) {\n        super(options)\n        this.frameel.attr({\n            'aria-live': 'polite',\n            role: 'log',\n            tabindex: -1,\n        })\n        this.innerel = create('div', 'BufferWindowInner')\n            .append(this.textinput.el)\n            .appendTo(this.frameel)\n        this.visibleheight = this.frameel.height()!\n    }\n\n    /** Measure the height of the window that is currently visible (excluding virtual keyboards for example) */\n    measure_height() {\n        this.visibleheight = this.frameel.height()!\n    }\n\n    protected onclick(_: JQuery.ClickEvent) {\n        if (this.inputs?.type && no_text_selected()) {\n            // Check that we've scrolled to the bottom (if there is actually text in this window)\n            if (this.lastline && this.visibleheight) {\n                const rect = this.lastline[0].getBoundingClientRect()\n                if (rect.bottom < 0 || rect.top > document.documentElement.clientHeight) {\n                    return false\n                }\n            }\n            this.textinput.el.trigger('focus')\n            return false\n        }\n    }\n\n    update(data: protocol.BufferWindowContentUpdate) {\n        if (data.clear) {\n            this.innerel.children('.BufferLine').remove()\n            this.lastline = undefined\n            this.last_run_styles = undefined\n            this.refresh_styles(data.bg, data.fg)\n        }\n\n        // If the text field is missing, just do nothing\n        if (!data.text) {\n            return\n        }\n\n        // Tell ARIA that we're busy while we're updating the window\n        this.frameel.attr('aria-busy', 'true')\n\n        // Get the scrolltop for this update\n        this.updatescrolltop = Math.max(0, (this.lastline?.position().top || 0) - 20)\n\n        let line_index = 0\n        while (line_index < data.text.length) {\n            const line = data.text[line_index++]\n            const content = line.content\n            let divel: JQuery<HTMLElement> | undefined\n            let line_has_style\n            if (line.append && this.lastline) {\n                divel = this.lastline\n                line_has_style = 1\n            }\n            else {\n                divel = create('div', 'BufferLine')\n                this.innerel.append(divel)\n                this.lastline = divel\n                if (!content?.length) {\n                    divel.addClass('BlankPara')\n                    divel.append(create('span', 'BlankLineSpace').text(NBSP))\n                    continue\n                }\n            }\n            if (line.flowbreak) {\n                divel.addClass('FlowBreak')\n            }\n\n            if (!content?.length) {\n                continue\n            }\n            for (let run_index = 0; run_index < content.length; run_index++) {\n                let run: protocol.TextRun\n                const instruction = content[run_index]\n                if (typeof instruction === 'string') {\n                    run = {\n                        style: content[run_index++] as string,\n                        text: content[run_index] as string,\n                    }\n                }\n                else if ('special' in instruction && instruction.special === 'image') {\n                    const el = $('<img>', {\n                        alt: instruction.alttext || `Image ${instruction.image}`,\n                        class: inline_alignment_classes[instruction.alignment || 'inlineup'],\n                        height: instruction.height,\n                        src: this.blorb && this.blorb.get_image_url(instruction.image!) || instruction.url!,\n                        width: instruction.width,\n                    })\n                    if (instruction.hyperlink) {\n                        $('<a>', {\n                            data: {\n                                glklink: instruction.hyperlink,\n                            },\n                            href: '#',\n                        })\n                            .append(el)\n                            .appendTo(divel)\n                        continue\n                    }\n                    divel.append(el)\n                    continue\n                }\n                else {\n                    run = instruction as protocol.TextRun\n                }\n                if (!line_has_style) {\n                    line_has_style = 1\n                    divel.addClass(`Style_${run.style}`)\n                }\n                divel.append(this.create_text_run(run, line_index === data.text.length ? true : undefined))\n                // Store the last text run for setting styles in the input\n                this.last_run_styles = run.css_styles\n            }\n        }\n\n        // Scroll down\n        if (!is_pinch_zoomed()) {\n            this.frameel.scrollTop(this.updatescrolltop)\n        }\n\n        // TODO: Trim log?\n\n        this.frameel.attr('aria-busy', 'false')\n    }\n}\n\nexport class GraphicsWindow extends WindowBase {\n    type = 'graphics' as const\n    buffer: JQuery<HTMLCanvasElement>\n    canvas: JQuery<HTMLCanvasElement>\n    fillcolour = ''\n    framequeue: protocol.GraphicsWindowOperation[][] = []\n    /** Height in CSS pixels */\n    height = 0\n    image_cache: Map<number | string, HTMLImageElement> = new Map()\n    /** Width in CSS pixels */\n    width = 0\n\n    constructor(options: WindowConstructorOptions) {\n        super(options)\n        // Create the canvas\n        this.canvas = this.dom.create('canvas', `win${options.id}_canvas`, {\n            data: {\n                window: this,\n            },\n        }) as JQuery<HTMLCanvasElement>\n        this.frameel.append(this.canvas)\n        this.manager.canvasResizeObserver?.observe(this.canvas[0])\n\n        // And a buffer canvas to reduce flicker\n        this.buffer = this.dom.create('canvas', `win${options.id}_buffer`) as JQuery<HTMLCanvasElement>\n    }\n\n    // Clear the image cache 5 seconds after the last frame, so that the cache can be useful for animations, but we don't waste memory for images which are only updated each turn\n    clear_cache = debounce(() => {\n        this.image_cache.clear()\n    }, 5000)\n\n    // Decode and cache an image\n    decode_image(key: number | string, url: string): Promise<void> {\n        const image = new Image()\n        image.src = url\n        return image.decode()\n            .then(() => {\n                this.image_cache.set(key, image)\n            })\n            .catch(() => {})\n    }\n\n    destroy(remove_frame: boolean) {\n        this.manager.canvasResizeObserver?.unobserve(this.canvas[0])\n        super.destroy(remove_frame)\n    }\n\n    onclick(ev: JQuery.ClickEvent) {\n        if (this.inputs?.mouse && ev.button === 0) {\n            this.inputs.mouse = false\n            this.manager.send_event({\n                type: 'mouse',\n                window: this.id,\n                x: Math.floor(ev.offsetX - this.metrics.graphicsmarginx / 2),\n                y: Math.floor(ev.offsetY - this.metrics.graphicsmarginy / 2),\n            })\n            return false\n        }\n        return super.onclick(ev)\n    }\n\n    set_dimensions(height: number, width: number) {\n        // First set the things which use CSS pixels\n        this.canvas.css({height, width})\n        this.height = height\n        this.width = width\n        // Then the canvas dimensions using devicePixelRatio\n        const dPR = devicePixelRatio\n        height = height * dPR\n        width = width * dPR\n        this.buffer.attr({height, width})\n        this.canvas.attr({height, width})\n        // The resize observer will handle setting true pixel sizes if supported\n    }\n\n    // This function is async because images must be loaded asynchrounously, and each operation painted in sequence, but the rest of GlkOte doesn't need to await it\n    async update() {\n        const buffercontext = this.buffer[0].getContext('2d')!\n\n        // If we're slow loading images then more than one frame may have arrived, so go through the queue now\n        for (let i = 0; i < this.framequeue.length; i++) {\n            const frame = this.framequeue[i]\n\n            // Stop if the window is collapsed\n            if (!this.height || !this.width) {\n                break\n            }\n            // There shouldn't be any empty frames, but check just in case\n            if (!frame.length) {\n                continue\n            }\n\n            // Preload images\n            const loading_images = []\n            for (const op of frame) {\n                if (op.special === 'image') {\n                    const key = op.url || op.image!\n                    if (this.image_cache.has(key)) {\n                        continue\n                    }\n                    const url = op.url || this.blorb && this.blorb.get_image_url(op.image!)\n                    if (url) {\n                        loading_images.push(this.decode_image(key, url))\n                    }\n                }\n            }\n            await Promise.all(loading_images)\n\n            const dPR = devicePixelRatio\n            for (const op of frame) {\n                switch (op.special) {\n                    case 'fill':\n                        buffercontext.fillStyle = op.color || this.fillcolour\n                        if (Number.isFinite(op.x)) {\n                            buffercontext.fillRect(op.x! * dPR, op.y! * dPR, op.width! * dPR, op.height! * dPR)\n                        }\n                        else {\n                            buffercontext.fillRect(0, 0, parseInt(this.buffer.attr('width')!), parseInt(this.buffer.attr('height')!))\n                        }\n                        break\n                    case 'image': {\n                        const image = this.image_cache.get(op.url || op.image!)\n                        if (image) {\n                            buffercontext.drawImage(image, op.x * dPR, op.y * dPR, op.width * dPR, op.height * dPR)\n                        }\n                        break\n                    }\n                    case 'setcolor':\n                        this.fillcolour = op.color\n                        break\n                }\n            }\n        }\n        // Now that all operations/frames are finished, draw the buffer to the main canvas (as long as it hasn't been collapsed)\n        if (this.height && this.width) {\n            this.canvas[0].getContext('2d')!.drawImage(this.buffer[0], 0, 0)\n        }\n\n        // Empty the queue\n        this.framequeue.length = 0\n        // And queue the cache to be cleared, if more frames don't arrive soon\n        this.clear_cache()\n    }\n}\n\nclass GridWindow extends TextualWindow {\n    type = 'grid' as const\n    height = 0\n    lines: JQuery<HTMLElement>[] = []\n    width = 0\n\n    constructor(options: WindowConstructorOptions) {\n        super(options)\n        this.frameel.attr({\n            'aria-atomic': 'true',\n            'aria-live': 'off',\n            role: 'status',\n        })\n    }\n\n    onclick(ev: JQuery.ClickEvent) {\n        if (this.inputs?.mouse && ev.button === 0 && no_text_selected()) {\n            this.inputs.mouse = false\n            this.manager.send_event({\n                type: 'mouse',\n                window: this.id,\n                x: Math.floor((ev.offsetX - this.metrics.gridmarginx / 2) / this.metrics.gridcharwidth),\n                y: Math.floor((ev.offsetY - this.metrics.gridmarginy / 2) / this.metrics.gridcharheight),\n            })\n            return false\n        }\n        return super.onclick(ev)\n    }\n\n    update(data: protocol.GridWindowContentUpdate) {\n        if (data.clear) {\n            this.last_run_styles = undefined\n            this.refresh_styles(data.bg, data.fg)\n        }\n\n        // Tell ARIA that we're busy while we're updating the window\n        this.frameel.attr('aria-busy', 'true')\n\n        for (const line of data.lines) {\n            const lineel = this.lines[line.line]\n            if (!lineel.length) {\n                throw new Error(`Got content for nonexistent line ${line.line} of window ${this.id}`)\n            }\n\n            const content = line.content\n            if (!content || !content.length) {\n                lineel.text(NBSP)\n            }\n            else {\n                lineel.empty()\n                for (let i = 0; i < content.length; i++) {\n                    let run: protocol.TextRun\n                    if (typeof content[i] === 'string') {\n                        run = {\n                            style: content[i++] as string,\n                            text: content[i] as string,\n                        }\n                    }\n                    else {\n                        run = content[i] as protocol.TextRun\n                    }\n                    lineel.append(this.create_text_run(run, false))\n                    // Store the last text run for setting styles in the input\n                    this.last_run_styles = run.css_styles\n                }\n            }\n        }\n\n        // Apply the class of 'reverse' to the window if all the text in it is reversed\n        this.frameel.toggleClass('reverse', $(`#window${this.id} span:not(.reverse)`).length === 0)\n\n        // If there are more than 4 lines, set aria-live to polite\n            .attr({\n                'aria-busy': 'false',\n                'aria-live': this.lines.length > 3 ? 'polite' : 'off',\n            })\n    }\n}\n\nconst window_classes: Record<string, new (opt: WindowConstructorOptions) => Window> = {\n    buffer: BufferWindow,\n    graphics: GraphicsWindow,\n    grid: GridWindow,\n}\n\nconst window_types: Record<string, string> = {\n    buffer: 'BufferWindow',\n    graphics: 'GraphicsWindow',\n    grid: 'GridWindow',\n}\n\nexport default class Windows extends Map<number, Window> {\n    active_window?: Window\n    blorb?: Blorb // Note will be set after this is constructed, in WebGlkOte.init\n    canvasResizeObserver?: ResizeObserver // Will only be created if the browser's ResizeObserver supports devicePixelContentBoxSize\n    private dom: DOM\n    private glkote: WebGlkOte\n    history: string[] = []\n    private metrics: protocol.NormalisedMetrics\n    send_event: EventFunc\n\n    constructor(glkote: WebGlkOte) {\n        super()\n        this.dom = glkote.dom\n        this.glkote = glkote\n        this.metrics = glkote.current_metrics\n        if (window.ResizeObserver) {\n            // We can use a ResizeObserver to get true pixel dimensions for canvases, but it's not supported in all browsers, so test\n            const testRO = new ResizeObserver((entries) => {\n                if (typeof entries?.[0].devicePixelContentBoxSize?.[0].blockSize !== 'undefined') {\n                    this.canvasResizeObserver = new ResizeObserver((entries: ResizeObserverEntry[]) => this.oncanvasresize(entries))\n                }\n                testRO.disconnect()\n            })\n            testRO.observe(document.body)\n        }\n        this.send_event = ev => glkote.send_event(ev)\n\n        $(document).on('keydown', this.onkeydown)\n        this.dom.gameport().on('click', () => this.onclick())\n    }\n\n    // Clean up after a GlkOte.exit() call, but don't empty the HTML\n    destroy() {\n        for (const win of this.values()) {\n            win.destroy(false)\n            this.delete(win.id)\n        }\n        $(document).off('keydown', this.onkeydown)\n    }\n\n    cancel_inputs(windows: protocol.InputUpdate[]) {\n        const newinputs: Record<number, protocol.InputUpdate> = {}\n        for (const window of windows) {\n            newinputs[window.id] = window\n        }\n\n        for (const win of this.values()) {\n            const update = newinputs[win.id]\n            if (!update && win.inputs) {\n                if (win.textinput.el.is(':focus')) {\n                    this.active_window = win\n                    win.textinput.el.trigger('blur')\n                }\n                delete win.inputs\n            }\n        }\n    }\n\n    // Use a resize observer to set true pixel sizes on graphics windows\n    private oncanvasresize(entries: ResizeObserverEntry[]) {\n        for (const entry of entries) {\n            const box = entry.devicePixelContentBoxSize![0]\n            const height = box.blockSize\n            const width = box.inlineSize\n            const win: GraphicsWindow = $(entry.target).data('window')\n            win.buffer.attr({height, width})\n            win.canvas.attr({height, width})\n        }\n        this.send_event({type: 'redraw'})\n    }\n\n    // If the gameport receives a click event, then find one window with active text input to focus\n    private onclick() {\n        if (!this.glkote.disabled && no_text_selected()) {\n            for (const window of this.values()) {\n                if (window.inputs?.type) {\n                    window.frameel.trigger('click')\n                    break\n                }\n            }\n        }\n    }\n\n    // On document.keypress events, redirect to a window\n    private onkeydown = (ev: JQuery.KeyDownEvent) => {\n        // Don't fire on inputs or focused buffer windows\n        if (!this.glkote.disabled && ev.target.nodeName !== 'input' && !(ev.target.nodeName === 'div' && $(ev.target).is('.BufferWindow:focus'))) {\n            // Look first for a window with active text input, but as a fallback any buffer window\n            const windows = [...this.values()]\n            const window = windows.filter(win => win.inputs?.type)[0] || windows.filter(win => win.type === 'buffer')[0]\n            if (window) {\n                window.frameel.trigger('click')\n                // After focusing, the keypress event will fire, but not the keydown, meaning that function keys won't be recognised\n                // So manually trigger the keydown event in the input (as long as it is actually focused)\n                if (window.textinput.el.is(':focus')) {\n                    window.textinput.el.trigger(ev)\n                }\n                // Otherwise focus the window so that nav keys will work\n                else if (window.type === 'buffer') {\n                    window.frameel.trigger('focus')\n                }\n            }\n        }\n    }\n\n    update(windows: protocol.WindowUpdate[]) {\n        // Mark all windows as non-desired\n        for (const win of this.values()) {\n            win.desired = false\n        }\n\n        // Go through each window in this update\n        for (const update of windows) {\n            const id = update.id\n            const type = update.type\n\n            // Is there an existing window?\n            let win = this.get(id)\n\n            // Create it if not\n            if (!win) {\n                win = new (window_classes[type])({\n                    blorb: this.blorb,\n                    dom: this.dom,\n                    id,\n                    manager: this,\n                    metrics: this.metrics,\n                    rock: update.rock,\n                    styles: update.styles,\n                    type,\n                })\n                this.set(id, win)\n            }\n            else {\n                if (win.type !== type) {\n                    throw new Error(`Window ${id} was created with type ${win.type}, but now is described as type ${type}`)\n                }\n            }\n            win.desired = true\n\n            // Ensure graphics windows are the right size\n            if (win.type === 'graphics') {\n                if (win.height !== update.graphheight || win.width !== update.graphwidth) {\n                    win.set_dimensions(update.graphheight!, update.graphwidth!)\n                }\n            }\n\n            // Ensure grid windows have the right number of lines\n            if (win.type === 'grid') {\n                if (update.gridheight! > win.height) {\n                    for (let i = win.height; i < update.gridheight!; i++) {\n                        const line = this.dom.create('div', `win${win.id}_ln${i}`, 'GridLine')\n                        line.append(NBSP)\n                        win.frameel.append(line)\n                        win.lines[i] = line\n                    }\n                }\n                if (update.gridheight! < win.height) {\n                    for (let i = update.gridheight!; i < win.height; i++) {\n                        this.dom.id(`win${win.id}_ln${i}`).remove()\n                    }\n                }\n                win.height = update.gridheight!\n                win.lines.length = win.height\n                win.width = update.gridwidth!\n            }\n\n            // Update the position of the window\n            win.frameel.css({\n                height: update.height,\n                left: update.left,\n                top: update.top,\n                width: update.width,\n            })\n            win.measure_height()\n        }\n\n        const windowstoclose: Window[] = []\n        for (const win of this.values()) {\n            if (!win.desired) {\n                windowstoclose.push(win)\n            }\n        }\n        for (const win of windowstoclose) {\n            win.destroy(true)\n            this.delete(win.id)\n        }\n    }\n\n    update_content(content: protocol.ContentUpdate[]) {\n        for (const update of content) {\n            const win = this.get(update.id)\n            if (!win) {\n                throw new Error(`Got content update for window ${update.id}, which does not exist`)\n            }\n            // TODO: check for pending line input\n\n            switch (win.type) {\n                case 'buffer': win.update(update as protocol.BufferWindowContentUpdate); break\n                case 'graphics':\n                    // Queue this frame, but only run the update function if this is the only frame\n                    win.framequeue.push((update as protocol.GraphicsWindowContentUpdate).draw)\n                    if (win.framequeue.length === 1) {\n                        win.update()\n                    }\n                    break\n                case 'grid': win.update(update as protocol.GridWindowContentUpdate); break\n            }\n        }\n    }\n\n    update_inputs(windows: protocol.InputUpdate[]) {\n        for (const update of windows) {\n            const win = this.get(update.id)\n            if (!win) {\n                throw new Error(`Got input update for window ${update.id}, which does not exist`)\n            }\n\n            const oldgen = win.inputs?.gen\n            win.inputs = update\n            if (update.type){\n                if (update.gen !== oldgen) {\n                    win.update_textinput()\n                }\n            }\n        }\n\n        // Refocus an <input>\n        // On Android this forces the window to be scrolled down to the bottom, so only refocus if the virtual keyboard doesn't make the window too small for the full update text to be seen\n        if (this.active_window) {\n            // Refocus the same window if it hasn't been deleted and still wants input\n            if (this.has(this.active_window.id) && this.active_window.inputs?.type) {\n                this.active_window.textinput.refocus()\n            }\n            // Look for any window with text input\n            else {\n                [...this.values()].filter(win => win.inputs?.type)[0]?.textinput.refocus()\n            }\n        }\n    }\n}", "/*\n\nWeb GlkOte implementation\n=========================\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {throttle} from 'lodash-es'\n\nimport * as GlkOte from '../common/glkote.js'\nimport * as protocol from '../../common/protocol.js'\n\nimport Metrics from './metrics.js'\nimport {DOM} from './shared.js'\nimport TranscriptRecorder from './transcript-recorder.js'\nimport Windows, {GraphicsWindow} from './windows.js'\n\ninterface AutosaveState {\n    graphics_bg?: Array<[number, string]>,\n    history?: Array<string>,\n    metrics?: {\n        height: number,\n        width: number,\n    },\n    transcript_recorder_session?: string,\n}\n\n/** A GlkOte implementation for the web\n * \n * WebGlkOte requires the following HTML divs to be present (though the id names can be varied through the options):\n * \n * ```\n *     <div id=\"gameport\">\n *         <div id=\"windowport\"></div>\n *         <div id=\"loadingpane\">Loading...</div>\n *         <div id=\"errorpane\" style=\"display:none;\"><div id=\"errorcontent\"></div></div>\n *     </div>\n * ```\n */\nexport default class WebGlkOte extends GlkOte.GlkOteBase implements GlkOte.GlkOte {\n    dom: DOM = new DOM({\n        context_element: undefined,\n        errorcontent_id: 'errorcontent',\n        errorpane_id: 'errorpane',\n        gameport_id: 'gameport',\n        loadingpane_id: 'loadingpane',\n        prefix: '',\n        windowport_id: 'windowport',\n    })\n    private metrics_calculator: Metrics\n    private showing_error = false\n    private showing_loading = true\n    private transcript_recorder?: TranscriptRecorder\n    private windows: Windows\n\n    constructor() {\n        super()\n\n        this.metrics_calculator = new Metrics(this)\n        this.windows = new Windows(this)\n    }\n\n    async init(options: GlkOte.GlkOteOptions) {\n        try {\n            if (!options) {\n                throw new Error('no options provided')\n            }\n\n            if (typeof jQuery === 'undefined') {\n                throw new Error('jQuery is not loaded')\n            }\n\n            // Set DOM IDs\n            if (options.dom_prefix) {\n                this.dom.prefix = options.dom_prefix\n            }\n            if (options.errorcontent) {\n                this.dom.errorcontent_id = options.errorcontent\n            }\n            if (options.errorpane) {\n                this.dom.errorpane_id = options.errorpane\n            }\n            if (options.gameport) {\n                this.dom.gameport_id = options.gameport\n            }\n            if (options.loadingpane) {\n                this.dom.loadingpane_id = options.loadingpane\n            }\n            if (options.windowport) {\n                this.dom.windowport_id = options.windowport\n            }\n\n            if (options.Blorb) {\n                this.windows.blorb = options.Blorb\n            }\n\n            // The windport is required to already exist\n            const windowport = this.dom.windowport()\n            if (!windowport.length) {\n                throw new Error(`Cannot find windowport element #${this.dom.windowport_id}`)\n            }\n            windowport.empty()\n\n            $(document).on('scroll', this.on_document_scroll)\n\n            // Prevent iOS from zooming in when focusing input, but allow Android to still pinch zoom\n            // As they handle the maximum-scale viewport meta option differently, we will conditionally add it only in iOS\n            // Idea from https://stackoverflow.com/a/62750441/2854284\n            if (/iPhone OS/i.test(navigator.userAgent)) {\n                (document.head.querySelector('meta[name=\"viewport\"]')! as HTMLMetaElement).content = 'width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1'\n            }\n\n            await this.metrics_calculator.measure()\n\n            // Set up transcript recording\n            if (options.recording_url || options.recording_handler) {\n                if (options.recording_format && options.recording_format !== 'simple') {\n                    console.warn('GlkOte: only the \"simple\" recording_format is supported')\n                }\n                else {\n                    // Check if the user has opted out\n                    const query_feedback = (new URLSearchParams(document.location.search)).get('feedback')\n                    const cookie_name = options.recording_cookie || 'transcript_recording_opt_out'\n                    if ((query_feedback && query_feedback !== '1') || document.cookie.includes(`${cookie_name}=1`)) {\n                        console.log('User has opted out of transcript recording.')\n                    }\n                    else {\n                        this.transcript_recorder = new TranscriptRecorder(options, this.windows)\n                    }\n                }\n            }\n\n            // Note that this must be called last as it will result in VM.start() being called\n            return super.init(options)\n        }\n        catch (err) {\n            this.error(err as Error)\n        }\n    }\n\n    protected autorestore(data: AutosaveState) {\n        // erkyrath/glkote history is an object rather than an array\n        if (Array.isArray(data.history)) {\n            this.windows.history = data.history\n        }\n\n        for (const win of this.windows.values()) {\n            // Scroll all buffer windows\n            if (win.type === 'buffer') {\n                win.frameel.scrollTop(win.innerel.height()!)\n            }\n        }\n\n        if (data.graphics_bg) {\n            for (const [winid, colour] of data.graphics_bg) {\n                (this.windows.get(winid) as GraphicsWindow).fillcolour = colour\n            }\n        }\n\n        if (data.metrics && (data.metrics.height !== this.current_metrics.height || data.metrics.width !== this.current_metrics.width)) {\n            // Force a resize event\n            this.current_metrics.width += 2\n            this.metrics_calculator.on_gameport_resize()\n        }\n\n        if (data.transcript_recorder_session && this.transcript_recorder) {\n            this.transcript_recorder.session = data.transcript_recorder_session\n            console.log(`Resuming autosaved transcript recording session: ${data.transcript_recorder_session}`)\n        }\n    }\n\n    protected cancel_inputs(windows: protocol.InputUpdate[]) {\n        this.windows.cancel_inputs(windows)\n    }\n\n    protected capabilities(): string[] {\n        return [\n            'garglktext',\n            'graphics',\n            'graphicswin',\n            'hyperlinks',\n            'timer',\n        ]\n    }\n\n    protected disable(disable: boolean) {\n        for (const win of this.windows.values()) {\n            win.textinput.el.prop('disabled', disable || !win.inputs?.type)\n        }\n        this.disabled = disable\n    }\n\n    private embellish_error() {\n        if (typeof $ === 'undefined') {\n            return\n        }\n\n        const errorpane = $(`#${this.dom.errorpane_id}`)\n\n        // Add close button\n        if (!errorpane.find('#errorclose').length) {\n            $('<button>', {\n                'aria-label': 'Close',\n                click: () => {\n                    errorpane.hide()\n                },\n                id: 'errorclose',\n                text: '\u2716',\n                type: 'button',\n            })\n                .appendTo(errorpane)\n        }\n\n        // If autorestoring, add a link to restart after clearing the autosave\n        if (this.autorestoring && this.Dialog?.autosave_clear) {\n            const link = $('<a>', {\n                click: async () => {\n                    await this.Dialog!.autosave_clear!()\n                    location.reload()\n                },\n                text: 'Clear autosave and restart',\n            })\n            $('<div>')\n                .append(link)\n                .appendTo(errorpane)\n        }\n    }\n\n    error(error: Error | string) {\n        error ??= '???'\n        let msg: string\n        if (typeof error === 'string') {\n            msg = error\n            error = new Error(error)\n        }\n        else {\n            msg = error.toString()\n        }\n\n        // Don't use jQuery, because this is called if jQuery isn't present\n        const errorcontent = document.getElementById(this.dom.errorcontent_id)\n        if (!errorcontent) {\n            throw new Error(msg)\n        }\n        errorcontent.innerHTML = msg\n\n        const errorpane = document.getElementById(this.dom.errorpane_id)!\n        if (errorpane.className === 'WarningPane') {\n            errorpane.className = ''\n        }\n\n        this.embellish_error()\n\n        errorpane.style.display = ''\n        this.showing_error = true\n        this.hide_loading()\n        console.error(error)\n    }\n\n    protected exit() {\n        // Try to clean up and remove any event handlers\n        this.metrics_calculator.destroy()\n        this.windows.destroy()\n    }\n\n    getdomcontext(): HTMLElement | undefined {\n        return this.dom.context_element\n    }\n\n    getdomid(name: string): string {\n        switch (name) {\n            case 'errorcontent': return this.dom.errorcontent_id\n            case 'errorpane': return this.dom.errorpane_id\n            case 'gameport': return this.dom.gameport_id\n            case 'loadingpane': return this.dom.loadingpane_id\n            case 'windowport': return this.dom.windowport_id\n            default: return name\n        }\n    }\n\n    private hide_loading() {\n        if (!this.showing_loading) {\n            return\n        }\n        this.showing_loading = false\n\n        // Don't use jQuery because this could be called from error()\n        const loadingpane = document.getElementById(this.dom.loadingpane_id)\n        if (loadingpane) {\n            loadingpane.style.display = 'none'\n        }\n    }\n\n    // iOS devices can scroll the window even though body/#gameport are set to height 100%\n    // Scroll back to the top if they try\n    on_document_scroll = throttle(async () => {\n        window.scrollTo(0, 0)\n    }, 500, {leading: false})\n\n    save_allstate(): AutosaveState {\n        const graphics_bg: Array<[number, string]> = []\n        for (const win of this.windows.values()) {\n            if (win.type === 'graphics') {\n                graphics_bg.push([win.id, win.fillcolour])\n            }\n        }\n\n        return {\n            graphics_bg,\n            history: this.windows.history,\n            metrics: {\n                height: this.current_metrics.height,\n                width: this.current_metrics.width,\n            },\n            transcript_recorder_session: this.transcript_recorder?.session,\n        }\n    }\n\n    // Send partial line input values\n    send_event(ev: Partial<protocol.Event>) {\n        if (ev.type !== 'init' && ev.type !== 'refresh' && ev.type !== 'specialresponse') {\n            for (const win of this.windows.values()) {\n                if (win.inputs?.type) {\n                    const val = win.textinput.el.val() as string\n                    if (val) {\n                        if (!ev.partial) {\n                            ev.partial = {}\n                        }\n                        ev.partial[win.id] = val\n                    }\n                }\n            }\n        }\n        if (this.transcript_recorder?.enabled) {\n            this.transcript_recorder.record_event(ev)\n        }\n        super.send_event(ev)\n    }\n\n    setdomcontext(val: HTMLElement) {\n        this.dom.context_element = val\n    }\n\n    protected set_page_bg(colour: string) {\n        $('body').css('background-color', colour)\n    }\n\n    update(data: protocol.Update) {\n        if (this.showing_loading) {\n            this.hide_loading()\n        }\n        super.update(data)\n        if (this.transcript_recorder?.enabled && data.type === 'update' && !data.autorestore) {\n            this.transcript_recorder.record_update(data)\n        }\n    }\n\n    protected update_content(content: protocol.ContentUpdate[]) {\n        this.windows.update_content(content)\n    }\n\n    protected update_inputs(windows: protocol.InputUpdate[]) {\n        this.windows.update_inputs(windows)\n    }\n\n    protected update_windows(windows: protocol.WindowUpdate[]) {\n        this.windows.update(windows)\n    }\n\n    warning(msg: any) {\n        // Don't show warnings if an error is already being shown\n        if (this.showing_error) {\n            return\n        }\n\n        const errorpane = $(`#${this.dom.errorpane_id}`)\n\n        // Hide a warning\n        if (!msg) {\n            errorpane.hide()\n            return\n        }\n\n        const errorcontent = document.getElementById(this.dom.errorcontent_id)\n        if (!errorcontent) {\n            console.warn(msg)\n            return\n        }\n        errorcontent.innerHTML = msg\n\n        this.embellish_error()\n\n        errorpane.addClass('WarningPane')\n        errorpane.show()\n        this.hide_loading()\n    }\n}", "/**\r\n  Base32768 is a binary-to-text encoding optimised for UTF-16-encoded text.\r\n  (e.g. Windows, Java, JavaScript)\r\n*/\r\n\r\n// Z is a number, usually a uint15 but sometimes a uint7\r\n\r\nconst BITS_PER_CHAR = 15 // Base32768 is a 15-bit encoding\r\nconst BITS_PER_BYTE = 8\r\n\r\nconst pairStrings = [\r\n  '\u04A0\u04BF\u0500\u051F\u0680\u06BF\u0760\u079F\u07C0\u07DF\u1000\u101F\u10A0\u10BF\u1100\u115F\u1180\u119F\u11E0\u123F\u1260\u127F\u12E0\u12FF\u1320\u133F\u13A0\u13DF\u1420\u165F\u16A0\u16DF\u1780\u179F\u1820\u185F\u18C0\u18DF\u1980\u199F\u19E0\u19FF\u1A20\u1A3F\u1BC0\u1BDF\u1C00\u1C1F\u1D00\u1D1F\u21E0\u21FF\u22C0\u22DF\u2340\u23DF\u2400\u241F\u2500\u275F\u2780\u27BF\u2800\u297F\u29A0\u29BF\u2A20\u2A5F\u2A80\u2ABF\u2AE0\u2B5F\u2C00\u2C1F\u2C80\u2CDF\u2D00\u2D1F\u2D40\u2D5F\u2EA0\u2EDF\u31C0\u31DF\u3400\u4D9F\u4DC0\u9FBF\uA000\uA47F\uA4A0\uA4BF\uA500\uA5FF\uA640\uA65F\uA6A0\uA6DF\uA700\uA75F\uA780\uA79F\uA840\uA85F',\r\n  '\u0180\u019F\u0240\u029F'\r\n]\r\n\r\nconst lookupE = {}\r\nconst lookupD = {}\r\npairStrings.forEach((pairString, r) => {\r\n  // Decompression\r\n  const encodeRepertoire = []\r\n  pairString.match(/../gu).forEach(pair => {\r\n    const first = pair.codePointAt(0)\r\n    const last = pair.codePointAt(1)\r\n    for (let codePoint = first; codePoint <= last; codePoint++) {\r\n      encodeRepertoire.push(String.fromCodePoint(codePoint))\r\n    }\r\n  })\r\n\r\n  const numZBits = BITS_PER_CHAR - BITS_PER_BYTE * r // 0 -> 15, 1 -> 7\r\n  lookupE[numZBits] = encodeRepertoire\r\n  encodeRepertoire.forEach((chr, z) => {\r\n    lookupD[chr] = [numZBits, z]\r\n  })\r\n})\r\n\r\nconst encode = uint8Array => {\r\n  const length = uint8Array.length\r\n\r\n  let str = ''\r\n  let z = 0\r\n  let numZBits = 0\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    const uint8 = uint8Array[i]\r\n\r\n    // Take most significant bit first\r\n    for (let j = BITS_PER_BYTE - 1; j >= 0; j--) {\r\n      const bit = (uint8 >> j) & 1\r\n\r\n      z = (z << 1) + bit\r\n      numZBits++\r\n\r\n      if (numZBits === BITS_PER_CHAR) {\r\n        str += lookupE[numZBits][z]\r\n        z = 0\r\n        numZBits = 0\r\n      }\r\n    }\r\n  }\r\n\r\n  if (numZBits !== 0) {\r\n    // Final bits require special treatment.\r\n\r\n    // z = bbbbbbcccccccc, numZBits = 14, padBits = 1\r\n    // z = bbbbbcccccccc, numZBits = 13, padBits = 2\r\n    // z = bbbbcccccccc, numZBits = 12, padBits = 3\r\n    // z = bbbcccccccc, numZBits = 11, padBits = 4\r\n    // z = bbcccccccc, numZBits = 10, padBits = 5\r\n    // z = bcccccccc, numZBits = 9, padBits = 6\r\n    // z = cccccccc, numZBits = 8, padBits = 7\r\n    // => Pad `z` out to 15 bits using 1s, then encode as normal (r = 0)\r\n\r\n    // z = ccccccc, numZBits = 7, padBits = 0\r\n    // z = cccccc, numZBits = 6, padBits = 1\r\n    // z = ccccc, numZBits = 5, padBits = 2\r\n    // z = cccc, numZBits = 4, padBits = 3\r\n    // z = ccc, numZBits = 3, padBits = 4\r\n    // z = cc, numZBits = 2, padBits = 5\r\n    // z = c, numZBits = 1, padBits = 6\r\n    // => Pad `z` out to 7 bits using 1s, then encode specially (r = 1)\r\n\r\n    while (!(numZBits in lookupE)) {\r\n      z = (z << 1) + 1\r\n      numZBits++\r\n    }\r\n\r\n    str += lookupE[numZBits][z]\r\n  }\r\n\r\n  return str\r\n}\r\n\r\nconst decode = str => {\r\n  const length = str.length\r\n\r\n  // This length is a guess. There's a chance we allocate one more byte here\r\n  // than we actually need. But we can count and slice it off later\r\n  const uint8Array = new Uint8Array(Math.floor(length * BITS_PER_CHAR / BITS_PER_BYTE))\r\n  let numUint8s = 0\r\n  let uint8 = 0\r\n  let numUint8Bits = 0\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    const chr = str.charAt(i)\r\n\r\n    if (!(chr in lookupD)) {\r\n      throw new Error(`Unrecognised Base32768 character: ${chr}`)\r\n    }\r\n\r\n    const [numZBits, z] = lookupD[chr]\r\n\r\n    if (numZBits !== BITS_PER_CHAR && i !== length - 1) {\r\n      throw new Error('Secondary character found before end of input at position ' + String(i))\r\n    }\r\n\r\n    // Take most significant bit first\r\n    for (let j = numZBits - 1; j >= 0; j--) {\r\n      const bit = (z >> j) & 1\r\n\r\n      uint8 = (uint8 << 1) + bit\r\n      numUint8Bits++\r\n\r\n      if (numUint8Bits === BITS_PER_BYTE) {\r\n        uint8Array[numUint8s] = uint8\r\n        numUint8s++\r\n        uint8 = 0\r\n        numUint8Bits = 0\r\n      }\r\n    }\r\n  }\r\n\r\n  // Final padding bits! Requires special consideration!\r\n  // Remember how we always pad with 1s?\r\n  // Note: there could be 0 such bits, check still works though\r\n  if (uint8 !== ((1 << numUint8Bits) - 1)) {\r\n    throw new Error('Padding mismatch')\r\n  }\r\n\r\n  return new Uint8Array(uint8Array.buffer, 0, numUint8s)\r\n}\r\n\r\nexport { encode, decode }\r\n", "/* Dialog -- a Javascript load/save library for IF interfaces\n * Designed by Andrew Plotkin <erkyrath@eblong.com>\n * <http://eblong.com/zarf/glk/glkote.html>\n * \n * This Javascript library is copyright 2010-20 by Andrew Plotkin.\n * It is distributed under the MIT license; see the \"LICENSE\" file.\n *\n * This library lets you open a modal dialog box to select a \"file\" for saving\n * or loading data. The web page must have a <div> with id \"windowport\" (this\n * will be greyed out during the selection process, with the dialog box as a\n * child of the div). It should also have the dialog.css stylesheet loaded.\n *\n * This library also contains utility routines to manage \"files\", which are\n * actually entries in the browser's localStorage object.\n *\n * If you are in the Electron.io environment, you want to include electrofs.js\n * instead of this module. To distinguish this from electrofs.js, look at\n * Dialog.streaming, which will be true for electrofs.js and false for\n * dialog.js.\n *\n * The primary function to call:\n *\n * Dialog.open(tosave, usage, gameid, callback) -- open a file-choosing dialog\n *\n * The rest of the API concerns file reference objects. A fileref encodes a\n * usage and gameid (as above), along with a filename (which can be any string\n * at all). This trio specifies a \"file\", that is, a chunk of data in browser\n * local storage.\n *\n * (These fileref objects are not the same as the filerefs used in the Glk API.\n * A Glk fileref contains one of these filerefs, however.)\n *\n * Dialog.file_clean_fixed_name(filename, usage) -- clean up a filename\n * Dialog.file_construct_ref(filename, usage, gameid) -- create a fileref\n * Dialog.file_construct_temp_ref(usage) -- create a temporary fileref\n * Dialog.file_write(ref, content, israw) -- write data to the file\n * Dialog.file_read(ref, israw) -- read data from the file\n * Dialog.file_ref_exists(ref) -- returns whether the file exists\n * Dialog.file_remove_ref(ref) -- delete the file, if it exists\n *\n *\n * The localStorage format is as follows. Each file is represented as two\n * storage keys: \"dirent:usage:gameid:filename\" and\n * \"content:usage:gameid:filename\". (The filename is last so that it can\n * validly contain colons. Since this is a user-entered string, it can contain\n * *any* typeable character.)\n *\n * The \"content:\" key contains the file content, as a string. (The HTML5\n * browser storage spec says that you can store any serializable data, but the\n * browsers have not yet implemented this. Thus the \"israw\" option in the read\n * and write functions.)\n *\n * The \"dirent:\" key contains directory information. Currently this looks like\n * \"created:TIMESTAMP,modified:TIMESTAMP\". Future version of this library may\n * add a human-readable game name, a text/binary flag, or other data.\n */\n\n//### accept \"return\" keystroke for load-select box (already works in Chrome)\n\nimport {decode as base32768_decode, encode as base32768_encode} from 'base32768'\n\nconst utf_decoder = new TextDecoder()\nconst utf_encoder = new TextEncoder()\n\nfunction String_to_Uint8Array(str) {\n    return Uint8Array.from(str, ch => ch.charCodeAt(0))\n}\n\n/* Put everything inside the Dialog namespace. */\n\nvar Dialog = function() {\n\nvar dialog_el_id = 'dialog';\n\nvar is_open = false;\nvar dialog_callback = null;\nvar will_save; /* is this a save dialog? */\nvar confirming; /* are we in a \"confirm\" sub-dialog? */\nvar editing; /* have we flipped to \"edit\" mode? */\nvar editing_dirent; /* null for the edit selection screen, or a dirent to\n                       display */\nvar cur_usage; /* a string representing the file's category */\nvar cur_usage_name; /* the file's category as a human-readable string */\nvar cur_gameid; /* a string representing the game */\nvar cur_filelist; /* the files currently on display */\n\n// Handle updating the `dialog_storage_version`\nfunction dialog_init() {\n    const version = parseInt(localStorage.getItem('dialog_storage_version'), 10)\n    if (version > 1) {\n        throw new Error('dialog_storage_version is newer than this library supports')\n    }\n    if (!version) {\n        console.log('Dialog: updating storage version')\n        for (const [key, value] of Object.entries(localStorage)) {\n            if (key.startsWith('content:')) {\n                if (value !== '') {\n                    localStorage.setItem(key, base32768_encode(/\\[[,\\d]*\\]/.test(value) ? JSON.parse(value) : String_to_Uint8Array(value)))\n                }\n            }\n            if (key.startsWith('autosave:')) {\n                localStorage.removeItem(key)\n                const data = JSON.parse(value)\n                if (data.ram) {\n                    localStorage.setItem(key + '.ram', base32768_encode(data.ram))\n                    delete data.ram\n                }\n                localStorage.setItem(key, base32768_encode(utf_encoder.encode(JSON.stringify(data))))\n                localStorage.setItem(key + '.meta', base32768_encode(utf_encoder.encode(JSON.stringify({modified: Date.now()}))))\n            }\n        }\n        localStorage.setItem('dialog_storage_version', '1')\n    }\n}\n\n/* Dialog.open(tosave, usage, gameid, callback) -- open a file-choosing dialog\n *\n * The \"tosave\" flag should be true for a save dialog, false for a load\n * dialog.\n *\n * The \"usage\" and \"gameid\" arguments are arbitrary strings which describe the\n * file. These filter the list of files displayed; the dialog will only list\n * files that match the arguments. Pass null to either argument (or both) to\n * skip filtering.\n *\n * The \"callback\" should be a function. This will be called with a fileref\n * argument (see below) when the user selects a file. If the user cancels the\n * selection, the callback will be called with a null argument.\n*/\nfunction dialog_open(tosave, usage, gameid, callback) {\n    if (is_open)\n        throw new Error('Dialog: dialog box is already open.');\n\n    if (!Storage)\n        throw new Error('Dialog: no storage API is available.');\n\n    dialog_callback = callback;\n    will_save = tosave;\n    confirming = false;\n    editing = false;\n    editing_dirent = null;\n    cur_usage = usage;\n    cur_gameid = gameid;\n    cur_usage_name = label_for_usage(cur_usage);\n\n    /* Figure out what the root div is called. The dialog box will be\n       positioned in this div; also, the div will be greyed out by a \n       translucent rectangle. We use the same default as GlkOte: \n       \"windowport\". We also try to interrogate GlkOte to see if that\n       default has been changed. */\n    var root_el_id = 'windowport';\n    var iface = window.Game;\n    if (window.GlkOte) \n        iface = window.GlkOte.getinterface();\n    if (iface && iface.windowport)\n        root_el_id = iface.windowport;\n\n    var rootel = $('#'+root_el_id);\n    if (!rootel.length)\n        throw new Error('Dialog: unable to find root element #' + root_el_id + '.');\n\n    /* Create the grey-out screen. */\n    var screen = $('#'+dialog_el_id+'_screen');\n    if (!screen.length) {\n        screen = $('<div>',\n            { id: dialog_el_id+'_screen' });\n        rootel.append(screen);\n    }\n\n    /* And now, a lot of DOM creation for the dialog box. */\n\n    var frame = $('#'+dialog_el_id+'_frame');\n    if (!frame.length) {\n        frame = $('<div>',\n            { id: dialog_el_id+'_frame' });\n        rootel.append(frame);\n    }\n\n    var dia = $('#'+dialog_el_id);\n    if (dia.length)\n        dia.remove();\n\n    dia = $('<div>', { id: dialog_el_id });\n\n    var form, el, row;\n\n    form = $('<form>');\n    form.on('submit', \n        (will_save ? evhan_accept_save_button : evhan_accept_load_button));\n    dia.append(form);\n\n    row = $('<div>', { 'class': 'DiaButtonsFloat' });\n    el = $('<button>', { id: dialog_el_id+'_edit', type: 'button' });\n    el.append('Edit');\n    el.on('click', evhan_edit_button);\n    row.append(el);\n    form.append(row);\n\n    row = $('<div>', { id: dialog_el_id+'_cap', 'class': 'DiaCaption' });\n    row.append('XXX'); // the caption will be replaced momentarily.\n    form.append(row);\n\n    if (will_save) {\n        row = $('<div>', { id: dialog_el_id+'_input', 'class': 'DiaInput' });\n        form.append(row);\n        el = $('<input>', { id: dialog_el_id+'_infield', type: 'text', name: 'filename' });\n        row.append(el);\n\n        /* This was spurred by the Safari seven-day expiration policy (March 2020), but the general fragility of local storage has been a bother for years. */\n        row = $('<div>', { id: dialog_el_id+'_warning', 'class': 'DiaWarning' });\n        row.text('Warning: data may be erased by clearing cookies or browser privacy policies.');\n        form.append(row);\n    }\n\n    row = $('<div>', { id: dialog_el_id+'_body', 'class': 'DiaBody' });\n    form.append(row);\n\n    row = $('<div>', { id: dialog_el_id+'_cap2', 'class': 'DiaCaption' });\n    row.hide();\n    form.append(row);\n\n    row = $('<div>', { id: dialog_el_id+'_buttonrow', 'class': 'DiaButtons' });\n    {\n        /* Row of buttons */\n        el = $('<button>', { id: dialog_el_id+'_cancel', type: 'button' });\n        el.append('Cancel');\n        el.on('click', evhan_cancel_button);\n        row.append(el);\n\n        el = $('<button>', { id: dialog_el_id+'_delete', type: 'button' });\n        el.append('Delete');\n        el.on('click', evhan_delete_button);\n        el.hide();\n        row.append(el);\n\n        el = $('<button>', { id: dialog_el_id+'_display', type: 'button' });\n        el.append('Display');\n        el.on('click', evhan_display_button);\n        el.hide();\n        row.append(el);\n\n        el = $('<button>', { id: dialog_el_id+'_accept', type: 'submit' });\n        el.append(will_save ? 'Save' : 'Load');\n        el.on('click', \n            (will_save ? evhan_accept_save_button : evhan_accept_load_button));\n        row.append(el);\n    }\n    form.append(row);\n\n    frame.append(dia);\n    is_open = true;\n\n    evhan_storage_changed();\n\n    /* Set the input focus to the input field or the selection box.\n\n       MSIE is weird about when you can call focus(). The element has just been\n       added to the DOM, and MSIE balks at giving it the focus right away. So\n       we defer the call until after the javascript context has yielded control\n       to the browser. \n    */\n    var focusfunc;\n    if (will_save) {\n        focusfunc = function() {\n            var el = $('#'+dialog_el_id+'_infield');\n            if (el.length) \n                el.focus();\n        };\n    }\n    else {\n        focusfunc = function() {\n            var el = $('#'+dialog_el_id+'_select');\n            if (el.length) \n                el.focus();\n        };\n    }\n    defer_func(focusfunc);\n}\n\n/* Close the dialog and remove the grey-out screen.\n*/\nfunction dialog_close() {\n    var dia = $('#'+dialog_el_id);\n    if (dia.length)\n        dia.remove();\n    var frame = $('#'+dialog_el_id+'_frame');\n    if (frame.length)\n        frame.remove();\n    var screen = $('#'+dialog_el_id+'_screen');\n    if (screen.length)\n        screen.remove();\n\n    is_open = false;\n    dialog_callback = null;\n    cur_filelist = null;\n    editing = false;\n    editing_dirent = null;\n}\n\n/* Set the text caption in the dialog. (There are two, actually, above\n   and below the selection box.)\n*/\nfunction set_caption(msg, isupper) {\n    var elid = (isupper ? dialog_el_id+'_cap' : dialog_el_id+'_cap2');\n    var el = $('#'+elid);\n    if (!el.length)\n        return;\n\n    if (!msg) {\n        el.hide();\n    }\n    else {\n        el.text(msg);\n        el.show();\n    }\n}\n\n/* Pick a human-readable label for the usage. This will be displayed in the\n   dialog prompts. (Possibly pluralized, with an \"s\".) \n*/\nfunction label_for_usage(val) {\n    switch (val) {\n    case 'data': \n        return 'data file';\n    case 'save': \n        return 'save file';\n    case 'transcript': \n        return 'transcript';\n    case 'command': \n        return 'command script';\n    default:\n        return 'file';\n    }\n}\n\n/* Decide whether a given file is likely to contain text data. \n   ### really this should rely on a text/binary metadata field.\n*/\nfunction usage_is_textual(val) {\n    return (val == 'transcript' || val == 'command');\n}\n\n/* Run a function (no arguments) \"soon\". */\nfunction defer_func(func)\n{\n  return window.setTimeout(func, 0.01*1000);\n}\n\n/* Event handler: The user has changed which entry in the selection box is\n   highlighted. \n\n   This is used only in save dialogs; the highlighted filename is copied to the\n   input field.\n*/\nfunction evhan_select_change() {\n    if (!is_open)\n        return false;\n    if (confirming)\n        return false;\n\n    //GlkOte.log('### select changed');\n    var selel = $('#'+dialog_el_id+'_select');\n    if (!selel.length)\n        return false;\n    var pos = selel.prop('selectedIndex');\n    if (!cur_filelist || pos < 0 || pos >= cur_filelist.length)\n        return false;\n    var file = cur_filelist[pos];\n    var fel = $('#'+dialog_el_id+'_infield');\n    if (!fel.length)\n        return false;\n    fel.val(file.dirent.filename);\n    return false;\n}\n\n/* Event handler: The user has changed which entry in the selection box is\n   highlighted. (Also called manually, when we enter edit mode.)\n\n   This is only used in edit mode.\n*/\nfunction evhan_select_change_editing() {\n    if (!is_open)\n        return false;\n    if (!editing || editing_dirent)\n        return false;\n\n    var butel = $('#'+dialog_el_id+'_delete');\n    butel.prop('disabled', true);\n    butel = $('#'+dialog_el_id+'_display');\n    butel.prop('disabled', true);\n\n    var selel = $('#'+dialog_el_id+'_select');\n    if (!selel.length)\n        return false;\n    var pos = selel.prop('selectedIndex');\n    if (!cur_filelist || pos < 0 || pos >= cur_filelist.length)\n        return false;\n    var file = cur_filelist[pos];\n    if (!file || !file.dirent || !file_ref_exists(file.dirent))\n        return false;\n\n    butel = $('#'+dialog_el_id+'_delete');\n    butel.prop('disabled', false);\n    butel = $('#'+dialog_el_id+'_display');\n    butel.prop('disabled', false);\n}\n\n/* Event handler: The \"Load\" button.\n*/\nfunction evhan_accept_load_button(ev) {\n    ev.preventDefault();\n    if (!is_open)\n        return false;\n    if (editing)\n        return false;\n\n    //GlkOte.log('### accept load');\n    var selel = $('#'+dialog_el_id+'_select');\n    if (!selel.length)\n        return false;\n    var pos = selel.prop('selectedIndex');\n    if (!cur_filelist || pos < 0 || pos >= cur_filelist.length)\n        return false;\n    var file = cur_filelist[pos];\n    if (!file || !file.dirent || !file_ref_exists(file.dirent))\n        return false;\n\n    var callback = dialog_callback;\n    //GlkOte.log('### selected ' + file.dirent.dirent);\n    dialog_close();\n    if (callback)\n        callback(file.dirent);\n\n    return false;\n}\n\n/* Event handler: The \"Save\" or \"Replace\" button.\n*/\nfunction evhan_accept_save_button(ev) {\n    ev.preventDefault();\n    if (!is_open)\n        return false;\n    if (editing)\n        return false;\n\n    //GlkOte.log('### accept save');\n    var fel = $('#'+dialog_el_id+'_infield');\n    if (!fel.length)\n        return false;\n    var filename = fel.val();\n    filename = jQuery.trim(filename);\n    if (!filename.length)\n        return false;\n    var dirent = file_construct_ref(filename, cur_usage, cur_gameid);\n\n    if (file_ref_exists(dirent) && !confirming) {\n        /* If the file exists, and we are not already in confirm mode, go into\n           confirm mode. Yes, this is logistically messy. We change the button\n           label to \"Replace\"; if the user really meant it, we'll wind up back\n           in this event handler. */\n        confirming = true;\n        set_caption('You already have a ' + cur_usage_name + ' \"' \n            + dirent.filename + '\". Do you want to replace it?', false);\n        fel.prop('disabled', true);\n        var butel = $('#'+dialog_el_id+'_accept');\n        butel.text('Replace');\n        return false;\n    }\n\n    var callback = dialog_callback;\n    //GlkOte.log('### selected ' + dirent.dirent);\n    dialog_close();\n    if (callback)\n        callback(dirent);\n\n    return false;\n}\n\n/* Event handler: The \"Edit\" (or \"Done\") button.\n\n   This toggles edit mode.\n*/\nfunction evhan_edit_button(ev) {\n    ev.preventDefault();\n    if (!is_open)\n        return false;\n\n    if (!editing) {\n        editing = true;\n        editing_dirent = null;\n\n        if (confirming) {\n            /* Cancel the confirmation, first */\n            confirming = false;\n            set_caption(null, false);\n            const fel = $('#'+dialog_el_id+'_infield');\n            fel.prop('disabled', false);\n            const butel = $('#'+dialog_el_id+'_accept');\n            butel.prop('disabled', false);\n            butel.text('Save');\n        }\n\n        const fel = $('#'+dialog_el_id+'_input');\n        if (fel.length) {\n            fel.hide();\n        }\n\n        let butel = $('#'+dialog_el_id+'_edit');\n        butel.text('Done');\n\n        butel = $('#'+dialog_el_id+'_delete');\n        butel.show();\n        butel = $('#'+dialog_el_id+'_display');\n        butel.show();\n        butel = $('#'+dialog_el_id+'_accept');\n        butel.hide();\n\n        evhan_storage_changed();\n        return false;\n    }\n    else if (!editing_dirent) {\n        editing = false;\n        editing_dirent = null;\n\n        const fel = $('#'+dialog_el_id+'_input');\n        if (fel.length) {\n            fel.show();\n        }\n\n        let butel = $('#'+dialog_el_id+'_edit');\n        butel.text('Edit');\n\n        butel = $('#'+dialog_el_id+'_delete');\n        butel.hide();\n        butel = $('#'+dialog_el_id+'_display');\n        butel.hide();\n        butel = $('#'+dialog_el_id+'_accept');\n        butel.show();\n\n        evhan_storage_changed();\n        return false;\n    }\n    else {\n        /* Stop displaying a file, return to normal edit mode. */\n        editing = true;\n        editing_dirent = null;\n\n        $('#'+dialog_el_id+'_buttonrow').show();\n\n        const butel = $('#'+dialog_el_id+'_edit');\n        butel.text('Done');\n\n        evhan_storage_changed();\n        return false;\n    }\n}\n\n/* Event handler: The \"Delete\" button (for edit mode).\n*/\nfunction evhan_delete_button(ev) {\n    ev.preventDefault();\n    if (!is_open)\n        return false;\n    if (!editing || editing_dirent)\n        return false;\n\n    //GlkOte.log('### delete');\n    var selel = $('#'+dialog_el_id+'_select');\n    if (!selel.length)\n        return false;\n    var pos = selel.prop('selectedIndex');\n    if (!cur_filelist || pos < 0 || pos >= cur_filelist.length)\n        return false;\n    var file = cur_filelist[pos];\n    if (!file || !file.dirent)\n        return false;\n\n    file_remove_ref(file.dirent);\n    /* Force reload of display */\n    evhan_storage_changed();\n\n    return false;\n}\n\n/* Event handler: The \"Display\" button (for edit mode).\n*/\nfunction evhan_display_button(ev) {\n    ev.preventDefault();\n    if (!is_open)\n        return false;\n    if (!editing || editing_dirent)\n        return false;\n\n    //GlkOte.log('### display');\n    var selel = $('#'+dialog_el_id+'_select');\n    if (!selel.length)\n        return false;\n    var pos = selel.prop('selectedIndex');\n    if (!cur_filelist || pos < 0 || pos >= cur_filelist.length)\n        return false;\n    var file = cur_filelist[pos];\n    if (!file || !file.dirent || !file_ref_exists(file.dirent))\n        return false;\n\n    $('#'+dialog_el_id+'_buttonrow').hide();\n\n    var butel = $('#'+dialog_el_id+'_edit');\n    butel.text('Close');\n\n    editing_dirent = file.dirent;\n    /* Force reload of display */\n    evhan_storage_changed();\n\n    return false;\n}\n\n/* Event handler: The \"Cancel\" button.\n\n   This can mean either cancelling the dialog, or cancelling confirm mode on a\n   \"do you want to replace that?\" query.\n*/\nfunction evhan_cancel_button(ev) {\n    ev.preventDefault();\n    if (!is_open)\n        return false;\n\n    if (confirming) {\n        confirming = false;\n        set_caption(null, false);\n        var fel = $('#'+dialog_el_id+'_infield');\n        fel.prop('disabled', false);\n        var butel = $('#'+dialog_el_id+'_accept');\n        butel.prop('disabled', false);\n        butel.text('Save');\n        return false;\n    }\n\n    var callback = dialog_callback;\n    //GlkOte.log('### cancel');\n    dialog_close();\n    if (callback)\n        callback(null);\n\n    return false;\n}\n\n/* Event handler: Browser local storage has been updated. When this happens, we\n   re-check the list of files, because a new one might have been added from\n   another browser window.\n\n   This function is called manually when the dialog box is created,\n   to set up the list of files in the first place. We also call it manually\n   when switching in and out of edit mode -- it's the easiest way to redraw\n   everything.\n*/\nfunction evhan_storage_changed(/*ev*/) {\n    if (!is_open)\n        return false;\n\n    var butel, el;\n\n    //var changedkey = null;\n    //if (ev)\n    //    changedkey = ev.key;\n    //GlkOte.log('### noticed storage: key ' + changedkey);\n    /* We could use the changedkey to decide whether it's worth redrawing \n       the field here. */\n\n    const bodyel = $('#'+dialog_el_id+'_body');\n    if (!bodyel.length)\n        return false;\n\n    if (editing && editing_dirent) {\n        /* If the file was deleted out from under us, return to the editing\n           display. */\n        if (!file_ref_exists(editing_dirent)) {\n            editing_dirent = null;\n            $('#'+dialog_el_id+'_buttonrow').show();\n            butel = $('#'+dialog_el_id+'_edit');\n            butel.text('Done');\n        }\n    }\n\n    /* There are several editing modes, which means several things we might\n       display here. */\n\n    if (editing && editing_dirent) {\n        /* We want to display the selected file's contents. */\n        bodyel.empty();\n\n        /* ### Make the unjustified assumption that this is an array of\n           character values (as ints). */\n        let dat = file_read(editing_dirent);\n        /* ### This doesn't correctly handle Unicode characters outside the\n           16-bit range. */\n        dat = String.fromCharCode.apply(this, dat);\n          \n        //### use binary flag?\n        if (usage_is_textual(editing_dirent.usage)) {\n          var textel = $('<pre>', { 'class': 'DiaDisplayText' });\n          textel.text(dat);\n          bodyel.append(textel);\n          set_caption('Displaying file contents...', true);\n        }\n        else {\n          var b64dat = window.btoa(dat);\n          /*### the download link should really be the filename, escaped\n            for attribute safety, with the proper file suffix attached. */\n          var linkel = $('<a>', { 'href': 'data:application/octet-stream;base64,'+b64dat, 'target': '_blank', 'download': 'data' });\n          linkel.text(editing_dirent.filename);\n          bodyel.append(linkel);\n          set_caption('Use \"Save As\" option in your browser to download this link.', true);\n        }\n\n        return false;\n    }\n\n    if (editing) {\n        /* We want to display both game-specific files and general ones (but\n           not files specific to other games, i.e., save files for different\n           games). \n        */\n        let ls = files_list(null, cur_gameid);\n        if (cur_gameid != '') {\n            ls = ls.concat(files_list(null, ''));\n        }\n        /* Sort by usage, then date modified */\n        ls.sort(function(f1, f2) {\n                if (f1.dirent.usage < f2.dirent.usage) \n                    return -1;\n                else if (f1.dirent.usage > f2.dirent.usage) \n                    return 1;\n                return f2.modified.getTime() - f1.modified.getTime(); \n            });\n\n        if (ls.length == 0) {\n            bodyel.empty();\n            butel = $('#'+dialog_el_id+'_delete');\n            butel.prop('disabled', true);\n            butel = $('#'+dialog_el_id+'_display');\n            butel.prop('disabled', true);\n            set_caption('You have no stored files. Press Done to continue.', true);\n            return false;\n        }\n\n        cur_filelist = [];\n        let lastusage = '';\n        for (let ix=0; ix<ls.length; ix++) {\n            const file = ls[ix];\n            if (file.dirent.usage != lastusage) {\n                lastusage = file.dirent.usage;\n                cur_filelist.push({ label:lastusage });\n            }\n            cur_filelist.push(file);\n        }\n        ls = cur_filelist;\n\n        bodyel.empty();\n        \n        const selel = $('<select>', { id: dialog_el_id+'_select', name:'files' });\n        selel.prop('size', '5'); /* firefox doesn't like this being set in the constructor */\n        let anyselected = false;\n        for (let ix=0; ix<ls.length; ix++) {\n            const file = ls[ix];\n            if (!file.dirent) {\n                el = $('<option>', { name:'f'+ix } );\n                el.prop('disabled', true);\n                el.text('-- ' + label_for_usage(file.label) + 's --');\n                selel.append(el);\n                continue;\n            }\n\n            el = $('<option>', { name:'f'+ix } );\n            if (!anyselected) {\n                anyselected = true;\n                el.selected = true;\n            }\n            const datestr = format_date(file.modified);\n            el.text(file.dirent.filename + ' -- ' + datestr);\n            selel.append(el);\n        }\n        bodyel.append(selel);\n\n        selel.on('change', evhan_select_change_editing);\n        evhan_select_change_editing();\n\n        set_caption('All stored files are now visible. You may delete them, and display files containing text. Press Done when finished.', true);\n        return false;\n    }\n\n    /* Basic display mode: the list of available files, plus an input field\n       if this is for saving. */\n\n    const ls = files_list(cur_usage, cur_gameid);\n    /* Sort by date modified */\n    ls.sort(function(f1, f2) { return f2.modified.getTime() - f1.modified.getTime(); });\n    cur_filelist = ls;\n\n    /* Adjust the contents of the selection box. */\n    \n    if (ls.length == 0) {\n        bodyel.empty();\n    }\n    else {\n        bodyel.empty();\n        \n        const selel = $('<select>', { id: dialog_el_id+'_select', name:'files' });\n        selel.prop('size', '5'); /* firefox doesn't like this being set in the constructor */\n        let file, datestr;\n        for (let ix=0; ix<ls.length; ix++) {\n            file = ls[ix];\n            el = $('<option>', { name:'f'+ix } );\n            if (ix == 0)\n                el.selected = true;\n            datestr = format_date(file.modified);\n            el.text(file.dirent.filename + ' -- ' + datestr);\n            selel.append(el);\n        }\n        bodyel.append(selel);\n\n        if (will_save)\n            selel.on('change', evhan_select_change);\n    }\n\n    if (will_save) {\n        set_caption('Name this ' + cur_usage_name + '.', true);\n        el = $('#'+dialog_el_id+'_accept');\n        el.prop('disabled', false);\n    }\n    else {\n        if (ls.length == 0) {\n            set_caption('You have no ' + cur_usage_name + 's for this game.', true);\n            el = $('#'+dialog_el_id+'_accept');\n            el.prop('disabled', true);\n        }\n        else {\n            set_caption('Select a ' + cur_usage_name + ' to load.', true);\n            el = $('#'+dialog_el_id+'_accept');\n            el.prop('disabled', false);\n        }\n    }\n}\n\n/* Dialog.file_clean_fixed_name(filename, usage) -- clean up a filename\n *\n * Take an arbitrary string and convert it into a filename that can\n * validly be stored in the user's directory. This is called for filenames\n * that come from the game file, but not for filenames selected directly\n * by the user (i.e. from a file selection dialog).\n *\n * Because we store everything in browser local storage, we have no\n * filename restrictions.\n */\nfunction file_clean_fixed_name(filename /*, usage*/) {\n    return filename;\n}\n\n/* Dialog.file_construct_ref(filename, usage, gameid) -- create a fileref\n *\n * Create a fileref. This does not create a file; it's just a thing you can use\n * to read an existing file or create a new one. Any unspecified arguments are\n * assumed to be the empty string.\n */\nfunction file_construct_ref(filename, usage, gameid) {\n    if (!filename)\n        filename = '';\n    if (!usage)\n        usage = '';\n    if (!gameid)\n        gameid = '';\n    var key = usage + ':' + gameid + ':' + filename;\n    var ref = { dirent: 'dirent:'+key, content: 'content:'+key,\n                filename: filename, usage: usage, gameid: gameid };\n    return ref;\n}\n\n/* Dialog.file_construct_temp_ref(usage)\n *\n * Create a fileref in a temporary directory. Every time this is called\n * it should create a completely new fileref.\n */\nfunction file_construct_temp_ref(usage) {\n    var timestamp = new Date().getTime();\n    var filename = \"_temp_\" + timestamp + \"_\" + Math.random();\n    filename = filename.replace('.', '');\n    return file_construct_ref(filename, usage);\n}\n\n/* Create a fileref from a browser storage key (string). If the key does not\n   begin with \"dirent:\" (ie, this key does not represent a directory entry),\n   this returns null.\n*/\nfunction file_decode_ref(dirkey) {\n    if (dirkey.slice(0,7) != 'dirent:')\n        return null;\n\n    var oldpos = 7;\n    var pos = dirkey.indexOf(':', oldpos);\n    if (pos < 0)\n        return null;\n    var usage = dirkey.slice(oldpos, pos);\n    oldpos = pos+1;\n    \n    pos = dirkey.indexOf(':', oldpos);\n    if (pos < 0)\n        return null;\n    var gameid = dirkey.slice(oldpos, pos);\n    oldpos = pos+1;\n\n    var filename = dirkey.slice(oldpos);\n    var conkey = 'cont'+dirkey.slice(3);\n\n    var ref = { dirent: dirkey, content: conkey, \n                filename: filename, usage: usage, gameid: gameid };\n    return ref;\n}\n\n/* Load directory entry information for a fileref (or key denoting a fileref).\n\n   The dirent information includes when the file was created, and when it was\n   last modified. It does not include the file content.\n*/\nfunction file_load_dirent(dirent) {\n    if (typeof(dirent) != 'object') {\n        dirent = file_decode_ref(dirent);\n        if (!dirent)\n            return null;\n    }\n\n    var statstring = Storage.getItem(dirent.dirent);\n    if (!statstring)\n        return null;\n\n    var file = { dirent: dirent };\n\n    var ix, pos, key, val;\n\n    var ls = statstring.toString().split(',');\n    for (ix=0; ix<ls.length; ix++) {\n        val = ls[ix];\n        pos = val.indexOf(':');\n        if (pos < 0)\n            continue;\n        key = val.slice(0, pos);\n        val = val.slice(pos+1);\n\n        switch (key) {\n        case 'created':\n            file.created = new Date(Number(val));\n            break;\n        case 'modified':\n            file.modified = new Date(Number(val));\n            break;\n        }\n    }\n\n    //### binary\n    //### game name?\n\n    return file;\n}\n\n/* Dialog.file_ref_exists(ref) -- returns whether the file exists\n */\nfunction file_ref_exists(ref) {\n    var statstring = Storage.getItem(ref.dirent);\n    if (!statstring)\n        return false;\n    else\n        return true;\n}\n\n/* Dialog.file_remove_ref(ref) -- delete the file, if it exists\n */\nfunction file_remove_ref(ref) {\n    Storage.removeItem(ref.dirent);\n    Storage.removeItem(ref.content);\n}\n\n/* Dialog.file_write(dirent, content, israw) -- write data to the file\n *\n * The \"content\" argument is stored to the file. If \"israw\" is true, the\n * content must be a string. Otherwise, the content is converted to JSON (using\n * JSON.stringify) before being stored.\n *\n * HTML's localStorage mechanism has no incremental storage API; you have to\n * store the entire chunk of data at once. Therefore, the given content\n * replaces the existing contents of the file (if any).\n */\nfunction file_write(dirent, content, israw) {\n    if (israw && content !== '') {\n        throw new Error('Dialog raw mode is no longer supported')\n    }\n\n    var val, ls;\n    var err1, err2;\n\n    var file = file_load_dirent(dirent);\n    if (!file) {\n        /* Newly-created file. */\n        file = { dirent: dirent, created: new Date() };\n    }\n\n    file.modified = new Date();\n\n    content = base32768_encode(content)\n\n    ls = [];\n\n    if (file.created)\n        ls.push('created:' + file.created.getTime());\n    if (file.modified)\n        ls.push('modified:' + file.modified.getTime());\n\n    //### binary\n    //### game name?\n\n    val = ls.join(',');\n    err1 = Storage.setItem(file.dirent.dirent, val);\n    err2 = Storage.setItem(file.dirent.content, content);\n\n    if (err1 || err2)\n        return false;\n\n    return true;\n}\n\n/* Dialog.file_read(dirent, israw) -- read data from the file\n *\n * Read the (entire) content of the file. If \"israw\" is true, this returns the\n * string that was stored. Otherwise, the content is converted from JSON (using\n * JSON.parse) before being returned.\n *\n * As a special case, the empty string is converted to an empty array (when not\n * in israw mode).\n */\nfunction file_read(dirent, israw) {\n    if (israw) {\n        throw new Error('Dialog raw mode is no longer supported')\n    }\n    var file = file_load_dirent(dirent);\n    if (!file)\n        return null;\n\n    var content = Storage.getItem(dirent.content);\n    if (content == null)\n        return null;\n\n    return base32768_decode(content)\n}\n\nfunction file_notimplemented() {\n    throw new Error('streaming function not implemented in Dialog');\n}\n\n/* Check whether a given fileref matches the given usage and gameid strings. If\n   you don't want to check one attribute or the other, pass null for that\n   argument.\n*/\nfunction file_ref_matches(ref, usage, gameid) {\n    if (usage != null) {\n        if (ref.usage != usage)\n            return false;\n    }\n\n    if (gameid != null) {\n        if (ref.gameid != gameid)\n            return false;\n    }\n\n    return true;\n}\n\n/* Return the list of files (actually directory entries) matching the given\n   given usage and gameid strings. If you don't want to check one attribute or\n   the other, pass null for that argument.\n*/\nfunction files_list(usage, gameid) {\n    var ix;\n    var ls = [];\n\n    if (!Storage)\n        return ls;\n\n    var keyls = Storage.getKeys();\n    for (ix=0; ix<keyls.length; ix++) {\n        var key = keyls[ix];\n        if (!key)\n            continue;\n        var dirent = file_decode_ref(key.toString());\n        if (!dirent)\n            continue;\n        if (!file_ref_matches(dirent, usage, gameid))\n            continue;\n        var file = file_load_dirent(dirent);\n        ls.push(file);\n    }\n\n    //GlkOte.log('### files_list found ' + ls.length + ' files.');\n    return ls;\n}\n\n/* Convert a date object to a (short) string.\n*/\nfunction format_date(date) {\n    if (!date)\n        return '???';\n    //### display relative dates?\n    var day = (date.getMonth()+1) + '/' + date.getDate();\n    var time = date.getHours() + ':' + (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();\n    return day + ' ' + time;\n}\n\n/* Store a snapshot (a JSONable object) in a signature-dependent location.\n   If snapshot is null, delete the snapshot instead.\n\n   We rely on JSON.stringify() and JSON.parse(); autosave is primarily\n   for the Electron environment.\n*/\nfunction autosave_write(signature, snapshot) {\n    const key = 'autosave:' + signature\n    const key_meta = key + '.meta'\n    const key_ram = key + '.ram'\n    if (!snapshot) {\n        Storage.removeItem(key)\n        Storage.removeItem(key_meta)\n        Storage.removeItem(key_ram)\n    }\n    else {\n        if (snapshot.ram) {\n            Storage.setItem(key_ram, base32768_encode(snapshot.ram))\n            delete snapshot.ram\n        }\n        Storage.setItem(key, base32768_encode(utf_encoder.encode(JSON.stringify(snapshot))))\n        Storage.setItem(key_meta, base32768_encode(utf_encoder.encode(JSON.stringify({modified: Date.now()}))))\n    }\n}\n\n/* Load a snapshot (a JSONable object) from a signature-dependent location.\n*/\nlet saved_signature\nfunction autosave_read(signature) {\n    saved_signature = signature\n    const key = 'autosave:' + signature\n    const key_ram = key + '.ram'\n    const val = Storage.getItem(key)\n    if (val) {\n        try {\n            const data = JSON.parse(utf_decoder.decode(base32768_decode(val)))\n            const ram = Storage.getItem(key_ram)\n            if (ram) {\n                data.ram = base32768_decode(ram)\n            }\n            return data\n        }\n        catch (_) {\n            return null\n        }\n    }\n    return null\n}\n\nasync function autosave_clear() {\n    if (!saved_signature) {\n        throw new Error('Dialog.autosave_clear must be called after Dialog.autosave_read')\n    }\n    autosave_write(saved_signature, null)\n}\n\n/* Locate the storage object, and set up the storage event handler, at load\n   time (but after all the handlers are defined).\n\n   We wrap the HTML localStorage object in a simplified wrapper (Storage),\n   which supports just four calls: getItem, setItem, removeItem, and getKeys.\n   This lets us catch storage-quota errors, which turns out to be a good\n   idea. It also makes it easier to substitute a different storage back-end.\n*/\n\nvar Storage = null;\ntry {\n    var htmlLocalStorage = null;\n    /* Accessing window.localStorage might throw a security exception. */\n    if (window.localStorage != null) {\n        /* This is the API object for HTML5 browser storage. */\n        htmlLocalStorage = window.localStorage;\n    }\n    else if (window.globalStorage != null) {\n        /* This is a non-standard API used in Firefox 3.0 (but not 3.5). */\n        htmlLocalStorage = window.globalStorage[location.hostname];\n    }\n\n    if (htmlLocalStorage) {\n        /* First, test to make sure we can write at all. (In a private\n           window, localStorage quota may be zero.) */\n        try {\n            htmlLocalStorage.setItem('_dialogtest', 'xyzzy');\n            if (htmlLocalStorage.getItem('_dialogtest') != 'xyzzy')\n                throw new Error('localStorage test did not match');\n            htmlLocalStorage.removeItem('_dialogtest');\n\n            Storage = {\n                getItem: function(key) {\n                    try {\n                        return htmlLocalStorage.getItem(key);\n                    }\n                    catch (ex) {\n                        return null;\n                    }\n                },\n                removeItem: function(key) {\n                    try {\n                        htmlLocalStorage.removeItem(key);\n                    }\n                    catch (ex) {\n                        return null;\n                    }\n                },\n                setItem: function(key, val) {\n                    try {\n                        htmlLocalStorage.setItem(key, val);\n                    }\n                    catch (ex) {\n                        //GlkOte.log('Dialog: localStorage failed! ' + ex);\n                        return true; /* error */\n                    }\n                },\n                getKeys: function() {\n                    var ls = [];\n                    for (var ix=0; ix<htmlLocalStorage.length; ix++)\n                        ls.push(htmlLocalStorage.key(ix));\n                    return ls;\n                }\n            };\n        }\n        catch (ex) {\n            //GlkOte.log('Dialog: localStorage not available: ' + ex);\n            //GlkOte.log('Dialog: falling back to window memory');\n        }\n    }\n}\n/*eslint no-empty: \"off\"*/\ncatch (ex) { }\n\nif (Storage == null) {\n    /* This browser doesn't support storage at all. We'll whip up a\n       simple implementation. It will only last as long as the window\n       does, but that's good enough for a game. */\n    Storage = {\n        data: {},\n        keys: [],\n        getItem: function(key) {\n            return Storage.data[key];\n        },\n        setItem: function(key, val) {\n            if (Storage.keys.indexOf(key) < 0) {\n                Storage.keys.push(key);\n            }\n            Storage.data[key] = val;\n        },\n        removeItem: function(key) {\n            var pos = Storage.keys.indexOf(key);\n            if (pos >= 0) {\n                Storage.keys.splice(pos, 1);\n                delete Storage.data[key];\n            }\n        },\n        getKeys: function() {\n            return Storage.keys.slice(0);\n        }\n    }\n}\n\n$(window).on('storage', evhan_storage_changed);\n\n/* End of Dialog namespace function. Return the object which will\n   become the Dialog global. */\nreturn {\n    streaming: false,\n    init: dialog_init,\n\n    open: dialog_open,\n\n    file_clean_fixed_name: file_clean_fixed_name,\n    file_construct_ref: file_construct_ref,\n    file_construct_temp_ref: file_construct_temp_ref,\n    file_ref_exists: file_ref_exists,\n    file_remove_ref: file_remove_ref,\n    file_write: file_write,\n    file_read: file_read,\n\n    /* stubs for not-implemented functions */\n    file_fopen: file_notimplemented,\n\n    /* support for the autosave hook */\n    autosave_clear,\n    autosave_write: autosave_write,\n    autosave_read: autosave_read\n};\n\n}();\n\nexport default Dialog;\n\n/* End of Dialog library. */\n", "/*\n\nCommon Parchment Options\n========================\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/parchment\n\n*/\n\nimport {Dialog, GlkOte, GlkOteOptions, WebGlkOte} from '../upstream/asyncglk/src/index-browser.js'\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport WebDialog from '../upstream/glkote/dialog.js'\n\ntype ParchmentTruthy = boolean | number\n\nexport interface ParchmentOptions extends Partial<GlkOteOptions> {\n    // Parchment options\n\n    /** Whether or not to automatically launch Parchment */\n    auto_launch?: ParchmentTruthy,\n    /** Story path in the array format traditionally used by Parchment for Inform 7 */\n    default_story?: [string],\n    /** Domains to access directly: should always have both Access-Control-Allow-Origin and compression headers */\n    direct_domains: string[],\n    /** Format ID, matching formats.js */\n    format?: string,\n    /** Path to resources */\n    lib_path: string,\n    /** URL of Proxy */\n    proxy_url: string,\n    /** Whether to load embeded resources in single file mode */\n    single_file?: ParchmentTruthy,\n    /** Story path */\n    story?: string,\n    /** Theme name, can be set to 'dark */\n    theme?: string,\n    /** Name of theme cookie to check */\n    theme_cookie: string,\n    /** Disable the file proxy, which may mean that some files can't be loaded */\n    use_proxy?: ParchmentTruthy,\n\n    // Modules to pass to other modules\n\n    /** Dialog instance to use */\n    Dialog: Dialog,\n    /** GlkOte instance to use */\n    GlkOte: GlkOte,\n\n    // Common options for VMs\n\n    /** Whether or not to load an autosave */\n    do_vm_autosave?: ParchmentTruthy,\n}\n\nexport function get_default_options(): ParchmentOptions {\n    return {\n        auto_launch: 1,\n        Dialog: WebDialog,\n        direct_domains: [\n            'unbox.ifarchive.org',\n        ],\n        do_vm_autosave: 1,\n        GlkOte: new WebGlkOte(),\n        // This only makes sense after the source files are built\n        lib_path: import.meta.url,\n        proxy_url: 'https://iplayif.com/proxy/',\n        set_body_to_page_bg: 1,\n        theme_cookie: 'parchment_theme',\n        use_proxy: 1,\n    }\n}\n\n/** Get options specified in the URL query */\nexport function get_query_options(possible_query_options: Array<keyof ParchmentOptions>): Partial<ParchmentOptions> {\n    const query = new URLSearchParams(document.location.search)\n    const options: Partial<ParchmentOptions> = {}\n    for (const option of possible_query_options) {\n        if (query.has(option)) {\n            options[option] = query.get(option)\n        }\n    }\n    return options\n}\n", "/*\n\nFile loader\n===========\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/parchment\n\n*/\n\nimport {ParchmentOptions} from './options.js'\n\n// Fetch a storyfile, using the proxy if necessary, and handling JSified stories\nexport async function fetch_storyfile(options: ParchmentOptions, url: string) {\n    // Handle a relative URL\n    const story_url = new URL(url, document.URL)\n    const story_domain = story_url.hostname\n    const same_domain = story_domain === document.location.hostname\n    const proxy_url = `${options.proxy_url}?url=${story_url}`\n    let response: Response\n\n    // Only directly access files same origin files or those from the list of reliable domains\n    let direct_access = same_domain || story_url.protocol === 'data:'\n    if (!direct_access) {\n        for (const domain of options.direct_domains) {\n            if (story_domain.endsWith(domain)) {\n                direct_access = true\n                break\n            }\n        }\n    }\n\n    if (direct_access) {\n        try {\n            response = await fetch('' + story_url)\n        }\n        // We can't specifically detect CORS errors but that's probably what happened\n        catch (_) {\n            throw new Error('Failed to fetch storyfile (possible CORS error)')\n        }\n    }\n\n    // Otherwise use the proxy\n    else {\n        if (options.use_proxy) {\n            response = await fetch(proxy_url)\n        }\n        else {\n            throw new Error('Storyfile not in list of direct domains and proxy disabled')\n        }\n    }\n\n    if (!response.ok) {\n        throw new Error(`Could not fetch storyfile, got ${response.status}`)\n    }\n\n    // It would be nice to check here if the file was compressed, but we can only read the Content-Encoding header for same domain files\n\n    // Handle JSified stories\n    if (url.endsWith('.js')) {\n        const text = await response.text()\n        const matched = /processBase64Zcode\\(['\"]([a-zA-Z0-9+/=]+)['\"]\\)/.exec(text)\n        if (!matched) {\n            throw new Error('Abnormal JSified story')\n        }\n\n        // Parse the base64 using a trick from https://stackoverflow.com/a/54123275/2854284\n        response = await fetch(`data:application/octet-binary;base64,${matched[1]}`)\n    }\n\n    const buffer = await response.arrayBuffer()\n    return new Uint8Array(buffer)\n}\n\nexport async function fetch_vm_resource(options: ParchmentOptions, path: string) {\n    // Handle embedded resources in single file mode\n    if (options.single_file) {\n        const data = (document.getElementById(path) as HTMLScriptElement).text\n        if (path.endsWith('.js')) {\n            return import(`data:text/javascript,${encodeURIComponent(data)}`)\n        }\n        if (!path.endsWith('.wasm')) {\n            throw new Error(`Can't load ${path} in single file mode`)\n        }\n        const response = await fetch(`data:application/wasm;base64,${data}`)\n        if (!response.ok) {\n            throw new Error(`Could not fetch ${path}, got ${response.status}`)\n        }\n        return response.arrayBuffer()\n    }\n\n    if (path.endsWith('.js')) {\n        return import(path)\n    }\n\n    // Something else, like a .wasm\n    // Handle when lib_path is a proper URL (such as import.meta.url), as well as the old style path fragment\n    let url\n    try {\n        url = new URL(path, options.lib_path)\n    }\n    catch (_) {\n        url = options.lib_path + path\n    }\n    const response = await fetch(url)\n    if (!response.ok) {\n        throw new Error(`Could not fetch ${path}, got ${response.status}`)\n    }\n    return response.arrayBuffer()\n}\n\n// Read an uploaded file and return it as a Uint8Array\nexport function read_uploaded_file(file: File): Promise<Uint8Array> {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader()\n        reader.onerror = () => reject(reader.error)\n        reader.onload = () => resolve(new Uint8Array(reader.result as ArrayBuffer))\n        reader.readAsArrayBuffer(file)\n    })\n}", "/* GlkAPI -- a Javascript Glk API for IF interfaces\n * GlkOte Library: version 2.2.5.\n * Glk API which this implements: version 0.7.4.\n * Designed by Andrew Plotkin <erkyrath@eblong.com>\n * <http://eblong.com/zarf/glk/glkote.html>\n * \n * This Javascript library is copyright 2010-20 by Andrew Plotkin.\n * It is distributed under the MIT license; see the \"LICENSE\" file.\n *\n * This file is a Glk API compatibility layer for glkote.js. It offers a \n * set of Javascript calls which closely match the original C Glk API;\n * these work by means of glkote.js operations.\n *\n * This API was built for Quixe, which is a pure-Javascript Glulx\n * interpreter. Therefore, the API is a little strange. Notably, it\n * accepts text buffers in the form of arrays of integers, not\n * Javascript strings. Only the Glk calls that explicitly use strings\n * (glk_put_string, etc) accept Javascript native strings.\n *\n * If you are writing an application in pure Javascript, you can use\n * this layer (along with glkote.js). If you are writing a web app which\n * is the front face of a server-side Glk app, ignore this file -- use\n * glkote.js directly.\n */\n\n/* Known problems:\n\n   Some places in the library get confused about Unicode characters\n   beyond 0xFFFF. They are handled correctly by streams, but grid windows\n   will think they occupy two characters rather than one, which will\n   throw off the grid spacing. \n\n   Also, the glk_put_jstring() function can't handle them at all. Quixe\n   printing operations that funnel through glk_put_jstring() -- meaning, \n   most native string printing -- will break up three-byte characters \n   into a UTF-16-encoded pair of two-byte characters. This will come\n   out okay in a buffer window, but it will again mess up grid windows,\n   and will also double the write-count in a stream.\n*/\n\n/* Put everything inside the Glk namespace. */\n\nvar Glk = function() {\n\n/* The VM interface object. */\nvar VM = null;\n\n// References to external libraries\nlet Blorb = null;\nlet Dialog = null;\nlet GiDispa = null;\nlet GlkOte = null;\n\n/* Environment capabilities. (Checked at init time.) */\nconst support = {};\n\n/* Options from the vm_options object. */\nvar option_exit_warning;\nvar option_do_vm_autosave;\nvar option_before_select_hook;\nvar option_extevent_hook;\nvar option_glk_gestalt_hook;\n\n/* Library display state. */\nvar has_exited = false;\nvar ui_disabled = false;\nvar ui_specialinput = null;\nvar ui_specialcallback = null;\nvar event_generation = 0;\nvar current_partial_inputs = null;\nvar current_partial_outputs = null;\n\n/* Initialize the library, initialize the VM, and set it running. (It will \n   run until the first glk_select() or glk_exit() call.)\n\n   The vm_options argument must have a vm_options.vm field, which must be an\n   appropriate VM interface object. (For example, Quixe.) This must have\n   init() and resume() methods.\n\n   The vm_options argument is also passed through to GlkOte as the game\n   interface object. It can be used to affect some GlkOte display options,\n   such as window spacing.\n\n   (You do not need to provide a vm_options.accept() function. The Glk\n   library sets that up for you.)\n*/\nfunction init(vm_options) {\n    if (vm_options.Dialog)\n    {\n        Dialog = vm_options.Dialog;\n    }\n    else\n    {\n        throw new Error('No reference to Dialog');\n    }\n\n    if (vm_options.GiDispa)\n    {\n        GiDispa = vm_options.GiDispa;\n    }\n\n    if (vm_options.Blorb)\n    {\n        Blorb = vm_options.Blorb;\n    }\n\n    if (vm_options.GlkOte)\n    {\n        GlkOte = vm_options.GlkOte;\n    }\n    else\n    {\n        throw new Error('No reference to GlkOte');\n    }\n\n    VM = vm_options.vm;\n    if (GiDispa) {\n        if (GiDispa.set_vm) {\n            GiDispa.set_vm(VM)\n        }\n        else {\n            GiDispa.init({\n                io: this,\n                vm: VM,\n            })\n        }\n    }\n\n    vm_options.accept = accept_ui_event;\n\n    GlkOte.init(vm_options);\n\n    option_exit_warning = vm_options.exit_warning;\n    option_do_vm_autosave = vm_options.do_vm_autosave;\n    option_before_select_hook = vm_options.before_select_hook;\n    option_extevent_hook = vm_options.extevent_hook;\n    option_glk_gestalt_hook = vm_options.glk_gestalt_hook;\n\n    if (option_before_select_hook) {\n        option_before_select_hook();\n    }\n}\n\nfunction accept_ui_event(obj) {\n    var box;\n\n    //qlog(\"### accept_ui_event: \" + obj.type + \", gen \" + obj.gen);\n    if (ui_disabled) {\n        /* We've hit glk_exit() or a VM fatal error, or just blocked the UI for\n           some modal dialog. */\n        qlog(\"### ui is disabled, ignoring event\");\n        return;\n    }\n\n    if (obj.gen != event_generation) {\n      GlkOte.log('Input event had wrong generation number: got ' + obj.gen + ', currently at ' + event_generation);\n      return;\n    }\n    event_generation += 1;\n\n    /* Note any partial inputs; we'll need them if the game cancels a line\n       input. This may be undef. */\n    current_partial_inputs = obj.partial;\n\n    switch (obj.type) {\n    case 'init':\n        content_metrics = obj.metrics;\n        // Process the support array\n        if (obj.support) {\n            obj.support.forEach(item => support[item] = 1);\n        }\n        // New Quixe API (was VM.init())\n        VM.start();\n        break;\n\n    case 'external': {\n        let res = null;\n        if (option_extevent_hook) {\n            res = option_extevent_hook(obj.value);\n        }\n        if (!res && obj.value == 'timer') {\n            /* Timer events no longer come in this way, but we'll still\n               accept them. */\n            gli_timer_started = Date.now();\n            res = { type: Const.evtype_Timer };\n        }\n        if (res && res.type) {\n            handle_external_input(res);\n        }\n        break;\n    }\n\n    case 'timer': {\n        gli_timer_started = Date.now();\n        const res = { type: Const.evtype_Timer };\n        handle_external_input(res);\n        break;\n    }\n\n    case 'hyperlink':\n        handle_hyperlink_input(obj.window, obj.value);\n        break;\n\n    case 'mouse':\n        handle_mouse_input(obj.window, obj.x, obj.y);\n        break;\n\n    case 'char':\n        handle_char_input(obj.window, obj.value);\n        break;\n\n    case 'line':\n        handle_line_input(obj.window, obj.value, obj.terminator);\n        break;\n\n    case 'arrange':\n        content_metrics = obj.metrics;\n        box = {\n            left: content_metrics.outspacingx,\n            top: content_metrics.outspacingy,\n            right: content_metrics.width-content_metrics.outspacingx,\n            bottom: content_metrics.height-content_metrics.outspacingy\n        };\n        if (gli_rootwin)\n            gli_window_rearrange(gli_rootwin, box);\n        handle_arrange_input();\n        break;\n\n    case 'redraw':\n        handle_redraw_input();\n        break;\n\n    case 'specialresponse':\n        if (obj.response == 'fileref_prompt') {\n            gli_fileref_create_by_prompt_callback(obj);\n        }\n        break;\n    }\n}\n\nfunction handle_arrange_input() {\n    if (!gli_selectref)\n        return;\n\n    gli_selectref.set_field(0, Const.evtype_Arrange);\n    gli_selectref.set_field(1, null);\n    gli_selectref.set_field(2, 0);\n    gli_selectref.set_field(3, 0);\n\n    if (GiDispa)\n        GiDispa.prepare_resume(gli_selectref);\n    gli_selectref = null;\n    VM.resume();\n}\n\nfunction handle_redraw_input() {\n    if (!gli_selectref)\n        return;\n\n    gli_selectref.set_field(0, Const.evtype_Redraw);\n    gli_selectref.set_field(1, null);\n    gli_selectref.set_field(2, 0);\n    gli_selectref.set_field(3, 0);\n\n    if (GiDispa)\n        GiDispa.prepare_resume(gli_selectref);\n    gli_selectref = null;\n    VM.resume();\n}\n\nfunction handle_external_input(res) {\n    if (!gli_selectref)\n        return;\n\n    /* This also handles timer input. */\n    var val1 = 0;\n    var val2 = 0;\n    if (res.val1)\n        val1 = res.val1;\n    if (res.val2)\n        val2 = res.val2;\n\n    gli_selectref.set_field(0, res.type);\n    gli_selectref.set_field(1, null);\n    gli_selectref.set_field(2, val1);\n    gli_selectref.set_field(3, val2);\n\n    if (GiDispa)\n        GiDispa.prepare_resume(gli_selectref);\n    gli_selectref = null;\n    VM.resume();\n}\n\nfunction handle_hyperlink_input(disprock, val) {\n    if (!gli_selectref)\n        return;\n\n    var win = null;\n    for (win=gli_windowlist; win; win=win.next) {\n        if (win.disprock == disprock) \n            break;\n    }\n    if (!win || !win.hyperlink_request)\n        return;\n\n    gli_selectref.set_field(0, Const.evtype_Hyperlink);\n    gli_selectref.set_field(1, win);\n    gli_selectref.set_field(2, val);\n    gli_selectref.set_field(3, 0);\n\n    win.hyperlink_request = false;\n\n    if (GiDispa)\n        GiDispa.prepare_resume(gli_selectref);\n    gli_selectref = null;\n    VM.resume();\n}\n\nfunction handle_mouse_input(disprock, xpos, ypos) {\n    if (!gli_selectref)\n        return;\n\n    var win = null;\n    for (win=gli_windowlist; win; win=win.next) {\n        if (win.disprock == disprock) \n            break;\n    }\n    if (!win || !win.mouse_request)\n        return;\n\n    gli_selectref.set_field(0, Const.evtype_MouseInput);\n    gli_selectref.set_field(1, win);\n    gli_selectref.set_field(2, xpos);\n    gli_selectref.set_field(3, ypos);\n\n    win.mouse_request = false;\n\n    if (GiDispa)\n        GiDispa.prepare_resume(gli_selectref);\n    gli_selectref = null;\n    VM.resume();\n}\n\nfunction handle_char_input(disprock, input) {\n    var charval;\n\n    if (!gli_selectref)\n        return;\n\n    var win = null;\n    for (win=gli_windowlist; win; win=win.next) {\n        if (win.disprock == disprock) \n            break;\n    }\n    if (!win || !win.char_request)\n        return;\n\n    if (input.length == 1) {\n        charval = input.charCodeAt(0);\n        if (!win.char_request_uni)\n            charval = charval & 0xFF;\n    }\n    else {\n        charval = KeystrokeNameMap[input];\n        if (!charval)\n            charval = Const.keycode_Unknown;\n    }\n\n    gli_selectref.set_field(0, Const.evtype_CharInput);\n    gli_selectref.set_field(1, win);\n    gli_selectref.set_field(2, charval);\n    gli_selectref.set_field(3, 0);\n\n    win.char_request = false;\n    win.char_request_uni = false;\n    win.input_generation = null;\n\n    if (GiDispa)\n        GiDispa.prepare_resume(gli_selectref);\n    gli_selectref = null;\n    VM.resume();\n}\n\nfunction handle_line_input(disprock, input, termkey) {\n    var ix;\n\n    if (!gli_selectref)\n        return;\n\n    var win = null;\n    for (win=gli_windowlist; win; win=win.next) {\n        if (win.disprock == disprock) \n            break;\n    }\n    if (!win || !win.line_request)\n        return;\n\n    if (input.length > win.linebuf.length)\n        input = input.slice(0, win.linebuf.length);\n\n    if (win.request_echo_line_input) {\n        ix = win.style;\n        gli_set_style(win.str, Const.style_Input);\n        gli_window_put_string(win, input);\n        if (win.echostr)\n            glk_put_jstring_stream(win.echostr, input);\n        gli_set_style(win.str, ix);\n        gli_window_put_string(win, \"\\n\");\n        if (win.echostr)\n            glk_put_jstring_stream(win.echostr, \"\\n\");\n    }\n\n    for (ix=0; ix<input.length; ix++)\n        win.linebuf[ix] = input.charCodeAt(ix);\n\n    var termcode = 0;\n    if (termkey && KeystrokeNameMap[termkey]) \n        termcode = KeystrokeNameMap[termkey];\n\n    gli_selectref.set_field(0, Const.evtype_LineInput);\n    gli_selectref.set_field(1, win);\n    gli_selectref.set_field(2, input.length);\n    gli_selectref.set_field(3, termcode);\n\n    if (GiDispa)\n        GiDispa.unretain_array(win.linebuf);\n    win.line_request = false;\n    win.line_request_uni = false;\n    win.request_echo_line_input = null;\n    win.input_generation = null;\n    win.linebuf = null;\n\n    if (GiDispa)\n        GiDispa.prepare_resume(gli_selectref);\n    gli_selectref = null;\n    VM.resume();\n}\n\nfunction update() {\n    var dataobj = { type: 'update', gen: event_generation };\n    var winarray = null;\n    var contentarray = null;\n    var inputarray = null;\n    var win, obj, robj, useobj, lineobj, ls, val, ix, cx;\n    var initial, lastpos;\n\n    if (geometry_changed) {\n        geometry_changed = false;\n        winarray = [];\n        for (win=gli_windowlist; win; win=win.next) {\n            if (win.type == Const.wintype_Pair)\n                continue;\n\n            obj = { id: win.disprock, rock: win.rock };\n            winarray.push(obj);\n\n            switch (win.type) {\n            case Const.wintype_TextBuffer:\n                obj.type = 'buffer';\n                obj.styles = clone_stylehints(win.stylehints)\n                break;\n            case Const.wintype_TextGrid:\n                obj.type = 'grid';\n                obj.gridwidth = win.gridwidth;\n                obj.gridheight = win.gridheight;\n                obj.styles = clone_stylehints(win.stylehints)\n                break;\n            case Const.wintype_Graphics:\n                obj.type = 'graphics';\n                obj.graphwidth = win.graphwidth;\n                obj.graphheight = win.graphheight;\n                break;\n            }\n\n            obj.left = win.bbox.left;\n            obj.top = win.bbox.top;\n            obj.width = win.bbox.right - win.bbox.left;\n            obj.height = win.bbox.bottom - win.bbox.top;\n        }\n    }\n\n    for (win=gli_windowlist; win; win=win.next) {\n        useobj = false;\n        obj = { id: win.disprock };\n        if (contentarray == null)\n            contentarray = [];\n\n        switch (win.type) {\n        case Const.wintype_TextBuffer:\n            gli_window_buffer_deaccumulate(win);\n            if (win.content.length) {\n                obj.text = win.content.slice(0);\n                win.content.length = 0;\n                useobj = true;\n            }\n            if (win.clearcontent) {\n                obj.clear = true;\n                obj.bg = win.cleared_bg;\n                obj.fg = win.cleared_fg;\n                win.clearcontent = false;\n                useobj = true;\n                if (!obj.text) {\n                    obj.text = [];\n                }\n                win.reserve.length = 0;\n            }\n            if (obj.text && obj.text.length) {\n                for (ix=0; ix<obj.text.length; ix++) {\n                    win.reserve.push(obj.text[ix]);\n                }\n            }\n            if (win.reserve.length > 100) {\n                win.reserve.splice(0, win.reserve.length-100);\n            }\n            break;\n        case Const.wintype_TextGrid:\n            if (win.gridwidth == 0 || win.gridheight == 0)\n                break;\n            obj.lines = [];\n            for (ix=0; ix<win.gridheight; ix++) {\n                lineobj = win.lines[ix];\n                if (!lineobj.dirty)\n                    continue;\n                lineobj.dirty = false;\n                ls = [];\n                lastpos = 0;\n                for (cx=0; cx<win.gridwidth; ) {\n                    const laststyle = lineobj.styles[cx];\n                    const lasthyperlink = lineobj.hyperlinks[cx];\n                    const lastfg = lineobj.fgs[cx];\n                    const lastbg = lineobj.bgs[cx];\n                    const lastreverse = lineobj.reverses[cx];\n                    for (; cx<win.gridwidth \n                             && lineobj.styles[cx] === laststyle\n                             && lineobj.hyperlinks[cx] === lasthyperlink\n                             && lineobj.fgs[cx] === lastfg\n                             && lineobj.bgs[cx] === lastbg\n                             && lineobj.reverses[cx] === lastreverse;\n                         cx++) {\n                             continue;\n                         }\n                    if (lastpos < cx) {\n                        if (!lasthyperlink && lastfg == null && lastbg == null && !lastreverse) {\n                            ls.push(StyleNameMap[laststyle]);\n                            ls.push(lineobj.chars.slice(lastpos, cx).join(''));\n                        }\n                        else {\n                            robj = {\n                                style: StyleNameMap[laststyle],\n                                text: lineobj.chars.slice(lastpos, cx).join(''),\n                                hyperlink: lasthyperlink,\n                            };\n                            if (lastbg || lastfg || lastreverse) {\n                                robj.css_styles = {}\n                                if (lastbg) {\n                                    robj.css_styles['background-color'] = lastbg\n                                }\n                                if (lastfg) {\n                                    robj.css_styles.color = lastfg\n                                }\n                                if (lastreverse) {\n                                    robj.css_styles.reverse = lastreverse\n                                }\n                            }\n                            ls.push(robj);\n                        }\n                        lastpos = cx;\n                    }\n                }\n                obj.lines.push({ line:ix, content:ls });\n            }\n            if (win.clearcontent) {\n                obj.clear = true;\n                obj.bg = win.cleared_bg;\n                obj.fg = win.cleared_fg;\n                win.clearcontent = false;\n            }\n            useobj = obj.lines.length;\n            break;\n        case Const.wintype_Graphics:\n            if (win.content.length) {\n                obj.draw = win.content.slice(0);\n                win.content.length = 0;\n                useobj = true;\n            }\n            /* Copy new drawing commands over to the reserve. Keep track\n               of the last (whole-window) fill command. */\n            var clearedat = -1;\n            if (obj.draw && obj.draw.length) {\n                for (ix=0; ix<obj.draw.length; ix++) {\n                    var drawel = obj.draw[ix];\n                    if (drawel.special == 'fill' \n                        && drawel.x === undefined && drawel.y === undefined \n                        && drawel.width === undefined && drawel.height === undefined) {\n                        clearedat = win.reserve.length;\n                    }\n                    win.reserve.push(drawel);\n                }\n            }\n            if (clearedat >= 0) {\n                /* We're going to delete every command before the\n                   fill, except that we save the last setcolor. */\n                var setcol = null;\n                for (let ix=0; ix<win.reserve.length && ix<clearedat; ix++) {\n                    const drawel = win.reserve[ix];\n                    if (drawel.special == 'setcolor')\n                        setcol = drawel;\n                }\n                win.reserve.splice(0, clearedat);\n                if (setcol)\n                    win.reserve.unshift(setcol);\n            }\n            break;\n        }\n\n        if (useobj)\n            contentarray.push(obj);\n    }\n\n    inputarray = [];\n    for (win=gli_windowlist; win; win=win.next) {\n        obj = null;\n        if (win.char_request) {\n            obj = { id: win.disprock, type: 'char', gen: win.input_generation };\n            if (win.type == Const.wintype_TextGrid) {\n                if (gli_window_grid_canonicalize(win)) {\n                    obj.xpos = win.gridwidth;\n                    obj.ypos = win.gridheight-1;\n                }\n                else {\n                    obj.xpos = win.cursorx;\n                    obj.ypos = win.cursory;\n                }\n            }\n        }\n        if (win.line_request) {\n            initial = '';\n            if (current_partial_outputs) {\n                val = current_partial_outputs[win.disprock];\n                if (val)\n                    initial = val;\n            }\n            /* Note that the initial and terminators fields will be ignored\n               if this is a continued (old) input request. So it doesn't\n               matter if they're wrong. */\n            obj = { id: win.disprock, type: 'line', gen: win.input_generation,\n                    maxlen: win.linebuf.length, initial: initial };\n            if (win.line_input_terminators.length) {\n                obj.terminators = win.line_input_terminators;\n            }\n            if (win.type == Const.wintype_TextGrid) {\n                if (gli_window_grid_canonicalize(win)) {\n                    obj.xpos = win.gridwidth;\n                    obj.ypos = win.gridheight-1;\n                }\n                else {\n                    obj.xpos = win.cursorx;\n                    obj.ypos = win.cursory;\n                }\n            }\n        }\n        if (win.hyperlink_request) {\n            if (!obj)\n                obj = { id: win.disprock };\n            obj.hyperlink = true;\n        }\n        if (win.mouse_request) {\n            if (!obj)\n                obj = { id: win.disprock };\n            obj.mouse = true;\n        }\n        if (obj)\n            inputarray.push(obj);\n    }\n\n    dataobj.windows = winarray;\n    dataobj.content = contentarray;\n    dataobj.input = inputarray;\n\n    if (gli_timer_lastsent != gli_timer_interval) {\n        //qlog(\"### timer update: \" + gli_timer_interval);\n        dataobj.timer = gli_timer_interval;\n        gli_timer_lastsent = gli_timer_interval;\n    }\n\n    if (ui_specialinput) {\n        //qlog(\"### special input: \" + ui_specialinput.type);\n        dataobj.specialinput = ui_specialinput;\n    }\n\n    if (ui_disabled) {\n        //qlog(\"### disabling ui\");\n        dataobj.disable = true;\n    }\n\n    // Send a live-updated bage background colour\n    const current_page_pg = stylehints.buffer['span.Style_normal']?.['background-color']\n    if (last_page_bg != current_page_pg)\n    {\n        last_page_bg = current_page_pg\n        dataobj.page_margin_bg = current_page_pg || ''\n    }\n\n    /* Clean this up; it's only meaningful within one run/update cycle. */\n    current_partial_outputs = null;\n\n    /* If we're doing an autorestore, gli_autorestore_glkstate will \n       contain additional setup information for the first update()\n       call only. */\n    if (gli_autorestore_glkstate)\n        dataobj.autorestore = gli_autorestore_glkstate;\n    gli_autorestore_glkstate = null;\n\n    GlkOte.update(dataobj, gli_autorestore_glkstate);\n\n    if (option_before_select_hook) {\n        option_before_select_hook();\n    }\n    if (option_do_vm_autosave) {\n        if (has_exited) {\n            /* On quit or fatal error, delete the autosave. */\n            VM.do_autosave(-1);\n        }\n        else if (GiDispa) {\n            /* If this is a good time, autosave. */\n            var eventarg = GiDispa.check_autosave();\n            if (eventarg)\n                VM.do_autosave(eventarg);\n        }\n    }\n}\n\n/* Return the library interface object that we were passed or created.\n   Call this if you want to use, e.g., the same Dialog object that GlkOte\n   is using.\n*/\nfunction get_library(val) {\n    switch (val) {\n        case 'VM': return VM;\n        case 'GlkOte': return GlkOte;\n        case 'GiDispa': return GiDispa;\n        case 'Blorb': return Blorb;\n        case 'Dialog': return GlkOte.getlibrary('Dialog');\n    }\n    /* Unrecognized library name. */\n    return null;\n}\n\n/* Wrap up the current display state as a (JSONable) object. This is\n   called from Quixe.vm_autosave.\n*/\nfunction save_allstate() {\n    var res = {};\n\n    if (gli_rootwin)\n        res.rootwin = gli_rootwin.disprock;\n\n    if (gli_currentstr)\n        res.currentstr = gli_currentstr.disprock;\n\n    if (gli_timer_interval)\n        res.timer_interval = gli_timer_interval;\n\n    res.windows = [];\n    for (var win = gli_windowlist; win; win = win.next) {\n        var obj = {\n            type: win.type, rock: win.rock, disprock: win.disprock,\n            style: win.style, hyperlink: win.hyperlink,\n            bg: win.bg, fg: win.fg, reverse: win.reverse,\n            cleared_bg: win.cleared_bg, cleared_fg: win.cleared_fg,\n        };\n        if (win.parent)\n            obj.parent = win.parent.disprock;\n        obj.str = win.str.disprock;\n        if (win.echostr)\n            obj.echostr = win.echostr.disprock;\n\n        obj.bbox = { \n            left: win.bbox.left, right: win.bbox.right,\n            top: win.bbox.top, bottom: win.bbox.bottom \n        };\n\n        if (win.linebuf !== null) {\n            var info = GiDispa.get_retained_array(win.linebuf);\n            obj.linebuf = {\n                addr: info.addr,\n                len: info.len,\n                arr: info.arr.slice(0),\n                arg: info.arg.serialize()\n            };\n        }\n        obj.char_request = win.char_request;\n        obj.line_request = win.line_request;\n        obj.char_request_uni = win.char_request_uni;\n        obj.line_request_uni = win.line_request_uni;\n        obj.hyperlink_request = win.hyperlink_request;\n        obj.mouse_request = win.mouse_request;\n        obj.echo_line_input = win.echo_line_input;\n        obj.request_echo_line_input = win.request_echo_line_input;\n        obj.line_input_terminators = win.line_input_terminators.slice(0);\n        //### should have a request_line_input_terminators as well\n\n        switch (win.type) {\n        case Const.wintype_TextBuffer:\n            obj.reserve = win.reserve.slice(0);\n            obj.stylehints = win.stylehints\n            break;\n        case Const.wintype_TextGrid:\n            obj.gridwidth = win.gridwidth;\n            obj.gridheight = win.gridheight;\n            obj.lines = [];\n            for (var ix=0; ix<win.lines.length; ix++) {\n                var ln = win.lines[ix];\n                obj.lines.push({\n                        chars: ln.chars.slice(0),\n                        styles: ln.styles.slice(0),\n                        hyperlinks: ln.hyperlinks.slice(0),\n                        fgs: ln.fgs.slice(0),\n                        bgs: ln.bgs.slice(0),\n                        reverses: ln.reverses.slice(0),\n                    });\n            }\n            obj.cursorx = win.cursorx;\n            obj.cursory = win.cursory;\n            obj.stylehints = win.stylehints\n            break;\n        case Const.wintype_Graphics:\n            obj.graphwidth = win.graphwidth;\n            obj.graphheight = win.graphheight;\n            obj.reserve = win.reserve.slice(0);\n            break;\n        case Const.wintype_Pair:\n            obj.pair_dir = win.pair_dir;\n            obj.pair_division = win.pair_division;\n            obj.pair_key = win.pair_key.disprock;\n            obj.pair_keydamage = false;\n            obj.pair_size = win.pair_size;\n            obj.pair_hasborder = win.pair_hasborder;\n            obj.pair_vertical = win.pair_vertical;\n            obj.pair_backward = win.pair_backward;\n            obj.child1 = win.child1.disprock;\n            obj.child2 = win.child2.disprock;\n            break;\n        }\n\n        res.windows.push(obj);\n    }\n\n    res.streams = [];\n    for (let str = gli_streamlist; str; str = str.next) {\n        const obj = {\n            type: str.type, rock: str.rock, disprock: str.disprock,\n            unicode: str.unicode, isbinary: str.isbinary,\n            readcount: str.readcount, writecount: str.writecount,\n            readable: str.readable, writable: str.writable,\n            streaming: str.streaming\n        };\n\n        switch (str.type) {\n\n        case strtype_Window:\n            if (str.win)\n                obj.win = str.win.disprock;\n            break;\n\n        case strtype_Memory:\n            if (str.buf !== null) {\n                const info = GiDispa.get_retained_array(str.buf);\n                obj.buf = {\n                    addr: info.addr,\n                    len: info.len,\n                    arr: info.arr.slice(0),\n                    arg: info.arg.serialize()\n                };\n            }\n            obj.buflen = str.buflen;\n            obj.bufpos = str.bufpos;\n            obj.bufeof = str.bufeof;\n            break;\n\n        case strtype_Resource:\n            obj.resfilenum = str.resfilenum;\n            // Don't need str.buf\n            obj.buflen = str.buflen;\n            obj.bufpos = str.bufpos;\n            obj.bufeof = str.bufeof;\n            break;\n\n        case strtype_File:\n            obj.origfmode = str.origfmode;\n            if (!Dialog.streaming) {\n                obj.ref = str.ref;\n                gli_stream_flush_file(str);\n                // Don't need str.buf\n                obj.buflen = str.buflen;\n                obj.bufpos = str.bufpos;\n                obj.bufeof = str.bufeof;\n            }\n            else {\n                str.fstream.fflush();\n                obj.ref = str.ref;\n                obj.filepos = str.fstream.ftell();\n            }\n            break;\n\n        }\n\n        res.streams.push(obj);\n    }\n\n    res.filerefs = [];\n    for (let fref = gli_filereflist; fref; fref = fref.next) {\n        const obj = {\n            type: fref.type, rock: fref.rock, disprock: fref.disprock,\n            filename: fref.filename, textmode: fref.textmode,\n            filetype: fref.filetype, filetypename: fref.filetypename\n        };\n\n        obj.ref = fref.ref;\n\n        res.filerefs.push(obj);\n    }\n\n    // Ignore gli_schannellist, as it's currently always empty.\n\n    // Save the in-progress stylehints\n    res.stylehints = stylehints;\n\n    /* Save GlkOte-level information. This includes the overall metrics. */\n    res.glkote = GlkOte.save_allstate();\n\n    return res;\n}\n\n/* Take display information (created by save_allstate) and set up our\n   state to match it. Called from vm_autorestore.\n*/\nfunction restore_allstate(res)\n{\n    if (gli_windowlist || gli_streamlist || gli_filereflist)\n        throw('restore_allstate: glkapi module has already been launched');\n\n    /* We build and register all the bare objects first. (In reverse\n       order so that the linked lists come out right way around.) */\n\n    for (let ix=res.windows.length-1; ix>=0; ix--) {\n        const obj = res.windows[ix];\n        const win = {\n            type: obj.type, rock: obj.rock, disprock: obj.disprock,\n            style: obj.style, hyperlink: obj.hyperlink,\n            bg: obj.bg, fg: obj.fg, reverse: obj.reverse,\n            cleared_bg: obj.cleared_bg, cleared_fg: obj.cleared_fg,\n        };\n        GiDispa.class_register('window', win, win.disprock);\n\n        win.prev = null;\n        win.next = gli_windowlist;\n        gli_windowlist = win;\n        if (win.next)\n            win.next.prev = win;\n    }\n\n    for (let ix=res.streams.length-1; ix>=0; ix--) {\n        const obj = res.streams[ix];\n        const str = {\n            type: obj.type, rock: obj.rock, disprock: obj.disprock,\n            unicode: obj.unicode, isbinary: obj.isbinary,\n            readcount: obj.readcount, writecount: obj.writecount,\n            readable: obj.readable, writable: obj.writable,\n            streaming: obj.streaming\n        };\n        GiDispa.class_register('stream', str, str.disprock);\n\n        str.prev = null;\n        str.next = gli_streamlist;\n        gli_streamlist = str;\n        if (str.next)\n            str.next.prev = str;\n    }\n\n    for (let ix=res.filerefs.length-1; ix>=0; ix--) {\n        const obj = res.filerefs[ix];\n        const fref = {\n            type: obj.type, rock: obj.rock, disprock: obj.disprock,\n            filename: obj.filename, textmode: obj.textmode,\n            filetype: obj.filetype, filetypename: obj.filetypename\n        };\n        GiDispa.class_register('fileref', fref, fref.disprock);\n\n        fref.prev = null;\n        fref.next = gli_filereflist;\n        gli_filereflist = fref;\n        if (fref.next)\n            fref.next.prev = fref;\n    }\n\n    /* ...Now we fill in the cross-references. */\n\n    for (let ix=0; ix<res.windows.length; ix++) {\n        const obj = res.windows[ix];\n        const win = GiDispa.class_obj_from_id('window', obj.disprock);\n\n        win.parent = GiDispa.class_obj_from_id('window', obj.parent);\n        win.str = GiDispa.class_obj_from_id('stream', obj.str);\n        win.echostr = GiDispa.class_obj_from_id('stream', obj.echostr);\n\n        win.bbox = { \n            left: obj.bbox.left, right: obj.bbox.right,\n            top: obj.bbox.top, bottom: obj.bbox.bottom \n        };\n\n        win.input_generation = null;\n        if (obj.char_request || obj.line_request)\n            win.input_generation = event_generation;\n        win.linebuf = null;\n        if (obj.linebuf !== undefined) {\n            // should clone that object\n            win.linebuf = obj.linebuf.arr;\n            GiDispa.retain_array(win.linebuf, obj.linebuf);\n        }\n        win.char_request = obj.char_request;\n        win.line_request = obj.line_request;\n        win.char_request_uni = obj.char_request_uni;\n        win.line_request_uni = obj.line_request_uni;\n        win.hyperlink_request = obj.hyperlink_request;\n        win.mouse_request = obj.mouse_request;\n        win.echo_line_input = obj.echo_line_input;\n        win.request_echo_line_input = obj.request_echo_line_input;\n        win.line_input_terminators = obj.line_input_terminators.slice(0);\n        //### should have a request_line_input_terminators as well\n\n        switch (win.type) {\n        case Const.wintype_TextBuffer:\n            win.accum = [];\n            win.accumstyle = win.style;\n            win.accumhyperlink = win.hyperlink;\n            win.accum_fg = win.fg\n            win.accum_bg = win.bg\n            win.accum_reverse = win.reverse\n            win.content = obj.reserve.slice(0);\n            win.clearcontent = true;\n            win.reserve = [];\n            win.stylehints = restore_stylehints(obj.stylehints);\n            break;\n        case Const.wintype_TextGrid:\n            win.gridwidth = obj.gridwidth;\n            win.gridheight = obj.gridheight;\n            win.lines = [];\n            for (var jx=0; jx<obj.lines.length; jx++) {\n                var ln = obj.lines[jx];\n                win.lines.push({\n                        dirty: true,\n                        chars: ln.chars.slice(0),\n                        styles: ln.styles.slice(0),\n                        hyperlinks: ln.hyperlinks.slice(0),\n                        fgs: ln.fgs.slice(0),\n                        bgs: ln.bgs.slice(0),\n                        reverses: ln.reverses.slice(0),\n                    });\n            }\n            win.cursorx = obj.cursorx;\n            win.cursory = obj.cursory;\n            win.clearcontent = true;\n            win.stylehints = restore_stylehints(obj.stylehints);\n            break;\n        case Const.wintype_Graphics:\n            win.graphwidth = obj.graphwidth;\n            win.graphheight = obj.graphheight;\n            win.content = obj.reserve.slice(0);\n            win.reserve = [];\n            break;\n        case Const.wintype_Pair:\n            win.pair_dir = obj.pair_dir;\n            win.pair_division = obj.pair_division;\n            win.pair_key = GiDispa.class_obj_from_id('window', obj.pair_key);\n            win.pair_keydamage = false;\n            win.pair_size = obj.pair_size;\n            win.pair_hasborder = obj.pair_hasborder;\n            win.pair_vertical = obj.pair_vertical;\n            win.pair_backward = obj.pair_backward;\n            win.child1 = GiDispa.class_obj_from_id('window', obj.child1);\n            win.child2 = GiDispa.class_obj_from_id('window', obj.child2);\n            break;\n        }\n    }\n\n    for (let ix=0; ix<res.streams.length; ix++) {\n        const obj = res.streams[ix];\n        const str = GiDispa.class_obj_from_id('stream', obj.disprock);\n\n        /* Defaults first... */\n        str.win = null;\n        str.ref = null;\n        str.file = null;\n\n        str.buf = null;\n        str.bufpos = 0;\n        str.buflen = 0;\n        str.bufeof = 0;\n        str.timer_id = null;\n        str.flush_func = null;\n        str.fstream = null;\n\n        switch (str.type) {\n\n        case strtype_Window:\n            str.win = GiDispa.class_obj_from_id('window', obj.win);\n            break;\n\n        case strtype_Memory:\n            if (obj.buf !== undefined) {\n                // should clone that object\n                str.buf = obj.buf.arr;\n                GiDispa.retain_array(str.buf, obj.buf);\n            }\n            str.buflen = obj.buflen;\n            str.bufpos = obj.bufpos;\n            str.bufeof = obj.bufeof;\n            break;\n\n        case strtype_Resource:\n            str.resfilenum = obj.resfilenum;\n            var el = Blorb.find_data_chunk(str.resfilenum);\n            if (el) {\n                str.buf = el.data;\n            }\n            str.buflen = obj.buflen;\n            str.bufpos = obj.bufpos;\n            str.bufeof = obj.bufeof;\n            break;\n\n        case strtype_File:\n            str.origfmode = obj.origfmode;\n            if (!Dialog.streaming) {\n                str.ref = obj.ref;\n                str.buflen = obj.buflen;\n                str.bufpos = obj.bufpos;\n                str.bufeof = obj.bufeof;\n\n                var content = Dialog.file_read(str.ref);\n                if (content == null) {\n                    /* The file was somehow deleted. Create an empty\n                       file (even in read mode). */\n                    content = [];\n                    Dialog.file_write(str.ref, '', true);\n                }\n                str.buf = content;\n\n                /* If the file has been shortened, we might have to\n                   trim bufeof to fit within it. The game might see\n                   the file pos mysteriously move; sorry. */\n                str.bufeof = content.length;\n                if (str.bufpos > str.bufeof)\n                    str.bufpos = str.bufeof;\n            }\n            else {\n                str.ref = obj.ref;\n                str.fstream = Dialog.file_fopen(str.origfmode, str.ref);\n                if (!str.fstream) {\n                    /* This is the panic case. We can't reopen the stream,\n                       but the game expects an open stream! We'll just\n                       have to open a temporary file; the user will never\n                       get their data, but at least the game won't crash.\n                       (Better policy would be to prompt the user for\n                       a new file location...) */\n                    var tempref = Dialog.file_construct_temp_ref(str.ref.usage);\n                    str.fstream = Dialog.file_fopen(str.origfmode, tempref);\n                    if (!str.fstream)\n                        throw('restore_allstate: could not reopen even a temp stream for: ' + str.ref.filename);\n                }\n\n                if (str.origfmode != Const.filemode_WriteAppend) {\n                    /* Jump to the last known filepos. */\n                    str.fstream.fseek(obj.filepos, Const.seekmode_Start);\n                }\n\n                str.buffer4 = str.fstream.BufferClass.alloc(4);\n            }\n            break;\n\n        }\n    }\n\n    for (let ix=0; ix<res.filerefs.length; ix++) {\n        const obj = res.filerefs[ix];\n        const fref = GiDispa.class_obj_from_id('fileref', obj.disprock);\n\n        fref.ref = obj.ref; // should deep clone\n    }\n\n    gli_rootwin = GiDispa.class_obj_from_id('window', res.rootwin);\n    gli_currentstr = GiDispa.class_obj_from_id('stream', res.currentstr);\n\n    if (res.timer_interval)\n        glk_request_timer_events(res.timer_interval);\n\n    stylehints.buffer = restore_stylehints(res.stylehints.buffer);\n    stylehints.grid = restore_stylehints(res.stylehints.grid);\n\n    /* Stash this for the next (first) GlkOte.update call. */\n    gli_autorestore_glkstate = res.glkote;\n}\n\n/* This is the handler for a VM fatal error. (Not for an error in our own\n   library!) We display the error message, and then push a final display\n   update, which kills all input fields in all windows.\n*/\nfunction fatal_error(msg) {\n    has_exited = true;\n    ui_disabled = true;\n    if (!GlkOte) {\n        // We haven't been initialized yet, so we can only try to log the error and hope someone sees it.\n        console.log('Fatal error:', msg);\n        return;\n    }\n    GlkOte.error(msg);\n    var dataobj = { type: 'update', gen: event_generation, disable: true };\n    dataobj.input = [];\n    GlkOte.update(dataobj);\n}\n\n/* All the numeric constants used by the Glk interface. We push these into\n   an object, for tidiness. */\n\nvar Const = {\n    gestalt_Version : 0,\n    gestalt_CharInput : 1,\n    gestalt_LineInput : 2,\n    gestalt_CharOutput : 3,\n      gestalt_CharOutput_CannotPrint : 0,\n      gestalt_CharOutput_ApproxPrint : 1,\n      gestalt_CharOutput_ExactPrint : 2,\n    gestalt_MouseInput : 4,\n    gestalt_Timer : 5,\n    gestalt_Graphics : 6,\n    gestalt_DrawImage : 7,\n    gestalt_Sound : 8,\n    gestalt_SoundVolume : 9,\n    gestalt_SoundNotify : 10,\n    gestalt_Hyperlinks : 11,\n    gestalt_HyperlinkInput : 12,\n    gestalt_SoundMusic : 13,\n    gestalt_GraphicsTransparency : 14,\n    gestalt_Unicode : 15,\n    gestalt_UnicodeNorm : 16,\n    gestalt_LineInputEcho : 17,\n    gestalt_LineTerminators : 18,\n    gestalt_LineTerminatorKey : 19,\n    gestalt_DateTime : 20,\n    gestalt_Sound2 : 21,\n    gestalt_ResourceStream : 22,\n    gestalt_GraphicsCharInput : 23,\n    gestalt_GarglkText: 0x1100,\n\n    keycode_Unknown  : 0xffffffff,\n    keycode_Left     : 0xfffffffe,\n    keycode_Right    : 0xfffffffd,\n    keycode_Up       : 0xfffffffc,\n    keycode_Down     : 0xfffffffb,\n    keycode_Return   : 0xfffffffa,\n    keycode_Delete   : 0xfffffff9,\n    keycode_Escape   : 0xfffffff8,\n    keycode_Tab      : 0xfffffff7,\n    keycode_PageUp   : 0xfffffff6,\n    keycode_PageDown : 0xfffffff5,\n    keycode_Home     : 0xfffffff4,\n    keycode_End      : 0xfffffff3,\n    keycode_Func1    : 0xffffffef,\n    keycode_Func2    : 0xffffffee,\n    keycode_Func3    : 0xffffffed,\n    keycode_Func4    : 0xffffffec,\n    keycode_Func5    : 0xffffffeb,\n    keycode_Func6    : 0xffffffea,\n    keycode_Func7    : 0xffffffe9,\n    keycode_Func8    : 0xffffffe8,\n    keycode_Func9    : 0xffffffe7,\n    keycode_Func10   : 0xffffffe6,\n    keycode_Func11   : 0xffffffe5,\n    keycode_Func12   : 0xffffffe4,\n    /* The last keycode is always (0x100000000 - keycode_MAXVAL) */\n    keycode_MAXVAL   : 28,\n\n    evtype_None : 0,\n    evtype_Timer : 1,\n    evtype_CharInput : 2,\n    evtype_LineInput : 3,\n    evtype_MouseInput : 4,\n    evtype_Arrange : 5,\n    evtype_Redraw : 6,\n    evtype_SoundNotify : 7,\n    evtype_Hyperlink : 8,\n    evtype_VolumeNotify : 9,\n\n    style_Normal : 0,\n    style_Emphasized : 1,\n    style_Preformatted : 2,\n    style_Header : 3,\n    style_Subheader : 4,\n    style_Alert : 5,\n    style_Note : 6,\n    style_BlockQuote : 7,\n    style_Input : 8,\n    style_User1 : 9,\n    style_User2 : 10,\n    style_NUMSTYLES : 11,\n\n    wintype_AllTypes : 0,\n    wintype_Pair : 1,\n    wintype_Blank : 2,\n    wintype_TextBuffer : 3,\n    wintype_TextGrid : 4,\n    wintype_Graphics : 5,\n\n    winmethod_Left  : 0x00,\n    winmethod_Right : 0x01,\n    winmethod_Above : 0x02,\n    winmethod_Below : 0x03,\n    winmethod_DirMask : 0x0f,\n\n    winmethod_Fixed : 0x10,\n    winmethod_Proportional : 0x20,\n    winmethod_DivisionMask : 0xf0,\n\n    winmethod_Border : 0x000,\n    winmethod_NoBorder : 0x100,\n    winmethod_BorderMask : 0x100,\n\n    fileusage_Data : 0x00,\n    fileusage_SavedGame : 0x01,\n    fileusage_Transcript : 0x02,\n    fileusage_InputRecord : 0x03,\n    fileusage_TypeMask : 0x0f,\n\n    fileusage_TextMode   : 0x100,\n    fileusage_BinaryMode : 0x000,\n\n    filemode_Write : 0x01,\n    filemode_Read : 0x02,\n    filemode_ReadWrite : 0x03,\n    filemode_WriteAppend : 0x05,\n\n    seekmode_Start : 0,\n    seekmode_Current : 1,\n    seekmode_End : 2,\n\n    stylehint_Indentation : 0,\n    stylehint_ParaIndentation : 1,\n    stylehint_Justification : 2,\n    stylehint_Size : 3,\n    stylehint_Weight : 4,\n    stylehint_Oblique : 5,\n    stylehint_Proportional : 6,\n    stylehint_TextColor : 7,\n    stylehint_BackColor : 8,\n    stylehint_ReverseColor : 9,\n    stylehint_NUMHINTS : 10,\n\n      stylehint_just_LeftFlush : 0,\n      stylehint_just_LeftRight : 1,\n      stylehint_just_Centered : 2,\n      stylehint_just_RightFlush : 3,\n\n    imagealign_InlineUp : 1,\n    imagealign_InlineDown : 2,\n    imagealign_InlineCenter : 3,\n    imagealign_MarginLeft : 4,\n    imagealign_MarginRight : 5,\n\n    zcolor_Default: -1,\n    zcolor_Current: -2,\n\n};\n\nvar KeystrokeNameMap = {\n    /* The key values are taken from GlkOte's \"char\" event. A couple of them\n       are Javascript keywords, so they're in quotes, but that doesn't affect\n       the final structure. */\n    left : Const.keycode_Left,\n    right : Const.keycode_Right,\n    up : Const.keycode_Up,\n    down : Const.keycode_Down,\n    'return' : Const.keycode_Return,\n    'delete' : Const.keycode_Delete,\n    escape : Const.keycode_Escape,\n    tab : Const.keycode_Tab,\n    pageup : Const.keycode_PageUp,\n    pagedown : Const.keycode_PageDown,\n    home : Const.keycode_Home,\n    end : Const.keycode_End,\n    func1 : Const.keycode_Func1,\n    func2 : Const.keycode_Func2,\n    func3 : Const.keycode_Func3,\n    func4 : Const.keycode_Func4,\n    func5 : Const.keycode_Func5,\n    func6 : Const.keycode_Func6,\n    func7 : Const.keycode_Func7,\n    func8 : Const.keycode_Func8,\n    func9 : Const.keycode_Func9,\n    func10 : Const.keycode_Func10,\n    func11 : Const.keycode_Func11,\n    func12 : Const.keycode_Func12\n};\n\n/* The inverse of KeystrokeNameMap. We'll fill this in if needed. (It \n   generally isn't.) */\nvar KeystrokeValueMap = null;\n\nvar StyleNameMap = {\n    0 : 'normal',\n    1 : 'emphasized',\n    2 : 'preformatted',\n    3 : 'header',\n    4 : 'subheader',\n    5 : 'alert',\n    6 : 'note',\n    7 : 'blockquote',\n    8 : 'input',\n    9 : 'user1',\n    10 : 'user2'\n};\n\nvar FileTypeMap = {\n    0: 'data',\n    1: 'save',\n    2: 'transcript',\n    3: 'command'\n};\n\n/* These tables were generated by casemap.py. */\n/* Derived from Unicode data files, Unicode version 4.0.1. */\n\n/* list all the special cases in unicode_upper_table */\nvar unicode_upper_table = {\n181: 924, 223: [ 83,83 ], 255: 376, 305: 73, 329: [ 700,78 ],\n383: 83, 405: 502, 414: 544, 447: 503, 454: 452,\n457: 455, 460: 458, 477: 398, 496: [ 74,780 ], 499: 497,\n595: 385, 596: 390, 598: 393, 599: 394, 601: 399,\n603: 400, 608: 403, 611: 404, 616: 407, 617: 406,\n623: 412, 626: 413, 629: 415, 640: 422, 643: 425,\n648: 430, 650: 433, 651: 434, 658: 439, 837: 921,\n912: [ 921,776,769 ], 940: 902, 941: 904, 942: 905, 943: 906,\n944: [ 933,776,769 ], 962: 931, 972: 908, 973: 910, 974: 911,\n976: 914, 977: 920, 981: 934, 982: 928, 1008: 922,\n1010: 1017, 1013: 917, 1415: [ 1333,1362 ], 7830: [ 72,817 ], 7831: [ 84,776 ],\n7832: [ 87,778 ], 7833: [ 89,778 ], 7834: [ 65,702 ], 7835: 7776, 8016: [ 933,787 ],\n8018: [ 933,787,768 ], 8020: [ 933,787,769 ], 8022: [ 933,787,834 ], 8048: 8122, 8049: 8123,\n8050: 8136, 8051: 8137, 8052: 8138, 8053: 8139, 8054: 8154,\n8055: 8155, 8056: 8184, 8057: 8185, 8058: 8170, 8059: 8171,\n8060: 8186, 8061: 8187, 8064: [ 7944,921 ], 8065: [ 7945,921 ], 8066: [ 7946,921 ],\n8067: [ 7947,921 ], 8068: [ 7948,921 ], 8069: [ 7949,921 ], 8070: [ 7950,921 ], 8071: [ 7951,921 ],\n8072: [ 7944,921 ], 8073: [ 7945,921 ], 8074: [ 7946,921 ], 8075: [ 7947,921 ], 8076: [ 7948,921 ],\n8077: [ 7949,921 ], 8078: [ 7950,921 ], 8079: [ 7951,921 ], 8080: [ 7976,921 ], 8081: [ 7977,921 ],\n8082: [ 7978,921 ], 8083: [ 7979,921 ], 8084: [ 7980,921 ], 8085: [ 7981,921 ], 8086: [ 7982,921 ],\n8087: [ 7983,921 ], 8088: [ 7976,921 ], 8089: [ 7977,921 ], 8090: [ 7978,921 ], 8091: [ 7979,921 ],\n8092: [ 7980,921 ], 8093: [ 7981,921 ], 8094: [ 7982,921 ], 8095: [ 7983,921 ], 8096: [ 8040,921 ],\n8097: [ 8041,921 ], 8098: [ 8042,921 ], 8099: [ 8043,921 ], 8100: [ 8044,921 ], 8101: [ 8045,921 ],\n8102: [ 8046,921 ], 8103: [ 8047,921 ], 8104: [ 8040,921 ], 8105: [ 8041,921 ], 8106: [ 8042,921 ],\n8107: [ 8043,921 ], 8108: [ 8044,921 ], 8109: [ 8045,921 ], 8110: [ 8046,921 ], 8111: [ 8047,921 ],\n8114: [ 8122,921 ], 8115: [ 913,921 ], 8116: [ 902,921 ], 8118: [ 913,834 ], 8119: [ 913,834,921 ],\n8124: [ 913,921 ], 8126: 921, 8130: [ 8138,921 ], 8131: [ 919,921 ], 8132: [ 905,921 ],\n8134: [ 919,834 ], 8135: [ 919,834,921 ], 8140: [ 919,921 ], 8146: [ 921,776,768 ], 8147: [ 921,776,769 ],\n8150: [ 921,834 ], 8151: [ 921,776,834 ], 8162: [ 933,776,768 ], 8163: [ 933,776,769 ], 8164: [ 929,787 ],\n8165: 8172, 8166: [ 933,834 ], 8167: [ 933,776,834 ], 8178: [ 8186,921 ], 8179: [ 937,921 ],\n8180: [ 911,921 ], 8182: [ 937,834 ], 8183: [ 937,834,921 ], 8188: [ 937,921 ], 64256: [ 70,70 ],\n64257: [ 70,73 ], 64258: [ 70,76 ], 64259: [ 70,70,73 ], 64260: [ 70,70,76 ], 64261: [ 83,84 ],\n64262: [ 83,84 ], 64275: [ 1348,1350 ], 64276: [ 1348,1333 ], 64277: [ 1348,1339 ], 64278: [ 1358,1350 ],\n64279: [ 1348,1341 ]\n};\n/* add all the regular cases to unicode_upper_table */\n(function() {\n  var ls, ix, val;\n  var map = unicode_upper_table;\n  ls = [\n7936, 7937, 7938, 7939, 7940, 7941, 7942, 7943,\n7952, 7953, 7954, 7955, 7956, 7957, 7968, 7969,\n7970, 7971, 7972, 7973, 7974, 7975, 7984, 7985,\n7986, 7987, 7988, 7989, 7990, 7991, 8000, 8001,\n8002, 8003, 8004, 8005, 8017, 8019, 8021, 8023,\n8032, 8033, 8034, 8035, 8036, 8037, 8038, 8039,\n8112, 8113, 8144, 8145, 8160, 8161,\n  ];\n  for (ix=0; ix<54; ix++) {\n    val = ls[ix];\n    map[val] = val+8;\n  }\n  for (val=257; val<=303; val+=2) {\n    map[val] = val-1;\n  }\n  for (val=331; val<=375; val+=2) {\n    map[val] = val-1;\n  }\n  for (val=505; val<=543; val+=2) {\n    map[val] = val-1;\n  }\n  for (val=1121; val<=1153; val+=2) {\n    map[val] = val-1;\n  }\n  for (val=1163; val<=1215; val+=2) {\n    map[val] = val-1;\n  }\n  for (val=1233; val<=1269; val+=2) {\n    map[val] = val-1;\n  }\n  for (val=7681; val<=7829; val+=2) {\n    map[val] = val-1;\n  }\n  for (val=7841; val<=7929; val+=2) {\n    map[val] = val-1;\n  }\n  ls = [\n307, 309, 311, 314, 316, 318, 320, 322,\n324, 326, 328, 378, 380, 382, 387, 389,\n392, 396, 402, 409, 417, 419, 421, 424,\n429, 432, 436, 438, 441, 445, 453, 456,\n459, 462, 464, 466, 468, 470, 472, 474,\n476, 479, 481, 483, 485, 487, 489, 491,\n493, 495, 498, 501, 547, 549, 551, 553,\n555, 557, 559, 561, 563, 985, 987, 989,\n991, 993, 995, 997, 999, 1001, 1003, 1005,\n1007, 1016, 1019, 1218, 1220, 1222, 1224, 1226,\n1228, 1230, 1273, 1281, 1283, 1285, 1287, 1289,\n1291, 1293, 1295,\n  ];\n  for (ix=0; ix<91; ix++) {\n    val = ls[ix];\n    map[val] = val-1;\n  }\n  for (val=8560; val<=8575; val+=1) {\n    map[val] = val-16;\n  }\n  for (val=9424; val<=9449; val+=1) {\n    map[val] = val-26;\n  }\n  for (val=97; val<=122; val+=1) {\n    map[val] = val-32;\n  }\n  for (val=224; val<=246; val+=1) {\n    map[val] = val-32;\n  }\n  for (val=945; val<=961; val+=1) {\n    map[val] = val-32;\n  }\n  for (val=1072; val<=1103; val+=1) {\n    map[val] = val-32;\n  }\n  for (val=65345; val<=65370; val+=1) {\n    map[val] = val-32;\n  }\n  ls = [\n248, 249, 250, 251, 252, 253, 254, 963,\n964, 965, 966, 967, 968, 969, 970, 971,\n  ];\n  for (ix=0; ix<16; ix++) {\n    val = ls[ix];\n    map[val] = val-32;\n  }\n  for (val=66600; val<=66639; val+=1) {\n    map[val] = val-40;\n  }\n  for (val=1377; val<=1414; val+=1) {\n    map[val] = val-48;\n  }\n  for (val=1104; val<=1119; val+=1) {\n    map[val] = val-80;\n  }\n  map[1009] = 929;\n})();\n\n/* list all the special cases in unicode_lower_table */\nvar unicode_lower_table = {\n304: [ 105,775 ], 376: 255, 385: 595, 390: 596, 393: 598,\n394: 599, 398: 477, 399: 601, 400: 603, 403: 608,\n404: 611, 406: 617, 407: 616, 412: 623, 413: 626,\n415: 629, 422: 640, 425: 643, 430: 648, 433: 650,\n434: 651, 439: 658, 452: 454, 455: 457, 458: 460,\n497: 499, 502: 405, 503: 447, 544: 414, 902: 940,\n904: 941, 905: 942, 906: 943, 908: 972, 910: 973,\n911: 974, 1012: 952, 1017: 1010, 8122: 8048, 8123: 8049,\n8124: 8115, 8136: 8050, 8137: 8051, 8138: 8052, 8139: 8053,\n8140: 8131, 8154: 8054, 8155: 8055, 8170: 8058, 8171: 8059,\n8172: 8165, 8184: 8056, 8185: 8057, 8186: 8060, 8187: 8061,\n8188: 8179, 8486: 969, 8490: 107, 8491: 229\n};\n/* add all the regular cases to unicode_lower_table */\n(function() {\n  var ls, ix, val;\n  var map = unicode_lower_table;\n  for (val=1024; val<=1039; val+=1) {\n    map[val] = val+80;\n  }\n  for (val=1329; val<=1366; val+=1) {\n    map[val] = val+48;\n  }\n  for (val=66560; val<=66599; val+=1) {\n    map[val] = val+40;\n  }\n  for (val=65; val<=90; val+=1) {\n    map[val] = val+32;\n  }\n  for (val=192; val<=214; val+=1) {\n    map[val] = val+32;\n  }\n  for (val=913; val<=929; val+=1) {\n    map[val] = val+32;\n  }\n  for (val=1040; val<=1071; val+=1) {\n    map[val] = val+32;\n  }\n  for (val=65313; val<=65338; val+=1) {\n    map[val] = val+32;\n  }\n  ls = [\n216, 217, 218, 219, 220, 221, 222, 931,\n932, 933, 934, 935, 936, 937, 938, 939,\n  ];\n  for (ix=0; ix<16; ix++) {\n    val = ls[ix];\n    map[val] = val+32;\n  }\n  for (val=9398; val<=9423; val+=1) {\n    map[val] = val+26;\n  }\n  for (val=8544; val<=8559; val+=1) {\n    map[val] = val+16;\n  }\n  for (val=256; val<=302; val+=2) {\n    map[val] = val+1;\n  }\n  for (val=330; val<=374; val+=2) {\n    map[val] = val+1;\n  }\n  for (val=504; val<=542; val+=2) {\n    map[val] = val+1;\n  }\n  for (val=1120; val<=1152; val+=2) {\n    map[val] = val+1;\n  }\n  for (val=1162; val<=1214; val+=2) {\n    map[val] = val+1;\n  }\n  for (val=1232; val<=1268; val+=2) {\n    map[val] = val+1;\n  }\n  for (val=7680; val<=7828; val+=2) {\n    map[val] = val+1;\n  }\n  for (val=7840; val<=7928; val+=2) {\n    map[val] = val+1;\n  }\n  ls = [\n306, 308, 310, 313, 315, 317, 319, 321,\n323, 325, 327, 377, 379, 381, 386, 388,\n391, 395, 401, 408, 416, 418, 420, 423,\n428, 431, 435, 437, 440, 444, 453, 456,\n459, 461, 463, 465, 467, 469, 471, 473,\n475, 478, 480, 482, 484, 486, 488, 490,\n492, 494, 498, 500, 546, 548, 550, 552,\n554, 556, 558, 560, 562, 984, 986, 988,\n990, 992, 994, 996, 998, 1000, 1002, 1004,\n1006, 1015, 1018, 1217, 1219, 1221, 1223, 1225,\n1227, 1229, 1272, 1280, 1282, 1284, 1286, 1288,\n1290, 1292, 1294,\n  ];\n  for (ix=0; ix<91; ix++) {\n    val = ls[ix];\n    map[val] = val+1;\n  }\n  ls = [\n7944, 7945, 7946, 7947, 7948, 7949, 7950, 7951,\n7960, 7961, 7962, 7963, 7964, 7965, 7976, 7977,\n7978, 7979, 7980, 7981, 7982, 7983, 7992, 7993,\n7994, 7995, 7996, 7997, 7998, 7999, 8008, 8009,\n8010, 8011, 8012, 8013, 8025, 8027, 8029, 8031,\n8040, 8041, 8042, 8043, 8044, 8045, 8046, 8047,\n8072, 8073, 8074, 8075, 8076, 8077, 8078, 8079,\n8088, 8089, 8090, 8091, 8092, 8093, 8094, 8095,\n8104, 8105, 8106, 8107, 8108, 8109, 8110, 8111,\n8120, 8121, 8152, 8153, 8168, 8169,\n  ];\n  for (ix=0; ix<78; ix++) {\n    val = ls[ix];\n    map[val] = val-8;\n  }\n})();\n\n/* list all the special cases in unicode_title_table */\nvar unicode_title_table = {\n223: [ 83,115 ], 452: 453, 453: 453, 454: 453, 455: 456,\n456: 456, 457: 456, 458: 459, 459: 459, 460: 459,\n497: 498, 498: 498, 499: 498, 1415: [ 1333,1410 ], 8114: [ 8122,837 ],\n8115: 8124, 8116: [ 902,837 ], 8119: [ 913,834,837 ], 8124: 8124, 8130: [ 8138,837 ],\n8131: 8140, 8132: [ 905,837 ], 8135: [ 919,834,837 ], 8140: 8140, 8178: [ 8186,837 ],\n8179: 8188, 8180: [ 911,837 ], 8183: [ 937,834,837 ], 8188: 8188, 64256: [ 70,102 ],\n64257: [ 70,105 ], 64258: [ 70,108 ], 64259: [ 70,102,105 ], 64260: [ 70,102,108 ], 64261: [ 83,116 ],\n64262: [ 83,116 ], 64275: [ 1348,1398 ], 64276: [ 1348,1381 ], 64277: [ 1348,1387 ], 64278: [ 1358,1398 ],\n64279: [ 1348,1389 ]\n};\n/* add all the regular cases to unicode_title_table */\n(function() {\n  var ls, ix, val;\n  var map = unicode_title_table;\n  ls = [\n8072, 8073, 8074, 8075, 8076, 8077, 8078, 8079,\n8072, 8073, 8074, 8075, 8076, 8077, 8078, 8079,\n8088, 8089, 8090, 8091, 8092, 8093, 8094, 8095,\n8088, 8089, 8090, 8091, 8092, 8093, 8094, 8095,\n8104, 8105, 8106, 8107, 8108, 8109, 8110, 8111,\n8104, 8105, 8106, 8107, 8108, 8109, 8110, 8111,\n  ];\n  for (ix=0; ix<48; ix++) {\n    val = ls[ix];\n    map[ix+8064] = val;\n  }\n})();\n\n/* list all the special cases in unicode_decomp_table */\nvar unicode_decomp_table = {\n192: [ 65,768 ], 193: [ 65,769 ], 194: [ 65,770 ], 195: [ 65,771 ], 196: [ 65,776 ],\n197: [ 65,778 ], 199: [ 67,807 ], 200: [ 69,768 ], 201: [ 69,769 ], 202: [ 69,770 ],\n203: [ 69,776 ], 204: [ 73,768 ], 205: [ 73,769 ], 206: [ 73,770 ], 207: [ 73,776 ],\n209: [ 78,771 ], 210: [ 79,768 ], 211: [ 79,769 ], 212: [ 79,770 ], 213: [ 79,771 ],\n214: [ 79,776 ], 217: [ 85,768 ], 218: [ 85,769 ], 219: [ 85,770 ], 220: [ 85,776 ],\n221: [ 89,769 ], 224: [ 97,768 ], 225: [ 97,769 ], 226: [ 97,770 ], 227: [ 97,771 ],\n228: [ 97,776 ], 229: [ 97,778 ], 231: [ 99,807 ], 232: [ 101,768 ], 233: [ 101,769 ],\n234: [ 101,770 ], 235: [ 101,776 ], 236: [ 105,768 ], 237: [ 105,769 ], 238: [ 105,770 ],\n239: [ 105,776 ], 241: [ 110,771 ], 242: [ 111,768 ], 243: [ 111,769 ], 244: [ 111,770 ],\n245: [ 111,771 ], 246: [ 111,776 ], 249: [ 117,768 ], 250: [ 117,769 ], 251: [ 117,770 ],\n252: [ 117,776 ], 253: [ 121,769 ], 296: [ 73,771 ], 297: [ 105,771 ], 298: [ 73,772 ],\n299: [ 105,772 ], 300: [ 73,774 ], 301: [ 105,774 ], 302: [ 73,808 ], 303: [ 105,808 ],\n304: [ 73,775 ], 308: [ 74,770 ], 309: [ 106,770 ], 310: [ 75,807 ], 311: [ 107,807 ],\n313: [ 76,769 ], 314: [ 108,769 ], 315: [ 76,807 ], 316: [ 108,807 ], 317: [ 76,780 ],\n318: [ 108,780 ], 323: [ 78,769 ], 324: [ 110,769 ], 325: [ 78,807 ], 326: [ 110,807 ],\n327: [ 78,780 ], 328: [ 110,780 ], 332: [ 79,772 ], 333: [ 111,772 ], 334: [ 79,774 ],\n335: [ 111,774 ], 336: [ 79,779 ], 337: [ 111,779 ], 416: [ 79,795 ], 417: [ 111,795 ],\n431: [ 85,795 ], 432: [ 117,795 ], 478: [ 65,776,772 ], 479: [ 97,776,772 ], 480: [ 65,775,772 ],\n481: [ 97,775,772 ], 482: [ 198,772 ], 483: [ 230,772 ], 486: [ 71,780 ], 487: [ 103,780 ],\n488: [ 75,780 ], 489: [ 107,780 ], 490: [ 79,808 ], 491: [ 111,808 ], 492: [ 79,808,772 ],\n493: [ 111,808,772 ], 494: [ 439,780 ], 495: [ 658,780 ], 496: [ 106,780 ], 500: [ 71,769 ],\n501: [ 103,769 ], 542: [ 72,780 ], 543: [ 104,780 ], 550: [ 65,775 ], 551: [ 97,775 ],\n552: [ 69,807 ], 553: [ 101,807 ], 554: [ 79,776,772 ], 555: [ 111,776,772 ], 556: [ 79,771,772 ],\n557: [ 111,771,772 ], 558: [ 79,775 ], 559: [ 111,775 ], 560: [ 79,775,772 ], 561: [ 111,775,772 ],\n562: [ 89,772 ], 563: [ 121,772 ], 832: 768, 833: 769, 835: 787,\n836: [ 776,769 ], 884: 697, 894: 59, 901: [ 168,769 ], 902: [ 913,769 ],\n903: 183, 904: [ 917,769 ], 905: [ 919,769 ], 906: [ 921,769 ], 908: [ 927,769 ],\n910: [ 933,769 ], 911: [ 937,769 ], 912: [ 953,776,769 ], 938: [ 921,776 ], 939: [ 933,776 ],\n940: [ 945,769 ], 941: [ 949,769 ], 942: [ 951,769 ], 943: [ 953,769 ], 944: [ 965,776,769 ],\n970: [ 953,776 ], 971: [ 965,776 ], 972: [ 959,769 ], 973: [ 965,769 ], 974: [ 969,769 ],\n979: [ 978,769 ], 980: [ 978,776 ], 1024: [ 1045,768 ], 1025: [ 1045,776 ], 1027: [ 1043,769 ],\n1031: [ 1030,776 ], 1036: [ 1050,769 ], 1037: [ 1048,768 ], 1038: [ 1059,774 ], 1049: [ 1048,774 ],\n1081: [ 1080,774 ], 1104: [ 1077,768 ], 1105: [ 1077,776 ], 1107: [ 1075,769 ], 1111: [ 1110,776 ],\n1116: [ 1082,769 ], 1117: [ 1080,768 ], 1118: [ 1091,774 ], 1142: [ 1140,783 ], 1143: [ 1141,783 ],\n1217: [ 1046,774 ], 1218: [ 1078,774 ], 1232: [ 1040,774 ], 1233: [ 1072,774 ], 1234: [ 1040,776 ],\n1235: [ 1072,776 ], 1238: [ 1045,774 ], 1239: [ 1077,774 ], 1242: [ 1240,776 ], 1243: [ 1241,776 ],\n1244: [ 1046,776 ], 1245: [ 1078,776 ], 1246: [ 1047,776 ], 1247: [ 1079,776 ], 1250: [ 1048,772 ],\n1251: [ 1080,772 ], 1252: [ 1048,776 ], 1253: [ 1080,776 ], 1254: [ 1054,776 ], 1255: [ 1086,776 ],\n1258: [ 1256,776 ], 1259: [ 1257,776 ], 1260: [ 1069,776 ], 1261: [ 1101,776 ], 1262: [ 1059,772 ],\n1263: [ 1091,772 ], 1264: [ 1059,776 ], 1265: [ 1091,776 ], 1266: [ 1059,779 ], 1267: [ 1091,779 ],\n1268: [ 1063,776 ], 1269: [ 1095,776 ], 1272: [ 1067,776 ], 1273: [ 1099,776 ], 1570: [ 1575,1619 ],\n1571: [ 1575,1620 ], 1572: [ 1608,1620 ], 1573: [ 1575,1621 ], 1574: [ 1610,1620 ], 1728: [ 1749,1620 ],\n1730: [ 1729,1620 ], 1747: [ 1746,1620 ], 2345: [ 2344,2364 ], 2353: [ 2352,2364 ], 2356: [ 2355,2364 ],\n2392: [ 2325,2364 ], 2393: [ 2326,2364 ], 2394: [ 2327,2364 ], 2395: [ 2332,2364 ], 2396: [ 2337,2364 ],\n2397: [ 2338,2364 ], 2398: [ 2347,2364 ], 2399: [ 2351,2364 ], 2507: [ 2503,2494 ], 2508: [ 2503,2519 ],\n2524: [ 2465,2492 ], 2525: [ 2466,2492 ], 2527: [ 2479,2492 ], 2611: [ 2610,2620 ], 2614: [ 2616,2620 ],\n2649: [ 2582,2620 ], 2650: [ 2583,2620 ], 2651: [ 2588,2620 ], 2654: [ 2603,2620 ], 2888: [ 2887,2902 ],\n2891: [ 2887,2878 ], 2892: [ 2887,2903 ], 2908: [ 2849,2876 ], 2909: [ 2850,2876 ], 2964: [ 2962,3031 ],\n3018: [ 3014,3006 ], 3019: [ 3015,3006 ], 3020: [ 3014,3031 ], 3144: [ 3142,3158 ], 3264: [ 3263,3285 ],\n3271: [ 3270,3285 ], 3272: [ 3270,3286 ], 3274: [ 3270,3266 ], 3275: [ 3270,3266,3285 ], 3402: [ 3398,3390 ],\n3403: [ 3399,3390 ], 3404: [ 3398,3415 ], 3546: [ 3545,3530 ], 3548: [ 3545,3535 ], 3549: [ 3545,3535,3530 ],\n3550: [ 3545,3551 ], 3907: [ 3906,4023 ], 3917: [ 3916,4023 ], 3922: [ 3921,4023 ], 3927: [ 3926,4023 ],\n3932: [ 3931,4023 ], 3945: [ 3904,4021 ], 3955: [ 3953,3954 ], 3957: [ 3953,3956 ], 3958: [ 4018,3968 ],\n3960: [ 4019,3968 ], 3969: [ 3953,3968 ], 3987: [ 3986,4023 ], 3997: [ 3996,4023 ], 4002: [ 4001,4023 ],\n4007: [ 4006,4023 ], 4012: [ 4011,4023 ], 4025: [ 3984,4021 ], 4134: [ 4133,4142 ], 7835: [ 383,775 ],\n7960: [ 917,787 ], 7961: [ 917,788 ], 7962: [ 917,787,768 ], 7963: [ 917,788,768 ], 7964: [ 917,787,769 ],\n7965: [ 917,788,769 ], 8008: [ 927,787 ], 8009: [ 927,788 ], 8010: [ 927,787,768 ], 8011: [ 927,788,768 ],\n8012: [ 927,787,769 ], 8013: [ 927,788,769 ], 8016: [ 965,787 ], 8017: [ 965,788 ], 8018: [ 965,787,768 ],\n8019: [ 965,788,768 ], 8020: [ 965,787,769 ], 8021: [ 965,788,769 ], 8022: [ 965,787,834 ], 8023: [ 965,788,834 ],\n8025: [ 933,788 ], 8027: [ 933,788,768 ], 8029: [ 933,788,769 ], 8118: [ 945,834 ], 8119: [ 945,834,837 ],\n8120: [ 913,774 ], 8121: [ 913,772 ], 8122: [ 913,768 ], 8123: [ 913,769 ], 8124: [ 913,837 ],\n8126: 953, 8129: [ 168,834 ], 8130: [ 951,768,837 ], 8131: [ 951,837 ], 8132: [ 951,769,837 ],\n8134: [ 951,834 ], 8135: [ 951,834,837 ], 8136: [ 917,768 ], 8137: [ 917,769 ], 8138: [ 919,768 ],\n8139: [ 919,769 ], 8140: [ 919,837 ], 8141: [ 8127,768 ], 8142: [ 8127,769 ], 8143: [ 8127,834 ],\n8144: [ 953,774 ], 8145: [ 953,772 ], 8146: [ 953,776,768 ], 8147: [ 953,776,769 ], 8150: [ 953,834 ],\n8151: [ 953,776,834 ], 8152: [ 921,774 ], 8153: [ 921,772 ], 8154: [ 921,768 ], 8155: [ 921,769 ],\n8178: [ 969,768,837 ], 8179: [ 969,837 ], 8180: [ 969,769,837 ], 8182: [ 969,834 ], 8183: [ 969,834,837 ],\n8184: [ 927,768 ], 8185: [ 927,769 ], 8186: [ 937,768 ], 8187: [ 937,769 ], 8188: [ 937,837 ],\n8189: 180, 8192: 8194, 8193: 8195, 8486: 937, 8490: 75,\n8491: [ 65,778 ], 8602: [ 8592,824 ], 8603: [ 8594,824 ], 8622: [ 8596,824 ], 8653: [ 8656,824 ],\n8654: [ 8660,824 ], 8655: [ 8658,824 ], 8708: [ 8707,824 ], 8713: [ 8712,824 ], 8716: [ 8715,824 ],\n8740: [ 8739,824 ], 8742: [ 8741,824 ], 8769: [ 8764,824 ], 8772: [ 8771,824 ], 8775: [ 8773,824 ],\n8777: [ 8776,824 ], 8800: [ 61,824 ], 8802: [ 8801,824 ], 8813: [ 8781,824 ], 8814: [ 60,824 ],\n8815: [ 62,824 ], 8816: [ 8804,824 ], 8817: [ 8805,824 ], 8820: [ 8818,824 ], 8821: [ 8819,824 ],\n8824: [ 8822,824 ], 8825: [ 8823,824 ], 8832: [ 8826,824 ], 8833: [ 8827,824 ], 8836: [ 8834,824 ],\n8837: [ 8835,824 ], 8840: [ 8838,824 ], 8841: [ 8839,824 ], 8876: [ 8866,824 ], 8877: [ 8872,824 ],\n8878: [ 8873,824 ], 8879: [ 8875,824 ], 8928: [ 8828,824 ], 8929: [ 8829,824 ], 8930: [ 8849,824 ],\n8931: [ 8850,824 ], 8938: [ 8882,824 ], 8939: [ 8883,824 ], 8940: [ 8884,824 ], 8941: [ 8885,824 ],\n9001: 12296, 9002: 12297, 10972: [ 10973,824 ], 12364: [ 12363,12441 ], 12366: [ 12365,12441 ],\n12368: [ 12367,12441 ], 12370: [ 12369,12441 ], 12372: [ 12371,12441 ], 12374: [ 12373,12441 ], 12376: [ 12375,12441 ],\n12378: [ 12377,12441 ], 12380: [ 12379,12441 ], 12382: [ 12381,12441 ], 12384: [ 12383,12441 ], 12386: [ 12385,12441 ],\n12389: [ 12388,12441 ], 12391: [ 12390,12441 ], 12393: [ 12392,12441 ], 12400: [ 12399,12441 ], 12401: [ 12399,12442 ],\n12403: [ 12402,12441 ], 12404: [ 12402,12442 ], 12406: [ 12405,12441 ], 12407: [ 12405,12442 ], 12409: [ 12408,12441 ],\n12410: [ 12408,12442 ], 12412: [ 12411,12441 ], 12413: [ 12411,12442 ], 12436: [ 12358,12441 ], 12446: [ 12445,12441 ],\n12460: [ 12459,12441 ], 12462: [ 12461,12441 ], 12464: [ 12463,12441 ], 12466: [ 12465,12441 ], 12468: [ 12467,12441 ],\n12470: [ 12469,12441 ], 12472: [ 12471,12441 ], 12474: [ 12473,12441 ], 12476: [ 12475,12441 ], 12478: [ 12477,12441 ],\n12480: [ 12479,12441 ], 12482: [ 12481,12441 ], 12485: [ 12484,12441 ], 12487: [ 12486,12441 ], 12489: [ 12488,12441 ],\n12496: [ 12495,12441 ], 12497: [ 12495,12442 ], 12499: [ 12498,12441 ], 12500: [ 12498,12442 ], 12502: [ 12501,12441 ],\n12503: [ 12501,12442 ], 12505: [ 12504,12441 ], 12506: [ 12504,12442 ], 12508: [ 12507,12441 ], 12509: [ 12507,12442 ],\n12532: [ 12454,12441 ], 12535: [ 12527,12441 ], 12536: [ 12528,12441 ], 12537: [ 12529,12441 ], 12538: [ 12530,12441 ],\n12542: [ 12541,12441 ], 64016: 22618, 64018: 26228, 64021: 20958, 64022: 29482,\n64023: 30410, 64024: 31036, 64025: 31070, 64026: 31077, 64027: 31119,\n64028: 38742, 64029: 31934, 64030: 32701, 64032: 34322, 64034: 35576,\n64037: 36920, 64038: 37117, 64042: 39151, 64043: 39164, 64044: 39208,\n64045: 40372, 64285: [ 1497,1460 ], 64287: [ 1522,1463 ], 64298: [ 1513,1473 ], 64299: [ 1513,1474 ],\n64300: [ 1513,1468,1473 ], 64301: [ 1513,1468,1474 ], 64302: [ 1488,1463 ], 64303: [ 1488,1464 ], 64304: [ 1488,1468 ],\n64305: [ 1489,1468 ], 64306: [ 1490,1468 ], 64307: [ 1491,1468 ], 64308: [ 1492,1468 ], 64309: [ 1493,1468 ],\n64310: [ 1494,1468 ], 64312: [ 1496,1468 ], 64313: [ 1497,1468 ], 64314: [ 1498,1468 ], 64315: [ 1499,1468 ],\n64316: [ 1500,1468 ], 64318: [ 1502,1468 ], 64320: [ 1504,1468 ], 64321: [ 1505,1468 ], 64323: [ 1507,1468 ],\n64324: [ 1508,1468 ], 64326: [ 1510,1468 ], 64327: [ 1511,1468 ], 64328: [ 1512,1468 ], 64329: [ 1513,1468 ],\n64330: [ 1514,1468 ], 64331: [ 1493,1465 ], 64332: [ 1489,1471 ], 64333: [ 1499,1471 ], 64334: [ 1508,1471 ],\n119134: [ 119127,119141 ], 119135: [ 119128,119141 ], 119136: [ 119128,119141,119150 ], 119137: [ 119128,119141,119151 ], 119138: [ 119128,119141,119152 ],\n119139: [ 119128,119141,119153 ], 119140: [ 119128,119141,119154 ], 119227: [ 119225,119141 ], 119228: [ 119226,119141 ], 119229: [ 119225,119141,119150 ],\n119230: [ 119226,119141,119150 ], 119231: [ 119225,119141,119151 ], 119232: [ 119226,119141,119151 ]\n};\n/* add all the regular cases to unicode_decomp_table */\n(function() {\n  var ls, ix, val;\n  var map = unicode_decomp_table;\n  ls = [\n[121,776], [65,772], [97,772], [65,774], [97,774], [65,808], [97,808], [67,769],\n[99,769], [67,770], [99,770], [67,775], [99,775], [67,780], [99,780], [68,780],\n[100,780],\n  ];\n  for (ix=0; ix<17; ix++) {\n    val = ls[ix];\n    map[ix+255] = val;\n  }\n  ls = [\n[69,772], [101,772], [69,774], [101,774], [69,775], [101,775], [69,808], [101,808],\n[69,780], [101,780], [71,770], [103,770], [71,774], [103,774], [71,775], [103,775],\n[71,807], [103,807], [72,770], [104,770],\n  ];\n  for (ix=0; ix<20; ix++) {\n    val = ls[ix];\n    map[ix+274] = val;\n  }\n  ls = [\n[82,769], [114,769], [82,807], [114,807], [82,780], [114,780], [83,769], [115,769],\n[83,770], [115,770], [83,807], [115,807], [83,780], [115,780], [84,807], [116,807],\n[84,780], [116,780],\n  ];\n  for (ix=0; ix<18; ix++) {\n    val = ls[ix];\n    map[ix+340] = val;\n  }\n  ls = [\n[85,771], [117,771], [85,772], [117,772], [85,774], [117,774], [85,778], [117,778],\n[85,779], [117,779], [85,808], [117,808], [87,770], [119,770], [89,770], [121,770],\n[89,776], [90,769], [122,769], [90,775], [122,775], [90,780], [122,780],\n  ];\n  for (ix=0; ix<23; ix++) {\n    val = ls[ix];\n    map[ix+360] = val;\n  }\n  ls = [\n[65,780], [97,780], [73,780], [105,780], [79,780], [111,780], [85,780], [117,780],\n[85,776,772], [117,776,772], [85,776,769], [117,776,769], [85,776,780], [117,776,780], [85,776,768], [117,776,768],\n  ];\n  for (ix=0; ix<16; ix++) {\n    val = ls[ix];\n    map[ix+461] = val;\n  }\n  ls = [\n[78,768], [110,768], [65,778,769], [97,778,769], [198,769], [230,769], [216,769], [248,769],\n[65,783], [97,783], [65,785], [97,785], [69,783], [101,783], [69,785], [101,785],\n[73,783], [105,783], [73,785], [105,785], [79,783], [111,783], [79,785], [111,785],\n[82,783], [114,783], [82,785], [114,785], [85,783], [117,783], [85,785], [117,785],\n[83,806], [115,806], [84,806], [116,806],\n  ];\n  for (ix=0; ix<36; ix++) {\n    val = ls[ix];\n    map[ix+504] = val;\n  }\n  ls = [\n[65,805], [97,805], [66,775], [98,775], [66,803], [98,803], [66,817], [98,817],\n[67,807,769], [99,807,769], [68,775], [100,775], [68,803], [100,803], [68,817], [100,817],\n[68,807], [100,807], [68,813], [100,813], [69,772,768], [101,772,768], [69,772,769], [101,772,769],\n[69,813], [101,813], [69,816], [101,816], [69,807,774], [101,807,774], [70,775], [102,775],\n[71,772], [103,772], [72,775], [104,775], [72,803], [104,803], [72,776], [104,776],\n[72,807], [104,807], [72,814], [104,814], [73,816], [105,816], [73,776,769], [105,776,769],\n[75,769], [107,769], [75,803], [107,803], [75,817], [107,817], [76,803], [108,803],\n[76,803,772], [108,803,772], [76,817], [108,817], [76,813], [108,813], [77,769], [109,769],\n[77,775], [109,775], [77,803], [109,803], [78,775], [110,775], [78,803], [110,803],\n[78,817], [110,817], [78,813], [110,813], [79,771,769], [111,771,769], [79,771,776], [111,771,776],\n[79,772,768], [111,772,768], [79,772,769], [111,772,769], [80,769], [112,769], [80,775], [112,775],\n[82,775], [114,775], [82,803], [114,803], [82,803,772], [114,803,772], [82,817], [114,817],\n[83,775], [115,775], [83,803], [115,803], [83,769,775], [115,769,775], [83,780,775], [115,780,775],\n[83,803,775], [115,803,775], [84,775], [116,775], [84,803], [116,803], [84,817], [116,817],\n[84,813], [116,813], [85,804], [117,804], [85,816], [117,816], [85,813], [117,813],\n[85,771,769], [117,771,769], [85,772,776], [117,772,776], [86,771], [118,771], [86,803], [118,803],\n[87,768], [119,768], [87,769], [119,769], [87,776], [119,776], [87,775], [119,775],\n[87,803], [119,803], [88,775], [120,775], [88,776], [120,776], [89,775], [121,775],\n[90,770], [122,770], [90,803], [122,803], [90,817], [122,817], [104,817], [116,776],\n[119,778], [121,778],\n  ];\n  for (ix=0; ix<154; ix++) {\n    val = ls[ix];\n    map[ix+7680] = val;\n  }\n  ls = [\n[65,803], [97,803], [65,777], [97,777], [65,770,769], [97,770,769], [65,770,768], [97,770,768],\n[65,770,777], [97,770,777], [65,770,771], [97,770,771], [65,803,770], [97,803,770], [65,774,769], [97,774,769],\n[65,774,768], [97,774,768], [65,774,777], [97,774,777], [65,774,771], [97,774,771], [65,803,774], [97,803,774],\n[69,803], [101,803], [69,777], [101,777], [69,771], [101,771], [69,770,769], [101,770,769],\n[69,770,768], [101,770,768], [69,770,777], [101,770,777], [69,770,771], [101,770,771], [69,803,770], [101,803,770],\n[73,777], [105,777], [73,803], [105,803], [79,803], [111,803], [79,777], [111,777],\n[79,770,769], [111,770,769], [79,770,768], [111,770,768], [79,770,777], [111,770,777], [79,770,771], [111,770,771],\n[79,803,770], [111,803,770], [79,795,769], [111,795,769], [79,795,768], [111,795,768], [79,795,777], [111,795,777],\n[79,795,771], [111,795,771], [79,795,803], [111,795,803], [85,803], [117,803], [85,777], [117,777],\n[85,795,769], [117,795,769], [85,795,768], [117,795,768], [85,795,777], [117,795,777], [85,795,771], [117,795,771],\n[85,795,803], [117,795,803], [89,768], [121,768], [89,803], [121,803], [89,777], [121,777],\n[89,771], [121,771],\n  ];\n  for (ix=0; ix<90; ix++) {\n    val = ls[ix];\n    map[ix+7840] = val;\n  }\n  ls = [\n[945,787], [945,788], [945,787,768], [945,788,768], [945,787,769], [945,788,769], [945,787,834], [945,788,834],\n[913,787], [913,788], [913,787,768], [913,788,768], [913,787,769], [913,788,769], [913,787,834], [913,788,834],\n[949,787], [949,788], [949,787,768], [949,788,768], [949,787,769], [949,788,769],\n  ];\n  for (ix=0; ix<22; ix++) {\n    val = ls[ix];\n    map[ix+7936] = val;\n  }\n  ls = [\n[951,787], [951,788], [951,787,768], [951,788,768], [951,787,769], [951,788,769], [951,787,834], [951,788,834],\n[919,787], [919,788], [919,787,768], [919,788,768], [919,787,769], [919,788,769], [919,787,834], [919,788,834],\n[953,787], [953,788], [953,787,768], [953,788,768], [953,787,769], [953,788,769], [953,787,834], [953,788,834],\n[921,787], [921,788], [921,787,768], [921,788,768], [921,787,769], [921,788,769], [921,787,834], [921,788,834],\n[959,787], [959,788], [959,787,768], [959,788,768], [959,787,769], [959,788,769],\n  ];\n  for (ix=0; ix<38; ix++) {\n    val = ls[ix];\n    map[ix+7968] = val;\n  }\n  ls = [\n[933,788,834], [969,787], [969,788], [969,787,768], [969,788,768], [969,787,769], [969,788,769], [969,787,834],\n[969,788,834], [937,787], [937,788], [937,787,768], [937,788,768], [937,787,769], [937,788,769], [937,787,834],\n[937,788,834], [945,768], [945,769], [949,768], [949,769], [951,768], [951,769], [953,768],\n[953,769], [959,768], [959,769], [965,768], [965,769], [969,768], [969,769],\n  ];\n  for (ix=0; ix<31; ix++) {\n    val = ls[ix];\n    map[ix+8031] = val;\n  }\n  ls = [\n[945,787,837], [945,788,837], [945,787,768,837], [945,788,768,837], [945,787,769,837], [945,788,769,837], [945,787,834,837], [945,788,834,837],\n[913,787,837], [913,788,837], [913,787,768,837], [913,788,768,837], [913,787,769,837], [913,788,769,837], [913,787,834,837], [913,788,834,837],\n[951,787,837], [951,788,837], [951,787,768,837], [951,788,768,837], [951,787,769,837], [951,788,769,837], [951,787,834,837], [951,788,834,837],\n[919,787,837], [919,788,837], [919,787,768,837], [919,788,768,837], [919,787,769,837], [919,788,769,837], [919,787,834,837], [919,788,834,837],\n[969,787,837], [969,788,837], [969,787,768,837], [969,788,768,837], [969,787,769,837], [969,788,769,837], [969,787,834,837], [969,788,834,837],\n[937,787,837], [937,788,837], [937,787,768,837], [937,788,768,837], [937,787,769,837], [937,788,769,837], [937,787,834,837], [937,788,834,837],\n[945,774], [945,772], [945,768,837], [945,837], [945,769,837],\n  ];\n  for (ix=0; ix<53; ix++) {\n    val = ls[ix];\n    map[ix+8064] = val;\n  }\n  ls = [\n[8190,768], [8190,769], [8190,834], [965,774], [965,772], [965,776,768], [965,776,769], [961,787],\n[961,788], [965,834], [965,776,834], [933,774], [933,772], [933,768], [933,769], [929,788],\n[168,768], [168,769], 96,\n  ];\n  for (ix=0; ix<19; ix++) {\n    val = ls[ix];\n    map[ix+8157] = val;\n  }\n  ls = [\n35912, 26356, 36554, 36040, 28369, 20018, 21477, 40860,\n40860, 22865, 37329, 21895, 22856, 25078, 30313, 32645,\n34367, 34746, 35064, 37007, 27138, 27931, 28889, 29662,\n33853, 37226, 39409, 20098, 21365, 27396, 29211, 34349,\n40478, 23888, 28651, 34253, 35172, 25289, 33240, 34847,\n24266, 26391, 28010, 29436, 37070, 20358, 20919, 21214,\n25796, 27347, 29200, 30439, 32769, 34310, 34396, 36335,\n38706, 39791, 40442, 30860, 31103, 32160, 33737, 37636,\n40575, 35542, 22751, 24324, 31840, 32894, 29282, 30922,\n36034, 38647, 22744, 23650, 27155, 28122, 28431, 32047,\n32311, 38475, 21202, 32907, 20956, 20940, 31260, 32190,\n33777, 38517, 35712, 25295, 27138, 35582, 20025, 23527,\n24594, 29575, 30064, 21271, 30971, 20415, 24489, 19981,\n27852, 25976, 32034, 21443, 22622, 30465, 33865, 35498,\n27578, 36784, 27784, 25342, 33509, 25504, 30053, 20142,\n20841, 20937, 26753, 31975, 33391, 35538, 37327, 21237,\n21570, 22899, 24300, 26053, 28670, 31018, 38317, 39530,\n40599, 40654, 21147, 26310, 27511, 36706, 24180, 24976,\n25088, 25754, 28451, 29001, 29833, 31178, 32244, 32879,\n36646, 34030, 36899, 37706, 21015, 21155, 21693, 28872,\n35010, 35498, 24265, 24565, 25467, 27566, 31806, 29557,\n20196, 22265, 23527, 23994, 24604, 29618, 29801, 32666,\n32838, 37428, 38646, 38728, 38936, 20363, 31150, 37300,\n38584, 24801, 20102, 20698, 23534, 23615, 26009, 27138,\n29134, 30274, 34044, 36988, 40845, 26248, 38446, 21129,\n26491, 26611, 27969, 28316, 29705, 30041, 30827, 32016,\n39006, 20845, 25134, 38520, 20523, 23833, 28138, 36650,\n24459, 24900, 26647, 29575, 38534, 21033, 21519, 23653,\n26131, 26446, 26792, 27877, 29702, 30178, 32633, 35023,\n35041, 37324, 38626, 21311, 28346, 21533, 29136, 29848,\n34298, 38563, 40023, 40607, 26519, 28107, 33256, 31435,\n31520, 31890, 29376, 28825, 35672, 20160, 33590, 21050,\n20999, 24230, 25299, 31958, 23429, 27934, 26292, 36667,\n34892, 38477, 35211, 24275, 20800, 21952,\n  ];\n  for (ix=0; ix<270; ix++) {\n    val = ls[ix];\n    map[ix+63744] = val;\n  }\n  ls = [\n20398, 20711, 20813, 21193, 21220, 21329, 21917, 22022,\n22120, 22592, 22696, 23652, 23662, 24724, 24936, 24974,\n25074, 25935, 26082, 26257, 26757, 28023, 28186, 28450,\n29038, 29227, 29730, 30865, 31038, 31049, 31048, 31056,\n31062, 31069, 31117, 31118, 31296, 31361, 31680, 32244,\n32265, 32321, 32626, 32773, 33261, 33401, 33401, 33879,\n35088, 35222, 35585, 35641, 36051, 36104, 36790, 36920,\n38627, 38911, 38971,\n  ];\n  for (ix=0; ix<59; ix++) {\n    val = ls[ix];\n    map[ix+64048] = val;\n  }\n  ls = [\n20029, 20024, 20033, 131362, 20320, 20398, 20411, 20482,\n20602, 20633, 20711, 20687, 13470, 132666, 20813, 20820,\n20836, 20855, 132380, 13497, 20839, 20877, 132427, 20887,\n20900, 20172, 20908, 20917, 168415, 20981, 20995, 13535,\n21051, 21062, 21106, 21111, 13589, 21191, 21193, 21220,\n21242, 21253, 21254, 21271, 21321, 21329, 21338, 21363,\n21373, 21375, 21375, 21375, 133676, 28784, 21450, 21471,\n133987, 21483, 21489, 21510, 21662, 21560, 21576, 21608,\n21666, 21750, 21776, 21843, 21859, 21892, 21892, 21913,\n21931, 21939, 21954, 22294, 22022, 22295, 22097, 22132,\n20999, 22766, 22478, 22516, 22541, 22411, 22578, 22577,\n22700, 136420, 22770, 22775, 22790, 22810, 22818, 22882,\n136872, 136938, 23020, 23067, 23079, 23000, 23142, 14062,\n14076, 23304, 23358, 23358, 137672, 23491, 23512, 23527,\n23539, 138008, 23551, 23558, 24403, 23586, 14209, 23648,\n23662, 23744, 23693, 138724, 23875, 138726, 23918, 23915,\n23932, 24033, 24034, 14383, 24061, 24104, 24125, 24169,\n14434, 139651, 14460, 24240, 24243, 24246, 24266, 172946,\n24318, 140081, 140081, 33281, 24354, 24354, 14535, 144056,\n156122, 24418, 24427, 14563, 24474, 24525, 24535, 24569,\n24705, 14650, 14620, 24724, 141012, 24775, 24904, 24908,\n24910, 24908, 24954, 24974, 25010, 24996, 25007, 25054,\n25074, 25078, 25104, 25115, 25181, 25265, 25300, 25424,\n142092, 25405, 25340, 25448, 25475, 25572, 142321, 25634,\n25541, 25513, 14894, 25705, 25726, 25757, 25719, 14956,\n25935, 25964, 143370, 26083, 26360, 26185, 15129, 26257,\n15112, 15076, 20882, 20885, 26368, 26268, 32941, 17369,\n26391, 26395, 26401, 26462, 26451, 144323, 15177, 26618,\n26501, 26706, 26757, 144493, 26766, 26655, 26900, 15261,\n26946, 27043, 27114, 27304, 145059, 27355, 15384, 27425,\n145575, 27476, 15438, 27506, 27551, 27578, 27579, 146061,\n138507, 146170, 27726, 146620, 27839, 27853, 27751, 27926,\n27966, 28023, 27969, 28009, 28024, 28037, 146718, 27956,\n28207, 28270, 15667, 28363, 28359, 147153, 28153, 28526,\n147294, 147342, 28614, 28729, 28702, 28699, 15766, 28746,\n28797, 28791, 28845, 132389, 28997, 148067, 29084, 148395,\n29224, 29237, 29264, 149000, 29312, 29333, 149301, 149524,\n29562, 29579, 16044, 29605, 16056, 16056, 29767, 29788,\n29809, 29829, 29898, 16155, 29988, 150582, 30014, 150674,\n30064, 139679, 30224, 151457, 151480, 151620, 16380, 16392,\n30452, 151795, 151794, 151833, 151859, 30494, 30495, 30495,\n30538, 16441, 30603, 16454, 16534, 152605, 30798, 30860,\n30924, 16611, 153126, 31062, 153242, 153285, 31119, 31211,\n16687, 31296, 31306, 31311, 153980, 154279, 154279, 31470,\n16898, 154539, 31686, 31689, 16935, 154752, 31954, 17056,\n31976, 31971, 32000, 155526, 32099, 17153, 32199, 32258,\n32325, 17204, 156200, 156231, 17241, 156377, 32634, 156478,\n32661, 32762, 32773, 156890, 156963, 32864, 157096, 32880,\n144223, 17365, 32946, 33027, 17419, 33086, 23221, 157607,\n157621, 144275, 144284, 33281, 33284, 36766, 17515, 33425,\n33419, 33437, 21171, 33457, 33459, 33469, 33510, 158524,\n33509, 33565, 33635, 33709, 33571, 33725, 33767, 33879,\n33619, 33738, 33740, 33756, 158774, 159083, 158933, 17707,\n34033, 34035, 34070, 160714, 34148, 159532, 17757, 17761,\n159665, 159954, 17771, 34384, 34396, 34407, 34409, 34473,\n34440, 34574, 34530, 34681, 34600, 34667, 34694, 17879,\n34785, 34817, 17913, 34912, 34915, 161383, 35031, 35038,\n17973, 35066, 13499, 161966, 162150, 18110, 18119, 35488,\n35565, 35722, 35925, 162984, 36011, 36033, 36123, 36215,\n163631, 133124, 36299, 36284, 36336, 133342, 36564, 36664,\n165330, 165357, 37012, 37105, 37137, 165678, 37147, 37432,\n37591, 37592, 37500, 37881, 37909, 166906, 38283, 18837,\n38327, 167287, 18918, 38595, 23986, 38691, 168261, 168474,\n19054, 19062, 38880, 168970, 19122, 169110, 38923, 38923,\n38953, 169398, 39138, 19251, 39209, 39335, 39362, 39422,\n19406, 170800, 39698, 40000, 40189, 19662, 19693, 40295,\n172238, 19704, 172293, 172558, 172689, 40635, 19798, 40697,\n40702, 40709, 40719, 40726, 40763, 173568,\n  ];\n  for (ix=0; ix<542; ix++) {\n    val = ls[ix];\n    map[ix+194560] = val;\n  }\n})();\n\n/* list all the special cases in unicode_combin_table */\nvar unicode_combin_table = {\n768: 230, 769: 230, 770: 230, 771: 230, 772: 230,\n773: 230, 774: 230, 775: 230, 776: 230, 777: 230,\n778: 230, 779: 230, 780: 230, 781: 230, 782: 230,\n783: 230, 784: 230, 785: 230, 786: 230, 787: 230,\n788: 230, 789: 232, 790: 220, 791: 220, 792: 220,\n793: 220, 794: 232, 795: 216, 796: 220, 797: 220,\n798: 220, 799: 220, 800: 220, 801: 202, 802: 202,\n803: 220, 804: 220, 805: 220, 806: 220, 807: 202,\n808: 202, 809: 220, 810: 220, 811: 220, 812: 220,\n813: 220, 814: 220, 815: 220, 816: 220, 817: 220,\n818: 220, 819: 220, 820: 1, 821: 1, 822: 1,\n823: 1, 824: 1, 825: 220, 826: 220, 827: 220,\n828: 220, 829: 230, 830: 230, 831: 230, 832: 230,\n833: 230, 834: 230, 835: 230, 836: 230, 837: 240,\n838: 230, 839: 220, 840: 220, 841: 220, 842: 230,\n843: 230, 844: 230, 845: 220, 846: 220, 848: 230,\n849: 230, 850: 230, 851: 220, 852: 220, 853: 220,\n854: 220, 855: 230, 861: 234, 862: 234, 863: 233,\n864: 234, 865: 234, 866: 233, 867: 230, 868: 230,\n869: 230, 870: 230, 871: 230, 872: 230, 873: 230,\n874: 230, 875: 230, 876: 230, 877: 230, 878: 230,\n879: 230, 1155: 230, 1156: 230, 1157: 230, 1158: 230,\n1425: 220, 1426: 230, 1427: 230, 1428: 230, 1429: 230,\n1430: 220, 1431: 230, 1432: 230, 1433: 230, 1434: 222,\n1435: 220, 1436: 230, 1437: 230, 1438: 230, 1439: 230,\n1440: 230, 1441: 230, 1443: 220, 1444: 220, 1445: 220,\n1446: 220, 1447: 220, 1448: 230, 1449: 230, 1450: 220,\n1451: 230, 1452: 230, 1453: 222, 1454: 228, 1455: 230,\n1456: 10, 1457: 11, 1458: 12, 1459: 13, 1460: 14,\n1461: 15, 1462: 16, 1463: 17, 1464: 18, 1465: 19,\n1467: 20, 1468: 21, 1469: 22, 1471: 23, 1473: 24,\n1474: 25, 1476: 230, 1552: 230, 1553: 230, 1554: 230,\n1555: 230, 1556: 230, 1557: 230, 1611: 27, 1612: 28,\n1613: 29, 1614: 30, 1615: 31, 1616: 32, 1617: 33,\n1618: 34, 1619: 230, 1620: 230, 1621: 220, 1622: 220,\n1623: 230, 1624: 230, 1648: 35, 1750: 230, 1751: 230,\n1752: 230, 1753: 230, 1754: 230, 1755: 230, 1756: 230,\n1759: 230, 1760: 230, 1761: 230, 1762: 230, 1763: 220,\n1764: 230, 1767: 230, 1768: 230, 1770: 220, 1771: 230,\n1772: 230, 1773: 220, 1809: 36, 1840: 230, 1841: 220,\n1842: 230, 1843: 230, 1844: 220, 1845: 230, 1846: 230,\n1847: 220, 1848: 220, 1849: 220, 1850: 230, 1851: 220,\n1852: 220, 1853: 230, 1854: 220, 1855: 230, 1856: 230,\n1857: 230, 1858: 220, 1859: 230, 1860: 220, 1861: 230,\n1862: 220, 1863: 230, 1864: 220, 1865: 230, 1866: 230,\n2364: 7, 2381: 9, 2385: 230, 2386: 220, 2387: 230,\n2388: 230, 2492: 7, 2509: 9, 2620: 7, 2637: 9,\n2748: 7, 2765: 9, 2876: 7, 2893: 9, 3021: 9,\n3149: 9, 3157: 84, 3158: 91, 3260: 7, 3277: 9,\n3405: 9, 3530: 9, 3640: 103, 3641: 103, 3642: 9,\n3656: 107, 3657: 107, 3658: 107, 3659: 107, 3768: 118,\n3769: 118, 3784: 122, 3785: 122, 3786: 122, 3787: 122,\n3864: 220, 3865: 220, 3893: 220, 3895: 220, 3897: 216,\n3953: 129, 3954: 130, 3956: 132, 3962: 130, 3963: 130,\n3964: 130, 3965: 130, 3968: 130, 3970: 230, 3971: 230,\n3972: 9, 3974: 230, 3975: 230, 4038: 220, 4151: 7,\n4153: 9, 5908: 9, 5940: 9, 6098: 9, 6109: 230,\n6313: 228, 6457: 222, 6458: 230, 6459: 220, 8400: 230,\n8401: 230, 8402: 1, 8403: 1, 8404: 230, 8405: 230,\n8406: 230, 8407: 230, 8408: 1, 8409: 1, 8410: 1,\n8411: 230, 8412: 230, 8417: 230, 8421: 1, 8422: 1,\n8423: 230, 8424: 220, 8425: 230, 8426: 1, 12330: 218,\n12331: 228, 12332: 232, 12333: 222, 12334: 224, 12335: 224,\n12441: 8, 12442: 8, 64286: 26, 65056: 230, 65057: 230,\n65058: 230, 65059: 230, 119141: 216, 119142: 216, 119143: 1,\n119144: 1, 119145: 1, 119149: 226, 119150: 216, 119151: 216,\n119152: 216, 119153: 216, 119154: 216, 119163: 220, 119164: 220,\n119165: 220, 119166: 220, 119167: 220, 119168: 220, 119169: 220,\n119170: 220, 119173: 230, 119174: 230, 119175: 230, 119176: 230,\n119177: 230, 119178: 220, 119179: 220, 119210: 230, 119211: 230,\n119212: 230, 119213: 230\n};\n\n/* list all of unicode_compo_table */\nvar unicode_compo_table = {\n 60: { 824:8814 },\n 61: { 824:8800 },\n 62: { 824:8815 },\n 65: { 768:192, 769:193, 770:194, 771:195, 772:256, 774:258, 775:550, 776:196, 777:7842, 778:197, 780:461, 783:512, 785:514, 803:7840, 805:7680, 808:260 },\n 66: { 775:7682, 803:7684, 817:7686 },\n 67: { 769:262, 770:264, 775:266, 780:268, 807:199 },\n 68: { 775:7690, 780:270, 803:7692, 807:7696, 813:7698, 817:7694 },\n 69: { 768:200, 769:201, 770:202, 771:7868, 772:274, 774:276, 775:278, 776:203, 777:7866, 780:282, 783:516, 785:518, 803:7864, 807:552, 808:280, 813:7704, 816:7706 },\n 70: { 775:7710 },\n 71: { 769:500, 770:284, 772:7712, 774:286, 775:288, 780:486, 807:290 },\n 72: { 770:292, 775:7714, 776:7718, 780:542, 803:7716, 807:7720, 814:7722 },\n 73: { 768:204, 769:205, 770:206, 771:296, 772:298, 774:300, 775:304, 776:207, 777:7880, 780:463, 783:520, 785:522, 803:7882, 808:302, 816:7724 },\n 74: { 770:308 },\n 75: { 769:7728, 780:488, 803:7730, 807:310, 817:7732 },\n 76: { 769:313, 780:317, 803:7734, 807:315, 813:7740, 817:7738 },\n 77: { 769:7742, 775:7744, 803:7746 },\n 78: { 768:504, 769:323, 771:209, 775:7748, 780:327, 803:7750, 807:325, 813:7754, 817:7752 },\n 79: { 768:210, 769:211, 770:212, 771:213, 772:332, 774:334, 775:558, 776:214, 777:7886, 779:336, 780:465, 783:524, 785:526, 795:416, 803:7884, 808:490 },\n 80: { 769:7764, 775:7766 },\n 82: { 769:340, 775:7768, 780:344, 783:528, 785:530, 803:7770, 807:342, 817:7774 },\n 83: { 769:346, 770:348, 775:7776, 780:352, 803:7778, 806:536, 807:350 },\n 84: { 775:7786, 780:356, 803:7788, 806:538, 807:354, 813:7792, 817:7790 },\n 85: { 768:217, 769:218, 770:219, 771:360, 772:362, 774:364, 776:220, 777:7910, 778:366, 779:368, 780:467, 783:532, 785:534, 795:431, 803:7908, 804:7794, 808:370, 813:7798, 816:7796 },\n 86: { 771:7804, 803:7806 },\n 87: { 768:7808, 769:7810, 770:372, 775:7814, 776:7812, 803:7816 },\n 88: { 775:7818, 776:7820 },\n 89: { 768:7922, 769:221, 770:374, 771:7928, 772:562, 775:7822, 776:376, 777:7926, 803:7924 },\n 90: { 769:377, 770:7824, 775:379, 780:381, 803:7826, 817:7828 },\n 97: { 768:224, 769:225, 770:226, 771:227, 772:257, 774:259, 775:551, 776:228, 777:7843, 778:229, 780:462, 783:513, 785:515, 803:7841, 805:7681, 808:261 },\n 98: { 775:7683, 803:7685, 817:7687 },\n 99: { 769:263, 770:265, 775:267, 780:269, 807:231 },\n 100: { 775:7691, 780:271, 803:7693, 807:7697, 813:7699, 817:7695 },\n 101: { 768:232, 769:233, 770:234, 771:7869, 772:275, 774:277, 775:279, 776:235, 777:7867, 780:283, 783:517, 785:519, 803:7865, 807:553, 808:281, 813:7705, 816:7707 },\n 102: { 775:7711 },\n 103: { 769:501, 770:285, 772:7713, 774:287, 775:289, 780:487, 807:291 },\n 104: { 770:293, 775:7715, 776:7719, 780:543, 803:7717, 807:7721, 814:7723, 817:7830 },\n 105: { 768:236, 769:237, 770:238, 771:297, 772:299, 774:301, 776:239, 777:7881, 780:464, 783:521, 785:523, 803:7883, 808:303, 816:7725 },\n 106: { 770:309, 780:496 },\n 107: { 769:7729, 780:489, 803:7731, 807:311, 817:7733 },\n 108: { 769:314, 780:318, 803:7735, 807:316, 813:7741, 817:7739 },\n 109: { 769:7743, 775:7745, 803:7747 },\n 110: { 768:505, 769:324, 771:241, 775:7749, 780:328, 803:7751, 807:326, 813:7755, 817:7753 },\n 111: { 768:242, 769:243, 770:244, 771:245, 772:333, 774:335, 775:559, 776:246, 777:7887, 779:337, 780:466, 783:525, 785:527, 795:417, 803:7885, 808:491 },\n 112: { 769:7765, 775:7767 },\n 114: { 769:341, 775:7769, 780:345, 783:529, 785:531, 803:7771, 807:343, 817:7775 },\n 115: { 769:347, 770:349, 775:7777, 780:353, 803:7779, 806:537, 807:351 },\n 116: { 775:7787, 776:7831, 780:357, 803:7789, 806:539, 807:355, 813:7793, 817:7791 },\n 117: { 768:249, 769:250, 770:251, 771:361, 772:363, 774:365, 776:252, 777:7911, 778:367, 779:369, 780:468, 783:533, 785:535, 795:432, 803:7909, 804:7795, 808:371, 813:7799, 816:7797 },\n 118: { 771:7805, 803:7807 },\n 119: { 768:7809, 769:7811, 770:373, 775:7815, 776:7813, 778:7832, 803:7817 },\n 120: { 775:7819, 776:7821 },\n 121: { 768:7923, 769:253, 770:375, 771:7929, 772:563, 775:7823, 776:255, 777:7927, 778:7833, 803:7925 },\n 122: { 769:378, 770:7825, 775:380, 780:382, 803:7827, 817:7829 },\n 168: { 768:8173, 769:901, 834:8129 },\n 194: { 768:7846, 769:7844, 771:7850, 777:7848 },\n 196: { 772:478 },\n 197: { 769:506 },\n 198: { 769:508, 772:482 },\n 199: { 769:7688 },\n 202: { 768:7872, 769:7870, 771:7876, 777:7874 },\n 207: { 769:7726 },\n 212: { 768:7890, 769:7888, 771:7894, 777:7892 },\n 213: { 769:7756, 772:556, 776:7758 },\n 214: { 772:554 },\n 216: { 769:510 },\n 220: { 768:475, 769:471, 772:469, 780:473 },\n 226: { 768:7847, 769:7845, 771:7851, 777:7849 },\n 228: { 772:479 },\n 229: { 769:507 },\n 230: { 769:509, 772:483 },\n 231: { 769:7689 },\n 234: { 768:7873, 769:7871, 771:7877, 777:7875 },\n 239: { 769:7727 },\n 244: { 768:7891, 769:7889, 771:7895, 777:7893 },\n 245: { 769:7757, 772:557, 776:7759 },\n 246: { 772:555 },\n 248: { 769:511 },\n 252: { 768:476, 769:472, 772:470, 780:474 },\n 258: { 768:7856, 769:7854, 771:7860, 777:7858 },\n 259: { 768:7857, 769:7855, 771:7861, 777:7859 },\n 274: { 768:7700, 769:7702 },\n 275: { 768:7701, 769:7703 },\n 332: { 768:7760, 769:7762 },\n 333: { 768:7761, 769:7763 },\n 346: { 775:7780 },\n 347: { 775:7781 },\n 352: { 775:7782 },\n 353: { 775:7783 },\n 360: { 769:7800 },\n 361: { 769:7801 },\n 362: { 776:7802 },\n 363: { 776:7803 },\n 383: { 775:7835 },\n 416: { 768:7900, 769:7898, 771:7904, 777:7902, 803:7906 },\n 417: { 768:7901, 769:7899, 771:7905, 777:7903, 803:7907 },\n 431: { 768:7914, 769:7912, 771:7918, 777:7916, 803:7920 },\n 432: { 768:7915, 769:7913, 771:7919, 777:7917, 803:7921 },\n 439: { 780:494 },\n 490: { 772:492 },\n 491: { 772:493 },\n 550: { 772:480 },\n 551: { 772:481 },\n 552: { 774:7708 },\n 553: { 774:7709 },\n 558: { 772:560 },\n 559: { 772:561 },\n 658: { 780:495 },\n 776: { 769:836 },\n 913: { 768:8122, 769:902, 772:8121, 774:8120, 787:7944, 788:7945, 837:8124 },\n 917: { 768:8136, 769:904, 787:7960, 788:7961 },\n 919: { 768:8138, 769:905, 787:7976, 788:7977, 837:8140 },\n 921: { 768:8154, 769:906, 772:8153, 774:8152, 776:938, 787:7992, 788:7993 },\n 927: { 768:8184, 769:908, 787:8008, 788:8009 },\n 929: { 788:8172 },\n 933: { 768:8170, 769:910, 772:8169, 774:8168, 776:939, 788:8025 },\n 937: { 768:8186, 769:911, 787:8040, 788:8041, 837:8188 },\n 940: { 837:8116 },\n 942: { 837:8132 },\n 945: { 768:8048, 769:940, 772:8113, 774:8112, 787:7936, 788:7937, 834:8118, 837:8115 },\n 949: { 768:8050, 769:941, 787:7952, 788:7953 },\n 951: { 768:8052, 769:942, 787:7968, 788:7969, 834:8134, 837:8131 },\n 953: { 768:8054, 769:943, 772:8145, 774:8144, 776:970, 787:7984, 788:7985, 834:8150 },\n 959: { 768:8056, 769:972, 787:8000, 788:8001 },\n 961: { 787:8164, 788:8165 },\n 965: { 768:8058, 769:973, 772:8161, 774:8160, 776:971, 787:8016, 788:8017, 834:8166 },\n 969: { 768:8060, 769:974, 787:8032, 788:8033, 834:8182, 837:8179 },\n 970: { 768:8146, 769:912, 834:8151 },\n 971: { 768:8162, 769:944, 834:8167 },\n 974: { 837:8180 },\n 978: { 769:979, 776:980 },\n 1030: { 776:1031 },\n 1040: { 774:1232, 776:1234 },\n 1043: { 769:1027 },\n 1045: { 768:1024, 774:1238, 776:1025 },\n 1046: { 774:1217, 776:1244 },\n 1047: { 776:1246 },\n 1048: { 768:1037, 772:1250, 774:1049, 776:1252 },\n 1050: { 769:1036 },\n 1054: { 776:1254 },\n 1059: { 772:1262, 774:1038, 776:1264, 779:1266 },\n 1063: { 776:1268 },\n 1067: { 776:1272 },\n 1069: { 776:1260 },\n 1072: { 774:1233, 776:1235 },\n 1075: { 769:1107 },\n 1077: { 768:1104, 774:1239, 776:1105 },\n 1078: { 774:1218, 776:1245 },\n 1079: { 776:1247 },\n 1080: { 768:1117, 772:1251, 774:1081, 776:1253 },\n 1082: { 769:1116 },\n 1086: { 776:1255 },\n 1091: { 772:1263, 774:1118, 776:1265, 779:1267 },\n 1095: { 776:1269 },\n 1099: { 776:1273 },\n 1101: { 776:1261 },\n 1110: { 776:1111 },\n 1140: { 783:1142 },\n 1141: { 783:1143 },\n 1240: { 776:1242 },\n 1241: { 776:1243 },\n 1256: { 776:1258 },\n 1257: { 776:1259 },\n 1488: { 1463:64302, 1464:64303, 1468:64304 },\n 1489: { 1468:64305, 1471:64332 },\n 1490: { 1468:64306 },\n 1491: { 1468:64307 },\n 1492: { 1468:64308 },\n 1493: { 1465:64331, 1468:64309 },\n 1494: { 1468:64310 },\n 1496: { 1468:64312 },\n 1497: { 1460:64285, 1468:64313 },\n 1498: { 1468:64314 },\n 1499: { 1468:64315, 1471:64333 },\n 1500: { 1468:64316 },\n 1502: { 1468:64318 },\n 1504: { 1468:64320 },\n 1505: { 1468:64321 },\n 1507: { 1468:64323 },\n 1508: { 1468:64324, 1471:64334 },\n 1510: { 1468:64326 },\n 1511: { 1468:64327 },\n 1512: { 1468:64328 },\n 1513: { 1468:64329, 1473:64298, 1474:64299 },\n 1514: { 1468:64330 },\n 1522: { 1463:64287 },\n 1575: { 1619:1570, 1620:1571, 1621:1573 },\n 1608: { 1620:1572 },\n 1610: { 1620:1574 },\n 1729: { 1620:1730 },\n 1746: { 1620:1747 },\n 1749: { 1620:1728 },\n 2325: { 2364:2392 },\n 2326: { 2364:2393 },\n 2327: { 2364:2394 },\n 2332: { 2364:2395 },\n 2337: { 2364:2396 },\n 2338: { 2364:2397 },\n 2344: { 2364:2345 },\n 2347: { 2364:2398 },\n 2351: { 2364:2399 },\n 2352: { 2364:2353 },\n 2355: { 2364:2356 },\n 2465: { 2492:2524 },\n 2466: { 2492:2525 },\n 2479: { 2492:2527 },\n 2503: { 2494:2507, 2519:2508 },\n 2582: { 2620:2649 },\n 2583: { 2620:2650 },\n 2588: { 2620:2651 },\n 2603: { 2620:2654 },\n 2610: { 2620:2611 },\n 2616: { 2620:2614 },\n 2849: { 2876:2908 },\n 2850: { 2876:2909 },\n 2887: { 2878:2891, 2902:2888, 2903:2892 },\n 2962: { 3031:2964 },\n 3014: { 3006:3018, 3031:3020 },\n 3015: { 3006:3019 },\n 3142: { 3158:3144 },\n 3263: { 3285:3264 },\n 3270: { 3266:3274, 3285:3271, 3286:3272 },\n 3274: { 3285:3275 },\n 3398: { 3390:3402, 3415:3404 },\n 3399: { 3390:3403 },\n 3545: { 3530:3546, 3535:3548, 3551:3550 },\n 3548: { 3530:3549 },\n 3904: { 4021:3945 },\n 3906: { 4023:3907 },\n 3916: { 4023:3917 },\n 3921: { 4023:3922 },\n 3926: { 4023:3927 },\n 3931: { 4023:3932 },\n 3953: { 3954:3955, 3956:3957, 3968:3969 },\n 3984: { 4021:4025 },\n 3986: { 4023:3987 },\n 3996: { 4023:3997 },\n 4001: { 4023:4002 },\n 4006: { 4023:4007 },\n 4011: { 4023:4012 },\n 4018: { 3968:3958 },\n 4019: { 3968:3960 },\n 4133: { 4142:4134 },\n 7734: { 772:7736 },\n 7735: { 772:7737 },\n 7770: { 772:7772 },\n 7771: { 772:7773 },\n 7778: { 775:7784 },\n 7779: { 775:7785 },\n 7840: { 770:7852, 774:7862 },\n 7841: { 770:7853, 774:7863 },\n 7864: { 770:7878 },\n 7865: { 770:7879 },\n 7884: { 770:7896 },\n 7885: { 770:7897 },\n 7936: { 768:7938, 769:7940, 834:7942, 837:8064 },\n 7937: { 768:7939, 769:7941, 834:7943, 837:8065 },\n 7938: { 837:8066 },\n 7939: { 837:8067 },\n 7940: { 837:8068 },\n 7941: { 837:8069 },\n 7942: { 837:8070 },\n 7943: { 837:8071 },\n 7944: { 768:7946, 769:7948, 834:7950, 837:8072 },\n 7945: { 768:7947, 769:7949, 834:7951, 837:8073 },\n 7946: { 837:8074 },\n 7947: { 837:8075 },\n 7948: { 837:8076 },\n 7949: { 837:8077 },\n 7950: { 837:8078 },\n 7951: { 837:8079 },\n 7952: { 768:7954, 769:7956 },\n 7953: { 768:7955, 769:7957 },\n 7960: { 768:7962, 769:7964 },\n 7961: { 768:7963, 769:7965 },\n 7968: { 768:7970, 769:7972, 834:7974, 837:8080 },\n 7969: { 768:7971, 769:7973, 834:7975, 837:8081 },\n 7970: { 837:8082 },\n 7971: { 837:8083 },\n 7972: { 837:8084 },\n 7973: { 837:8085 },\n 7974: { 837:8086 },\n 7975: { 837:8087 },\n 7976: { 768:7978, 769:7980, 834:7982, 837:8088 },\n 7977: { 768:7979, 769:7981, 834:7983, 837:8089 },\n 7978: { 837:8090 },\n 7979: { 837:8091 },\n 7980: { 837:8092 },\n 7981: { 837:8093 },\n 7982: { 837:8094 },\n 7983: { 837:8095 },\n 7984: { 768:7986, 769:7988, 834:7990 },\n 7985: { 768:7987, 769:7989, 834:7991 },\n 7992: { 768:7994, 769:7996, 834:7998 },\n 7993: { 768:7995, 769:7997, 834:7999 },\n 8000: { 768:8002, 769:8004 },\n 8001: { 768:8003, 769:8005 },\n 8008: { 768:8010, 769:8012 },\n 8009: { 768:8011, 769:8013 },\n 8016: { 768:8018, 769:8020, 834:8022 },\n 8017: { 768:8019, 769:8021, 834:8023 },\n 8025: { 768:8027, 769:8029, 834:8031 },\n 8032: { 768:8034, 769:8036, 834:8038, 837:8096 },\n 8033: { 768:8035, 769:8037, 834:8039, 837:8097 },\n 8034: { 837:8098 },\n 8035: { 837:8099 },\n 8036: { 837:8100 },\n 8037: { 837:8101 },\n 8038: { 837:8102 },\n 8039: { 837:8103 },\n 8040: { 768:8042, 769:8044, 834:8046, 837:8104 },\n 8041: { 768:8043, 769:8045, 834:8047, 837:8105 },\n 8042: { 837:8106 },\n 8043: { 837:8107 },\n 8044: { 837:8108 },\n 8045: { 837:8109 },\n 8046: { 837:8110 },\n 8047: { 837:8111 },\n 8048: { 837:8114 },\n 8052: { 837:8130 },\n 8060: { 837:8178 },\n 8118: { 837:8119 },\n 8127: { 768:8141, 769:8142, 834:8143 },\n 8134: { 837:8135 },\n 8182: { 837:8183 },\n 8190: { 768:8157, 769:8158, 834:8159 },\n 8592: { 824:8602 },\n 8594: { 824:8603 },\n 8596: { 824:8622 },\n 8656: { 824:8653 },\n 8658: { 824:8655 },\n 8660: { 824:8654 },\n 8707: { 824:8708 },\n 8712: { 824:8713 },\n 8715: { 824:8716 },\n 8739: { 824:8740 },\n 8741: { 824:8742 },\n 8764: { 824:8769 },\n 8771: { 824:8772 },\n 8773: { 824:8775 },\n 8776: { 824:8777 },\n 8781: { 824:8813 },\n 8801: { 824:8802 },\n 8804: { 824:8816 },\n 8805: { 824:8817 },\n 8818: { 824:8820 },\n 8819: { 824:8821 },\n 8822: { 824:8824 },\n 8823: { 824:8825 },\n 8826: { 824:8832 },\n 8827: { 824:8833 },\n 8828: { 824:8928 },\n 8829: { 824:8929 },\n 8834: { 824:8836 },\n 8835: { 824:8837 },\n 8838: { 824:8840 },\n 8839: { 824:8841 },\n 8849: { 824:8930 },\n 8850: { 824:8931 },\n 8866: { 824:8876 },\n 8872: { 824:8877 },\n 8873: { 824:8878 },\n 8875: { 824:8879 },\n 8882: { 824:8938 },\n 8883: { 824:8939 },\n 8884: { 824:8940 },\n 8885: { 824:8941 },\n 10973: { 824:10972 },\n 12358: { 12441:12436 },\n 12363: { 12441:12364 },\n 12365: { 12441:12366 },\n 12367: { 12441:12368 },\n 12369: { 12441:12370 },\n 12371: { 12441:12372 },\n 12373: { 12441:12374 },\n 12375: { 12441:12376 },\n 12377: { 12441:12378 },\n 12379: { 12441:12380 },\n 12381: { 12441:12382 },\n 12383: { 12441:12384 },\n 12385: { 12441:12386 },\n 12388: { 12441:12389 },\n 12390: { 12441:12391 },\n 12392: { 12441:12393 },\n 12399: { 12441:12400, 12442:12401 },\n 12402: { 12441:12403, 12442:12404 },\n 12405: { 12441:12406, 12442:12407 },\n 12408: { 12441:12409, 12442:12410 },\n 12411: { 12441:12412, 12442:12413 },\n 12445: { 12441:12446 },\n 12454: { 12441:12532 },\n 12459: { 12441:12460 },\n 12461: { 12441:12462 },\n 12463: { 12441:12464 },\n 12465: { 12441:12466 },\n 12467: { 12441:12468 },\n 12469: { 12441:12470 },\n 12471: { 12441:12472 },\n 12473: { 12441:12474 },\n 12475: { 12441:12476 },\n 12477: { 12441:12478 },\n 12479: { 12441:12480 },\n 12481: { 12441:12482 },\n 12484: { 12441:12485 },\n 12486: { 12441:12487 },\n 12488: { 12441:12489 },\n 12495: { 12441:12496, 12442:12497 },\n 12498: { 12441:12499, 12442:12500 },\n 12501: { 12441:12502, 12442:12503 },\n 12504: { 12441:12505, 12442:12506 },\n 12507: { 12441:12508, 12442:12509 },\n 12527: { 12441:12535 },\n 12528: { 12441:12536 },\n 12529: { 12441:12537 },\n 12530: { 12441:12538 },\n 12541: { 12441:12542 },\n 64329: { 1473:64300, 1474:64301 },\n 119127: { 119141:119134 },\n 119128: { 119141:119135 },\n 119135: { 119150:119136, 119151:119137, 119152:119138, 119153:119139, 119154:119140 },\n 119225: { 119141:119227 },\n 119226: { 119141:119228 },\n 119227: { 119150:119229, 119151:119231 },\n 119228: { 119150:119230, 119151:119232 }\n};\n/* End of tables generated by casemap.py. */\n\n\n/* Convert a 32-bit Unicode value to a JS string. */\nfunction CharToString(val) {\n    if (val < 0x10000) {\n        return String.fromCharCode(val);\n    }\n    else {\n        val -= 0x10000;\n        return String.fromCharCode(0xD800 + (val >> 10), 0xDC00 + (val & 0x3FF));\n    }\n}\n\n/* Given an array, return an array of the same length with all the values\n   trimmed to the range 0-255. This may be the same array. */\nfunction TrimArrayToBytes(arr) {\n    var ix, newarr;\n    var len = arr.length;\n    for (ix=0; ix<len; ix++) {\n        if (arr[ix] < 0 || arr[ix] >= 0x100) \n            break;\n    }\n    if (ix == len) {\n        return arr;\n    }\n    newarr = Array(len);\n    for (ix=0; ix<len; ix++) {\n        if (arr[ix] < 0 || arr[ix] >= 0x100) \n            newarr[ix] = 63;  // '?'\n        else\n            newarr[ix] = arr[ix];\n    }\n    return newarr;\n}\n\n/* Convert an array of 8-bit values to a JS string, trimming if\n   necessary. */\nfunction ByteArrayToString(arr) {\n    var ix, newarr;\n    var len = arr.length;\n    if (len == 0)\n        return '';\n    for (ix=0; ix<len; ix++) {\n        if (arr[ix] < 0 || arr[ix] >= 0x100) \n            break;\n    }\n    if (ix == len) {\n        return String.fromCharCode.apply(this, arr);\n    }\n    newarr = Array(len);\n    for (ix=0; ix<len; ix++) {\n        newarr[ix] = String.fromCharCode(arr[ix] & 0xFF);\n    }\n    return newarr.join('');\n}\n\n/* Convert an array of 32-bit Unicode values to a JS string. If they're\n   all in the 16-bit range, this is easy; otherwise we have to do\n   some munging. */\nfunction UniArrayToString(arr) {\n    var ix, val, newarr;\n    var len = arr.length;\n    if (len == 0)\n        return '';\n    for (ix=0; ix<len; ix++) {\n        if (arr[ix] >= 0x10000) \n            break;\n    }\n    if (ix == len) {\n        return String.fromCharCode.apply(this, arr);\n    }\n    newarr = Array(len);\n    for (ix=0; ix<len; ix++) {\n        val = arr[ix];\n        if (val < 0x10000) {\n            newarr[ix] = String.fromCharCode(val);\n        }\n        else {\n            val -= 0x10000;\n            newarr[ix] = String.fromCharCode(0xD800 + (val >> 10), 0xDC00 + (val & 0x3FF));\n        }\n    }\n    return newarr.join('');\n}\n\n/* Convert an array of 32-bit Unicode values to an array of 8-bit byte\n   values, encoded UTF-8. If all the values are 0-127, this returns the\n   same array. Otherwise it returns a new (longer) array. */\nfunction UniArrayToUTF8(arr) {\n    var count = 0;\n\n    for (let ix=0; ix<arr.length; ix++) {\n        const val = arr[ix];\n        if (val < 0x80) {\n            count += 1;\n        }\n        else if (val < 0x800) {\n            count += 2;\n        }\n        else if (val < 0x10000) {\n            count += 3;\n        }\n        else if (val < 0x200000) {\n            count += 4;\n        }\n        else {\n            count += 1;\n        }\n    }\n\n    if (count == arr.length)\n        return arr;\n\n    const res = [];\n    for (let ix=0; ix<arr.length; ix++) {\n        const val = arr[ix];\n        if (val < 0x80) {\n            res.push(val);\n        }\n        else if (val < 0x800) {\n            res.push(0xC0 | ((val & 0x7C0) >> 6));\n            res.push(0x80 |  (val & 0x03F)     );\n        }\n        else if (val < 0x10000) {\n            res.push(0xE0 | ((val & 0xF000) >> 12));\n            res.push(0x80 | ((val & 0x0FC0) >>  6));\n            res.push(0x80 |  (val & 0x003F)      );\n        }\n        else if (val < 0x200000) {\n            res.push(0xF0 | ((val & 0x1C0000) >> 18));\n            res.push(0x80 | ((val & 0x03F000) >> 12));\n            res.push(0x80 | ((val & 0x000FC0) >>  6));\n            res.push(0x80 |  (val & 0x00003F)      );\n        }\n        else {\n            res.push(63);  // '?'\n        }\n    }\n\n    return res;\n}\n\n/* Convert an array of 32-bit Unicode values to an array of 8-bit byte\n   values, encoded as big-endian words. */\nfunction UniArrayToBE32(arr) {\n    var res = new Array(4*arr.length);\n    for (var ix=0; ix<arr.length; ix++) {\n        var val = arr[ix];\n        res[4*ix]   = (val >> 24) & 0xFF;\n        res[4*ix+1] = (val >> 16) & 0xFF;\n        res[4*ix+2] = (val >> 8) & 0xFF;\n        res[4*ix+3] = (val) & 0xFF;\n    }\n    return res;\n}\n\n/* Log the message in the browser's error log, if it has one. (This shows\n   up in Safari, in Opera, and in Firefox if you have Firebug installed.)\n*/\nfunction qlog(msg) {\n    if (window.console && console.log)\n        console.log(msg);\n}\n\n/* RefBox: Simple class used for \"call-by-reference\" Glk arguments. The object\n   is just a box containing a single value, which can be written and read.\n*/\nfunction RefBox() {\n    this.value = undefined;\n    this.set_value = function(val) {\n        this.value = val;\n    }\n    this.get_value = function() {\n        return this.value;\n    }\n}\n\n/* RefStruct: Used for struct-type Glk arguments. After creating the\n   object, you should call push_field() the appropriate number of times,\n   to set the initial field values. Then set_field() can be used to\n   change them, and get_fields() retrieves the list of all fields.\n\n   (The usage here is loose, since Javascript is forgiving about arrays.\n   Really the caller could call set_field() instead of push_field() --\n   or skip that step entirely, as long as the Glk function later calls\n   set_field() for each field. Which it should.)\n*/\nfunction RefStruct(/*numels*/) {\n    this.fields = [];\n    this.push_field = function(val) {\n        this.fields.push(val);\n    }\n    this.set_field = function(pos, val) {\n        this.fields[pos] = val;\n    }\n    this.get_field = function(pos) {\n        return this.fields[pos];\n    }\n    this.get_fields = function() {\n        return this.fields;\n    }\n}\n\n/* Dummy return value, which means that the Glk call is still in progress,\n   or will never return at all. This is used by glk_exit(), glk_select(),\n   and glk_fileref_create_by_prompt().\n*/\nvar DidNotReturn = { dummy: 'Glk call has not yet returned' };\n\n/* This returns a hint for whether the Glk call (by selector number)\n   might block or never return. True for glk_exit(), glk_select(),\n   and glk_fileref_create_by_prompt().\n*/\nfunction call_may_not_return(id) {\n    if (id == 0x001 || id == 0x0C0 || id == 0x062)\n        return true;\n    else\n        return false;\n}\n\nvar strtype_File = 1;\nvar strtype_Window = 2;\nvar strtype_Memory = 3;\nvar strtype_Resource = 4;\n\n/* Extra update information -- autorestore only. */\nvar gli_autorestore_glkstate = null;\n\n/* Beginning of linked list of windows. */\nvar gli_windowlist = null;\nvar gli_rootwin = null;\n/* Set when any window is created, destroyed, or resized. */\nvar geometry_changed = true; \n/* Received from GlkOte; describes the window size. */\nvar content_metrics = null;\n\n/* Beginning of linked list of streams. */\nvar gli_streamlist = null;\n/* Beginning of linked list of filerefs. */\nvar gli_filereflist = null;\n/* Beginning of linked list of schannels. */\nvar gli_schannellist = null;\n\n/* The current output stream. */\nvar gli_currentstr = null;\n\n/* During a glk_select() block, this is the RefStruct which will contain\n   the result. */\nvar gli_selectref = null;\n\n/* This is used to assigned disprock values to windows, when there is\n   no GiDispa layer to provide them. */\nvar gli_api_display_rocks = 1;\n\n/* A positive number if the timer is set. */\nvar gli_timer_interval = null; \nvar gli_timer_started = null; /* when the setTimeout began */\nvar gli_timer_lastsent = null; /* last interval sent to GlkOte */\n\nfunction gli_new_window(type, rock) {\n    var win = {};\n    win.type = type;\n    win.rock = rock;\n    win.disprock = undefined;\n\n    win.parent = null;\n    win.str = gli_stream_open_window(win);\n    win.echostr = null;\n    win.style = Const.style_Normal;\n    win.hyperlink = 0;\n\n    win.input_generation = null;\n    win.linebuf = null;\n    win.char_request = false;\n    win.line_request = false;\n    win.char_request_uni = false;\n    win.line_request_uni = false;\n    win.hyperlink_request = false;\n    win.mouse_request = false;\n    win.echo_line_input = true;\n    win.line_input_terminators = [];\n    win.request_echo_line_input = null; /* only used during a request */\n\n    /* window-type-specific info is set up in glk_window_open */\n\n    win.prev = null;\n    win.next = gli_windowlist;\n    gli_windowlist = win;\n    if (win.next)\n        win.next.prev = win;\n\n    if (GiDispa)\n        GiDispa.class_register('window', win);\n    else\n        win.disprock = gli_api_display_rocks++;\n    /* We need to assign a disprock even if there's no GiDispa layer,\n       because GlkOte differentiates windows by their disprock. */\n    geometry_changed = true;\n\n    return win;\n}\n\nfunction gli_delete_window(win) {\n    var prev, next;\n\n    if (GiDispa)\n        GiDispa.class_unregister('window', win);\n    geometry_changed = true;\n    \n    win.echostr = null;\n    if (win.str) {\n        gli_delete_stream(win.str);\n        win.str = null;\n    }\n\n    prev = win.prev;\n    next = win.next;\n    win.prev = null;\n    win.next = null;\n\n    if (prev)\n        prev.next = next;\n    else\n        gli_windowlist = next;\n    if (next)\n        next.prev = prev;\n\n    win.parent = null;\n    win.rock = null;\n    win.disprock = null;\n}\n\nfunction gli_windows_unechostream(str) {\n    var win;\n    \n    for (win=gli_windowlist; win; win=win.next) {\n        if (win.echostr === str)\n            win.echostr = null;\n    }\n}\n\n/* Add a (Javascript) string to the given window's display. */\nfunction gli_window_put_string(win, val) {\n    var ix, ch;\n\n    //### might be efficient to split the implementation up into\n    //### gli_window_buffer_put_string(), etc, since many functions\n    //### know the window type when they call this\n    switch (win.type) {\n    case Const.wintype_TextBuffer:\n        if (win.style != win.accumstyle\n            || win.hyperlink != win.accumhyperlink\n            || win.fg != win.accum_fg\n            || win.bg != win.accum_bg\n            || win.reverse != win.accum_reverse)\n        {\n            gli_window_buffer_deaccumulate(win);\n        }\n        win.accum.push(val);\n        break;\n    case Const.wintype_TextGrid:\n        for (ix=0; ix<val.length; ix++) {\n            ch = val.charAt(ix);\n\n            /* Canonicalize the cursor position. This is like calling\n               gli_window_grid_canonicalize(), but I've inlined it. */\n            if (win.cursorx < 0)\n                win.cursorx = 0;\n            else if (win.cursorx >= win.gridwidth) {\n                win.cursorx = 0;\n                win.cursory++;\n            }\n            if (win.cursory < 0)\n                win.cursory = 0;\n            else if (win.cursory >= win.gridheight)\n                break; /* outside the window */\n\n            if (ch == \"\\n\") {\n                /* a newline just moves the cursor. */\n                win.cursory++;\n                win.cursorx = 0;\n                continue;\n            }\n\n            var lineobj = win.lines[win.cursory];\n            lineobj.dirty = true;\n            lineobj.chars[win.cursorx] = ch;\n            lineobj.styles[win.cursorx] = win.style;\n            lineobj.hyperlinks[win.cursorx] = win.hyperlink;\n            lineobj.fgs[win.cursorx] = win.fg;\n            lineobj.bgs[win.cursorx] = win.bg;\n            lineobj.reverses[win.cursorx] = win.reverse;\n\n            win.cursorx++;\n            /* We can leave the cursor outside the window, since it will be\n               canonicalized next time a character is printed. */\n        }\n        break;\n    }\n}\n\n/* Canonicalize the cursor position. That is, the cursor may have\n   been left outside the window area; wrap it if necessary.\n\n   Returns true if the cursor winds up wrapped outside the window entirely;\n   false if the cursor winds up at a legal printing position.\n*/\nfunction gli_window_grid_canonicalize(win) {\n    if (win.cursorx < 0)\n        win.cursorx = 0;\n    else if (win.cursorx >= win.gridwidth) {\n        win.cursorx = 0;\n        win.cursory++;\n    }\n    if (win.cursory < 0)\n        win.cursory = 0;\n    else if (win.cursory >= win.gridheight)\n        return true; /* outside the window */\n    return false;\n}\n\n/* Take the accumulation of strings (since the last style change) and\n   assemble them into a buffer window update. This must be called\n   after each style change; it must also be called right before \n   GlkOte.update(). (Actually we call it right before win.accum.push\n   if the style has changed -- there's no need to call for *every* style\n   change if no text is being pushed out in between.)\n*/\nfunction gli_window_buffer_deaccumulate(win) {\n    var conta = win.content;\n    var stylename = StyleNameMap[win.accumstyle];\n    var text, ls, ix, obj, arr;\n\n    if (win.accum.length) {\n        text = win.accum.join('');\n        ls = text.split('\\n');\n        for (ix=0; ix<ls.length; ix++) {\n            arr = undefined;\n            if (ix == 0) {\n                if (ls[ix]) {\n                    if (conta.length == 0) {\n                        arr = [];\n                        conta.push({ content: arr, append: true });\n                    }\n                    else {\n                        obj = conta[conta.length-1];\n                        if (!obj.content) {\n                            arr = [];\n                            obj.content = arr;\n                        }\n                        else {\n                            arr = obj.content;\n                        }\n                    }\n                }\n            }\n            else {\n                if (ls[ix]) {\n                    arr = [];\n                    conta.push({ content: arr });\n                }\n                else {\n                    conta.push({ });\n                }\n            }\n            if (arr !== undefined) {\n                if (!win.accumhyperlink && !win.accum_fg && !win.accum_bg && !win.accum_reverse) {\n                    arr.push(stylename);\n                    arr.push(ls[ix]);\n                }\n                else {\n                    const content = {\n                        style: stylename,\n                        text: ls[ix],\n                    }\n                    if (win.accumhyperlink)\n                    {\n                        content.hyperlink = win.accumhyperlink\n                    }\n                    if (win.accum_fg)\n                    {\n                        if (!content.css_styles) {\n                            content.css_styles = {}\n                        }\n                        content.css_styles.color = win.accum_fg\n                    }\n                    if (win.accum_bg)\n                    {\n                        if (!content.css_styles) {\n                            content.css_styles = {}\n                        }\n                        content.css_styles['background-color'] = win.accum_bg\n                    }\n                    if (win.accum_reverse)\n                    {\n                        if (!content.css_styles) {\n                            content.css_styles = {}\n                        }\n                        content.css_styles.reverse = 1\n                    }\n                    arr.push(content)\n                }\n            }\n        }\n    }\n\n    win.accum.length = 0;\n    win.accumstyle = win.style;\n    win.accumhyperlink = win.hyperlink;\n    win.accum_fg = win.fg\n    win.accum_bg = win.bg\n    win.accum_reverse = win.reverse\n}\n\n/* Add a special object onto a buffer window update. This resets the\n   accumulator.\n*/\nfunction gli_window_buffer_put_special(win, special, flowbreak) {\n    gli_window_buffer_deaccumulate(win);\n\n    var conta = win.content;\n    var arr = undefined;\n    var obj;\n\n    /* The next bit is a simplified version of the array-append code \n       from deaccumulate(). It's simpler because we have exactly one\n       item to add. */\n\n    if (conta.length == 0) {\n        arr = [];\n        obj = { content: arr, append: true };\n        if (flowbreak)\n            obj.flowbreak = true;\n        conta.push(obj);\n    }\n    else {\n        obj = conta[conta.length-1];\n        if (flowbreak)\n            obj.flowbreak = true;\n        if (!obj.content) {\n            arr = [];\n            obj.content = arr;\n        }\n        else {\n            arr = obj.content;\n        }\n    }\n    \n    if (arr !== undefined && special !== undefined) {\n        arr.push(special);\n    }\n}\n\nfunction gli_window_close(win, recurse) {\n    var wx;\n    \n    for (wx=win.parent; wx; wx=wx.parent) {\n        if (wx.type == Const.wintype_Pair) {\n            if (wx.pair_key === win) {\n                wx.pair_key = null;\n                wx.pair_keydamage = true;\n            }\n        }\n    }\n\n    if (GiDispa && win.linebuf) {\n        GiDispa.unretain_array(win.linebuf);\n        win.linebuf = null;\n    }\n    \n    switch (win.type) {\n        case Const.wintype_Pair: \n            if (recurse) {\n                if (win.child1)\n                    gli_window_close(win.child1, true);\n                if (win.child2)\n                    gli_window_close(win.child2, true);\n            }\n            win.child1 = null;\n            win.child2 = null;\n            win.pair_key = null;\n            break;\n        case Const.wintype_TextBuffer: \n            win.accum = null;\n            win.content = null;\n            win.reserve = null;\n            break;\n        case Const.wintype_TextGrid: \n            win.lines = null;\n            break;\n        case Const.wintype_Graphics:\n            win.content = null;\n            win.reserve = null;\n            break;\n    }\n    \n    gli_delete_window(win);\n}\n\nfunction gli_window_rearrange(win, box) {\n    var width, height, oldwidth, oldheight;\n    var min, max, diff, split, splitwid, ix, cx, lineobj;\n    var box1, box2, ch1, ch2;\n\n    geometry_changed = true;\n    win.bbox = box;\n\n    switch (win.type) {\n\n    case Const.wintype_TextGrid:\n        /* Compute the new grid size. */\n        width = box.right - box.left;\n        height = box.bottom - box.top;\n        oldheight = win.gridheight;\n        win.gridwidth = Math.max(0, Math.floor((width-content_metrics.gridmarginx) / content_metrics.gridcharwidth));\n        win.gridheight = Math.max(0, Math.floor((height-content_metrics.gridmarginy) / content_metrics.gridcharheight));\n\n        /* Now we have to resize the win.lines array, in two dimensions. */\n        if (oldheight > win.gridheight) {\n            win.lines.length = win.gridheight;\n        }\n        else if (oldheight < win.gridheight) {\n            for (ix=oldheight; ix<win.gridheight; ix++) {\n                win.lines[ix] = { chars:[], styles:[], hyperlinks:[], fgs:[], bgs:[], reverses:[],\n                                  dirty:true };\n            }\n        }\n        for (ix=0; ix<win.gridheight; ix++) {\n            lineobj = win.lines[ix];\n            oldwidth = lineobj.chars.length;\n            if (oldwidth > win.gridwidth) {\n                lineobj.dirty = true;\n                lineobj.chars.length = win.gridwidth;\n                lineobj.styles.length = win.gridwidth;\n                lineobj.hyperlinks.length = win.gridwidth;\n                lineobj.fgs.length = win.gridwidth;\n                lineobj.bgs.length = win.gridwidth;\n                lineobj.reverses.length = win.gridwidth;\n            }\n            else if (oldwidth < win.gridwidth) {\n                lineobj.dirty = true;\n                for (cx=oldwidth; cx<win.gridwidth; cx++) {\n                    lineobj.chars[cx] = ' ';\n                    lineobj.styles[cx] = Const.style_Normal;\n                    lineobj.hyperlinks[cx] = 0;\n                    lineobj.fgs[cx] = null\n                    lineobj.bgs[cx] = null\n                    lineobj.reverses[cx] = 0\n                }\n            }\n        }\n        break;\n\n    case Const.wintype_Graphics:\n        /* Compute the new canvas size. */\n        width = box.right - box.left;\n        height = box.bottom - box.top;\n        win.graphwidth = Math.max(0, width - content_metrics.graphicsmarginx);\n        win.graphheight = Math.max(0, height - content_metrics.graphicsmarginy);\n        break;\n\n    case Const.wintype_Pair:\n        if (win.pair_vertical) {\n            min = win.bbox.left;\n            max = win.bbox.right;\n            splitwid = content_metrics.inspacingx;\n        }\n        else {\n            min = win.bbox.top;\n            max = win.bbox.bottom;\n            splitwid = content_metrics.inspacingy;\n        }\n        if (!win.pair_hasborder)\n            splitwid = 0;\n        diff = max - min;\n\n        if (win.pair_division == Const.winmethod_Proportional) {\n            split = Math.floor((diff * win.pair_size) / 100);\n        }\n        else if (win.pair_division == Const.winmethod_Fixed) {\n            split = 0;\n            if (win.pair_key && win.pair_key.type == Const.wintype_TextBuffer) {\n                if (!win.pair_vertical) \n                    split = (win.pair_size * content_metrics.buffercharheight + content_metrics.buffermarginy);\n                else\n                    split = (win.pair_size * content_metrics.buffercharwidth + content_metrics.buffermarginx);\n            }\n            if (win.pair_key && win.pair_key.type == Const.wintype_TextGrid) {\n                if (!win.pair_vertical) \n                    split = (win.pair_size * content_metrics.gridcharheight + content_metrics.gridmarginy);\n                else\n                    split = (win.pair_size * content_metrics.gridcharwidth + content_metrics.gridmarginx);\n            }\n            if (win.pair_key && win.pair_key.type == Const.wintype_Graphics) {\n                if (!win.pair_vertical) \n                    split = win.pair_size + content_metrics.graphicsmarginy;\n                else\n                    split = win.pair_size + content_metrics.graphicsmarginx;\n            }\n            split = Math.ceil(split);\n        }\n        else {\n            /* default behavior for unknown division method */\n            split = Math.floor(diff / 2);\n        }\n\n        /* Split is now a number between 0 and diff. Convert that to a number\n           between min and max; also apply upside-down-ness. */\n        if (!win.pair_backward) {\n            split = max-split-splitwid;\n        }\n        else {\n            split = min+split;\n        }\n\n        /* Make sure it's really between min and max. */\n        if (min >= max) {\n            split = min;\n        }\n        else {\n            split = Math.min(Math.max(split, min), max-splitwid);\n        }\n\n        win.pair_splitpos = split;\n        win.pair_splitwidth = splitwid;\n        if (win.pair_vertical) {\n            box1 = {\n                left: win.bbox.left,\n                right: win.pair_splitpos,\n                top: win.bbox.top,\n                bottom: win.bbox.bottom\n            };\n            box2 = {\n                left: box1.right + win.pair_splitwidth,\n                right: win.bbox.right,\n                top: win.bbox.top,\n                bottom: win.bbox.bottom\n            };\n        }\n        else {\n            box1 = {\n                top: win.bbox.top,\n                bottom: win.pair_splitpos,\n                left: win.bbox.left,\n                right: win.bbox.right\n            };\n            box2 = {\n                top: box1.bottom + win.pair_splitwidth,\n                bottom: win.bbox.bottom,\n                left: win.bbox.left,\n                right: win.bbox.right\n            };\n        }\n        if (!win.pair_backward) {\n            ch1 = win.child1;\n            ch2 = win.child2;\n        }\n        else {\n            ch1 = win.child2;\n            ch2 = win.child1;\n        }\n\n        gli_window_rearrange(ch1, box1);\n        gli_window_rearrange(ch2, box2);\n        break;\n\n    }\n}\n\nfunction gli_new_stream(type, readable, writable, rock) {\n    var str = {};\n    str.type = type;\n    str.rock = rock;\n    str.disprock = undefined;\n\n    str.unicode = false;\n    /* isbinary is only meaningful for Resource and streaming-File streams */\n    str.isbinary = false;\n    str.streaming = false;\n    str.ref = null;\n    str.win = null;\n    str.file = null;\n\n    /* for buffer mode */\n    str.buf = null;\n    str.bufpos = 0;\n    str.buflen = 0;\n    str.bufeof = 0;\n    str.timer_id = null;\n    str.flush_func = null;\n\n    /* for streaming mode */\n    str.fstream = null;\n\n    str.readcount = 0;\n    str.writecount = 0;\n    str.readable = readable;\n    str.writable = writable;\n\n    str.prev = null;\n    str.next = gli_streamlist;\n    gli_streamlist = str;\n    if (str.next)\n        str.next.prev = str;\n\n    if (GiDispa)\n        GiDispa.class_register('stream', str);\n\n    return str;\n}\n\nfunction gli_delete_stream(str) {\n    var prev, next;\n    \n    if (str === gli_currentstr) {\n        gli_currentstr = null;\n    }\n\n    gli_windows_unechostream(str);\n\n    if (str.type == strtype_Memory) {\n        if (GiDispa)\n            GiDispa.unretain_array(str.buf);\n    }\n    else if (str.type == strtype_File) {\n        if (str.fstream) {\n            str.fstream.fclose();\n            str.fstream = null;\n        }\n    }\n\n    if (GiDispa)\n        GiDispa.class_unregister('stream', str);\n\n    prev = str.prev;\n    next = str.next;\n    str.prev = null;\n    str.next = null;\n\n    if (prev)\n        prev.next = next;\n    else\n        gli_streamlist = next;\n    if (next)\n        next.prev = prev;\n\n    str.fstream = null;\n    str.buf = null;\n    str.readable = false;\n    str.writable = false;\n    str.ref = null;\n    str.win = null;\n    str.file = null;\n    str.rock = null;\n    str.disprock = null;\n}\n\nfunction gli_stream_open_window(win) {\n    var str;\n    str = gli_new_stream(strtype_Window, false, true, 0);\n    str.unicode = true;\n    str.win = win;\n    return str;\n}\n\n/* This is called on every write to a file stream. If a file is being\n   written intermittently (a transcript file, for example) we'd like to\n   flush the output every few seconds, in case the user closes the\n   browser without closing the file (\"script off\").\n\n   We do this by setting a ten-second timer (if there isn't one set already).\n   The timer calls a flush method on the stream.\n\n   (If autosave is on, we'll wind up flushing on most glk_select calls,\n   which isn't quite as nicely paced. But it's a minor problem.)\n*/\nfunction gli_stream_dirty_file(str) {\n    if (str.streaming)\n        GlkOte.log('### gli_stream_dirty_file called for streaming file!');\n    if (str.timer_id === null) {\n        if (str.flush_func === null) {\n            /* Bodge together a closure to act as a stream method. */\n            str.flush_func = function() { gli_stream_flush_file(str); };\n        }\n        str.timer_id = setTimeout(str.flush_func, 10000);\n    }\n}\n\n/* Write out the contents of a file stream to the \"disk file\". Because\n   localStorage doesn't support appending, we have to dump the entire\n   buffer out.\n*/\nfunction gli_stream_flush_file(str) {\n    if (str.streaming)\n        GlkOte.log('### gli_stream_flush_file called for streaming file!');\n    if (!(str.timer_id === null)) {\n        clearTimeout(str.timer_id);\n    }\n    str.timer_id = null;\n    Dialog.file_write(str.ref, str.buf);\n}\n\nfunction gli_new_fileref(filename, usage, rock, ref) {\n    var fref = {};\n    fref.filename = filename;\n    fref.rock = rock;\n    fref.disprock = undefined;\n\n    fref.textmode = ((usage & Const.fileusage_TextMode) != 0);\n    fref.filetype = (usage & Const.fileusage_TypeMask);\n    fref.filetypename = FileTypeMap[fref.filetype];\n    if (!fref.filetypename) {\n        fref.filetypename = 'xxx';\n    }\n\n    if (!ref) {\n        var gameid = '';\n        if (fref.filetype == Const.fileusage_SavedGame)\n            gameid = VM.get_signature();\n        ref = Dialog.file_construct_ref(fref.filename, fref.filetypename, gameid);\n    }\n    fref.ref = ref;\n\n    fref.prev = null;\n    fref.next = gli_filereflist;\n    gli_filereflist = fref;\n    if (fref.next)\n        fref.next.prev = fref;\n\n    if (GiDispa)\n        GiDispa.class_register('fileref', fref);\n\n    return fref;\n}\n\nfunction gli_delete_fileref(fref) {\n    var prev, next;\n    \n    if (GiDispa)\n        GiDispa.class_unregister('fileref', fref);\n\n    prev = fref.prev;\n    next = fref.next;\n    fref.prev = null;\n    fref.next = null;\n\n    if (prev)\n        prev.next = next;\n    else\n        gli_filereflist = next;\n    if (next)\n        next.prev = prev;\n\n    fref.filename = null;\n    fref.ref = null;\n    fref.rock = null;\n    fref.disprock = null;\n}\n\n/* Write one character (given as a Unicode value) to a stream.\n   This is called by both the one-byte and four-byte character APIs.\n*/\nfunction gli_put_char(str, ch) {\n    if (!str || !str.writable)\n        throw('gli_put_char: invalid stream');\n\n    if (!str.unicode) {\n        if (ch < 0 || ch >= 0x100)\n            ch = 63;  // '?'\n    }\n\n    str.writecount += 1;\n    \n    switch (str.type) {\n    case strtype_File:\n        if (str.streaming) {\n            if (!str.unicode) {\n                str.buffer4[0] = ch;\n                str.fstream.fwrite(str.buffer4, 1);\n            }\n            else {\n                if (!str.isbinary) {\n                    /* cheap UTF-8 stream */\n                    var len;\n                    if (ch < 0x10000) {\n                        len = str.buffer4.write(String.fromCharCode(ch));\n                        str.fstream.fwrite(str.buffer4, len); // utf8\n                    }\n                    else {\n                        /* String.fromCharCode chokes on astral characters;\n                           do it the hard way */\n                        var arr8 = UniArrayToUTF8([ch]);\n                        var buf = str.fstream.BufferClass.from(arr8);\n                        str.fstream.fwrite(buf);\n                    }\n                }\n                else {\n                    /* cheap big-endian stream */\n                    str.buffer4.writeUInt32BE(ch, 0, true);\n                    str.fstream.fwrite(str.buffer4, 4);\n                }\n            }\n        }\n        else {\n            /* non-streaming... */\n            gli_stream_dirty_file(str);\n            if (!str.unicode || (ch < 0x80 && !str.isbinary)) {\n                if (str.bufpos < str.buflen) {\n                    str.buf[str.bufpos] = ch;\n                    str.bufpos += 1;\n                    if (str.bufpos > str.bufeof)\n                        str.bufeof = str.bufpos;\n                }\n            }\n            else {\n                let arr;\n                if (!str.isbinary)\n                    arr = UniArrayToUTF8([ch]);\n                else\n                    arr = UniArrayToBE32([ch]);\n                let len = arr.length;\n                if (len > str.buflen-str.bufpos)\n                    len = str.buflen-str.bufpos;\n                for (let ix=0; ix<len; ix++)\n                    str.buf[str.bufpos+ix] = arr[ix];\n                str.bufpos += len;\n                if (str.bufpos > str.bufeof)\n                    str.bufeof = str.bufpos;\n            }\n        }\n        break;\n    case strtype_Memory:\n        if (str.bufpos < str.buflen) {\n            str.buf[str.bufpos] = ch;\n            str.bufpos += 1;\n            if (str.bufpos > str.bufeof)\n                str.bufeof = str.bufpos;\n        }\n        break;\n    case strtype_Window:\n        if (str.win.line_request)\n            throw('gli_put_char: window has pending line request');\n        gli_window_put_string(str.win, CharToString(ch));\n        if (str.win.echostr)\n            gli_put_char(str.win.echostr, ch);\n        break;\n    }\n}\n\n/* Write characters (given as an array of Unicode values) to a stream.\n   This is called by both the one-byte and four-byte character APIs.\n   The \"allbytes\" argument is a hint that all the array values are\n   already in the range 0-255.\n*/\nfunction gli_put_array(str, arr, allbytes) {\n    var len, val;\n\n    if (!str || !str.writable)\n        throw('gli_put_array: invalid stream');\n\n    if (!str.unicode && !allbytes) {\n        arr = TrimArrayToBytes(arr);\n        allbytes = true;\n    }\n\n    str.writecount += arr.length;\n    \n    switch (str.type) {\n    case strtype_File:\n        if (str.streaming) {\n            if (!str.unicode) {\n                const buf = str.fstream.BufferClass.from(arr);\n                str.fstream.fwrite(buf);\n            }\n            else {\n                if (!str.isbinary) {\n                    /* cheap UTF-8 stream */\n                    const arr8 = UniArrayToUTF8(arr);\n                    const buf = str.fstream.BufferClass.from(arr8);\n                    str.fstream.fwrite(buf);\n                }\n                else {\n                    /* cheap big-endian stream */\n                    const buf = str.fstream.BufferClass.alloc(4*arr.length);\n                    for (let ix=0; ix<arr.length; ix++) {\n                        buf.writeUInt32BE(arr[ix], 4*ix, true);\n                    }\n                    str.fstream.fwrite(buf);\n                }\n            }\n        }\n        else {\n            /* non-streaming... */\n            gli_stream_dirty_file(str);\n            var arr8;\n            if (!str.unicode) {\n                arr8 = arr;\n            }\n            else {\n                if (!str.isbinary)\n                    arr8 = UniArrayToUTF8(arr);\n                else\n                    arr8 = UniArrayToBE32(arr);\n            }\n            let len = arr8.length;\n            if (len > str.buflen-str.bufpos)\n                len = str.buflen-str.bufpos;\n            for (let ix=0; ix<len; ix++)\n                str.buf[str.bufpos+ix] = arr8[ix];\n            str.bufpos += len;\n            if (str.bufpos > str.bufeof)\n                str.bufeof = str.bufpos;\n        }\n        break;\n    case strtype_Memory:\n        len = arr.length;\n        if (len > str.buflen-str.bufpos)\n            len = str.buflen-str.bufpos;\n        for (let ix=0; ix<len; ix++)\n            str.buf[str.bufpos+ix] = arr[ix];\n        str.bufpos += len;\n        if (str.bufpos > str.bufeof)\n            str.bufeof = str.bufpos;\n        break;\n    case strtype_Window:\n        if (str.win.line_request)\n            throw('gli_put_array: window has pending line request');\n        if (allbytes)\n            val = String.fromCharCode.apply(this, arr);\n        else\n            val = UniArrayToString(arr);\n        gli_window_put_string(str.win, val);\n        if (str.win.echostr)\n            gli_put_array(str.win.echostr, arr, allbytes);\n        break;\n    }\n}\n\nfunction gli_get_char(str, want_unicode) {\n    var ch;\n\n    if (!str || !str.readable)\n        return -1;\n    \n    switch (str.type) {\n    case strtype_File:\n        if (str.streaming) {\n            if (!str.unicode) {\n                const len = str.fstream.fread(str.buffer4, 1);\n                if (!len)\n                    return -1;\n                str.readcount++;\n                return str.buffer4[0];\n            }\n            else {\n                if (!str.isbinary) {\n                    /* slightly less cheap UTF8 stream */\n                    let val0, val1, val2, val3;\n                    const len = str.fstream.fread(str.buffer4, 1);\n                    if (!len)\n                        return -1;\n                    val0 = str.buffer4[0];\n                    if (val0 < 0x80) {\n                        ch = val0;\n                    }\n                    else {\n                        const len = str.fstream.fread(str.buffer4, 1);\n                        if (!len)\n                            return -1;\n                        val1 = str.buffer4[0];\n                        if ((val1 & 0xC0) != 0x80)\n                            return -1;\n                        if ((val0 & 0xE0) == 0xC0) {\n                            ch = (val0 & 0x1F) << 6;\n                            ch |= (val1 & 0x3F);\n                        }\n                        else {\n                            const len = str.fstream.fread(str.buffer4, 1);\n                            if (!len)\n                                return -1;\n                            val2 = str.buffer4[0];\n                            if ((val2 & 0xC0) != 0x80)\n                                return -1;\n                            if ((val0 & 0xF0) == 0xE0) {\n                                ch = (((val0 & 0xF)<<12)  & 0x0000F000);\n                                ch |= (((val1 & 0x3F)<<6) & 0x00000FC0);\n                                ch |= (((val2 & 0x3F))    & 0x0000003F);\n                            }\n                            else if ((val0 & 0xF0) == 0xF0) {\n                                const len = str.fstream.fread(str.buffer4, 1);\n                                if (!len)\n                                    return -1;\n                                val3 = str.buffer4[0];\n                                if ((val3 & 0xC0) != 0x80)\n                                    return -1;\n                                ch = (((val0 & 0x7)<<18)   & 0x1C0000);\n                                ch |= (((val1 & 0x3F)<<12) & 0x03F000);\n                                ch |= (((val2 & 0x3F)<<6)  & 0x000FC0);\n                                ch |= (((val3 & 0x3F))     & 0x00003F);\n                            }\n                            else {\n                                return -1;\n                            }\n                        }\n                    }\n                }\n                else {\n                    /* cheap big-endian stream */\n                    const len = str.fstream.fread(str.buffer4, 4);\n                    if (len < 4)\n                        return -1;\n                    /*### or buf.readUInt32BE(0, true) */\n                    ch = (str.buffer4[0] << 24);\n                    ch |= (str.buffer4[1] << 16);\n                    ch |= (str.buffer4[2] << 8);\n                    ch |= str.buffer4[3];\n                }\n                str.readcount++;\n                ch >>>= 0;\n                if (!want_unicode && ch >= 0x100)\n                    return 63; // return '?'\n                return ch;\n            }\n        }\n        /* non-streaming, fall through to resource... */\n    case strtype_Resource:\n        if (str.unicode) {\n            if (str.isbinary) {\n                /* cheap big-endian stream */\n                if (str.bufpos >= str.bufeof)\n                    return -1;\n                ch = str.buf[str.bufpos];\n                str.bufpos++;\n                if (str.bufpos >= str.bufeof)\n                    return -1;\n                ch = (ch << 8) | (str.buf[str.bufpos] & 0xFF);\n                str.bufpos++;\n                if (str.bufpos >= str.bufeof)\n                    return -1;\n                ch = (ch << 8) | (str.buf[str.bufpos] & 0xFF);\n                str.bufpos++;\n                if (str.bufpos >= str.bufeof)\n                    return -1;\n                ch = (ch << 8) | (str.buf[str.bufpos] & 0xFF);\n                str.bufpos++;\n            }\n            else {\n                /* slightly less cheap UTF8 stream */\n                let val0, val1, val2, val3;\n                if (str.bufpos >= str.bufeof)\n                    return -1;\n                val0 = str.buf[str.bufpos];\n                str.bufpos++;\n                if (val0 < 0x80) {\n                    ch = val0;\n                }\n                else {\n                    if (str.bufpos >= str.bufeof)\n                        return -1;\n                    val1 = str.buf[str.bufpos];\n                    str.bufpos++;\n                    if ((val1 & 0xC0) != 0x80)\n                        return -1;\n                    if ((val0 & 0xE0) == 0xC0) {\n                        ch = (val0 & 0x1F) << 6;\n                        ch |= (val1 & 0x3F);\n                    }\n                    else {\n                        if (str.bufpos >= str.bufeof)\n                            return -1;\n                        val2 = str.buf[str.bufpos];\n                        str.bufpos++;\n                        if ((val2 & 0xC0) != 0x80)\n                            return -1;\n                        if ((val0 & 0xF0) == 0xE0) {\n                            ch = (((val0 & 0xF)<<12)  & 0x0000F000);\n                            ch |= (((val1 & 0x3F)<<6) & 0x00000FC0);\n                            ch |= (((val2 & 0x3F))    & 0x0000003F);\n                        }\n                        else if ((val0 & 0xF0) == 0xF0) {\n                            if (str.bufpos >= str.bufeof)\n                                return -1;\n                            val3 = str.buf[str.bufpos];\n                            str.bufpos++;\n                            if ((val3 & 0xC0) != 0x80)\n                                return -1;\n                            ch = (((val0 & 0x7)<<18)   & 0x1C0000);\n                            ch |= (((val1 & 0x3F)<<12) & 0x03F000);\n                            ch |= (((val2 & 0x3F)<<6)  & 0x000FC0);\n                            ch |= (((val3 & 0x3F))     & 0x00003F);\n                        }\n                        else {\n                            return -1;\n                        }\n                    }\n                }\n            }\n            str.readcount++;\n            ch >>>= 0;\n            if (!want_unicode && ch >= 0x100)\n                return 63; // return '?'\n            return ch;\n        }\n        /* non-unicode file/resource, fall through to memory... */\n    case strtype_Memory:\n        if (str.bufpos < str.bufeof) {\n            ch = str.buf[str.bufpos];\n            str.bufpos++;\n            str.readcount++;\n            if (!want_unicode && ch >= 0x100)\n                return 63; // return '?'\n            return ch;\n        }\n        else {\n            return -1; // end of stream \n        }\n    default:\n        return -1;\n    }\n}\n\nfunction gli_get_line(str, buf, want_unicode) {\n    if (!str || !str.readable)\n        return 0;\n\n    var len = buf.length;\n    var lx, ch;\n    var gotnewline;\n\n    switch (str.type) {\n    case strtype_File:\n        if (str.streaming) {\n            if (len == 0)\n                return 0;\n            len -= 1; /* for the terminal null */\n            gotnewline = false;\n            for (lx=0; lx<len && !gotnewline; lx++) {\n                ch = gli_get_char(str, want_unicode);\n                if (ch == -1)\n                    break;\n                buf[lx] = ch;\n                gotnewline = (ch == 10);\n            }\n            return lx;\n        }\n        /* non-streaming, fall through to resource... */\n    case strtype_Resource:\n        if (str.unicode) {\n            if (len == 0)\n                return 0;\n            len -= 1; /* for the terminal null */\n            gotnewline = false;\n            for (lx=0; lx<len && !gotnewline; lx++) {\n                ch = gli_get_char(str, want_unicode);\n                if (ch == -1)\n                    break;\n                buf[lx] = ch;\n                gotnewline = (ch == 10);\n            }\n            return lx;\n        }\n        /* non-unicode file/resource, fall through to memory... */\n    case strtype_Memory:\n        if (len == 0)\n            return 0;\n        len -= 1; /* for the terminal null */\n        if (str.bufpos >= str.bufeof) {\n            len = 0;\n        }\n        else {\n            if (str.bufpos + len > str.bufeof) {\n                len = str.bufeof - str.bufpos;\n            }\n        }\n        gotnewline = false;\n        if (!want_unicode) {\n            for (lx=0; lx<len && !gotnewline; lx++) {\n                ch = str.buf[str.bufpos++];\n                if (!want_unicode && ch >= 0x100)\n                    ch = 63; // ch = '?'\n                buf[lx] = ch;\n                gotnewline = (ch == 10);\n            }\n        }\n        else {\n            for (lx=0; lx<len && !gotnewline; lx++) {\n                ch = str.buf[str.bufpos++];\n                buf[lx] = ch;\n                gotnewline = (ch == 10);\n            }\n        }\n        str.readcount += lx;\n        return lx;\n    default:\n        return 0;\n    }\n}\n\nfunction gli_get_buffer(str, buf, want_unicode) {\n    if (!str || !str.readable)\n        return 0;\n\n    var len = buf.length;\n    var lx, ch;\n    \n    switch (str.type) {\n    case strtype_File:\n        if (str.streaming) {\n            for (lx=0; lx<len; lx++) {\n                ch = gli_get_char(str, want_unicode);\n                if (ch == -1)\n                    break;\n                buf[lx] = ch;\n            }\n            return lx;\n        }\n        /* non-streaming, fall through to resource... */\n    case strtype_Resource:\n        if (str.unicode) {\n            for (lx=0; lx<len; lx++) {\n                ch = gli_get_char(str, want_unicode);\n                if (ch == -1)\n                    break;\n                buf[lx] = ch;\n            }\n            return lx;\n        }\n        /* non-unicode file/resource, fall through to memory... */\n    case strtype_Memory:\n        if (str.bufpos >= str.bufeof) {\n            len = 0;\n        }\n        else {\n            if (str.bufpos + len > str.bufeof) {\n                len = str.bufeof - str.bufpos;\n            }\n        }\n        if (!want_unicode) {\n            for (lx=0; lx<len; lx++) {\n                ch = str.buf[str.bufpos++];\n                if (!want_unicode && ch >= 0x100)\n                    ch = 63; // ch = '?'\n                buf[lx] = ch;\n            }\n        }\n        else {\n            for (lx=0; lx<len; lx++) {\n                buf[lx] = str.buf[str.bufpos++];\n            }\n        }\n        str.readcount += len;\n        return len;\n    default:\n        return 0;\n    }\n}\n\nfunction gli_stream_fill_result(str, result) {\n    if (!result)\n        return;\n    result.set_field(0, str.readcount);\n    result.set_field(1, str.writecount);\n}\n\nfunction glk_put_jstring(val, allbytes) {\n    glk_put_jstring_stream(gli_currentstr, val, allbytes);\n}\n\nfunction glk_put_jstring_stream(str, val, allbytes) {\n    var len;\n\n    if (!str || !str.writable)\n        throw('glk_put_jstring: invalid stream');\n\n    str.writecount += val.length;\n    \n    switch (str.type) {\n    case strtype_File:\n        if (str.streaming) {\n            if (!str.unicode) {\n                // if !allbytes, we just give up on non-Latin-1 characters\n                const buf = str.fstream.BufferClass.from(val, 'binary');\n                str.fstream.fwrite(buf);\n            }\n            else {\n                if (!str.isbinary) {\n                    /* cheap UTF-8 stream */\n                    const buf = str.fstream.BufferClass.from(val); // utf8\n                    str.fstream.fwrite(buf);\n                }\n                else {\n                    /* cheap big-endian stream */\n                    const buf = str.fstream.BufferClass.alloc(4*val.length);\n                    for (let ix=0; ix<val.length; ix++) {\n                        buf.writeUInt32BE(val.charCodeAt(ix), 4*ix, true);\n                    }\n                    str.fstream.fwrite(buf);\n                }\n            }\n        }\n        else {\n            /* non-streaming... */\n            gli_stream_dirty_file(str);\n            const arr = [];\n            for (let ix=0; ix<val.length; ix++)\n                arr.push(val.charCodeAt(ix));\n            let arr8;\n            if (!str.unicode) {\n                arr8 = arr;\n            }\n            else {\n                if (!str.isbinary)\n                    arr8 = UniArrayToUTF8(arr);\n                else\n                    arr8 = UniArrayToBE32(arr);\n            }\n            let len = arr8.length;\n            if (len > str.buflen-str.bufpos)\n                len = str.buflen-str.bufpos;\n            for (let ix=0; ix<len; ix++)\n                str.buf[str.bufpos+ix] = arr8[ix];\n            str.bufpos += len;\n            if (str.bufpos > str.bufeof)\n                str.bufeof = str.bufpos;\n        }\n        break;\n    case strtype_Memory:\n        len = val.length;\n        if (len > str.buflen-str.bufpos)\n            len = str.buflen-str.bufpos;\n        if (str.unicode || allbytes) {\n            for (let ix=0; ix<len; ix++)\n                str.buf[str.bufpos+ix] = val.charCodeAt(ix);\n        }\n        else {\n            for (let ix=0; ix<len; ix++) {\n                var ch = val.charCodeAt(ix);\n                if (ch < 0 || ch >= 0x100)\n                    ch = 63;  // '?'\n                str.buf[str.bufpos+ix] = ch;\n            }\n        }\n        str.bufpos += len;\n        if (str.bufpos > str.bufeof)\n            str.bufeof = str.bufpos;\n        break;\n    case strtype_Window:\n        if (str.win.line_request)\n            throw('glk_put_jstring: window has pending line request');\n        gli_window_put_string(str.win, val);\n        if (str.win.echostr)\n            glk_put_jstring_stream(str.win.echostr, val, allbytes);\n        break;\n    }\n}\n\nfunction gli_set_style(str, val) {\n    if (!str || !str.writable)\n        throw('gli_set_style: invalid stream');\n\n    if (val >= Const.style_NUMSTYLES)\n        val = 0;\n\n    if (str.type == strtype_Window) {\n        str.win.style = val;\n        if (str.win.echostr)\n            gli_set_style(str.win.echostr, val);\n    }\n}\n\nfunction gli_set_hyperlink(str, val) {\n    if (!str || !str.writable)\n        throw('gli_set_hyperlink: invalid stream');\n\n    if (str.type == strtype_Window) {\n        str.win.hyperlink = val;\n        if (str.win.echostr)\n            gli_set_hyperlink(str.win.echostr, val);\n    }\n}\n\n/* The catalog of Glk API functions. */\n\nfunction glk_exit() {\n    /* For safety, this is fast and idempotent. */\n    has_exited = true;\n    ui_disabled = true;\n    gli_selectref = null;\n    if (option_exit_warning)\n        GlkOte.warning(option_exit_warning);\n    return DidNotReturn;\n}\n\nfunction glk_tick() {\n    /* Do nothing. */\n}\n\nfunction glk_gestalt(sel, val) {\n    return glk_gestalt_ext(sel, val, null);\n}\n\nfunction glk_gestalt_ext(sel, val, arr) {\n    switch (sel) {\n\n    case 0: // gestalt_Version\n        /* This implements Glk spec version 0.7.4. */\n        return 0x00000704;\n\n    case 1: // gestalt_CharInput\n        /* This is not a terrific approximation. Return false for function\n           keys, control keys, and the high-bit non-printables. For\n           everything else in the Unicode range, return true. */\n        if (val <= Const.keycode_Left && val >= Const.keycode_End)\n            return 1;\n        if (val >= 0x100000000-Const.keycode_MAXVAL)\n            return 0;\n        if (val > 0x10FFFF)\n            return 0;\n        if ((val >= 0 && val < 32) || (val >= 127 && val < 160))\n            return 0;\n        return 1;\n\n    case 2: // gestalt_LineInput\n        /* Same as the above, except no special keys. */\n        if (val > 0x10FFFF)\n            return 0;\n        if ((val >= 0 && val < 32) || (val >= 127 && val < 160))\n            return 0;\n        return 1;\n\n    case 3: // gestalt_CharOutput\n        /* Same thing again. We assume that all printable characters,\n           as well as the placeholders for nonprintables, are one character\n           wide. */\n        if ((val > 0x10FFFF) \n            || (val >= 0 && val < 32) \n            || (val >= 127 && val < 160)) {\n            if (arr)\n                arr[0] = 1;\n            return 0; // gestalt_CharOutput_CannotPrint\n        }\n        if (arr)\n            arr[0] = 1;\n        return 2; // gestalt_CharOutput_ExactPrint\n\n    case 4: // gestalt_MouseInput\n        if (val == Const.wintype_TextGrid)\n            return 1;\n        if (support.graphics && val == Const.wintype_Graphics)\n            return 1;\n        return 0;\n\n    case 5: // gestalt_Timer\n        return support.timer || 0;\n\n    case 6: // gestalt_Graphics\n        return support.graphics || 0;\n\n    case 7: // gestalt_DrawImage\n        if (support.graphics && (val === Const.wintype_TextBuffer || val === Const.wintype_Graphics))\n        {\n            return 1;\n        }\n        return 0;\n\n    case 8: // gestalt_Sound\n        return 0;\n\n    case 9: // gestalt_SoundVolume\n        return 0;\n\n    case 10: // gestalt_SoundNotify\n        return 0;\n\n    case 11: // gestalt_Hyperlinks\n        return support.hyperlinks || 0;\n\n    case 12: // gestalt_HyperlinkInput\n        if (support.hyperlinks && (val === Const.wintype_TextBuffer || val === Const.wintype_TextGrid))\n            return 1;\n        else\n            return 0;\n\n    case 13: // gestalt_SoundMusic\n        return 0;\n\n    case 14: // gestalt_GraphicsTransparency\n        return support.graphics || 0;\n\n    case 15: // gestalt_Unicode\n        return 1;\n\n    case 16: // gestalt_UnicodeNorm\n        return 1;\n\n    case 17: // gestalt_LineInputEcho\n        return 1;\n\n    case 18: // gestalt_LineTerminators\n        return 1;\n\n    case 19: // gestalt_LineTerminatorKey\n        /* Really this result should be inspected from glkote.js. Since it\n           isn't, be sure to keep these values in sync with \n           terminator_key_names. */\n        if (val == Const.keycode_Escape)\n            return 1;\n        if (val >= Const.keycode_Func12 && val <= Const.keycode_Func1)\n            return 1;\n        return 0;\n\n    case 20: // gestalt_DateTime\n        return 1;\n\n    case 21: // gestalt_Sound2\n        return 0;\n\n    case 22: // gestalt_ResourceStream\n        return 1;\n\n    case 23: // gestalt_GraphicsCharInput\n        return 0;\n\n    case 0x1100: // gestalt_GarglkText\n        return support.garglktext || 0\n    }\n\n    if (option_glk_gestalt_hook) {\n        var res = option_glk_gestalt_hook(sel, val, arr);\n        if (res !== undefined)\n            return res;\n    }\n\n    return 0;\n}\n\nfunction glk_window_iterate(win, rockref) {\n    if (!win)\n        win = gli_windowlist;\n    else\n        win = win.next;\n\n    if (win) {\n        if (rockref)\n            rockref.set_value(win.rock);\n        return win;\n    }\n\n    if (rockref)\n        rockref.set_value(0);\n    return null;\n}\n\nfunction glk_window_get_rock(win) {\n    if (!win)\n        throw('glk_window_get_rock: invalid window');\n    return win.rock;\n}\n\nfunction glk_window_get_root() {\n    return gli_rootwin;\n}\n\nfunction glk_window_open(splitwin, method, size, wintype, rock) {\n    var oldparent, box, val;\n    var pairwin, newwin;\n\n    if (!gli_rootwin) {\n        if (splitwin)\n            throw('glk_window_open: splitwin must be null for first window');\n\n        oldparent = null;\n        box = {\n            left: content_metrics.outspacingx,\n            top: content_metrics.outspacingy,\n            right: content_metrics.width-content_metrics.outspacingx,\n            bottom: content_metrics.height-content_metrics.outspacingy\n        };\n    }\n    else {\n        if (!splitwin)\n            throw('glk_window_open: splitwin must not be null');\n\n        val = (method & Const.winmethod_DivisionMask);\n        if (val != Const.winmethod_Fixed && val != Const.winmethod_Proportional)\n            throw('glk_window_open: invalid method (not fixed or proportional)');\n\n        val = (method & Const.winmethod_DirMask);\n        if (val != Const.winmethod_Above && val != Const.winmethod_Below \n            && val != Const.winmethod_Left && val != Const.winmethod_Right) \n            throw('glk_window_open: invalid method (bad direction)');\n        \n        box = splitwin.bbox;\n\n        oldparent = splitwin.parent;\n        if (oldparent && oldparent.type != Const.wintype_Pair) \n            throw('glk_window_open: parent window is not Pair');\n    }\n\n    newwin = gli_new_window(wintype, rock);\n\n    switch (newwin.type) {\n    case Const.wintype_TextBuffer:\n        /* accum is a list of strings of a given style; newly-printed text\n           is pushed onto the list. accumstyle is the style of that text.\n           Anything printed in a different style (or hyperlink value)\n           triggers a call to gli_window_buffer_deaccumulate, which cleans\n           out accum and adds the results to the content array. The content\n           is in GlkOte format.\n        */\n        newwin.accum = [];\n        newwin.accumstyle = null;\n        newwin.accumhyperlink = 0;\n        newwin.accum_fg = null\n        newwin.accum_bg = null\n        newwin.accum_reverse = null\n        newwin.content = [];\n        newwin.clearcontent = false;\n        newwin.reserve = []; /* autosave of recent content */\n        newwin.stylehints = clone_stylehints(stylehints.buffer)\n        break;\n    case Const.wintype_TextGrid:\n        /* lines is a list of line objects. A line looks like\n           { chars: [...], styles: [...], hyperlinks: [...], dirty: bool, fgs: [], bgs: [], reverses: [] }.\n        */\n        newwin.gridwidth = 0;\n        newwin.gridheight = 0;\n        newwin.lines = [];\n        newwin.cursorx = 0;\n        newwin.cursory = 0;\n        newwin.clearcontent = false;\n        newwin.stylehints = clone_stylehints(stylehints.grid)\n        break;\n    case Const.wintype_Graphics:\n        if (!support.graphics) {\n            /* Graphics windows not supported; silently return null */\n            gli_delete_window(newwin);\n            return null;\n        }\n        newwin.content = [];\n        newwin.reserve = []; /* autosave of recent content */\n        break;\n    case Const.wintype_Blank:\n        break;\n    case Const.wintype_Pair:\n        throw('glk_window_open: cannot open pair window directly')\n    default:\n        /* Silently return null */\n        gli_delete_window(newwin);\n        return null;\n    }\n\n    if (!splitwin) {\n        gli_rootwin = newwin;\n        gli_window_rearrange(newwin, box);\n    }\n    else {\n        /* create pairwin, with newwin as the key */\n        pairwin = gli_new_window(Const.wintype_Pair, 0);\n        pairwin.pair_dir = method & Const.winmethod_DirMask;\n        pairwin.pair_division = method & Const.winmethod_DivisionMask;\n        pairwin.pair_key = newwin;\n        pairwin.pair_keydamage = false;\n        pairwin.pair_size = size;\n        pairwin.pair_hasborder = ((method & Const.winmethod_BorderMask) == Const.winmethod_Border);\n        pairwin.pair_vertical = (pairwin.pair_dir == Const.winmethod_Left || pairwin.pair_dir == Const.winmethod_Right);\n        pairwin.pair_backward = (pairwin.pair_dir == Const.winmethod_Left || pairwin.pair_dir == Const.winmethod_Above);\n\n        pairwin.child1 = splitwin;\n        pairwin.child2 = newwin;\n        splitwin.parent = pairwin;\n        newwin.parent = pairwin;\n        pairwin.parent = oldparent;\n\n        if (oldparent) {\n            if (oldparent.child1 == splitwin)\n                oldparent.child1 = pairwin;\n            else\n                oldparent.child2 = pairwin;\n        }\n        else {\n            gli_rootwin = pairwin;\n        }\n\n        gli_window_rearrange(pairwin, box);\n    }\n\n    return newwin;\n}\n\nfunction glk_window_close(win, statsref) {\n    if (!win)\n        throw('glk_window_close: invalid window');\n\n    if (win === gli_rootwin || !win.parent) {\n        /* close the root window, which means all windows. */\n        \n        gli_rootwin = null;\n        \n        /* begin (simpler) closation */\n        \n        gli_stream_fill_result(win.str, statsref);\n        gli_window_close(win, true); \n    }\n    else {\n        /* have to jigger parent */\n        var pairwin, grandparwin, sibwin, box, wx, keydamage_flag;\n\n        pairwin = win.parent;\n        if (win === pairwin.child1)\n            sibwin = pairwin.child2;\n        else if (win === pairwin.child2)\n            sibwin = pairwin.child1;\n        else\n            throw('glk_window_close: window tree is corrupted');\n\n        box = pairwin.bbox;\n\n        grandparwin = pairwin.parent;\n        if (!grandparwin) {\n            gli_rootwin = sibwin;\n            sibwin.parent = null;\n        }\n        else {\n            if (grandparwin.child1 === pairwin)\n                grandparwin.child1 = sibwin;\n            else\n                grandparwin.child2 = sibwin;\n            sibwin.parent = grandparwin;\n        }\n        \n        /* Begin closation */\n        \n        gli_stream_fill_result(win.str, statsref);\n\n        /* Close the child window (and descendants), so that key-deletion can\n            crawl up the tree to the root window. */\n        gli_window_close(win, true); \n\n        /* This probably isn't necessary, but the child *is* gone, so just\n            in case. */\n        if (win === pairwin.child1) {\n            pairwin.child1 = null;\n        }\n        else if (win === pairwin.child2) {\n            pairwin.child2 = null;\n        }\n        \n        /* Now we can delete the parent pair. */\n        gli_window_close(pairwin, false);\n\n        keydamage_flag = false;\n        for (wx=sibwin; wx; wx=wx.parent) {\n            if (wx.type == Const.wintype_Pair) {\n                if (wx.pair_keydamage) {\n                    keydamage_flag = true;\n                    wx.pair_keydamage = false;\n                }\n            }\n        }\n        \n        if (keydamage_flag) {\n            // Zarf: what was this meant to be?\n            //box = content_box;\n            gli_window_rearrange(gli_rootwin, box);\n        }\n        else {\n            gli_window_rearrange(sibwin, box);\n        }\n    }\n}\n\nfunction glk_window_get_size(win, widthref, heightref) {\n    if (!win)\n        throw('glk_window_get_size: invalid window');\n\n    var wid = 0;\n    var hgt = 0;\n    var boxwidth, boxheight;\n\n    switch (win.type) {\n\n    case Const.wintype_TextGrid:\n        boxwidth = win.bbox.right - win.bbox.left;\n        boxheight = win.bbox.bottom - win.bbox.top;\n        wid = Math.max(0, Math.floor((boxwidth-content_metrics.gridmarginx) / content_metrics.gridcharwidth));\n        hgt = Math.max(0, Math.floor((boxheight-content_metrics.gridmarginy) / content_metrics.gridcharheight));        \n        break;\n\n    case Const.wintype_TextBuffer:\n        boxwidth = win.bbox.right - win.bbox.left;\n        boxheight = win.bbox.bottom - win.bbox.top;\n        wid = Math.max(0, Math.floor((boxwidth-content_metrics.buffermarginx) / content_metrics.buffercharwidth));\n        hgt = Math.max(0, Math.floor((boxheight-content_metrics.buffermarginy) / content_metrics.buffercharheight));        \n        break;\n\n    case Const.wintype_Graphics:\n        boxwidth = win.bbox.right - win.bbox.left;\n        boxheight = win.bbox.bottom - win.bbox.top;\n        wid = boxwidth - content_metrics.graphicsmarginx;\n        hgt = boxheight - content_metrics.graphicsmarginy;\n        break;\n    }\n\n    if (widthref)\n        widthref.set_value(wid);\n    if (heightref)\n        heightref.set_value(hgt);\n}\n\nfunction glk_window_set_arrangement(win, method, size, keywin) {\n    var wx, newdir, newvertical, newbackward;\n\n    if (!win)\n        throw('glk_window_set_arrangement: invalid window');\n    if (win.type != Const.wintype_Pair) \n        throw('glk_window_set_arrangement: not a pair window');\n\n    if (keywin) {\n        if (keywin.type == Const.wintype_Pair)\n            throw('glk_window_set_arrangement: keywin cannot be a pair window');\n        for (wx=keywin; wx; wx=wx.parent) {\n            if (wx == win)\n                break;\n        }\n        if (!wx)\n            throw('glk_window_set_arrangement: keywin must be a descendant');\n    }\n\n    newdir = method & Const.winmethod_DirMask;\n    newvertical = (newdir == Const.winmethod_Left || newdir == Const.winmethod_Right);\n    newbackward = (newdir == Const.winmethod_Left || newdir == Const.winmethod_Above);\n    if (!keywin)\n        keywin = win.pair_key;\n\n    if (newvertical && !win.pair_vertical)\n        throw('glk_window_set_arrangement: split must stay horizontal');\n    if (!newvertical && win.pair_vertical)\n        throw('glk_window_set_arrangement: split must stay vertical');\n\n    if (keywin && keywin.type == Const.wintype_Blank\n        && (method & Const.winmethod_DivisionMask) == Const.winmethod_Fixed) \n        throw('glk_window_set_arrangement: a blank window cannot have a fixed size');\n\n    if ((newbackward && !win.pair_backward) || (!newbackward && win.pair_backward)) {\n        /* switch the children */\n        wx = win.child1;\n        win.child1 = win.child2;\n        win.child2 = wx;\n    }\n\n    /* set up everything else */\n    win.pair_dir = newdir;\n    win.pair_division = (method & Const.winmethod_DivisionMask);\n    win.pair_key = keywin;\n    win.pair_size = size;\n\n    win.pair_hasborder = ((method & Const.winmethod_BorderMask) == Const.winmethod_Border);\n    win.pair_vertical = (win.pair_dir == Const.winmethod_Left || win.pair_dir == Const.winmethod_Right);\n    win.pair_backward = (win.pair_dir == Const.winmethod_Left || win.pair_dir == Const.winmethod_Above);\n\n    gli_window_rearrange(win, win.bbox);\n}\n\nfunction glk_window_get_arrangement(win, methodref, sizeref, keywinref) {\n    if (!win)\n        throw('glk_window_get_arrangement: invalid window');\n    if (win.type != Const.wintype_Pair) \n        throw('glk_window_get_arrangement: not a pair window');\n\n    if (sizeref)\n        sizeref.set_value(win.pair_size);\n    if (keywinref)\n        keywinref.set_value(win.pair_key);\n    if (methodref)\n        methodref.set_value(win.pair_dir | win.pair_division | (win.pair_hasborder ? Const.winmethod_Border : Const.winmethod_NoBorder));\n}\n\nfunction glk_window_get_type(win) {\n    if (!win)\n        throw('glk_window_get_type: invalid window');\n    return win.type;\n}\n\nfunction glk_window_get_parent(win) {\n    if (!win)\n        throw('glk_window_get_parent: invalid window');\n    return win.parent;\n}\n\nfunction glk_window_clear(win) {\n    if (!win)\n        throw('glk_window_clear: invalid window');\n    \n    if (win.line_request) {\n        throw('glk_window_clear: window has pending line request');\n    }\n\n    let setcol = null;\n    switch (win.type) {\n    case Const.wintype_TextBuffer:\n        win.accum.length = 0;\n        win.accumstyle = null;\n        win.accumhyperlink = 0;\n        win.accum_fg = null\n        win.accum_bg = null\n        win.accum_reverse = null\n        win.content.length = 0;\n        win.clearcontent = true;\n        win.cleared_bg = win.bg\n        win.cleared_fg = win.fg\n        break;\n    case Const.wintype_TextGrid:\n        win.cursorx = 0;\n        win.cursory = 0;\n        for (let ix=0; ix<win.gridheight; ix++) {\n            const lineobj = win.lines[ix];\n            lineobj.dirty = true;\n            for (let cx=0; cx<win.gridwidth; cx++) {\n                lineobj.chars[cx] = ' ';\n                lineobj.styles[cx] = Const.style_Normal;\n                lineobj.hyperlinks[cx] = 0;\n                lineobj.fgs[cx] = win.fg;\n                lineobj.bgs[cx] = win.bg;\n                lineobj.reverses[cx] = win.reverse;\n            }\n        }\n        win.clearcontent = true;\n        win.cleared_bg = win.bg\n        win.cleared_fg = win.fg\n        break;\n    case Const.wintype_Graphics:\n        /* If the background color has been set, we must retain that entry.\n           (The last setcolor, if there are several.) */\n        for (let ix=0; ix<win.content.length; ix++) {\n            if (win.content[ix].special == 'setcolor')\n                setcol = win.content[ix];\n        }\n        win.content.length = 0;\n        if (setcol !== null)\n            win.content.push(setcol);\n        win.content.push({ special: 'fill' }); /* clear to background color */\n        break;\n    }\n}\n\nfunction glk_window_move_cursor(win, xpos, ypos) {\n    if (!win)\n        throw('glk_window_move_cursor: invalid window');\n    \n    if (win.type == Const.wintype_TextGrid) {\n        /* No bounds-checking; we canonicalize when we print. */\n        win.cursorx = xpos;\n        win.cursory = ypos;\n    }\n    else {\n        throw('glk_window_move_cursor: not a grid window');\n    }\n}\n\nfunction glk_window_get_stream(win) {\n    if (!win)\n        throw('glk_window_get_stream: invalid window');\n    return win.str;\n}\n\nfunction glk_window_set_echo_stream(win, str) {\n    if (!win)\n        throw('glk_window_set_echo_stream: invalid window');\n    win.echostr = str;\n}\n\nfunction glk_window_get_echo_stream(win) {\n    if (!win)\n        throw('glk_window_get_echo_stream: invalid window');\n    return win.echostr;\n}\n\nfunction glk_set_window(win) {\n    if (!win)\n        gli_currentstr = null;\n    else\n        gli_currentstr = win.str;\n}\n\nfunction glk_window_get_sibling(win) {\n    if (!win)\n        throw('glk_window_get_sibling: invalid window');\n    const parent = win.parent;\n    if (!parent)\n        return null;\n    if (win === parent.child1)\n        return parent.child2;\n    else if (win === parent.child2)\n        return parent.child1;\n    else\n        throw('glk_window_get_sibling: window tree is corrupted');\n}\n\nfunction glk_stream_iterate(str, rockref) {\n    if (!str)\n        str = gli_streamlist;\n    else\n        str = str.next;\n\n    if (str) {\n        if (rockref)\n            rockref.set_value(str.rock);\n        return str;\n    }\n\n    if (rockref)\n        rockref.set_value(0);\n    return null;\n}\n\nfunction glk_stream_get_rock(str) {\n    if (!str)\n        throw('glk_stream_get_rock: invalid stream');\n    return str.rock;\n}\n\nfunction glk_stream_open_file(fref, fmode, rock) {\n    if (!fref)\n        throw('glk_stream_open_file: invalid fileref');\n\n    var str;\n    var fstream;\n\n    if (fmode != Const.filemode_Read \n        && fmode != Const.filemode_Write \n        && fmode != Const.filemode_ReadWrite \n        && fmode != Const.filemode_WriteAppend) \n        throw('glk_stream_open_file: illegal filemode');\n\n    if (fmode == Const.filemode_Read && !Dialog.file_ref_exists(fref.ref))\n        return null;\n\n    if (!Dialog.streaming) {\n        var content = null;\n        if (fmode != Const.filemode_Write) {\n            content = Dialog.file_read(fref.ref);\n        }\n        if (content == null) {\n            content = [];\n            if (fmode != Const.filemode_Read) {\n                /* We just created this file. (Or perhaps we're in Write mode\n                   and we're truncating.) Write immediately, to create it and\n                   get the creation date right. */\n                Dialog.file_write(fref.ref, '', true);\n            }\n        }\n        if (content.length == null) \n            throw('glk_stream_open_file: data read had no length');\n    }\n    else {\n        fstream = Dialog.file_fopen(fmode, fref.ref);\n        if (!fstream)\n            return null;\n    }\n\n    str = gli_new_stream(strtype_File, \n        (fmode != Const.filemode_Write), \n        (fmode != Const.filemode_Read), \n        rock);\n    str.unicode = false;\n    str.isbinary = !fref.textmode;\n    str.ref = fref.ref;\n    str.origfmode = fmode;\n\n    if (!Dialog.streaming) {\n        str.streaming = false;\n        str.buf = content;\n        str.buflen = 0xFFFFFFFF; /* enormous */\n        if (fmode == Const.filemode_Write)\n            str.bufeof = 0;\n        else\n            str.bufeof = content.length;\n        if (fmode == Const.filemode_WriteAppend)\n            str.bufpos = str.bufeof;\n        else\n            str.bufpos = 0;\n    }\n    else {\n        str.streaming = true;\n        str.fstream = fstream;\n        /* We'll want a Buffer object around for short and writes. */\n        str.buffer4 = fstream.BufferClass.alloc(4);\n    }\n\n    return str;\n}\n\nfunction glk_stream_open_memory(buf, fmode, rock) {\n    var str;\n\n    if (fmode != Const.filemode_Read \n        && fmode != Const.filemode_Write \n        && fmode != Const.filemode_ReadWrite) \n        throw('glk_stream_open_memory: illegal filemode');\n\n    str = gli_new_stream(strtype_Memory, \n        (fmode != Const.filemode_Write), \n        (fmode != Const.filemode_Read), \n        rock);\n    str.unicode = false;\n\n    if (buf) {\n        str.buf = buf;\n        str.buflen = buf.length;\n        str.bufpos = 0;\n        if (fmode == Const.filemode_Write)\n            str.bufeof = 0;\n        else\n            str.bufeof = str.buflen;\n        if (GiDispa)\n            GiDispa.retain_array(buf);\n    }\n\n    return str;\n}\n\nfunction glk_stream_open_resource(filenum, rock) {\n    var str;\n\n    if (!Blorb || !Blorb.find_data_chunk)\n        return null;\n    var el = Blorb.find_data_chunk(filenum);\n    if (!el)\n        return null;\n\n    var buf = el.data;\n    var isbinary = (el.type == 'BINA');\n\n    str = gli_new_stream(strtype_Resource,\n        true, \n        false, \n        rock);\n    str.unicode = false;\n    str.isbinary = isbinary;\n\n    str.resfilenum = filenum;\n\n    /* Resource streams always use buffer mode. */\n    str.streaming = false;\n\n    /* We have been handed an array of bytes. (They're big-endian four-byte\n       chunks, or perhaps a UTF-8 byte sequence, rather than native-endian\n       four-byte integers). We'll have to do the translation in the get()\n       functions. */\n\n    if (buf) {\n        str.buf = buf;\n        str.buflen = buf.length;\n        str.bufpos = 0;\n        str.bufeof = str.buflen;\n    }\n\n    return str;\n}\n\nfunction glk_stream_open_resource_uni(filenum, rock) {\n    var str;\n\n    if (!Blorb || !Blorb.find_data_chunk)\n        return null;\n    var el = Blorb.find_data_chunk(filenum);\n    if (!el)\n        return null;\n\n    var buf = el.data;\n    var isbinary = (el.type == 'BINA');\n\n    str = gli_new_stream(strtype_Resource,\n        true, \n        false, \n        rock);\n    str.unicode = true;\n    str.isbinary = isbinary;\n\n    str.resfilenum = filenum;\n\n    /* Resource streams always use buffer mode. */\n    str.streaming = false;\n\n    /* We have been handed an array of bytes. (They're big-endian four-byte\n       chunks, or perhaps a UTF-8 byte sequence, rather than native-endian\n       four-byte integers). We'll have to do the translation in the get()\n       functions. */\n\n    if (buf) {\n        str.buf = buf;\n        str.buflen = buf.length;\n        str.bufpos = 0;\n        str.bufeof = str.buflen;\n    }\n\n    return str;\n}\n\nfunction glk_stream_close(str, result) {\n    if (!str)\n        throw('glk_stream_close: invalid stream');\n\n    if (str.type == strtype_Window)\n        throw('glk_stream_close: cannot close window stream');\n\n    if (str.type == strtype_File && str.writable) {\n        if (!str.streaming) {\n            if (!(str.timer_id === null)) {\n                clearTimeout(str.timer_id);\n                str.timer_id = null;\n            }\n            Dialog.file_write(str.ref, str.buf);\n        }\n    }\n\n    gli_stream_fill_result(str, result);\n    gli_delete_stream(str);\n}\n\nfunction glk_stream_set_position(str, pos, seekmode) {\n    if (!str)\n        throw('glk_stream_set_position: invalid stream');\n\n    switch (str.type) {\n    case strtype_File:\n        if (str.streaming) {\n            str.fstream.fseek(pos, seekmode);\n            break;\n        }\n        //### check if file has been modified? This is a half-decent time.\n        /* fall through to memory... */\n    case strtype_Resource:\n        /* fall through to memory... */\n    case strtype_Memory:\n        if (seekmode == Const.seekmode_Current) {\n            pos = str.bufpos + pos;\n        }\n        else if (seekmode == Const.seekmode_End) {\n            pos = str.bufeof + pos;\n        }\n        else {\n            /* pos = pos */\n        }\n        if (pos < 0)\n            pos = 0;\n        if (pos > str.bufeof)\n            pos = str.bufeof;\n        str.bufpos = pos;\n    }\n}\n\nfunction glk_stream_get_position(str) {\n    if (!str)\n        throw('glk_stream_get_position: invalid stream');\n\n    switch (str.type) {\n    case strtype_File:\n        if (str.streaming) {\n            return str.fstream.ftell();\n        }\n        /* fall through to memory... */\n    case strtype_Resource:\n        /* fall through to memory... */\n    case strtype_Memory:\n        return str.bufpos;\n    default:\n        return 0;\n    }\n}\n\nfunction glk_stream_set_current(str) {\n    gli_currentstr = str;\n}\n\nfunction glk_stream_get_current() {\n    return gli_currentstr;\n}\n\nfunction glk_fileref_create_temp(usage, rock) {\n    var filetype = (usage & Const.fileusage_TypeMask);\n    var filetypename = FileTypeMap[filetype];\n    var ref = Dialog.file_construct_temp_ref(filetypename);\n    var fref = gli_new_fileref(ref.filename, usage, rock, ref);\n    return fref;\n}\n\nfunction glk_fileref_create_by_name(usage, filename, rock) {\n    /* Filenames that do not come from the user must be cleaned up. */\n    filename = Dialog.file_clean_fixed_name(filename, (usage & Const.fileusage_TypeMask));\n\n    var fref = gli_new_fileref(filename, usage, rock, null);\n    return fref;\n}\n\nfunction glk_fileref_create_by_prompt(usage, fmode, rock) {\n    var modename;\n\n    var filetype = (usage & Const.fileusage_TypeMask);\n    var filetypename = FileTypeMap[filetype];\n    if (!filetypename) {\n        filetypename = 'xxx';\n    }\n\n    switch (fmode) {\n        case Const.filemode_Write:\n            modename = 'write';\n            break;\n        case Const.filemode_ReadWrite:\n            modename = 'readwrite';\n            break;\n        case Const.filemode_WriteAppend:\n            modename = 'writeappend';\n            break;\n        case Const.filemode_Read:\n        default:\n            modename = 'read';\n            break;\n    }\n\n    var special = {\n        type: 'fileref_prompt',\n        filetype: filetypename,\n        filemode: modename\n    };\n    var callback = {\n        usage: usage,\n        rock: rock\n    };\n\n    if (filetype == Const.fileusage_SavedGame)\n        special.gameid = VM.get_signature();\n\n    ui_specialinput = special;\n    ui_specialcallback = callback;\n    gli_selectref = null;\n    return DidNotReturn;\n}\n\nfunction gli_fileref_create_by_prompt_callback(obj) {\n    var ref = obj.value;\n    var usage = ui_specialcallback.usage;\n    var rock = ui_specialcallback.rock;\n\n    var fref = null;\n    if (ref) {\n        fref = gli_new_fileref(ref.filename, usage, rock, ref);\n    }\n\n    ui_specialinput = null;\n    ui_specialcallback = null;\n\n    if (GiDispa)\n        GiDispa.prepare_resume(fref);\n    VM.resume(fref);\n}\n\nfunction glk_fileref_destroy(fref) {\n    if (!fref)\n        throw('glk_fileref_destroy: invalid fileref');\n    gli_delete_fileref(fref);\n}\n\nfunction glk_fileref_iterate(fref, rockref) {\n    if (!fref)\n        fref = gli_filereflist;\n    else\n        fref = fref.next;\n\n    if (fref) {\n        if (rockref)\n            rockref.set_value(fref.rock);\n        return fref;\n    }\n\n    if (rockref)\n        rockref.set_value(0);\n    return null;\n}\n\nfunction glk_fileref_get_rock(fref) {\n    if (!fref)\n        throw('glk_fileref_get_rock: invalid fileref');\n    return fref.rock;\n}\n\nfunction glk_fileref_delete_file(fref) {\n    if (!fref)\n        throw('glk_fileref_delete_file: invalid fileref');\n    Dialog.file_remove_ref(fref.ref);\n}\n\nfunction glk_fileref_does_file_exist(fref) {\n    if (!fref)\n        throw('glk_fileref_does_file_exist: invalid fileref');\n    if (Dialog.file_ref_exists(fref.ref))\n        return 1;\n    else\n        return 0;\n}\n\nfunction glk_fileref_create_from_fileref(usage, oldfref, rock) {\n    if (!oldfref)\n        throw('glk_fileref_create_from_fileref: invalid fileref');\n    \n    var fref = gli_new_fileref(oldfref.filename, usage, rock, null);\n    return fref;\n}\n\nfunction glk_put_char(ch) {\n    gli_put_char(gli_currentstr, ch & 0xFF);\n}\n\nfunction glk_put_char_stream(str, ch) {\n    gli_put_char(str, ch & 0xFF);\n}\n\nfunction glk_put_string(val) {\n    glk_put_jstring_stream(gli_currentstr, val, true);\n}\n\nfunction glk_put_string_stream(str, val) {\n    glk_put_jstring_stream(str, val, true);\n}\n\nfunction glk_put_buffer(arr) {\n    arr = TrimArrayToBytes(arr);\n    gli_put_array(gli_currentstr, arr, true);\n}\n\nfunction glk_put_buffer_stream(str, arr) {\n    arr = TrimArrayToBytes(arr);\n    gli_put_array(str, arr, true);\n}\n\nfunction glk_set_style(val) {\n    gli_set_style(gli_currentstr, val);\n}\n\nfunction glk_set_style_stream(str, val) {\n    gli_set_style(str, val);\n}\n\nfunction glk_get_char_stream(str) {\n    if (!str)\n        throw('glk_get_char_stream: invalid stream');\n    return gli_get_char(str, false);\n}\n\nfunction glk_get_line_stream(str, buf) {\n    if (!str)\n        throw('glk_get_line_stream: invalid stream');\n    return gli_get_line(str, buf, false);\n}\n\nfunction glk_get_buffer_stream(str, buf) {\n    if (!str)\n        throw('glk_get_buffer_stream: invalid stream');\n    return gli_get_buffer(str, buf, false);\n}\n\nfunction glk_char_to_lower(val) {\n    if (val >= 0x41 && val <= 0x5A)\n        return val + 0x20;\n    if (val >= 0xC0 && val <= 0xDE && val != 0xD7)\n        return val + 0x20;\n    return val;\n}\n\nfunction glk_char_to_upper(val) {\n    if (val >= 0x61 && val <= 0x7A)\n        return val - 0x20;\n    if (val >= 0xE0 && val <= 0xFE && val != 0xF7)\n        return val - 0x20;\n    return val;\n}\n\n/* Style hints */\n\nvar last_page_bg = null\nvar stylehints = {\n    buffer: {},\n    grid: {},\n}\n\nfunction clone_stylehints(stylehints) {\n    const newstylehints = {}\n    for (const [selector, styles] of Object.entries(stylehints)) {\n        newstylehints[selector] = Object.assign({}, styles)\n    }\n    return newstylehints\n}\n\nconst STYLE_NAMES = ['normal', 'emphasized', 'preformatted', 'header', 'subheader', 'alert', 'note', 'blockquote', 'input', 'user1', 'user2']\nconst CSS_STYLE_PROPERTIES = ['margin-left', 'text-indent', 'text-align', 'font-size', 'font-weight', 'font-style', 'monospace', 'color', 'background-color', 'reverse']\n\n// Handle autorestoring the old style stylehints\nfunction restore_stylehints(stylehints) {\n    if (Array.isArray(stylehints)) {\n        const res = {}\n        for (const [stylenum, stylehint] of stylehints.entries()) {\n            for (const [css_style, value] of Object.entries(stylehint)) {\n                const selector = `${['margin-left', 'text-indent','text-align'].includes(css_style) ? 'div' : 'span'}.Style_${STYLE_NAMES[stylenum]}`\n                if (!res[selector]) {\n                    res[selector] = {}\n                }\n                res[selector][css_style] = value\n            }\n        }\n        return res\n    }\n    return stylehints\n}\n\nfunction glk_stylehint_set(wintype, style, hint, value) {\n    if (wintype === Const.wintype_AllTypes || wintype === Const.wintype_TextBuffer) {\n        add_css_style(stylehints.buffer, style, hint, value)\n    }\n\n    if ((wintype === Const.wintype_AllTypes || wintype === Const.wintype_TextGrid) && hint !== Const.stylehint_Proportional) {\n        add_css_style(stylehints.grid, style, hint, value)\n    }\n}\n\nfunction add_css_style(styles, style, hint, value) {\n    const selector = `${hint <= Const.stylehint_Justification ? 'div' : 'span'}.Style_${STYLE_NAMES[style]}`\n    var stylevalue\n    var justifications = ['left', 'justify', 'center', 'right']\n    var weights = ['lighter', 'normal', 'bold']\n\n    if (hint === Const.stylehint_Indentation)\n    {\n        stylevalue = value + 'em'\n    }\n\n    if (hint === Const.stylehint_ParaIndentation)\n    {\n        stylevalue = value + 'em'\n    }\n\n    if (hint === Const.stylehint_Justification)\n    {\n        stylevalue = justifications[value]\n    }\n\n    if (hint === Const.stylehint_Size)\n    {\n        stylevalue = (1 + value * 0.1) + 'em'\n    }\n\n    if (hint === Const.stylehint_Weight)\n    {\n        stylevalue = weights[value + 1]\n    }\n\n    if (hint === Const.stylehint_Oblique)\n    {\n        stylevalue = value ? 'italic': 'normal'\n    }\n\n    if (hint === Const.stylehint_Proportional)\n    {\n        stylevalue = value ? 0 : 1\n    }\n\n    if (hint === Const.stylehint_TextColor)\n    {\n        stylevalue = '#' + ('000000' + value.toString(16)).slice(-6)\n    }\n\n    if (hint === Const.stylehint_BackColor)\n    {\n        stylevalue = '#' + ('000000' + value.toString(16)).slice(-6)\n    }\n\n    if (hint === Const.stylehint_ReverseColor)\n    {\n        stylevalue = value\n    }\n\n    if (!styles[selector]) {\n        styles[selector] = {}\n    }\n    styles[selector][CSS_STYLE_PROPERTIES[hint]] = stylevalue\n}\n\nfunction glk_stylehint_clear(wintype, style, hint) {\n    const selector = `${hint <= Const.stylehint_Justification ? 'div' : 'span'}.Style_${STYLE_NAMES[style]}`\n    function remove_style(styles) {\n        if (styles[selector]) {\n            delete styles[selector][CSS_STYLE_PROPERTIES[hint]]\n            if (!Object.keys(styles[selector]).length) {\n                delete styles[selector]\n            }\n        }\n    }\n\n    if (wintype === Const.wintype_AllTypes || wintype === Const.wintype_TextBuffer) {\n        remove_style(stylehints.buffer)\n    }\n\n    if (wintype === Const.wintype_AllTypes || wintype === Const.wintype_TextGrid) {\n        remove_style(stylehints.grid)\n    }\n}\n\nfunction glk_style_distinguish(/*win, styl1, styl2*/) {\n    return 0;\n}\n\nfunction glk_style_measure(win, styl, hint, resultref) {\n    if (resultref)\n        resultref.set_value(0);\n    return 0;\n}\n\n// Gargolye text formatting functions\n\nfunction garglk_set_zcolors(fg, bg)\n{\n    garglk_set_zcolors_stream(gli_currentstr, fg, bg)\n}\n\nfunction garglk_set_zcolors_stream(str, fg, bg)\n{\n    if (!str || !str.writable)\n    {\n        throw('garglk_set_zcolors: invalid stream')\n    }\n\n    fg = fg >> 0\n    bg = bg >> 0\n    if (str.type == strtype_Window)\n    {\n        if (fg !== -2)\n        {\n            str.win.fg = fg === -1 ? null : '#' + ('000000' + fg.toString(16)).slice(-6)\n        }\n        if (bg !== -2)\n        {\n            str.win.bg = bg === -1 ? null : '#' + ('000000' + bg.toString(16)).slice(-6)\n        }\n        if (str.win.echostr)\n        {\n            garglk_set_zcolors_stream(str.win.echostr, fg, bg)\n        }\n    }\n}\n\nfunction garglk_set_reversevideo(reverse)\n{\n    garglk_set_reversevideo_stream(gli_currentstr, reverse)\n}\n\nfunction garglk_set_reversevideo_stream(str, reverse)\n{\n    if (!str || !str.writable)\n    {\n        throw('garglk_set_reversevideo: invalid stream')\n    }\n\n    if (str.type == strtype_Window)\n    {\n        str.win.reverse = reverse || null\n        if (str.win.echostr)\n        {\n            garglk_set_reversevideo_stream(str.win.echostr, reverse)\n        }\n    }\n}\n\nfunction glk_select(eventref) {\n    gli_selectref = eventref;\n    return DidNotReturn;\n}\n\nfunction glk_select_poll(eventref) {\n    /* Because the Javascript interpreter is single-threaded, we cannot\n       have gotten a timer event since the last glk_select call. */\n\n    eventref.set_field(0, Const.evtype_None);\n    eventref.set_field(1, null);\n    eventref.set_field(2, 0);\n    eventref.set_field(3, 0);\n\n    if (gli_timer_interval) {\n        var now = Date.now();\n        if (now - gli_timer_started > gli_timer_interval) {\n            /* We're past the timer interval, even though we got no\n               event. Let's pretend we did, reset it, and return a\n               timer event. */\n            gli_timer_started = Date.now();\n            /* Resend timer request at next update. */\n            gli_timer_lastsent = null;\n\n            eventref.set_field(0, Const.evtype_Timer);\n        }\n    }\n}\n\nfunction glk_request_line_event(win, buf, initlen) {\n    if (!win)\n        throw('glk_request_line_event: invalid window');\n    if (win.char_request || win.line_request)\n        throw('glk_request_line_event: window already has keyboard request');\n\n    if (win.type == Const.wintype_TextBuffer \n        || win.type == Const.wintype_TextGrid) {\n        if (initlen) {\n            /* This will be copied into the next update. */\n            var ls = buf.slice(0, initlen);\n            if (!current_partial_outputs)\n                current_partial_outputs = {};\n            current_partial_outputs[win.disprock] = ByteArrayToString(ls);\n        }\n        win.line_request = true;\n        win.line_request_uni = false;\n        if (win.type == Const.wintype_TextBuffer)\n            win.request_echo_line_input = win.echo_line_input;\n        else\n            win.request_echo_line_input = true;\n        win.input_generation = event_generation;\n        win.linebuf = buf;\n        if (GiDispa)\n            GiDispa.retain_array(buf);\n    }\n    else {\n        throw('glk_request_line_event: window does not support keyboard input');\n    }\n}\n\nfunction glk_cancel_line_event(win, eventref) {\n    if (!win)\n        throw('glk_cancel_line_event: invalid window');\n\n    if (!win.line_request) {\n        if (eventref) {\n            eventref.set_field(0, Const.evtype_None);\n            eventref.set_field(1, null);\n            eventref.set_field(2, 0);\n            eventref.set_field(3, 0);\n        }\n        return;\n    }\n\n    var input = \"\";\n    var ix, val;\n\n    if (current_partial_inputs) {\n        val = current_partial_inputs[win.disprock];\n        if (val) \n            input = val;\n    }\n\n    if (input.length > win.linebuf.length)\n        input = input.slice(0, win.linebuf.length);\n\n    if (win.request_echo_line_input) {\n        ix = win.style;\n        gli_set_style(win.str, Const.style_Input);\n        gli_window_put_string(win, input);\n        if (win.echostr)\n            glk_put_jstring_stream(win.echostr, input);\n        gli_set_style(win.str, ix);\n        gli_window_put_string(win, \"\\n\");\n        if (win.echostr)\n            glk_put_jstring_stream(win.echostr, \"\\n\");\n    }\n\n    for (ix=0; ix<input.length; ix++)\n        win.linebuf[ix] = input.charCodeAt(ix);\n\n    if (eventref) {\n        eventref.set_field(0, Const.evtype_LineInput);\n        eventref.set_field(1, win);\n        eventref.set_field(2, input.length);\n        eventref.set_field(3, 0);\n    }\n\n    if (GiDispa)\n        GiDispa.unretain_array(win.linebuf);\n    win.line_request = false;\n    win.line_request_uni = false;\n    win.request_echo_line_input = null;\n    win.input_generation = null;\n    win.linebuf = null;\n}\n\nfunction glk_request_char_event(win) {\n    if (!win)\n        throw('glk_request_char_event: invalid window');\n    if (win.char_request || win.line_request)\n        throw('glk_request_char_event: window already has keyboard request');\n\n    if (win.type == Const.wintype_TextBuffer \n        || win.type == Const.wintype_TextGrid) {\n        win.char_request = true;\n        win.char_request_uni = false;\n        win.input_generation = event_generation;\n    }\n    else {\n        /* ### wintype_Graphics could accept char input if we set up the focus to allow it. See gestalt_GraphicsCharInput. */\n        throw('glk_request_char_event: window does not support keyboard input');\n    }\n}\n\nfunction glk_cancel_char_event(win) {\n    if (!win)\n        throw('glk_cancel_char_event: invalid window');\n\n    win.char_request = false;\n    win.char_request_uni = false;\n}\n\nfunction glk_set_echo_line_event(win, val) {\n   if (!win)\n        throw('glk_set_echo_line_event: invalid window');\n\n   win.echo_line_input = (val != 0);\n}\n\nfunction glk_set_terminators_line_event(win, arr) {\n   if (!win)\n        throw('glk_set_terminators_line_event: invalid window');\n\n   if (KeystrokeValueMap === null) {\n       /* First, we have to build this map. (It's only used by this\n          function, which is why the constructor code is here. */\n       KeystrokeValueMap = {};\n       for (let val in KeystrokeNameMap) {\n           KeystrokeValueMap[KeystrokeNameMap[val]] = val;\n       }\n   }\n\n   const res = [];\n   if (arr) {\n       for (let ix=0; ix<arr.length; ix++) {\n           const val = KeystrokeValueMap[arr[ix]];\n           if (val)\n               res.push(val);\n       }\n   }\n   win.line_input_terminators = res;\n}\n\nfunction glk_request_mouse_event(win) {\n    if (!win)\n        throw('glk_request_mouse_event: invalid window');\n    if (win.type == Const.wintype_TextGrid\n        || win.type == Const.wintype_Graphics) {\n        win.mouse_request = true;\n    }\n    /* else ignore request */\n}\n\nfunction glk_cancel_mouse_event(win) {\n    if (!win)\n        throw('glk_cancel_mouse_event: invalid window');\n    win.mouse_request = false;\n}\n\nfunction glk_request_timer_events(msec) {\n    if (!msec) {\n        gli_timer_interval = null;\n        gli_timer_started = null;\n    }\n    else {\n        gli_timer_interval = msec;\n        gli_timer_started = Date.now();\n    }\n}\n\n/* Graphics functions. */\n\nfunction glk_image_get_info(imgid, widthref, heightref) {\n    if (!Blorb || !Blorb.get_image_info)\n        return null;\n\n    var info = Blorb.get_image_info(imgid);\n    if (info) {\n        if (widthref)\n            widthref.set_value(info.width);\n        if (heightref)\n            heightref.set_value(info.height);\n        return 1;\n    }\n    if (widthref)\n        widthref.set_value(0);\n    if (heightref)\n        heightref.set_value(0);\n    return 0;\n}\n\nfunction glk_image_draw(win, imgid, val1, val2) {\n    if (!win)\n        throw('glk_image_draw: invalid window');\n\n    if (!Blorb || !Blorb.get_image_info)\n        return 0;\n    var info = Blorb.get_image_info(imgid);\n    if (!info)\n        return 0;\n\n    var img = { special:'image', image:imgid, \n                url:info.url, alttext:info.alttext,\n                width:info.width, height:info.height };\n\n    switch (win.type) {\n    case Const.wintype_TextBuffer:\n        var alignment = 'inlineup';\n        switch (val1) {\n            case Const.imagealign_InlineUp:\n                alignment = 'inlineup';\n                break;\n            case Const.imagealign_InlineDown:\n                alignment = 'inlinedown';\n                break;\n            case Const.imagealign_InlineCenter:\n                alignment = 'inlinecenter';\n                break;\n            case Const.imagealign_MarginLeft:\n                alignment = 'marginleft';\n                break;\n            case Const.imagealign_MarginRight:\n                alignment = 'marginright';\n                break;\n        }\n        img.alignment = alignment;\n        if (win.hyperlink)\n            img.hyperlink = win.hyperlink;\n        gli_window_buffer_put_special(win, img);\n        return 1;\n\n    case Const.wintype_Graphics:\n        img.x = val1;\n        img.y = val2;\n        win.content.push(img);\n        return 1;\n    }\n\n    return 0;\n}\n\nfunction glk_image_draw_scaled(win, imgid, val1, val2, width, height) {\n    if (!win)\n        throw('glk_image_draw_scaled: invalid window');\n\n    if (!Blorb || !Blorb.get_image_info)\n        return 0;\n    var info = Blorb.get_image_info(imgid);\n    if (!info)\n        return 0;\n\n    /* Same as above, except we use the passed-in width and height\n       values */\n    var img = { special:'image', image:imgid, \n                url:info.url, alttext:info.alttext,\n                width:width, height:height };\n\n    switch (win.type) {\n    case Const.wintype_TextBuffer:\n        var alignment = 'inlineup';\n        switch (val1) {\n            case Const.imagealign_InlineUp:\n                alignment = 'inlineup';\n                break;\n            case Const.imagealign_InlineDown:\n                alignment = 'inlinedown';\n                break;\n            case Const.imagealign_InlineCenter:\n                alignment = 'inlinecenter';\n                break;\n            case Const.imagealign_MarginLeft:\n                alignment = 'marginleft';\n                break;\n            case Const.imagealign_MarginRight:\n                alignment = 'marginright';\n                break;\n        }\n        img.alignment = alignment;\n        if (win.hyperlink)\n            img.hyperlink = win.hyperlink;\n        gli_window_buffer_put_special(win, img);\n        return 1;\n\n    case Const.wintype_Graphics:\n        img.x = val1;\n        img.y = val2;\n        /* width, height already set */\n        win.content.push(img);\n        return 1;\n    }\n\n    return 0;\n}\n\nfunction glk_window_flow_break(win) {\n    if (!win)\n        throw('glk_window_flow_break: invalid window');\n\n    if (win.type == Const.wintype_TextBuffer)\n        gli_window_buffer_put_special(win, undefined, true);\n}\n\nfunction glk_window_erase_rect(win, left, top, width, height) {\n    if (!win)\n        throw('glk_window_erase_rect: invalid window');\n    if (win.type != Const.wintype_Graphics)\n        throw('glk_window_erase_rect: not a graphics window');\n\n    win.content.push({ special:'fill', x:left, y:top, width:width, height:height });\n}\n\nfunction glk_window_fill_rect(win, color, left, top, width, height) {\n    if (!win)\n        throw('glk_window_fill_rect: invalid window');\n    if (win.type != Const.wintype_Graphics)\n        throw('glk_window_fill_rect: not a graphics window');\n\n    var colstr = gli_color_to_css(color);\n    win.content.push({ special:'fill', color:colstr, x:left, y:top, width:width, height:height });\n}\n\nfunction glk_window_set_background_color(win, color) {\n    if (!win)\n        throw('glk_window_set_background_color: invalid window');\n    if (win.type != Const.wintype_Graphics)\n        throw('glk_window_set_background_color: not a graphics window');\n\n    var colstr = gli_color_to_css(color);\n    win.content.push({ special:'setcolor', color:colstr });\n}\n\n/* Convert a Glk numeric color value to a CSS-compatible string.\n*/\nfunction gli_color_to_css(color) {\n    var res = (color & 0xFFFFFF).toString(16);\n    while (res.length < 6) {\n        res = '0' + res;\n    }\n    return '#' + res.toUpperCase();\n}\n\nfunction glk_schannel_iterate(schan, rockref) {\n    if (!schan)\n        schan = gli_schannellist;\n    else\n        schan = schan.next;\n\n    if (schan) {\n        if (rockref)\n            rockref.set_value(schan.rock);\n        return schan;\n    }\n\n    if (rockref)\n        rockref.set_value(0);\n    return null;\n}\n\nfunction glk_schannel_get_rock(schan) {\n    if (!schan)\n        throw('glk_schannel_get_rock: invalid schannel');\n    return schan.rock;\n}\n\nfunction glk_schannel_create(/*rock*/) {\n    return null;\n}\n\nfunction glk_schannel_destroy(/*schan*/) {\n    throw('glk_schannel_destroy: invalid schannel');\n}\n\nfunction glk_schannel_play(/*schan, sndid*/) {\n    throw('glk_schannel_play: invalid schannel');\n}\n\nfunction glk_schannel_play_ext(/*schan, sndid, repeats, notify*/) {\n    throw('glk_schannel_play_ext: invalid schannel');\n}\n\nfunction glk_schannel_stop(/*schan*/) {\n    throw('glk_schannel_stop: invalid schannel');\n}\n\nfunction glk_schannel_set_volume(/*schan, vol*/) {\n    throw('glk_schannel_set_volume: invalid schannel');\n}\n\nfunction glk_sound_load_hint(/*sndid, flag*/) {\n}\n\nfunction glk_schannel_create_ext(/*rock, vol*/) {\n    return null;\n}\n\nfunction glk_schannel_play_multi(/*schans, sndids, notify*/) {\n    throw('glk_schannel_play_multi: invalid schannel');\n}\n\nfunction glk_schannel_pause(/*schan*/) {\n    throw('glk_schannel_pause: invalid schannel');\n}\n\nfunction glk_schannel_unpause(/*schan*/) {\n    throw('glk_schannel_unpause: invalid schannel');\n}\n\nfunction glk_schannel_set_volume_ext(/*schan, vol, duration, notify*/) {\n    throw('glk_schannel_set_volume_ext: invalid schannel');\n}\n\nfunction glk_set_hyperlink(val) {\n    gli_set_hyperlink(gli_currentstr, val);\n}\n\nfunction glk_set_hyperlink_stream(str, val) {\n    gli_set_hyperlink(str, val);\n}\n\nfunction glk_request_hyperlink_event(win) {\n    if (!win)\n        throw('glk_request_hyperlink_event: invalid window');\n    if (win.type == Const.wintype_TextBuffer \n        || win.type == Const.wintype_TextGrid) {\n        win.hyperlink_request = true;\n    }\n}\n\nfunction glk_cancel_hyperlink_event(win) {\n    if (!win)\n        throw('glk_cancel_hyperlink_event: invalid window');\n    if (win.type == Const.wintype_TextBuffer \n        || win.type == Const.wintype_TextGrid) {\n        win.hyperlink_request = false;\n    }\n}\n\nfunction glk_buffer_to_lower_case_uni(arr, numchars) {\n    var ix, jx, pos, val, origval;\n    var arrlen = arr.length;\n    var src = arr.slice(0, numchars);\n\n    if (arrlen < numchars)\n        throw('buffer_to_lower_case_uni: numchars exceeds array length');\n\n    pos = 0;\n    for (ix=0; ix<numchars; ix++) {\n        origval = src[ix];\n        val = unicode_lower_table[origval];\n        if (val === undefined) {\n            arr[pos] = origval;\n            pos++;\n        }\n        else if (!(val instanceof Array)) {\n            arr[pos] = val;\n            pos++;\n        }\n        else {\n            for (jx=0; jx<val.length; jx++) {\n                arr[pos] = val[jx];\n                pos++;\n            }\n        }\n    }\n\n    /* in case we stretched the array */\n    arr.length = arrlen;\n\n    return pos;\n}\n\nfunction glk_buffer_to_upper_case_uni(arr, numchars) {\n    var ix, jx, pos, val, origval;\n    var arrlen = arr.length;\n    var src = arr.slice(0, numchars);\n\n    if (arrlen < numchars)\n        throw('buffer_to_upper_case_uni: numchars exceeds array length');\n\n    pos = 0;\n    for (ix=0; ix<numchars; ix++) {\n        origval = src[ix];\n        val = unicode_upper_table[origval];\n        if (val === undefined) {\n            arr[pos] = origval;\n            pos++;\n        }\n        else if (!(val instanceof Array)) {\n            arr[pos] = val;\n            pos++;\n        }\n        else {\n            for (jx=0; jx<val.length; jx++) {\n                arr[pos] = val[jx];\n                pos++;\n            }\n        }\n    }\n\n    /* in case we stretched the array */\n    arr.length = arrlen;\n\n    return pos;\n}\n\nfunction glk_buffer_to_title_case_uni(arr, numchars, lowerrest) {\n    var ix, jx, pos, val, origval;\n    var arrlen = arr.length;\n    var src = arr.slice(0, numchars);\n\n    if (arrlen < numchars)\n        throw('buffer_to_title_case_uni: numchars exceeds array length');\n\n    pos = 0;\n\n    if (numchars == 0)\n        return 0;\n\n    ix = 0;\n    {\n        origval = src[ix];\n        val = unicode_title_table[origval];\n        if (val === undefined) {\n            val = unicode_upper_table[origval];\n        }\n        if (val === undefined) {\n            arr[pos] = origval;\n            pos++;\n        }\n        else if (!(val instanceof Array)) {\n            arr[pos] = val;\n            pos++;\n        }\n        else {\n            for (jx=0; jx<val.length; jx++) {\n                arr[pos] = val[jx];\n                pos++;\n            }\n        }\n    }\n    \n    if (!lowerrest) {\n        for (ix=1; ix<numchars; ix++) {\n            origval = src[ix];\n            arr[pos] = origval;\n            pos++;\n        }\n    }\n    else {\n        for (ix=1; ix<numchars; ix++) {\n            origval = src[ix];\n            val = unicode_lower_table[origval];\n            if (val === undefined) {\n                arr[pos] = origval;\n                pos++;\n            }\n            else if (!(val instanceof Array)) {\n                arr[pos] = val;\n                pos++;\n            }\n            else {\n                for (jx=0; jx<val.length; jx++) {\n                    arr[pos] = val[jx];\n                    pos++;\n                }\n            }\n        }\n    }\n\n    /* in case we stretched the array */\n    arr.length = arrlen;\n\n    return pos;\n}\n\nfunction gli_buffer_canon_decompose_uni(arr, numchars) {\n    /* This is a utility function to decompose an array. The behavior is\n       almost the same as glk_buffer_canon_decompose_uni(), except that\n       this *doesn't* trim the array down to its original length. That\n       is, this decomposition can cause the array to grow. */\n\n    /* The algorithm for the canonical decomposition of a string: For\n       each character, look up the decomposition in the decomp table.\n       Append the decomposition to the buffer. Finally, sort every\n       substring of the buffer which is made up of combining\n       characters (characters with a nonzero combining class). */\n\n    var src = arr.slice(0, numchars);\n    var pos, ix, jx, origval, val;\n    var grpstart, grpend, kx, tmp;\n\n    pos = 0;\n    for (ix=0; ix<numchars; ix++) {\n        origval = src[ix];\n        val = unicode_decomp_table[origval];\n        if (val === undefined) {\n            arr[pos] = origval;\n            pos++;\n        }\n        else if (!(val instanceof Array)) {\n            arr[pos] = val;\n            pos++;\n        }\n        else {\n            for (jx=0; jx<val.length; jx++) {\n                arr[pos] = val[jx];\n                pos++;\n            }\n        }\n    }\n\n    /* Now we sort groups of combining characters. This should be a\n       stable sort by the combining-class number. We're lazy and\n       nearly all groups are short, so we'll just bubble-sort. */\n    ix = 0;\n    while (ix < pos) {\n        if (!unicode_combin_table[arr[ix]]) {\n            ix++;\n            continue;\n        }\n        if (ix >= pos)\n            break;\n        grpstart = ix;\n        while (ix < pos && unicode_combin_table[arr[ix]]) \n            ix++;\n        grpend = ix;\n        if (grpend - grpstart >= 2) {\n            /* Sort this group. */\n            for (jx = grpend-1; jx > grpstart; jx--) {\n                for (kx = grpstart; kx < jx; kx++) {\n                    if (unicode_combin_table[arr[kx]] > unicode_combin_table[arr[kx+1]]) {\n                        tmp = arr[kx];\n                        arr[kx] = arr[kx+1];\n                        arr[kx+1] = tmp;\n                    }\n                }\n            }\n        }\n    }\n\n    return pos;\n}\n\nfunction gli_buffer_canon_compose_uni(arr, numchars) {\n    /* The algorithm for canonically composing characters in a string:\n       for each base character, compare it to all the following\n       combining characters (up to the next base character). If they're \n       composable, compose them. Repeat until no more pairs are found. */\n\n    var ix, jx, curch, newch, curclass, newclass, map, pos;\n\n    if (numchars == 0)\n        return 0;\n\n    pos = 0;\n    curch = arr[0];\n    curclass = unicode_combin_table[curch];\n    if (curclass)\n        curclass = 999; // just in case the first character is a combiner\n    ix = 1;\n    jx = ix;\n    while (true) {\n        if (jx >= numchars) {\n            arr[pos] = curch;\n            pos = ix;\n            break;\n        }\n        newch = arr[jx];\n        newclass = unicode_combin_table[newch];\n        map = unicode_compo_table[curch];\n        if (map !== undefined && map[newch] !== undefined\n            && (!curclass || (newclass && curclass < newclass))) {\n            curch = map[newch];\n            arr[pos] = curch;\n        }\n        else {\n            if (!newclass) {\n                pos = ix;\n                curch = newch;\n            }\n            curclass = newclass;\n            arr[ix] = newch;\n            ix++;\n        }\n        jx++;\n    }\n\n    return pos;\n}\n\nfunction glk_buffer_canon_decompose_uni(arr, numchars) {\n    var arrlen = arr.length;\n    var len;\n\n    len = gli_buffer_canon_decompose_uni(arr, numchars);\n\n    /* in case we stretched the array */\n    arr.length = arrlen;\n\n    return len;\n}\n\nfunction glk_buffer_canon_normalize_uni(arr, numchars) {\n    var arrlen = arr.length;\n    var len;\n\n    len = gli_buffer_canon_decompose_uni(arr, numchars);\n    len = gli_buffer_canon_compose_uni(arr, len);\n\n    /* in case we stretched the array */\n    arr.length = arrlen;\n\n    return len;\n}\n\nfunction glk_put_char_uni(ch) {\n    gli_put_char(gli_currentstr, ch);\n}\n\nfunction glk_put_string_uni(val) {\n    glk_put_jstring_stream(gli_currentstr, val, false);\n}\n\nfunction glk_put_buffer_uni(arr) {\n    gli_put_array(gli_currentstr, arr, false);\n}\n\nfunction glk_put_char_stream_uni(str, ch) {\n    gli_put_char(str, ch);\n}\n\nfunction glk_put_string_stream_uni(str, val) {\n    glk_put_jstring_stream(str, val, false);\n}\n\nfunction glk_put_buffer_stream_uni(str, arr) {\n    gli_put_array(str, arr, false);\n}\n\nfunction glk_get_char_stream_uni(str) {\n    if (!str)\n        throw('glk_get_char_stream_uni: invalid stream');\n    return gli_get_char(str, true);\n}\n\nfunction glk_get_buffer_stream_uni(str, buf) {\n    if (!str)\n        throw('glk_get_buffer_stream_uni: invalid stream');\n    return gli_get_buffer(str, buf, true);\n}\n\nfunction glk_get_line_stream_uni(str, buf) {\n    if (!str)\n        throw('glk_get_line_stream_uni: invalid stream');\n    return gli_get_line(str, buf, true);\n}\n\nfunction glk_stream_open_file_uni(fref, fmode, rock) {\n    if (!fref)\n        throw('glk_stream_open_file_uni: invalid fileref');\n\n    var str;\n    var fstream;\n\n    if (fmode != Const.filemode_Read \n        && fmode != Const.filemode_Write \n        && fmode != Const.filemode_ReadWrite \n        && fmode != Const.filemode_WriteAppend) \n        throw('glk_stream_open_file_uni: illegal filemode');\n\n    if (fmode == Const.filemode_Read && !Dialog.file_ref_exists(fref.ref))\n        return null;\n\n    if (!Dialog.streaming) {\n        var content = null;\n        if (fmode != Const.filemode_Write) {\n            content = Dialog.file_read(fref.ref);\n        }\n        if (content == null) {\n            content = [];\n            if (fmode != Const.filemode_Read) {\n                /* We just created this file. (Or perhaps we're in Write mode\n                   and we're truncating.) Write immediately, to create it and\n                   get the creation date right. */\n                Dialog.file_write(fref.ref, '', true);\n            }\n        }\n        if (content.length == null) \n            throw('glk_stream_open_file_uni: data read had no length');\n    }\n    else {\n        fstream = Dialog.file_fopen(fmode, fref.ref);\n        if (!fstream)\n            return null;\n    }\n\n    str = gli_new_stream(strtype_File, \n        (fmode != Const.filemode_Write), \n        (fmode != Const.filemode_Read), \n        rock);\n    str.unicode = true;\n    str.isbinary = !fref.textmode;\n    str.ref = fref.ref;\n    str.origfmode = fmode;\n\n    if (!Dialog.streaming) {\n        str.streaming = false;\n        str.buf = content;\n        str.buflen = 0xFFFFFFFF; /* enormous */\n        if (fmode == Const.filemode_Write)\n            str.bufeof = 0;\n        else\n            str.bufeof = content.length;\n        if (fmode == Const.filemode_WriteAppend)\n            str.bufpos = str.bufeof;\n        else\n            str.bufpos = 0;\n    }\n    else {\n        str.streaming = true;\n        str.fstream = fstream;\n        /* We'll want a Buffer object around for short and writes. */\n        str.buffer4 = fstream.BufferClass.alloc(4);\n    }\n\n    return str;\n}\n\nfunction glk_stream_open_memory_uni(buf, fmode, rock) {\n    var str;\n\n    if (fmode != Const.filemode_Read \n        && fmode != Const.filemode_Write \n        && fmode != Const.filemode_ReadWrite) \n        throw('glk_stream_open_memory: illegal filemode');\n\n    str = gli_new_stream(strtype_Memory, \n        (fmode != Const.filemode_Write), \n        (fmode != Const.filemode_Read), \n        rock);\n    str.unicode = true;\n\n    if (buf) {\n        str.buf = buf;\n        str.buflen = buf.length;\n        str.bufpos = 0;\n        if (fmode == Const.filemode_Write)\n            str.bufeof = 0;\n        else\n            str.bufeof = str.buflen;\n        if (GiDispa)\n            GiDispa.retain_array(buf);\n    }\n\n    return str;\n}\n\nfunction glk_request_char_event_uni(win) {\n    if (!win)\n        throw('glk_request_char_event: invalid window');\n    if (win.char_request || win.line_request)\n        throw('glk_request_char_event: window already has keyboard request');\n\n    if (win.type == Const.wintype_TextBuffer \n        || win.type == Const.wintype_TextGrid) {\n        win.char_request = true;\n        win.char_request_uni = true;\n        win.input_generation = event_generation;\n    }\n    else {\n        /* ### wintype_Graphics could accept char input if we set up the focus to allow it. See gestalt_GraphicsCharInput. */\n        throw('glk_request_char_event: window does not support keyboard input');\n    }\n}\n\nfunction glk_request_line_event_uni(win, buf, initlen) {\n    if (!win)\n        throw('glk_request_line_event: invalid window');\n    if (win.char_request || win.line_request)\n        throw('glk_request_line_event: window already has keyboard request');\n\n    if (win.type == Const.wintype_TextBuffer \n        || win.type == Const.wintype_TextGrid) {\n        if (initlen) {\n            /* This will be copied into the next update. */\n            var ls = buf.slice(0, initlen);\n            if (!current_partial_outputs)\n                current_partial_outputs = {};\n            current_partial_outputs[win.disprock] = UniArrayToString(ls);\n        }\n        win.line_request = true;\n        win.line_request_uni = true;\n        if (win.type == Const.wintype_TextBuffer)\n            win.request_echo_line_input = win.echo_line_input;\n        else\n            win.request_echo_line_input = true;\n        win.input_generation = event_generation;\n        win.linebuf = buf;\n        if (GiDispa)\n            GiDispa.retain_array(buf);\n    }\n    else {\n        throw('glk_request_line_event: window does not support keyboard input');\n    }\n}\n\nfunction glk_current_time(timevalref) {\n    var now = new Date().getTime();\n    var usec;\n\n    timevalref.set_field(0, Math.floor(now / 4294967296000));\n    timevalref.set_field(1, Math.floor(now / 1000) >>>0);\n    usec = Math.floor((now % 1000) * 1000);\n    if (usec < 0)\n        usec = 1000000 + usec;\n    timevalref.set_field(2, usec);\n}\n\nfunction glk_current_simple_time(factor) {\n    var now = new Date().getTime();\n    return Math.floor(now / (factor * 1000));\n}\n\nfunction glk_time_to_date_utc(timevalref, dateref) {\n    var now = timevalref.get_field(0) * 4294967296000 + timevalref.get_field(1) * 1000 + timevalref.get_field(2) / 1000;\n    var obj = new Date(now);\n    \n    dateref.set_field(0, obj.getUTCFullYear())\n    dateref.set_field(1, 1+obj.getUTCMonth())\n    dateref.set_field(2, obj.getUTCDate())\n    dateref.set_field(3, obj.getUTCDay())\n    dateref.set_field(4, obj.getUTCHours())\n    dateref.set_field(5, obj.getUTCMinutes())\n    dateref.set_field(6, obj.getUTCSeconds())\n    dateref.set_field(7, 1000*obj.getUTCMilliseconds())\n}\n\nfunction glk_time_to_date_local(timevalref, dateref) {\n    var now = timevalref.get_field(0) * 4294967296000 + timevalref.get_field(1) * 1000 + timevalref.get_field(2) / 1000;\n    var obj = new Date(now);\n    \n    dateref.set_field(0, obj.getFullYear())\n    dateref.set_field(1, 1+obj.getMonth())\n    dateref.set_field(2, obj.getDate())\n    dateref.set_field(3, obj.getDay())\n    dateref.set_field(4, obj.getHours())\n    dateref.set_field(5, obj.getMinutes())\n    dateref.set_field(6, obj.getSeconds())\n    dateref.set_field(7, 1000*obj.getMilliseconds())\n}\n\nfunction glk_simple_time_to_date_utc(time, factor, dateref) {\n    var now = time*(1000*factor);\n    var obj = new Date(now);\n    \n    dateref.set_field(0, obj.getUTCFullYear())\n    dateref.set_field(1, 1+obj.getUTCMonth())\n    dateref.set_field(2, obj.getUTCDate())\n    dateref.set_field(3, obj.getUTCDay())\n    dateref.set_field(4, obj.getUTCHours())\n    dateref.set_field(5, obj.getUTCMinutes())\n    dateref.set_field(6, obj.getUTCSeconds())\n    dateref.set_field(7, 1000*obj.getUTCMilliseconds())\n}\n\nfunction glk_simple_time_to_date_local(time, factor, dateref) {\n    var now = time*(1000*factor);\n    var obj = new Date(now);\n    \n    dateref.set_field(0, obj.getFullYear())\n    dateref.set_field(1, 1+obj.getMonth())\n    dateref.set_field(2, obj.getDate())\n    dateref.set_field(3, obj.getDay())\n    dateref.set_field(4, obj.getHours())\n    dateref.set_field(5, obj.getMinutes())\n    dateref.set_field(6, obj.getSeconds())\n    dateref.set_field(7, 1000*obj.getMilliseconds())\n}\n\nfunction glk_date_to_time_utc(dateref, timevalref) {\n    var obj = new Date(0);\n\n    obj.setUTCFullYear(dateref.get_field(0));\n    obj.setUTCMonth(dateref.get_field(1)-1);\n    obj.setUTCDate(dateref.get_field(2));\n    obj.setUTCHours(dateref.get_field(4));\n    obj.setUTCMinutes(dateref.get_field(5));\n    obj.setUTCSeconds(dateref.get_field(6));\n    obj.setUTCMilliseconds(dateref.get_field(7)/1000);\n\n    var now = obj.getTime();\n    var usec;\n\n    timevalref.set_field(0, Math.floor(now / 4294967296000));\n    timevalref.set_field(1, Math.floor(now / 1000) >>>0);\n    usec = Math.floor((now % 1000) * 1000);\n    if (usec < 0)\n        usec = 1000000 + usec;\n    timevalref.set_field(2, usec);\n}\n\nfunction glk_date_to_time_local(dateref, timevalref) {\n    var obj = new Date(\n        dateref.get_field(0), dateref.get_field(1)-1, dateref.get_field(2),\n        dateref.get_field(4), dateref.get_field(5), dateref.get_field(6), \n        dateref.get_field(7)/1000);\n\n    var now = obj.getTime();\n    var usec;\n\n    timevalref.set_field(0, Math.floor(now / 4294967296000));\n    timevalref.set_field(1, Math.floor(now / 1000) >>>0);\n    usec = Math.floor((now % 1000) * 1000);\n    if (usec < 0)\n        usec = 1000000 + usec;\n    timevalref.set_field(2, usec);\n}\n\nfunction glk_date_to_simple_time_utc(dateref, factor) {\n    var obj = new Date(0);\n\n    obj.setUTCFullYear(dateref.get_field(0));\n    obj.setUTCMonth(dateref.get_field(1)-1);\n    obj.setUTCDate(dateref.get_field(2));\n    obj.setUTCHours(dateref.get_field(4));\n    obj.setUTCMinutes(dateref.get_field(5));\n    obj.setUTCSeconds(dateref.get_field(6));\n    obj.setUTCMilliseconds(dateref.get_field(7)/1000);\n\n    var now = obj.getTime();\n    return Math.floor(now / (factor * 1000));\n}\n\nfunction glk_date_to_simple_time_local(dateref, factor) {\n    var obj = new Date(\n        dateref.get_field(0), dateref.get_field(1)-1, dateref.get_field(2),\n        dateref.get_field(4), dateref.get_field(5), dateref.get_field(6), \n        dateref.get_field(7)/1000);\n\n    var now = obj.getTime();\n    return Math.floor(now / (factor * 1000));\n}\n\n/* End of Glk namespace function. Return the object which will\n   become the Glk global. */\nreturn {\n    version: '2.2.5', /* GlkOte/GlkApi version */\n    init : init,\n    update : update,\n    getlibrary : get_library,\n    save_allstate : save_allstate,\n    restore_allstate : restore_allstate,\n    fatal_error : fatal_error,\n\n    byte_array_to_string : ByteArrayToString,\n    uni_array_to_string : UniArrayToString,\n    Const : Const,\n    RefBox : RefBox,\n    RefStruct : RefStruct,\n    DidNotReturn : DidNotReturn,\n    call_may_not_return : call_may_not_return,\n\n    glk_put_jstring : glk_put_jstring,\n    glk_put_jstring_stream : glk_put_jstring_stream,\n\n    glk_exit : glk_exit,\n    glk_tick : glk_tick,\n    glk_gestalt : glk_gestalt,\n    glk_gestalt_ext : glk_gestalt_ext,\n    glk_window_iterate : glk_window_iterate,\n    glk_window_get_rock : glk_window_get_rock,\n    glk_window_get_root : glk_window_get_root,\n    glk_window_open : glk_window_open,\n    glk_window_close : glk_window_close,\n    glk_window_get_size : glk_window_get_size,\n    glk_window_set_arrangement : glk_window_set_arrangement,\n    glk_window_get_arrangement : glk_window_get_arrangement,\n    glk_window_get_type : glk_window_get_type,\n    glk_window_get_parent : glk_window_get_parent,\n    glk_window_clear : glk_window_clear,\n    glk_window_move_cursor : glk_window_move_cursor,\n    glk_window_get_stream : glk_window_get_stream,\n    glk_window_set_echo_stream : glk_window_set_echo_stream,\n    glk_window_get_echo_stream : glk_window_get_echo_stream,\n    glk_set_window : glk_set_window,\n    glk_window_get_sibling : glk_window_get_sibling,\n    glk_stream_iterate : glk_stream_iterate,\n    glk_stream_get_rock : glk_stream_get_rock,\n    glk_stream_open_file : glk_stream_open_file,\n    glk_stream_open_memory : glk_stream_open_memory,\n    glk_stream_close : glk_stream_close,\n    glk_stream_set_position : glk_stream_set_position,\n    glk_stream_get_position : glk_stream_get_position,\n    glk_stream_set_current : glk_stream_set_current,\n    glk_stream_get_current : glk_stream_get_current,\n    glk_fileref_create_temp : glk_fileref_create_temp,\n    glk_fileref_create_by_name : glk_fileref_create_by_name,\n    glk_fileref_create_by_prompt : glk_fileref_create_by_prompt,\n    glk_fileref_destroy : glk_fileref_destroy,\n    glk_fileref_iterate : glk_fileref_iterate,\n    glk_fileref_get_rock : glk_fileref_get_rock,\n    glk_fileref_delete_file : glk_fileref_delete_file,\n    glk_fileref_does_file_exist : glk_fileref_does_file_exist,\n    glk_fileref_create_from_fileref : glk_fileref_create_from_fileref,\n    glk_put_char : glk_put_char,\n    glk_put_char_stream : glk_put_char_stream,\n    glk_put_string : glk_put_string,\n    glk_put_string_stream : glk_put_string_stream,\n    glk_put_buffer : glk_put_buffer,\n    glk_put_buffer_stream : glk_put_buffer_stream,\n    glk_set_style : glk_set_style,\n    glk_set_style_stream : glk_set_style_stream,\n    glk_get_char_stream : glk_get_char_stream,\n    glk_get_line_stream : glk_get_line_stream,\n    glk_get_buffer_stream : glk_get_buffer_stream,\n    glk_char_to_lower : glk_char_to_lower,\n    glk_char_to_upper : glk_char_to_upper,\n    glk_stylehint_set : glk_stylehint_set,\n    glk_stylehint_clear : glk_stylehint_clear,\n    glk_style_distinguish : glk_style_distinguish,\n    glk_style_measure : glk_style_measure,\n    glk_select : glk_select,\n    glk_select_poll : glk_select_poll,\n    glk_request_line_event : glk_request_line_event,\n    glk_cancel_line_event : glk_cancel_line_event,\n    glk_request_char_event : glk_request_char_event,\n    glk_cancel_char_event : glk_cancel_char_event,\n    glk_request_mouse_event : glk_request_mouse_event,\n    glk_cancel_mouse_event : glk_cancel_mouse_event,\n    glk_request_timer_events : glk_request_timer_events,\n    glk_image_get_info : glk_image_get_info,\n    glk_image_draw : glk_image_draw,\n    glk_image_draw_scaled : glk_image_draw_scaled,\n    glk_window_flow_break : glk_window_flow_break,\n    glk_window_erase_rect : glk_window_erase_rect,\n    glk_window_fill_rect : glk_window_fill_rect,\n    glk_window_set_background_color : glk_window_set_background_color,\n    glk_schannel_iterate : glk_schannel_iterate,\n    glk_schannel_get_rock : glk_schannel_get_rock,\n    glk_schannel_create : glk_schannel_create,\n    glk_schannel_destroy : glk_schannel_destroy,\n    glk_schannel_play : glk_schannel_play,\n    glk_schannel_play_ext : glk_schannel_play_ext,\n    glk_schannel_stop : glk_schannel_stop,\n    glk_schannel_set_volume : glk_schannel_set_volume,\n    glk_schannel_create_ext : glk_schannel_create_ext,\n    glk_schannel_play_multi : glk_schannel_play_multi,\n    glk_schannel_pause : glk_schannel_pause,\n    glk_schannel_unpause : glk_schannel_unpause,\n    glk_schannel_set_volume_ext : glk_schannel_set_volume_ext,\n    glk_sound_load_hint : glk_sound_load_hint,\n    glk_set_hyperlink : glk_set_hyperlink,\n    glk_set_hyperlink_stream : glk_set_hyperlink_stream,\n    glk_request_hyperlink_event : glk_request_hyperlink_event,\n    glk_cancel_hyperlink_event : glk_cancel_hyperlink_event,\n    glk_buffer_to_lower_case_uni : glk_buffer_to_lower_case_uni,\n    glk_buffer_to_upper_case_uni : glk_buffer_to_upper_case_uni,\n    glk_buffer_to_title_case_uni : glk_buffer_to_title_case_uni,\n    glk_buffer_canon_decompose_uni : glk_buffer_canon_decompose_uni,\n    glk_buffer_canon_normalize_uni : glk_buffer_canon_normalize_uni,\n    glk_put_char_uni : glk_put_char_uni,\n    glk_put_string_uni : glk_put_string_uni,\n    glk_put_buffer_uni : glk_put_buffer_uni,\n    glk_put_char_stream_uni : glk_put_char_stream_uni,\n    glk_put_string_stream_uni : glk_put_string_stream_uni,\n    glk_put_buffer_stream_uni : glk_put_buffer_stream_uni,\n    glk_get_char_stream_uni : glk_get_char_stream_uni,\n    glk_get_buffer_stream_uni : glk_get_buffer_stream_uni,\n    glk_get_line_stream_uni : glk_get_line_stream_uni,\n    glk_stream_open_file_uni : glk_stream_open_file_uni,\n    glk_stream_open_memory_uni : glk_stream_open_memory_uni,\n    glk_request_char_event_uni : glk_request_char_event_uni,\n    glk_request_line_event_uni : glk_request_line_event_uni,\n    glk_set_echo_line_event : glk_set_echo_line_event,\n    glk_set_terminators_line_event : glk_set_terminators_line_event,\n    glk_current_time : glk_current_time,\n    glk_current_simple_time : glk_current_simple_time,\n    glk_time_to_date_utc : glk_time_to_date_utc,\n    glk_time_to_date_local : glk_time_to_date_local,\n    glk_simple_time_to_date_utc : glk_simple_time_to_date_utc,\n    glk_simple_time_to_date_local : glk_simple_time_to_date_local,\n    glk_date_to_time_utc : glk_date_to_time_utc,\n    glk_date_to_time_local : glk_date_to_time_local,\n    glk_date_to_simple_time_utc : glk_date_to_simple_time_utc,\n    glk_date_to_simple_time_local : glk_date_to_simple_time_local,\n    glk_stream_open_resource : glk_stream_open_resource,\n    glk_stream_open_resource_uni : glk_stream_open_resource_uni,\n    garglk_set_zcolors: garglk_set_zcolors,\n    garglk_set_zcolors_stream: garglk_set_zcolors_stream,\n    garglk_set_reversevideo: garglk_set_reversevideo,\n    garglk_set_reversevideo_stream: garglk_set_reversevideo_stream,\n};\n\n}();\n\nexport default Glk;\n\n/* End of Glk library. */\n", "/*\n\nFormat specifications\n=====================\n\nCopyright (c) 2023 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/parchment\n\n*/\n\nimport Glk from '../upstream/glkote/glkapi.js'\n\n//import {AsyncGlk} from '../upstream/asyncglk/src/index-browser.js'\n//const Glk = new AsyncGlk()\n\nasync function generic_emglken_vm(options, requires)\n{\n    const [file_data, engine, wasmBinary] = requires\n\n    const vm_options = Object.assign({}, options, {\n        wasmBinary,\n    })\n\n    const vm = new engine.default()\n    vm.init(file_data, vm_options)\n    await vm.start()\n}\n\nexport const formats = [\n    {\n        id: 'blorb',\n        extensions: /\\.(blb|blorb)/i,\n    },\n\n    {\n        id: 'adrift4',\n        extensions: /\\.taf/i,\n        engines: [\n            {\n                id: 'scare',\n                load: ['./scare.js', './scare-core.wasm'],\n                start: generic_emglken_vm,\n            },\n        ],\n    },\n\n    /*{\n        id: 'adrift5',\n        extensions: /\\.(blb|blorb)/i,\n        engines: [\n            {\n                id: 'frankendrift',\n                load: ['./frankendrift.js'],\n                start: (options, requires) => {\n                    const [file_data, FrankenDrift] = requires\n\n                    const vm = new FrankenDrift.FrankenDrift()\n                    const vm_options = Object.assign({}, options, {\n                        vm,\n                        Glk,\n                    })\n\n                    vm.init(file_data, vm_options)\n                    Glk.init(vm_options)\n                },\n            },\n        ],\n    },*/\n\n    {\n        id: 'hugo',\n        extensions: /\\.hex/i,\n        engines: [\n            {\n                id: 'hugo',\n                load: ['./hugo.js', './hugo-core.wasm'],\n                start: generic_emglken_vm,\n            },\n        ],\n    },\n\n    {\n        id: 'glulx',\n        extensions: /\\.(gblorb|glb|ulx)/i,\n        engines: [\n            {\n                id: 'quixe',\n                load: ['./quixe.js'],\n                start: (options, requires) =>\n                {\n                    const [file_data, quixe] = requires\n                    const data_array = file_data\n\n                    const vm_options = Object.assign({}, options, {\n                        blorb_gamechunk_type: 'GLUL',\n                        GiDispa: new quixe.GiDispa(),\n                        GiLoad: quixe.GiLoad,\n                        image_info_map: 'StaticImageInfo',\n                        io: Glk,\n                        set_page_title: 0,\n                        spacing: 0,\n                        use_query_story: 0,\n                        vm: quixe.Quixe,\n                    })\n\n                    quixe.GiLoad.load_run(vm_options, data_array, 'array')\n                },\n            },\n\n            {\n                id: 'glulxe',\n                load: ['./glulxe.js', './glulxe-core.wasm'],\n                start: generic_emglken_vm,\n            },\n\n            {\n                id: 'git',\n                load: ['./git.js', './git-core.wasm'],\n                start: generic_emglken_vm,\n            },\n        ],\n    },\n\n    {\n        id: 'tads',\n        extensions: /\\.(gam|t3)/i,\n        engines: [\n            {\n                id: 'tads',\n                load: ['./tads.js', './tads-core.wasm'],\n                start: generic_emglken_vm,\n            },\n        ],\n    },\n\n    {\n        id: 'zcode',\n        extensions: /\\.(zblorb|zlb|z3|z4|z5|z8)/i,\n        engines: [\n            {\n                id: 'zvm',\n                load: ['./zvm.js'],\n                start: (options, requires) =>\n                {\n                    const [file_data, zvm] = requires\n\n                    const vm = new zvm.ZVM()\n                    const vm_options = Object.assign({}, options, {\n                        vm,\n                        GiDispa: new zvm.ZVMDispatch(),\n                        Glk,\n                    })\n\n                    vm.prepare(file_data, vm_options)\n                    Glk.init(vm_options)\n                },\n            },\n\n            {\n                id: 'bocfel',\n                load: ['./bocfel.js', './bocfel-core.wasm'],\n                start: generic_emglken_vm,\n            },\n        ],\n    },\n]\n\n// Search within a Blorb to find what format is inside\n// Must be passed a Blorb instance\nexport function identify_blorb_storyfile_format(blorb) {\n    const blorb_chunks = {\n        GLUL: 'glulx',\n        ZCOD: 'zcode',\n    }\n    const chunktype = blorb.get_chunk('exec', 0)?.blorbtype\n    if (blorb_chunks[chunktype]) {\n        return blorb_chunks[chunktype]\n    }\n    throw new Error('Unknown storyfile format in Blorb')\n}\n", "/*\n\nParchment Launcher\n==================\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/parchment\n\n*/\n\nimport Cookies from 'js-cookie'\n\nimport {Blorb, FileView} from '../upstream/asyncglk/src/index-browser.ts'\nimport {get_default_options, get_query_options} from './options.js'\nimport {fetch_storyfile, fetch_vm_resource, read_uploaded_file} from './file.js'\nimport {formats, identify_blorb_storyfile_format} from './formats.js'\n\nclass ParchmentLauncher\n{\n    constructor(parchment_options) {\n        this.options = Object.assign({}, get_default_options(), parchment_options, get_query_options(['do_vm_autosave', 'story']))\n    }\n\n    find_format(format, path) {\n        for (const formatspec of formats) {\n            if (formatspec.id === format || formatspec.extensions.test(path)) {\n                return formatspec\n            }\n        }\n        throw new Error('Unknown storyfile format')\n    }\n\n    get_storyfile_path() {\n        return this.options.story || this.options.default_story?.[0] || null\n    }\n\n    launch() {\n        try {\n            // Update the Dialog storage version\n            this.options.Dialog.init()\n\n            // Apply the dark theme if set\n            const theme = this.options.theme\n                || Cookies.get(this.options.theme_cookie)\n                // Or if the browser tells us to prefer dark\n                || (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : '')\n            if (theme) {\n                document.documentElement.setAttribute('data-theme', theme)\n            }\n\n            const storyfile_path = this.get_storyfile_path()\n            if (!storyfile_path) {\n                // Set up all the ways we can load a story\n                $('#custom-file-upload').show().on('keydown', event => {\n                    if (event.keyCode === 32 /*Space*/ || event.keyCode === 13 /*Enter*/) {\n                        event.target.click()\n                    }\n                })\n                $('#file-upload').on('change', () => {\n                    const file = $('#file-upload')[0]?.files?.[0]\n                    if (file) {\n                        this.load_uploaded_file(file)\n                    }\n                })\n                $('#play-url').show()\n                $('#play-url-button').on('click', () => this.load_url())\n                $('#play-url-input').on('keydown', event => {\n                    if (event.keyCode === 13 /*Enter*/) {\n                        this.load_url()\n                    }\n                })\n                return\n            }\n\n            this.load(storyfile_path, this.options.format)\n        }\n        catch (err) {\n            this.options.GlkOte.error(err)\n            throw err\n        }\n    }\n\n    // Overloaded load\n    // story can be a path or Uint8Array\n    // format can be an engine object, id string, or null, in which case it will be identified from the story\n    async load(story, format) {\n        try {\n            // Hide the about page, and show the loading spinner instead\n            $('#about').remove()\n            $('#loadingpane').show()\n\n            // Identify the format\n            if (!format) {\n                if (typeof story === 'string') {\n                    format = this.find_format(null, story)\n                }\n                else {\n                    throw new Error('Cannot identify storyfile format without path')\n                }\n            }\n\n            // If a blorb file extension is generic, we must download it first to identify its format\n            let blorb\n            if (format.id === 'blorb') {\n                if (typeof story === 'string') {\n                    story = await fetch_storyfile(this.options, story)\n                }\n                blorb = new Blorb(story)\n                format = identify_blorb_storyfile_format(blorb)\n            }\n\n            if (typeof format === 'string') {\n                format = this.find_format(format)\n            }\n            const engine = format.engines[0]\n\n            const requires = await Promise.all([\n                typeof story === 'string' ? fetch_storyfile(this.options, story) : story,\n                ...engine.load.map(path => fetch_vm_resource(this.options, path))\n            ])\n            story = requires[0]\n\n            // If the story is a Blorb, then parse it and pass in the options\n            const options = Object.assign({}, this.options)\n            const view = new FileView(story)\n            if (view.getFourCC(0) === 'FORM' && view.getFourCC(8) === 'IFRS') {\n                options.Blorb = blorb || new Blorb(story)\n            }\n\n            await engine.start(options, requires)\n        }\n        catch (err) {\n            this.options.GlkOte.error(err)\n            throw err\n        }\n    }\n\n    async load_uploaded_file(file) {\n        try {\n            this.load(await read_uploaded_file(file), this.find_format(null, file.name))\n        }\n        catch (err) {\n            this.options.GlkOte.error(err)\n            throw err\n        }\n    }\n\n    load_url() {\n        const url = $('#play-url-input').val()\n        if (!url) {\n            return\n        }\n        // Validate the URL\n        try {\n            new URL(url)\n        }\n        catch (_) {\n            $('#play-url-error').text('Please enter a valid URL')\n            return\n        }\n\n        // Change the page URL\n        const new_url = new URL(window.location)\n        new_url.searchParams.set('story', url)\n        window.location = new_url\n\n        // TODO: We could use the history API, but we need to then handle going back\n        //history.pushState(null, '', new_url)\n        //this.load(url)\n    }\n}\n\n$(() => {\n    const parchment = new ParchmentLauncher(window.parchment_options)\n    window.parchment = parchment\n\n    if (parchment.options.auto_launch) {\n        parchment.launch()\n    }\n})\n"],
  "mappings": "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KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,IAAK,EAClG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EACtG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EACtG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EACtG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EACtG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EACtG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EACtG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EACtG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EACtG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAC3G,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,KAAK,IAAK,EAC3G,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EACtG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EACtG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EACtG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,KAAK,IAAK,EAAG,KAAM,CAAE,IAAI,GAAI,EACpG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EACxG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EACxG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EACxG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAChH,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EACxG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAC5F,KAAM,IAAK,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAC5F,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAChG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAC/F,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EACpG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAChG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,IAAI,GAAI,EACxG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAAG,KAAM,CAAE,IAAI,GAAI,EAC5F,KAAM,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,IAAK,KAAM,GACpD,KAAM,CAAE,GAAG,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAC/F,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,GAAG,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,GAAG,GAAI,EAC7F,KAAM,CAAE,GAAG,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAC/F,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EAAG,KAAM,CAAE,KAAK,GAAI,EACjG,KAAM,MAAO,KAAM,MAAO,MAAO,CAAE,MAAM,GAAI,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAC7F,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EACrH,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EACrH,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EACrH,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EACrH,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EACrH,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EACrH,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EACrH,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EACrH,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EACrH,MAAO,CAAE,MAAM,KAAM,EAAG,MAAO,CAAE,MAAM,KAAM,EAA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CzF,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EACjF,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EACzF,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EACjF,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EACjG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EACjG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EACzF,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EACjG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EACzF,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EACjF,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EACjG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EACjF,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EACjF,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,IAAI,GAAG,EAClF,CAAC,IAAI,GAAG,EAAG,CAAC,IAAI,GAAG,CACjB,EACKb,EAAG,EAAGA,EAAG,IAAKA,IACjBT,EAAMsB,EAAGb,GACT+D,EAAI/D,EAAG,MAAQT,EAgBjB,IAdAsB,EAAK,CACP,CAAC,GAAG,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAC7F,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAC7G,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAC7G,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EACzF,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EACjH,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,GAAG,GAAG,EAAG,CAAC,IAAI,GAAG,EACjF,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,GAAG,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI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AAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAC7I,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAC7I,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAC7I,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAC7I,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,IAAI,GAAG,EAC7I,CAAC,IAAI,GAAG,EAAG,CAAC,IAAI,GAAG,EAAG,CAAC,IAAI,IAAI,G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AAK,IACzC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC7C,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC7C,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC7C,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC7C,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC7C,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC7C,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC7C,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC7C,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAC7C,IAAK,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IACjD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAC9C,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAC9C,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAC9C,KAAM,GAAI,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IACjD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,GAAI,KAAM,GACjD,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAC9C,KAAM,GAAI,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IACjD,KAAM,IAAK,KAAM,IAAK,KAAM,GAAI,KAAM,IAAK,KAAM,IACjD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,GAAI,KAAM,IAAK,KAAM,IACjD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,EAAG,KAAM,EAAG,KAAM,IAAK,KAAM,IAAK,KAAM,IAC9C,KAAM,IAAK,KAAM,EAAG,KAAM,EAAG,KAAM,EAAG,KAAM,EAC5C,KAAM,EAAG,KAAM,EAAG,KAAM,EAAG,KAAM,EAAG,KAAM,EAC1C,KAAM,EAAG,KAAM,GAAI,KAAM,GAAI,KAAM,EAAG,KAAM,EAC5C,KAAM,EAAG,KAAM,EAAG,KAAM,IAAK,KAAM,IAAK,KAAM,EAC9C,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,EAAG,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,EAChD,KAAM,EAAG,KAAM,EAAG,KAAM,EAAG,KAAM,EAAG,KAAM,IAC1C,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,IAClD,KAAM,IAAK,KAAM,EAAG,KAAM,EAAG,KAAM,IAAK,KAAM,IAC9C,KAAM,IAAK,KAAM,IAAK,KAAM,EAAG,KAAM,EAAG,KAAM,EAC9C,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,EAAG,KAAM,EAChD,KAAM,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,EAAG,MAAO,IACjD,MAAO,IAAK,MAAO,IAAK,MAAO,IAAK,MAAO,IAAK,MAAO,IACvD,MAAO,EAAG,MAAO,EAAG,MAAO,GAAI,MAAO,IAAK,MAAO,IAClD,MAAO,IAAK,MAAO,IAAK,OAAQ,IAAK,OAAQ,IAAK,OAAQ,EAC1D,OAAQ,EAAG,OAAQ,EAAG,OAAQ,IAAK,OAAQ,IAAK,OAAQ,IACxD,OAAQ,IAAK,OAAQ,IAAK,OAAQ,IAAK,OAAQ,IAAK,OAAQ,IAC5D,OAAQ,IAAK,OAAQ,IAAK,OAAQ,IAAK,OAAQ,IAAK,OAAQ,IAC5D,OAAQ,IAAK,OAAQ,IAAK,OAAQ,IAAK,OAAQ,IAAK,OAAQ,IAC5D,OAAQ,IAAK,OAAQ,IAAK,OAAQ,IAAK,OAAQ,IAAK,OAAQ,IAC5D,OAAQ,IAAK,OAAQ,GACrB,EAGIC,GAAsB,CACzB,GAAI,CAAE,IAAI,IAAK,EACf,GAAI,CAAE,IAAI,IAAK,EACf,GAAI,CAAE,IAAI,IAAK,EACf,GAAI,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,GAAI,EACxJ,GAAI,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACnC,GAAI,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,GAAI,EAClD,GAAI,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAChE,GAAI,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EACnK,GAAI,CAAE,IAAI,IAAK,EACf,GAAI,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,GAAI,EACrE,GAAI,CAAE,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACzE,GAAI,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,EAC/I,GAAI,CAAE,IAAI,GAAI,EACd,GAAI,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,EACrD,GAAI,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EAC9D,GAAI,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACnC,GAAI,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EAC1F,GAAI,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,GAAI,EACvJ,GAAI,CAAE,IAAI,KAAM,IAAI,IAAK,EACzB,GAAI,CAAE,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,EAChF,GAAI,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,GAAI,EACtE,GAAI,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EACxE,GAAI,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EACrL,GAAI,CAAE,IAAI,KAAM,IAAI,IAAK,EACzB,GAAI,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAChE,GAAI,CAAE,IAAI,KAAM,IAAI,IAAK,EACzB,GAAI,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EAC3F,GAAI,CAAE,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EAC9D,GAAI,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,GAAI,EACxJ,GAAI,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACnC,GAAI,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,GAAI,EAClD,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACjE,IAAK,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EACpK,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,GAAI,EACtE,IAAK,CAAE,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACpF,IAAK,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,EACvI,IAAK,CAAE,IAAI,IAAK,IAAI,GAAI,EACxB,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,EACtD,IAAK,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EAC/D,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACpC,IAAK,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EAC3F,IAAK,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,GAAI,EACxJ,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,EAC1B,IAAK,CAAE,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,EACjF,IAAK,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,GAAI,EACvE,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EACnF,IAAK,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EACtL,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,EAC1B,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC3E,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,EAC1B,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACtG,IAAK,CAAE,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EAC/D,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,EACnC,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC9C,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,IAAK,IAAI,GAAI,EACxB,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC9C,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC9C,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,EACnC,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,GAAI,EAC1C,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC9C,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,IAAK,IAAI,GAAI,EACxB,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC9C,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC9C,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,EACnC,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,IAAK,IAAI,IAAK,IAAI,IAAK,IAAI,GAAI,EAC1C,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC9C,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC9C,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,EAC1B,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,EAC1B,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,EAC1B,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,EAC1B,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACxD,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACxD,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACxD,IAAK,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACxD,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,GAAI,EACf,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC3E,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EAC7C,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACvD,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EAC1E,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EAC7C,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,EAChE,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACvD,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACrF,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,IAAK,EAC7C,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACjE,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACpF,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,IAAM,IAAI,IAAK,EAC7C,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,EAC1B,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACpF,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACjE,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,EACnC,IAAK,CAAE,IAAI,KAAM,IAAI,IAAK,IAAI,IAAK,EACnC,IAAK,CAAE,IAAI,IAAK,EAChB,IAAK,CAAE,IAAI,IAAK,IAAI,GAAI,EACxB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,IAAK,EAC3B,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACrC,KAAM,CAAE,IAAI,KAAM,IAAI,IAAK,EAC3B,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,IAAK,EAC3B,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACrC,KAAM,CAAE,IAAI,KAAM,IAAI,IAAK,EAC3B,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,KAAK,MAAO,KAAK,MAAO,KAAK,KAAM,EAC3C,KAAM,CAAE,KAAK,MAAO,KAAK,KAAM,EAC/B,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,MAAO,KAAK,KAAM,EAC/B,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,MAAO,KAAK,KAAM,EAC/B,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,MAAO,KAAK,KAAM,EAC/B,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,MAAO,KAAK,KAAM,EAC/B,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,MAAO,KAAK,MAAO,KAAK,KAAM,EAC3C,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,KAAM,EACnB,KAAM,CAAE,KAAK,KAAM,KAAK,KAAM,KAAK,IAAK,EACxC,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,KAAM,KAAK,IAAK,EAC7B,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,KAAM,KAAK,KAAM,KAAK,IAAK,EACxC,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,KAAM,KAAK,IAAK,EAC7B,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,KAAM,KAAK,KAAM,KAAK,IAAK,EACxC,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,KAAM,KAAK,IAAK,EAC7B,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,KAAM,KAAK,KAAM,KAAK,IAAK,EACxC,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,KAAM,KAAK,KAAM,KAAK,IAAK,EACxC,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,KAAK,IAAK,EAClB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,IAAK,EAC3B,KAAM,CAAE,IAAI,KAAM,IAAI,IAAK,EAC3B,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,IAAK,EAC3B,KAAM,CAAE,IAAI,KAAM,IAAI,IAAK,EAC3B,KAAM,CAAE,IAAI,KAAM,IAAI,IAAK,EAC3B,KAAM,CAAE,IAAI,KAAM,IAAI,IAAK,EAC3B,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACrC,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACrC,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACrC,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACrC,IAAM,CAAE,IAAI,KAAM,IAAI,IAAK,EAC3B,KAAM,CAAE,IAAI,KAAM,IAAI,IAAK,EAC3B,KAAM,CAAE,IAAI,KAAM,IAAI,IAAK,EAC3B,KAAM,CAAE,IAAI,KAAM,IAAI,IAAK,EAC3B,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACrC,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACrC,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACrC,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EAC/C,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACrC,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,KAAM,IAAI,KAAM,IAAI,IAAK,EACrC,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE,IAAI,IAAK,EACjB,KAAM,CAAE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",
  "names": ["assign", "target", "i", "source", "key", "defaultConverter", "value", "init", "converter", "defaultAttributes", "set", "name", "attributes", "stringifiedAttributes", "attributeName", "get", "cookies", "jar", "parts", "found", "api", "FileView", "data", "byteOffset", "byteLength", "index", "length", "text", "utf8decoder", "utf8encoder", "IFF", "data", "view", "FileView", "i", "length", "chunk_length", "buffer_length", "chunk", "BLORB_RESOURCE_INDEX_USAGES", "UNKNOWN_IMAGE_TYPE", "Blorb", "data", "options", "iff", "IFF", "iff_chunk", "view", "FileView", "html", "utf8decoder", "bibels", "el", "i", "usage", "resource_number", "text_length", "chunk", "resource_offset", "resource_chunk", "type", "key", "num", "gametype", "get_jpeg_dimensions", "get_png_dimensions", "img", "field", "get_jpeg_dimensions", "data", "view", "FileView", "i", "marker", "chunklength", "get_png_dimensions", "chunktype", "DEFAULT_METRICS", "KEY_CODES_TO_NAMES", "KEY_CODE_DOWN", "KEY_CODE_RETURN", "KEY_CODE_UP", "NBSP", "OFFSCREEN_OFFSET", "PACKAGE_VERSION", "freeGlobal", "freeGlobal_default", "freeSelf", "root", "freeGlobal_default", "root_default", "Symbol", "root_default", "Symbol_default", "objectProto", "hasOwnProperty", "nativeObjectToString", "symToStringTag", "Symbol_default", "getRawTag", "value", "isOwn", "tag", "unmasked", "result", "getRawTag_default", "objectProto", "nativeObjectToString", "objectToString", "value", "objectToString_default", "nullTag", "undefinedTag", "symToStringTag", "Symbol_default", "baseGetTag", "value", "getRawTag_default", "objectToString_default", "baseGetTag_default", "isObjectLike", "value", "isObjectLike_default", "symbolTag", "isSymbol", "value", "isObjectLike_default", "baseGetTag_default", "isSymbol_default", "reWhitespace", "trimmedEndIndex", "string", "index", "trimmedEndIndex_default", "reTrimStart", "baseTrim", "string", "trimmedEndIndex_default", "baseTrim_default", "isObject", "value", "type", "isObject_default", "NAN", "reIsBadHex", "reIsBinary", "reIsOctal", "freeParseInt", "toNumber", "value", "isSymbol_default", "isObject_default", "other", "baseTrim_default", "isBinary", "toNumber_default", "now", "root_default", "now_default", "FUNC_ERROR_TEXT", "nativeMax", "nativeMin", "debounce", "func", "wait", "options", "lastArgs", "lastThis", "maxWait", "result", "timerId", "lastCallTime", "lastInvokeTime", "leading", "maxing", "trailing", "toNumber_default", "isObject_default", "invokeFunc", "time", "args", "thisArg", "leadingEdge", "timerExpired", "remainingWait", "timeSinceLastCall", "timeSinceLastInvoke", "timeWaiting", "shouldInvoke", "now_default", "trailingEdge", "cancel", "flush", "debounced", "isInvoking", "debounce_default", "FUNC_ERROR_TEXT", "throttle", "func", "wait", "options", "leading", "trailing", "isObject_default", "debounce_default", "throttle_default", "GlkOteBase", "PACKAGE_VERSION", "DEFAULT_METRICS", "options", "error", "value", "name", "msg", "val", "data", "err", "replyfunc", "ref", "ex", "ev", "colour", "create", "tag", "className", "DOM", "options", "id", "props", "is_pinch_zoomed", "get_size", "el", "metrics_differ", "newmetrics", "oldmetrics", "ios15_0", "Metrics", "glkote", "throttle_default", "is_pinch_zoomed", "gameport", "input_is_active", "window", "resolve", "dom", "layout_test_pane", "line", "create", "bufwin", "bufline1", "bufline2", "bufspan", "graphwin", "graphcanvas", "gridwin", "gridline1", "gridline2", "gridspan", "font_family", "bufwinsize", "bufspansize", "bufline1size", "bufline2size", "graphicswinsize", "canvassize", "gridwinsize", "gridspansize", "gridline1size", "gridline2size", "TranscriptRecorder", "options", "windows", "state", "ev", "event", "eventtype", "input", "output", "update", "win", "textdata", "data", "content", "run_index", "instruction", "response", "err", "MAX_HISTORY_LENGTH", "TextInput", "window", "ev", "scroll_window", "is_pinch_zoomed", "char", "keycode", "KEY_CODE_DOWN", "KEY_CODE_UP", "history", "changed", "terminator", "KEY_CODES_TO_NAMES", "code", "KEY_CODE_RETURN", "OFFSCREEN_OFFSET", "inputparent", "val", "update", "metrics", "css_styles", "reverse", "apply_text_run_styles", "throttle_default", "do_scroll", "count", "no_text_selected", "WindowBase", "options", "window_types", "ev", "TextInput", "remove_frame", "apply_text_run_styles", "orig_styles", "reverse", "el", "styles", "bg", "fg", "split_after_spaces", "text", "res", "whitespace", "prev_whitespace", "c", "is_whitespace", "TextualWindow", "onlink", "target", "windowid", "selector", "original_styles", "full_selector", "css_styles", "reverse_styles", "normal_styles", "rule", "properties", "property", "name", "value", "run", "split_words", "run_style", "monospace_val", "monospace_class", "create", "els", "linkval", "styles_need_refreshing", "inline_alignment_classes", "BufferWindow", "_", "rect", "data", "line_index", "line", "content", "divel", "line_has_style", "NBSP", "run_index", "instruction", "is_pinch_zoomed", "GraphicsWindow", "debounce_default", "key", "url", "image", "height", "width", "dPR", "buffercontext", "i", "frame", "loading_images", "op", "GridWindow", "lineel", "window_classes", "Windows", "glkote", "windows", "window", "win", "testRO", "entries", "newinputs", "entry", "box", "update", "id", "type", "windowstoclose", "oldgen", "WebGlkOte", "GlkOteBase", "DOM", "throttle_default", "Metrics", "Windows", "options", "windowport", "query_feedback", "cookie_name", "TranscriptRecorder", "err", "data", "win", "winid", "colour", "windows", "disable", "errorpane", "link", "error", "msg", "errorcontent", "name", "loadingpane", "graphics_bg", "ev", "val", "content", "pairStrings", "lookupE", "lookupD", "pairString", "r", "encodeRepertoire", "pair", "first", "last", "codePoint", "numZBits", "chr", "z", "encode", "uint8Array", "length", "str", "i", "uint8", "j", "bit", "decode", "numUint8s", "numUint8Bits", "utf_decoder", "utf_encoder", "String_to_Uint8Array", "str", "ch", "Dialog", "dialog_el_id", "is_open", "dialog_callback", "will_save", "confirming", "editing", "editing_dirent", "cur_usage", "cur_usage_name", "cur_gameid", "cur_filelist", "dialog_init", "version", "key", "value", "encode", "data", "dialog_open", "tosave", "usage", "gameid", "callback", "Storage", "label_for_usage", "root_el_id", "iface", "rootel", "screen", "frame", "dia", "form", "el", "row", "evhan_accept_save_button", "evhan_accept_load_button", "evhan_edit_button", "evhan_cancel_button", "evhan_delete_button", "evhan_display_button", "evhan_storage_changed", "focusfunc", "defer_func", "dialog_close", "set_caption", "msg", "isupper", "elid", "val", "usage_is_textual", "func", "evhan_select_change", "selel", "pos", "file", "fel", "evhan_select_change_editing", "butel", "file_ref_exists", "ev", "filename", "dirent", "file_construct_ref", "file_remove_ref", "bodyel", "dat", "file_read", "textel", "b64dat", "linkel", "ls", "files_list", "f1", "f2", "lastusage", "ix", "anyselected", "datestr", "format_date", "file_clean_fixed_name", "ref", "file_construct_temp_ref", "timestamp", "file_decode_ref", "dirkey", "oldpos", "conkey", "file_load_dirent", "statstring", "file_write", "content", "israw", "err1", "err2", "decode", "file_notimplemented", "file_ref_matches", "keyls", "date", "day", "time", "autosave_write", "signature", "snapshot", "key_meta", "key_ram", "saved_signature", "autosave_read", "ram", "autosave_clear", "htmlLocalStorage", "dialog_default", "get_default_options", "dialog_default", "WebGlkOte", "get_query_options", "possible_query_options", "query", "options", "option", "fetch_storyfile", "options", "url", "story_url", "story_domain", "same_domain", "proxy_url", "response", "direct_access", "domain", "text", "matched", "buffer", "fetch_vm_resource", "path", "data", "read_uploaded_file", "file", "resolve", "reject", "reader", "Glk", "VM", "Blorb", "Dialog", "GiDispa", "GlkOte", "support", "option_exit_warning", "option_do_vm_autosave", "option_before_select_hook", "option_extevent_hook", "option_glk_gestalt_hook", "has_exited", "ui_disabled", "ui_specialinput", "ui_specialcallback", "event_generation", "current_partial_inputs", "current_partial_outputs", "init", "vm_options", "accept_ui_event", "obj", "box", "qlog", "content_metrics", "item", "res", "gli_timer_started", "Const", "handle_external_input", "handle_hyperlink_input", "handle_mouse_input", "handle_char_input", "handle_line_input", "gli_rootwin", "gli_window_rearrange", "handle_arrange_input", "handle_redraw_input", "gli_fileref_create_by_prompt_callback", "gli_selectref", "val1", "val2", "disprock", "val", "win", "gli_windowlist", "xpos", "ypos", "input", "charval", "KeystrokeNameMap", "termkey", "ix", "gli_set_style", "gli_window_put_string", "glk_put_jstring_stream", "termcode", "update", "dataobj", "winarray", "contentarray", "inputarray", "robj", "useobj", "lineobj", "ls", "cx", "initial", "lastpos", "geometry_changed", "clone_stylehints", "gli_window_buffer_deaccumulate", "laststyle", "lasthyperlink", "lastfg", "lastbg", "lastreverse", "StyleNameMap", "clearedat", "drawel", "setcol", "gli_window_grid_canonicalize", "gli_timer_lastsent", "gli_timer_interval", "current_page_pg", "stylehints", "last_page_bg", "gli_autorestore_glkstate", "eventarg", "get_library", "save_allstate", "gli_currentstr", "info", "ln", "str", "gli_streamlist", "strtype_Window", "strtype_Memory", "strtype_Resource", "strtype_File", "gli_stream_flush_file", "fref", "gli_filereflist", "restore_allstate", "restore_stylehints", "jx", "el", "tempref", "content", "glk_request_timer_events", "fatal_error", "msg", "KeystrokeValueMap", "FileTypeMap", "unicode_upper_table", "map", "unicode_lower_table", "unicode_title_table", "unicode_decomp_table", "unicode_combin_table", "unicode_compo_table", "CharToString", "TrimArrayToBytes", "arr", "newarr", "len", "ByteArrayToString", "UniArrayToString", "UniArrayToUTF8", "count", "UniArrayToBE32", "RefBox", "RefStruct", "pos", "DidNotReturn", "call_may_not_return", "id", "gli_schannellist", "gli_api_display_rocks", "gli_new_window", "type", "rock", "gli_stream_open_window", "gli_delete_window", "prev", "next", "gli_delete_stream", "gli_windows_unechostream", "ch", "conta", "stylename", "text", "gli_window_buffer_put_special", "special", "flowbreak", "gli_window_close", "recurse", "wx", "width", "height", "oldwidth", "oldheight", "min", "max", "diff", "split", "splitwid", "box1", "box2", "ch1", "ch2", "gli_new_stream", "readable", "writable", "gli_stream_dirty_file", "gli_new_fileref", "filename", "usage", "ref", "gameid", "gli_delete_fileref", "gli_put_char", "arr8", "buf", "gli_put_array", "allbytes", "gli_get_char", "want_unicode", "val0", "val3", "gli_get_line", "lx", "gotnewline", "gli_get_buffer", "gli_stream_fill_result", "result", "glk_put_jstring", "gli_set_hyperlink", "glk_exit", "glk_tick", "glk_gestalt", "sel", "glk_gestalt_ext", "glk_window_iterate", "rockref", "glk_window_get_rock", "glk_window_get_root", "glk_window_open", "splitwin", "method", "size", "wintype", "oldparent", "pairwin", "newwin", "glk_window_close", "statsref", "grandparwin", "sibwin", "keydamage_flag", "glk_window_get_size", "widthref", "heightref", "wid", "hgt", "boxwidth", "boxheight", "glk_window_set_arrangement", "keywin", "newdir", "newvertical", "newbackward", "glk_window_get_arrangement", "methodref", "sizeref", "keywinref", "glk_window_get_type", "glk_window_get_parent", "glk_window_clear", "glk_window_move_cursor", "glk_window_get_stream", "glk_window_set_echo_stream", "glk_window_get_echo_stream", "glk_set_window", "glk_window_get_sibling", "parent", "glk_stream_iterate", "glk_stream_get_rock", "glk_stream_open_file", "fmode", "fstream", "glk_stream_open_memory", "glk_stream_open_resource", "filenum", "isbinary", "glk_stream_open_resource_uni", "glk_stream_close", "glk_stream_set_position", "seekmode", "glk_stream_get_position", "glk_stream_set_current", "glk_stream_get_current", "glk_fileref_create_temp", "filetype", "filetypename", "glk_fileref_create_by_name", "glk_fileref_create_by_prompt", "modename", "callback", "glk_fileref_destroy", "glk_fileref_iterate", "glk_fileref_get_rock", "glk_fileref_delete_file", "glk_fileref_does_file_exist", "glk_fileref_create_from_fileref", "oldfref", "glk_put_char", "glk_put_char_stream", "glk_put_string", "glk_put_string_stream", "glk_put_buffer", "glk_put_buffer_stream", "glk_set_style", "glk_set_style_stream", "glk_get_char_stream", "glk_get_line_stream", "glk_get_buffer_stream", "glk_char_to_lower", "glk_char_to_upper", "newstylehints", "selector", "styles", "STYLE_NAMES", "CSS_STYLE_PROPERTIES", "stylenum", "stylehint", "css_style", "value", "glk_stylehint_set", "style", "hint", "add_css_style", "stylevalue", "justifications", "weights", "glk_stylehint_clear", "remove_style", "glk_style_distinguish", "glk_style_measure", "styl", "resultref", "garglk_set_zcolors", "fg", "bg", "garglk_set_zcolors_stream", "garglk_set_reversevideo", "reverse", "garglk_set_reversevideo_stream", "glk_select", "eventref", "glk_select_poll", "now", "glk_request_line_event", "initlen", "glk_cancel_line_event", "glk_request_char_event", "glk_cancel_char_event", "glk_set_echo_line_event", "glk_set_terminators_line_event", "glk_request_mouse_event", "glk_cancel_mouse_event", "msec", "glk_image_get_info", "imgid", "glk_image_draw", "img", "alignment", "glk_image_draw_scaled", "glk_window_flow_break", "glk_window_erase_rect", "left", "top", "glk_window_fill_rect", "color", "colstr", "gli_color_to_css", "glk_window_set_background_color", "glk_schannel_iterate", "schan", "glk_schannel_get_rock", "glk_schannel_create", "glk_schannel_destroy", "glk_schannel_play", "glk_schannel_play_ext", "glk_schannel_stop", "glk_schannel_set_volume", "glk_sound_load_hint", "glk_schannel_create_ext", "glk_schannel_play_multi", "glk_schannel_pause", "glk_schannel_unpause", "glk_schannel_set_volume_ext", "glk_set_hyperlink", "glk_set_hyperlink_stream", "glk_request_hyperlink_event", "glk_cancel_hyperlink_event", "glk_buffer_to_lower_case_uni", "numchars", "origval", "arrlen", "src", "glk_buffer_to_upper_case_uni", "glk_buffer_to_title_case_uni", "lowerrest", "gli_buffer_canon_decompose_uni", "grpstart", "grpend", "kx", "tmp", "gli_buffer_canon_compose_uni", "curch", "newch", "curclass", "newclass", "glk_buffer_canon_decompose_uni", "glk_buffer_canon_normalize_uni", "glk_put_char_uni", "glk_put_string_uni", "glk_put_buffer_uni", "glk_put_char_stream_uni", "glk_put_string_stream_uni", "glk_put_buffer_stream_uni", "glk_get_char_stream_uni", "glk_get_buffer_stream_uni", "glk_get_line_stream_uni", "glk_stream_open_file_uni", "glk_stream_open_memory_uni", "glk_request_char_event_uni", "glk_request_line_event_uni", "glk_current_time", "timevalref", "usec", "glk_current_simple_time", "factor", "glk_time_to_date_utc", "dateref", "glk_time_to_date_local", "glk_simple_time_to_date_utc", "time", "glk_simple_time_to_date_local", "glk_date_to_time_utc", "glk_date_to_time_local", "glk_date_to_simple_time_utc", "glk_date_to_simple_time_local", "glkapi_default", "generic_emglken_vm", "options", "requires", "file_data", "engine", "wasmBinary", "vm_options", "vm", "formats", "quixe", "data_array", "glkapi_default", "zvm", "identify_blorb_storyfile_format", "blorb", "blorb_chunks", "chunktype", "ParchmentLauncher", "parchment_options", "get_default_options", "get_query_options", "format", "path", "formatspec", "formats", "theme", "api", "storyfile_path", "event", "file", "err", "story", "blorb", "fetch_storyfile", "Blorb", "identify_blorb_storyfile_format", "engine", "requires", "fetch_vm_resource", "options", "view", "FileView", "read_uploaded_file", "url", "new_url", "parchment"]
}
