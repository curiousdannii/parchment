var tt=(()=>{var ee=import.meta.url;return async function(vr={}){var re,o=vr,ae,B,fr=new Promise((e,r)=>{ae=e,B=r}),_r=typeof WorkerGlobalScope<"u";if(0)var it;let g,L,b,te=()=>{};o.start=function(e){if(g=e.Dialog,!g.async)throw new Error("Emglken requires an async Dialog library");L=e.GlkOte,e.accept=ur,or(e.arguments),L.init(e)};function ur(e){b&&console.warn("Already have GlkOte event when next event arrives"),b=e,te()}o.locateFile=function(e){try{return new URL(e,import.meta.url).href}catch{return e}};var ie=Object.assign({},o),dr=[],ne="./this.program",le=(e,r)=>{throw r},m="";function yr(e){return o.locateFile?o.locateFile(e,m):m+e}var se,oe;if(0)var nt,lt;else _r?m=self.location.href:typeof document<"u"&&document.currentScript&&(m=document.currentScript.src),ee&&(m=ee),m.startsWith("blob:")?m="":m=m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1),se=async e=>{var r=await fetch(e,{credentials:"same-origin"});if(r.ok)return r.arrayBuffer();throw new Error(r.status+" : "+r.url)};var mr=console.log.bind(console),A=console.error.bind(console);Object.assign(o,ie),ie=null;var j=o.wasmBinary,M,w=!1,U,h,p,hr,pr,k,d,gr,wr;function ce(){var e=M.buffer;h=new Int8Array(e),hr=new Int16Array(e),p=new Uint8Array(e),pr=new Uint16Array(e),k=new Int32Array(e),d=new Uint32Array(e),gr=new Float32Array(e),wr=new Float64Array(e)}var kr=[],ve=[],Cr=[],Sr=[],Rr=[],br=!1,H=!1;function Ar(){I(kr)}function Er(){br=!0,I(ve)}function Nr(){I(Cr)}function Tr(){je(),I(Sr),Ea(),H=!0}function Ir(){I(Rr)}function Dr(e){ve.unshift(e)}var E=0,N=null;function Fr(e){E++}function jr(e){if(E--,E==0&&N){var r=N;N=null,r()}}function T(e){e="Aborted("+e+")",A(e),w=!0,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw B(r),r}var Mr="data:application/octet-stream;base64,",fe=e=>e.startsWith(Mr),st=e=>e.startsWith("file://");function Ur(){if(o.locateFile){var e="glulxe.wasm";return fe(e)?e:yr(e)}return new URL("glulxe.wasm",import.meta.url).href}var V;function Pr(e){if(e==V&&j)return new Uint8Array(j);if(oe)return oe(e);throw"both async and sync fetching of the wasm failed"}async function Or(e){if(!j)try{var r=await se(e);return new Uint8Array(r)}catch{}return Pr(e)}async function xr(e,r){try{var a=await Or(e),t=await WebAssembly.instantiate(a,r);return t}catch(i){A(`failed to asynchronously prepare wasm: ${i}`),T(i)}}async function Wr(e,r,a){if(!e&&typeof WebAssembly.instantiateStreaming=="function"&&!fe(r)&&typeof fetch=="function")try{var t=fetch(r,{credentials:"same-origin"}),i=await WebAssembly.instantiateStreaming(t,a);return i}catch(n){A(`wasm streaming compile failed: ${n}`),A("falling back to ArrayBuffer instantiation")}return xr(r,a)}function Br(){return{a:Pa}}async function Lr(){function e(i,n){return v=i.exports,v=l.instrumentWasmExports(v),M=v._,ce(),Fa=v.da,Dr(v.$),jr("wasm-instantiate"),v}Fr("wasm-instantiate");function r(i){e(i.instance)}var a=Br();V??=Ur();try{var t=await Wr(j,V,a);return r(t),t}catch(i){B(i);return}}var C,q;class _e{name="ExitStatus";constructor(r){this.message=`Program terminated with exit(${r})`,this.status=r}}var I=e=>{for(;e.length>0;)e.shift()(o)},_=e=>Oe(e),u=()=>We(),Hr=(e,r)=>(a=>Q(e,a))(r),S=0;class ue{constructor(r){this.excPtr=r,this.ptr=r-24}set_type(r){d[this.ptr+4>>2]=r}get_type(){return d[this.ptr+4>>2]}set_destructor(r){d[this.ptr+8>>2]=r}get_destructor(){return d[this.ptr+8>>2]}set_caught(r){r=r?1:0,h[this.ptr+12]=r}get_caught(){return h[this.ptr+12]!=0}set_rethrown(r){r=r?1:0,h[this.ptr+13]=r}get_rethrown(){return h[this.ptr+13]!=0}init(r,a){this.set_adjusted_ptr(0),this.set_type(r),this.set_destructor(a)}set_adjusted_ptr(r){d[this.ptr+16>>2]=r}get_adjusted_ptr(){return d[this.ptr+16>>2]}}var Vr=e=>{throw S||(S=e),S},P=e=>Pe(e),qr=e=>{var r=S;if(!r)return P(0),0;var a=new ue(r);a.set_adjusted_ptr(r);var t=a.get_type();if(!t)return P(0),r;for(var i of e){if(i===0||i===t)break;var n=a.ptr+16;if(Be(i,t,n))return P(i),r}return P(t),r},zr=()=>qr([]),$r=0,Gr=(e,r,a)=>{var t=new ue(e);throw t.init(r,a),S=e,$r++,S},Kr=(e,r)=>{},Jr=e=>{for(var r=0,a=0;a<e.length;++a){var t=e.charCodeAt(a);t<=127?r++:t<=2047?r+=2:t>=55296&&t<=57343?(r+=4,++a):r+=3}return r},Xr=(e,r,a,t)=>{if(!(t>0))return 0;for(var i=a,n=a+t-1,s=0;s<e.length;++s){var c=e.charCodeAt(s);if(c>=55296&&c<=57343){var y=e.charCodeAt(++s);c=65536+((c&1023)<<10)|y&1023}if(c<=127){if(a>=n)break;r[a++]=c}else if(c<=2047){if(a+1>=n)break;r[a++]=192|c>>6,r[a++]=128|c&63}else if(c<=65535){if(a+2>=n)break;r[a++]=224|c>>12,r[a++]=128|c>>6&63,r[a++]=128|c&63}else{if(a+3>=n)break;r[a++]=240|c>>18,r[a++]=128|c>>12&63,r[a++]=128|c>>6&63,r[a++]=128|c&63}}return r[a]=0,a-i},Yr=(e,r,a)=>Xr(e,p,r,a),Qr=(e,r)=>{},Zr=(e,r)=>{},ea=(e,r,a,t)=>{},de=new TextDecoder,R=(e,r)=>{if(!e)return"";for(var a=e+r,t=e;!(t>=a)&&p[t];)++t;return de.decode(p.subarray(e,t))},ra={varargs:void 0,getStr(e){var r=R(e);return r}};function aa(e,r,a,t){ra.varargs=t}var ta=(e,r)=>{},ia=()=>T(""),na=(e,r,a)=>p.copyWithin(e,r,r+a),O=0,la=()=>{O=0},D={},z=e=>{if(e instanceof _e||e=="unwind")return U;le(1,e)},$=()=>O>0,ye=e=>{U=e,$()||(w=!0),le(e,new _e(e))},me=(e,r)=>{U=e,$()||Tr(),ye(e)},he=me,sa=()=>{if(!H&&!$())try{he(U)}catch(e){z(e)}},pe=e=>{if(!(H||w))try{e(),sa()}catch(r){z(r)}},ge=()=>performance.now(),oa=(e,r)=>{if(D[e]&&(clearTimeout(D[e].id),delete D[e]),!r)return 0;var a=setTimeout(()=>{delete D[e],pe(()=>Ue(e,ge()))},r);return D[e]={id:a,timeout_ms:r},0},we=()=>Date.now(),ca=1,va=e=>e>=0&&e<=3,ke=(e,r)=>r+2097152>>>0<4194305-!!e?(e>>>0)+r*4294967296:NaN;function fa(e,r,a,t){var i=ke(r,a);if(!va(e))return 28;var n;if(e===0)n=we();else if(ca)n=ge();else return 52;var s=Math.round(n*1e3*1e3);return q=[s>>>0,(C=s,+Math.abs(C)>=1?C>0?+Math.floor(C/4294967296)>>>0:~~+Math.ceil((C-+(~~C>>>0))/4294967296)>>>0:0)],k[t>>2]=q[0],k[t+4>>2]=q[1],0}function Ce(e,r){let a=Y(r.length);h.set(r,a),k[e>>2]=a,k[e+4>>2]=r.length}function Se(e,r){let a=JSON.stringify(r);Ce(e,Ua.encode(a))}var Re=function(r,a){return l.handleAsync(async()=>{let t=R(r,a);await g.delete(t)})};Re.isAsync=!0;var be=function(r,a){return l.handleAsync(async()=>{let t=R(r,a);return g.exists(t)})};be.isAsync=!0;var Ae=function(){return l.handleAsync(async()=>{await g.write(X),X={}})};Ae.isAsync=!0;var Ee=function(r,a,t){return l.handleAsync(async()=>{let i=R(r,a),n=await g.read(i);return n?(Ce(t,n),!0):!1})};Ee.isAsync=!0;function _a(e,r,a,t){let i=R(e,r),n=h.subarray(a,a+t);X[i]=n}function ua(e){let r=g.get_dirs();Se(e,r)}var Ne=function(r){return l.handleAsync(async()=>{b||await new Promise(a=>{te=a}),Se(r,b),b=null})};Ne.isAsync=!0;function da(e,r){let a=JSON.parse(R(e,r));L.update(a)}var ya=()=>2147483648,ma=(e,r)=>Math.ceil(e/r)*r,ha=e=>{var r=M.buffer,a=(e-r.byteLength+65535)/65536|0;try{return M.grow(a),ce(),1}catch{}},pa=e=>{var r=p.length;e>>>=0;var a=ya();if(e>a)return!1;for(var t=1;t<=4;t*=2){var i=r*(1+.2/t);i=Math.min(i,e+100663296);var n=Math.min(a,ma(Math.max(e,i),65536)),s=ha(n);if(s)return!0}return!1},G={},ga=()=>ne||"./this.program",F=()=>{if(!F.strings){var e=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:ga()};for(var a in G)G[a]===void 0?delete r[a]:r[a]=G[a];var t=[];for(var a in r)t.push(`${a}=${r[a]}`);F.strings=t}return F.strings},wa=(e,r)=>{for(var a=0;a<e.length;++a)h[r++]=e.charCodeAt(a);h[r]=0},ka=(e,r)=>{var a=0;return F().forEach((t,i)=>{var n=r+a;d[e+i*4>>2]=n,wa(t,n),a+=t.length+1}),0},Ca=(e,r)=>{var a=F();d[e>>2]=a.length;var t=0;return a.forEach(i=>t+=i.length+1),d[r>>2]=t,0},Sa=e=>52,Ra=(e,r,a,t)=>52;function ba(e,r,a,t,i){var n=ke(r,a);return 70}var K=[null,[],[]],Aa=(e,r=0,a=NaN)=>{for(var t=r+a,i=r;e[i]&&!(i>=t);)++i;return de.decode(e.buffer?e.subarray(r,i):new Uint8Array(e.slice(r,i)))},J=(e,r)=>{var a=K[e];r===0||r===10?((e===1?mr:A)(Aa(a)),a.length=0):a.push(r)},Ea=()=>{Me(0),K[1].length&&J(1,10),K[2].length&&J(2,10)},Na=(e,r,a,t)=>{for(var i=0,n=0;n<a;n++){var s=d[r>>2],c=d[r+4>>2];r+=8;for(var y=0;y<c;y++)J(e,p[s+y]);i+=c}return d[t>>2]=i,0},Ta=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return t=>crypto.getRandomValues(t);if(0)try{var e,r,a}catch(t){}T("initRandomDevice")},Te=e=>(Te=Ta())(e),Ia=(e,r)=>(Te(p.subarray(e,e+r)),0),Ie=e=>xe(e),Da=e=>{var r=Jr(e)+1,a=Ie(r);return Yr(e,a,r),a},Fa,x=e=>{try{return e()}catch(r){T(r)}},ja=()=>{O+=1},Ma=()=>{O-=1},l={instrumentWasmImports(e){var r=/^(invoke_.*|__asyncjs__.*)$/;for(let[a,t]of Object.entries(e))if(typeof t=="function"){let i=t.isAsync||r.test(a)}},instrumentWasmExports(e){var r={};for(let[a,t]of Object.entries(e))typeof t=="function"?r[a]=(...i)=>{l.exportCallStack.push(a);try{return t(...i)}finally{if(!w){var n=l.exportCallStack.pop();l.maybeStopUnwind()}}}:r[a]=t;return r},State:{Normal:0,Unwinding:1,Rewinding:2,Disabled:3},state:0,StackSize:8192,currData:null,handleSleepReturnValue:0,exportCallStack:[],callStackNameToId:{},callStackIdToName:{},callStackId:0,asyncPromiseHandlers:null,sleepCallbacks:[],getCallStackId(e){var r=l.callStackNameToId[e];return r===void 0&&(r=l.callStackId++,l.callStackNameToId[e]=r,l.callStackIdToName[r]=e),r},maybeStopUnwind(){l.currData&&l.state===l.State.Unwinding&&l.exportCallStack.length===0&&(l.state=l.State.Normal,ja(),x(nr),typeof Fibers<"u"&&Fibers.trampoline())},whenDone(){return new Promise((e,r)=>{l.asyncPromiseHandlers={resolve:e,reject:r}})},allocateData(){var e=Y(12+l.StackSize);return l.setDataHeader(e,e+12,l.StackSize),l.setDataRewindFunc(e),e},setDataHeader(e,r,a){d[e>>2]=r,d[e+4>>2]=r+a},setDataRewindFunc(e){var r=l.exportCallStack[0],a=l.getCallStackId(r);k[e+8>>2]=a},getDataRewindFuncName(e){var r=k[e+8>>2],a=l.callStackIdToName[r];return a},getDataRewindFunc(e){var r=v[e];return r},doRewind(e){var r=l.getDataRewindFuncName(e),a=l.getDataRewindFunc(r);return Ma(),a()},handleSleep(e){if(!w){if(l.state===l.State.Normal){var r=!1,a=!1;e((t=0)=>{if(!w&&(l.handleSleepReturnValue=t,r=!0,!!a)){l.state=l.State.Rewinding,x(()=>lr(l.currData)),typeof MainLoop<"u"&&MainLoop.func&&MainLoop.resume();var i,n=!1;try{i=l.doRewind(l.currData)}catch(y){i=y,n=!0}var s=!1;if(!l.currData){var c=l.asyncPromiseHandlers;c&&(l.asyncPromiseHandlers=null,(n?c.reject:c.resolve)(i),s=!0)}if(n&&!s)throw i}}),a=!0,r||(l.state=l.State.Unwinding,l.currData=l.allocateData(),typeof MainLoop<"u"&&MainLoop.func&&MainLoop.pause(),x(()=>ir(l.currData)))}else l.state===l.State.Rewinding?(l.state=l.State.Normal,x(sr),De(l.currData),l.currData=null,l.sleepCallbacks.forEach(pe)):T(`invalid state: ${l.state}`);return l.handleSleepReturnValue}},handleAsync(e){return l.handleSleep(r=>{e().then(r)})}};let X={},Ua=new TextEncoder;var Pa={Z:Hr,a:zr,Y:Gr,g:Vr,X:Kr,W:Qr,V:Zr,U:ea,T:aa,S:ta,K:ia,J:na,I:la,H:oa,u:fa,G:Re,F:be,E:Ae,D:Ee,C:_a,B:ua,A:Ne,z:da,y:we,x:pa,R:ka,Q:Ca,w:he,P:Sa,O:Ra,t:ba,N:Na,m:Ja,c:Va,k:Ha,i:Ga,o:Ya,l:Xa,p:Qa,s:Za,r:rt,h:$a,b:xa,d:La,f:Ba,j:qa,e:Wa,n:za,v:Ka,q:et,M:ye,L:Ia},v;Lr();var Oa=()=>(Oa=v.$)(),Y=e=>(Y=v.aa)(e),De=e=>(De=v.ba)(e),Fe=o._main=(e,r)=>(Fe=o._main=v.ca)(e,r),je=()=>(je=v.ea)(),Me=e=>(Me=v.fa)(e),Ue=(e,r)=>(Ue=v.ga)(e,r),f=o._setThrew=(e,r)=>(f=o._setThrew=v.ha)(e,r),Pe=e=>(Pe=v.ia)(e),Oe=e=>(Oe=v.ja)(e),xe=e=>(xe=v.ka)(e),We=()=>(We=v.la)(),Be=(e,r,a)=>(Be=v.ma)(e,r,a),Q=o.dynCall_vi=(e,r)=>(Q=o.dynCall_vi=v.na)(e,r),Le=o.dynCall_iii=(e,r,a)=>(Le=o.dynCall_iii=v.oa)(e,r,a),He=o.dynCall_viiiii=(e,r,a,t,i,n)=>(He=o.dynCall_viiiii=v.pa)(e,r,a,t,i,n),Ve=o.dynCall_viii=(e,r,a,t)=>(Ve=o.dynCall_viii=v.qa)(e,r,a,t),qe=o.dynCall_vii=(e,r,a)=>(qe=o.dynCall_vii=v.ra)(e,r,a),ze=o.dynCall_ii=(e,r)=>(ze=o.dynCall_ii=v.sa)(e,r),$e=o.dynCall_viiii=(e,r,a,t,i)=>($e=o.dynCall_viiii=v.ta)(e,r,a,t,i),Ge=o.dynCall_viiiiii=(e,r,a,t,i,n,s)=>(Ge=o.dynCall_viiiiii=v.ua)(e,r,a,t,i,n,s),Ke=o.dynCall_v=e=>(Ke=o.dynCall_v=v.va)(e),Je=o.dynCall_iiii=(e,r,a,t)=>(Je=o.dynCall_iiii=v.wa)(e,r,a,t),Xe=o.dynCall_iijj=(e,r,a,t,i,n)=>(Xe=o.dynCall_iijj=v.xa)(e,r,a,t,i,n),Ye=o.dynCall_viiiiiii=(e,r,a,t,i,n,s,c)=>(Ye=o.dynCall_viiiiiii=v.ya)(e,r,a,t,i,n,s,c),Qe=o.dynCall_i=e=>(Qe=o.dynCall_i=v.za)(e),Ze=o.dynCall_iiiiii=(e,r,a,t,i,n)=>(Ze=o.dynCall_iiiiii=v.Aa)(e,r,a,t,i,n),er=o.dynCall_iiiii=(e,r,a,t,i)=>(er=o.dynCall_iiiii=v.Ba)(e,r,a,t,i),rr=o.dynCall_viij=(e,r,a,t,i)=>(rr=o.dynCall_viij=v.Ca)(e,r,a,t,i),ar=o.dynCall_jiij=(e,r,a,t,i)=>(ar=o.dynCall_jiij=v.Da)(e,r,a,t,i),tr=o.dynCall_iiiiiii=(e,r,a,t,i,n,s)=>(tr=o.dynCall_iiiiiii=v.Ea)(e,r,a,t,i,n,s),ir=e=>(ir=v.Fa)(e),nr=()=>(nr=v.Ga)(),lr=e=>(lr=v.Ha)(e),sr=()=>(sr=v.Ia)();function xa(e,r){var a=u();try{Q(e,r)}catch(t){if(_(a),t!==t+0)throw t;f(1,0)}}function Wa(e,r,a,t,i,n){var s=u();try{He(e,r,a,t,i,n)}catch(c){if(_(s),c!==c+0)throw c;f(1,0)}}function Ba(e,r,a,t){var i=u();try{Ve(e,r,a,t)}catch(n){if(_(i),n!==n+0)throw n;f(1,0)}}function La(e,r,a){var t=u();try{qe(e,r,a)}catch(i){if(_(t),i!==i+0)throw i;f(1,0)}}function Ha(e,r,a){var t=u();try{return Le(e,r,a)}catch(i){if(_(t),i!==i+0)throw i;f(1,0)}}function Va(e,r){var a=u();try{return ze(e,r)}catch(t){if(_(a),t!==t+0)throw t;f(1,0)}}function qa(e,r,a,t,i){var n=u();try{$e(e,r,a,t,i)}catch(s){if(_(n),s!==s+0)throw s;f(1,0)}}function za(e,r,a,t,i,n,s){var c=u();try{Ge(e,r,a,t,i,n,s)}catch(y){if(_(c),y!==y+0)throw y;f(1,0)}}function $a(e){var r=u();try{Ke(e)}catch(a){if(_(r),a!==a+0)throw a;f(1,0)}}function Ga(e,r,a,t){var i=u();try{return Je(e,r,a,t)}catch(n){if(_(i),n!==n+0)throw n;f(1,0)}}function Ka(e,r,a,t,i,n,s,c){var y=u();try{Ye(e,r,a,t,i,n,s,c)}catch(Z){if(_(y),Z!==Z+0)throw Z;f(1,0)}}function Ja(e){var r=u();try{return Qe(e)}catch(a){if(_(r),a!==a+0)throw a;f(1,0)}}function Xa(e,r,a,t,i,n){var s=u();try{return Ze(e,r,a,t,i,n)}catch(c){if(_(s),c!==c+0)throw c;f(1,0)}}function Ya(e,r,a,t,i){var n=u();try{return er(e,r,a,t,i)}catch(s){if(_(n),s!==s+0)throw s;f(1,0)}}function Qa(e,r,a,t,i,n,s){var c=u();try{return tr(e,r,a,t,i,n,s)}catch(y){if(_(c),y!==y+0)throw y;f(1,0)}}function Za(e,r,a,t,i,n){var s=u();try{return Xe(e,r,a,t,i,n)}catch(c){if(_(s),c!==c+0)throw c;f(1,0)}}function et(e,r,a,t,i){var n=u();try{rr(e,r,a,t,i)}catch(s){if(_(n),s!==s+0)throw s;f(1,0)}}function rt(e,r,a,t,i){var n=u();try{return ar(e,r,a,t,i)}catch(s){if(_(n),s!==s+0)throw s;f(1,0)}}var W;N=function e(){W||cr(),W||(N=e)};function or(e=[]){var r=Fe;e.unshift(ne);var a=e.length,t=Ie((a+1)*4),i=t;e.forEach(s=>{d[i>>2]=Da(s),i+=4}),d[i>>2]=0;try{var n=r(a,t);return me(n,!0),n}catch(s){return z(s)}}function cr(e=dr){if(E>0||(Ar(),E>0))return;function r(){W||(W=!0,o.calledRun=!0,!w&&(Er(),Nr(),ae(o),at&&or(e),Ir()))}r()}var at=!1;return cr(),re=fr,re}})(),ot=tt;export{ot as default};
//# sourceMappingURL=glulxe.js.map
