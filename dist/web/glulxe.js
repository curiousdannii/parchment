async function Kt(ur={}){var L,d=ur;if(0)var Gt;let h,W,R,ee=()=>{};d.start=function(e){if(h=e.Dialog,!h.async)throw new Error("Emglken requires an async Dialog library");W=e.GlkOte,e.accept=_r,fr(e.arguments),W.init(e)};function _r(e){R&&console.warn("Already have GlkOte event when next event arrives"),R=e,ee()}d.locateFile=function(e){try{return new URL(e,import.meta.url).href}catch{return e}};var vr=[],re="./this.program",te=(e,r)=>{throw r},yr=import.meta.url,H="";function dr(e){return d.locateFile?d.locateFile(e,H):H+e}var ne,ie;if(0)var Xt;else{try{H=new URL(".",yr).href}catch{}ne=async e=>{var r=await fetch(e,{credentials:"same-origin"});if(r.ok)return r.arrayBuffer();throw new Error(r.status+" : "+r.url)}}var mr=console.log.bind(console),C=console.error.bind(console),F,p=!1,I,Yt=e=>e.startsWith("file://"),ae,ce,w,k,hr,gr,N,v,pr,wr,le,kr,oe=!1,z=!1;function se(){var e=E.buffer;w=new Int8Array(e),hr=new Int16Array(e),k=new Uint8Array(e),gr=new Uint16Array(e),N=new Int32Array(e),v=new Uint32Array(e),pr=new Float32Array(e),wr=new Float64Array(e),le=new BigInt64Array(e),kr=new BigUint64Array(e)}function Qt(){}function Sr(){oe=!0,S.aa()}function Zt(){}function br(){Ie(),vt(),z=!0}function xt(){}function M(e){e="Aborted("+e+")",C(e),p=!0,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw ce?.(r),r}var V;function Ar(){return d.locateFile?dr("glulxe.wasm"):new URL("glulxe.wasm",import.meta.url).href}function Rr(e){if(e==V&&F)return new Uint8Array(F);if(ie)return ie(e);throw"both async and sync fetching of the wasm failed"}async function Cr(e){if(!F)try{var r=await ne(e);return new Uint8Array(r)}catch{}return Rr(e)}async function Fr(e,r){try{var t=await Cr(e),n=await WebAssembly.instantiate(t,r);return n}catch(i){C(`failed to asynchronously prepare wasm: ${i}`),M(i)}}async function Nr(e,r,t){if(!e)try{var n=fetch(r,{credentials:"same-origin"}),i=await WebAssembly.instantiateStreaming(n,t);return i}catch(a){C(`wasm streaming compile failed: ${a}`),C("falling back to ArrayBuffer instantiation")}return Fr(r,t)}function Tr(){return{a:bt}}async function jr(){function e(a,o){return S=a.exports,S=c.instrumentWasmExports(S),St(S),se(),S}function r(a){return e(a.instance)}var t=Tr();V??=Ar();var n=await Nr(F,V,t),i=r(n);return i}class fe{name="ExitStatus";constructor(r){this.message=`Program terminated with exit(${r})`,this.status=r}}var f={},u=e=>Oe(e),_=()=>Be(),Ur=(e,r)=>(t=>Z(e,t))(r),b=0;class ue{constructor(r){this.excPtr=r,this.ptr=r-24}set_type(r){v[this.ptr+4>>2]=r}get_type(){return v[this.ptr+4>>2]}set_destructor(r){v[this.ptr+8>>2]=r}get_destructor(){return v[this.ptr+8>>2]}set_caught(r){r=r?1:0,w[this.ptr+12]=r}get_caught(){return w[this.ptr+12]!=0}set_rethrown(r){r=r?1:0,w[this.ptr+13]=r}get_rethrown(){return w[this.ptr+13]!=0}init(r,t){this.set_adjusted_ptr(0),this.set_type(r),this.set_destructor(t)}set_adjusted_ptr(r){v[this.ptr+16>>2]=r}get_adjusted_ptr(){return v[this.ptr+16>>2]}}var D=e=>Pe(e),Ir=e=>{var r=b;if(!r)return D(0),0;var t=new ue(r);t.set_adjusted_ptr(r);var n=t.get_type();if(!n)return D(0),r;for(var i of e){if(i===0||i===n)break;var a=t.ptr+16;if(Le(i,n,a))return D(i),r}return D(n),r},Mr=()=>Ir([]),Dr=0,Pr=(e,r,t)=>{var n=new ue(e);throw n.init(r,t),b=e,Dr++,b},Or=e=>{throw b||(b=e),b},Er=(e,r)=>{},Br=()=>M(""),P=0,Lr=()=>{P=0},T={},q=e=>{if(e instanceof fe||e=="unwind")return I;te(1,e)},$=()=>P>0,_e=e=>{I=e,$()||(p=!0),te(e,new fe(e))},ve=(e,r)=>{I=e,$()||br(),_e(e)},ye=ve,Wr=()=>{if(!z&&!$())try{ye(I)}catch(e){q(e)}},de=e=>{if(!(z||p))try{e(),Wr()}catch(r){q(r)}},me=()=>performance.now(),Hr=(e,r)=>{if(T[e]&&(clearTimeout(T[e].id),delete T[e]),!r)return 0;var t=setTimeout(()=>{delete T[e],de(()=>De(e,me()))},r);return T[e]={id:t,timeout_ms:r},0},he=()=>Date.now(),zr=1,Vr=e=>e>=0&&e<=3,qr=9007199254740992,$r=-9007199254740992,Jr=e=>e<$r||e>qr?NaN:Number(e);function Kr(e,r,t){if(r=Jr(r),!Vr(e))return 28;var n;if(e===0)n=he();else if(zr)n=me();else return 52;var i=Math.round(n*1e3*1e3);return le[t>>3]=BigInt(i),0}var j=function(r,t,n,i,a){let o=r>>2,l=v.subarray(o,o+n),y=a?l:l.reduce((x,Jt)=>x+String.fromCodePoint(Jt),""),g=i(y),B=Uint32Array.from(g,x=>x.codePointAt(0)),m=B.length;return v.set(B.subarray(0,Math.min(t,m)),o),m};function ge(e,r){let t=Q(r.length);w.set(r,t),N[e>>2]=t,N[e+4>>2]=r.length}function J(e,r){let t=JSON.stringify(r);ge(e,wt.encode(t))}var Gr=function(r,t,n){return j(r,t,n,i=>i.normalize("NFD"))},Xr=function(r,t,n){return j(r,t,n,i=>i.normalize("NFC"))},Yr=function(r,t,n){return j(r,t,n,i=>i.toLowerCase())},Qr=function(r,t,n,i){return j(r,t,n,a=>a.reduce((o,l,y)=>{let g={\u00DF:"Ss",\u01C4:"\u01C5",\u01C5:"\u01C5",\u01C6:"\u01C5",\u01C7:"\u01C8",\u01C8:"\u01C8",\u01C9:"\u01C8",\u01CA:"\u01CB",\u01CB:"\u01CB",\u01CC:"\u01CB",\u01F1:"\u01F2",\u01F2:"\u01F2",\u01F3:"\u01F2",\u0587:"\u0535\u0582",\u1FB2:"\u1FBA\u0345",\u1FB3:"\u1FBC",\u1FB4:"\u0386\u0345",\u1FB7:"\u0391\u0342\u0345",\u1FBC:"\u1FBC",\u1FC2:"\u1FCA\u0345",\u1FC3:"\u1FCC",\u1FC4:"\u0389\u0345",\u1FC7:"\u0397\u0342\u0345",\u1FCC:"\u1FCC",\u1FF2:"\u1FFA\u0345",\u1FF3:"\u1FFC",\u1FF4:"\u038F\u0345",\u1FF7:"\u03A9\u0342\u0345",\u1FFC:"\u1FFC",\uFB00:"Ff",\uFB01:"Fi",\uFB02:"Fl",\uFB03:"Ffi",\uFB04:"Ffl",\uFB05:"St",\uFB06:"St",\uFB13:"\u0544\u0576",\uFB14:"\u0544\u0565",\uFB15:"\u0544\u056B",\uFB16:"\u054E\u0576",\uFB17:"\u0544\u056D"},B=["\u1F88\u1F89\u1F8A\u1F8B\u1F8C\u1F8D\u1F8E\u1F8F","\u1F98\u1F99\u1F9A\u1F9B\u1F9C\u1F9D\u1F9E\u1F9F","\u1FA8\u1FA9\u1FAA\u1FAB\u1FAC\u1FAD\u1FAE\u1FAF"],m=String.fromCodePoint(l);return y===0?g[m]?m=g[m]:l>=8064&&l<8112?m=B[(l-8064)/16|0][l%8]:m=m.toUpperCase():i&&(m=m.toLowerCase()),o+m},""),1)},Zr=function(r,t,n){return j(r,t,n,i=>i.toUpperCase())},pe=new TextDecoder,we=(e,r,t,n)=>{var i=r+t;if(n)return i;for(;e[r]&&!(r>=i);)++r;return r},A=(e,r,t)=>{if(!e)return"";var n=we(k,e,r,t);return pe.decode(k.subarray(e,n))},ke=function(r,t){return c.handleAsync(async()=>{let n=A(r,t);await h.delete(n)})};ke.isAsync=!0;var Se=function(r,t){return c.handleAsync(async()=>{let n=A(r,t);return h.exists(n)})};Se.isAsync=!0;var be=function(){return c.handleAsync(async()=>{await h.write(Y),Y={}})};be.isAsync=!0;var Ae=function(r,t,n){return c.handleAsync(async()=>{let i=A(r,t),a=await h.read(i);return a?(ge(n,a),!0):!1})};Ae.isAsync=!0;function xr(e,r,t,n){let i=A(e,r),a=w.subarray(t,t+n);Y[i]=a}function et(e){let r=h.get_dirs();J(e,r)}var Re=function(r){return c.handleAsync(async()=>{R||await new Promise(t=>{ee=t}),J(r,R),R=null})};Re.isAsync=!0;function rt(){return new Date().getTimezoneOffset()*-60}function tt(e,r){let t=JSON.parse(A(e,r));W.update(t)}function nt(e,r,t){let n=A(e,r),i=h.set_storyfile_dir(n);J(t,i)}var it=()=>2147483648,at=(e,r)=>Math.ceil(e/r)*r,ct=e=>{var r=E.buffer.byteLength,t=(e-r+65535)/65536|0;try{return E.grow(t),se(),1}catch{}},lt=e=>{var r=k.length;e>>>=0;var t=it();if(e>t)return!1;for(var n=1;n<=4;n*=2){var i=r*(1+.2/n);i=Math.min(i,e+100663296);var a=Math.min(t,at(Math.max(e,i),65536)),o=ct(a);if(o)return!0}return!1},K={},ot=()=>re||"./this.program",U=()=>{if(!U.strings){var e=(typeof navigator=="object"&&navigator.language||"C").replace("-","_")+".UTF-8",r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:ot()};for(var t in K)K[t]===void 0?delete r[t]:r[t]=K[t];var n=[];for(var t in r)n.push(`${t}=${r[t]}`);U.strings=n}return U.strings},st=(e,r,t,n)=>{if(!(n>0))return 0;for(var i=t,a=t+n-1,o=0;o<e.length;++o){var l=e.codePointAt(o);if(l<=127){if(t>=a)break;r[t++]=l}else if(l<=2047){if(t+1>=a)break;r[t++]=192|l>>6,r[t++]=128|l&63}else if(l<=65535){if(t+2>=a)break;r[t++]=224|l>>12,r[t++]=128|l>>6&63,r[t++]=128|l&63}else{if(t+3>=a)break;r[t++]=240|l>>18,r[t++]=128|l>>12&63,r[t++]=128|l>>6&63,r[t++]=128|l&63,o++}}return r[t]=0,t-i},Ce=(e,r,t)=>st(e,k,r,t),ft=(e,r)=>{var t=0,n=0;for(var i of U()){var a=r+t;v[e+n>>2]=a,t+=Ce(i,a,1/0)+1,n+=4}return 0},Fe=e=>{for(var r=0,t=0;t<e.length;++t){var n=e.charCodeAt(t);n<=127?r++:n<=2047?r+=2:n>=55296&&n<=57343?(r+=4,++t):r+=3}return r},ut=(e,r)=>{var t=U();v[e>>2]=t.length;var n=0;for(var i of t)n+=Fe(i)+1;return v[r>>2]=n,0},G=[null,[],[]],_t=(e,r=0,t,n)=>{var i=we(e,r,t,n);return pe.decode(e.buffer?e.subarray(r,i):new Uint8Array(e.slice(r,i)))},X=(e,r)=>{var t=G[e];r===0||r===10?((e===1?mr:C)(_t(t)),t.length=0):t.push(r)},vt=()=>{Me(0),G[1].length&&X(1,10),G[2].length&&X(2,10)},yt=(e,r,t,n)=>{for(var i=0,a=0;a<t;a++){var o=v[r>>2],l=v[r+4>>2];r+=8;for(var y=0;y<l;y++)X(e,k[o+y]);i+=l}return v[n>>2]=i,0},dt=()=>{if(0)var e;return r=>crypto.getRandomValues(r)},Ne=e=>{(Ne=dt())(e)},mt=(e,r)=>(Ne(k.subarray(e,e+r)),0),Te=e=>Ee(e),ht=e=>{var r=Fe(e)+1,t=Te(r);return Ce(e,t,r),t},O=e=>{try{return e()}catch(r){M(r)}},gt=()=>{P+=1},pt=()=>{P-=1},c={instrumentWasmImports(e){var r=/^(invoke_.*|__asyncjs__.*)$/;for(let[t,n]of Object.entries(e))if(typeof n=="function"){let i=n.isAsync||r.test(t)}},instrumentFunction(e){var r=(...t)=>{c.exportCallStack.push(e);try{return e(...t)}finally{if(!p){var n=c.exportCallStack.pop();c.maybeStopUnwind()}}};return c.funcWrappers.set(e,r),r},instrumentWasmExports(e){var r={};for(let[n,i]of Object.entries(e))if(typeof i=="function"){var t=c.instrumentFunction(i);r[n]=t}else r[n]=i;return r},State:{Normal:0,Unwinding:1,Rewinding:2,Disabled:3},state:0,StackSize:8192,currData:null,handleSleepReturnValue:0,exportCallStack:[],callstackFuncToId:new Map,callStackIdToFunc:new Map,funcWrappers:new Map,callStackId:0,asyncPromiseHandlers:null,sleepCallbacks:[],getCallStackId(e){if(!c.callstackFuncToId.has(e)){var r=c.callStackId++;c.callstackFuncToId.set(e,r),c.callStackIdToFunc.set(r,e)}return c.callstackFuncToId.get(e)},maybeStopUnwind(){c.currData&&c.state===c.State.Unwinding&&c.exportCallStack.length===0&&(c.state=c.State.Normal,gt(),O(lr),typeof Fibers<"u"&&Fibers.trampoline())},whenDone(){return new Promise((e,r)=>{c.asyncPromiseHandlers={resolve:e,reject:r}})},allocateData(){var e=Q(12+c.StackSize);return c.setDataHeader(e,e+12,c.StackSize),c.setDataRewindFunc(e),e},setDataHeader(e,r,t){v[e>>2]=r,v[e+4>>2]=r+t},setDataRewindFunc(e){var r=c.exportCallStack[0],t=c.getCallStackId(r);N[e+8>>2]=t},getDataRewindFunc(e){var r=N[e+8>>2],t=c.callStackIdToFunc.get(r);return t},doRewind(e){var r=c.getDataRewindFunc(e),t=c.funcWrappers.get(r);return pt(),t()},handleSleep(e){if(!p){if(c.state===c.State.Normal){var r=!1,t=!1;e((n=0)=>{if(!p&&(c.handleSleepReturnValue=n,r=!0,!!t)){c.state=c.State.Rewinding,O(()=>or(c.currData)),typeof MainLoop<"u"&&MainLoop.func&&MainLoop.resume();var i,a=!1;try{i=c.doRewind(c.currData)}catch(y){i=y,a=!0}var o=!1;if(!c.currData){var l=c.asyncPromiseHandlers;l&&(c.asyncPromiseHandlers=null,(a?l.reject:l.resolve)(i),o=!0)}if(a&&!o)throw i}}),t=!0,r||(c.state=c.State.Unwinding,c.currData=c.allocateData(),typeof MainLoop<"u"&&MainLoop.func&&MainLoop.pause(),O(()=>cr(c.currData)))}else c.state===c.State.Rewinding?(c.state=c.State.Normal,O(sr),je(c.currData),c.currData=null,c.sleepCallbacks.forEach(de)):M(`invalid state: ${c.state}`);return c.handleSleepReturnValue}},handleAsync:e=>c.handleSleep(r=>{e().then(r)})};let Y={},wt=new TextEncoder;d.wasmBinary&&(F=d.wasmBinary);var Q,je,Ue,Ie,Me,De,s,Pe,Oe,Ee,Be,Le,Z,We,He,ze,Ve,qe,$e,Je,Ke,Ge,Xe,Ye,Qe,Ze,xe,er,rr,tr,nr,ir,ar,cr,lr,or,sr,E,kt;function St(e){Q=e.ba,je=e.ca,Ue=d._main=e.da,Ie=e.ea,Me=e.fa,De=e.ga,s=d._setThrew=e.ha,Pe=e.ia,Oe=e.ja,Ee=e.ka,Be=e.la,Le=e.ma,Z=f.vi=e.na,We=f.viiiii=e.oa,He=f.viii=e.pa,ze=f.vii=e.qa,Ve=f.iii=e.ra,qe=f.iiii=e.sa,$e=f.ii=e.ta,Je=f.viiii=e.ua,Ke=f.viiiiii=e.va,Ge=f.iijj=e.wa,Xe=f.jiii=e.xa,Ye=f.viiiiiii=e.ya,Qe=f.iiiiii=e.za,Ze=f.ij=e.Aa,xe=f.iiiii=e.Ba,er=f.iiji=e.Ca,rr=f.i=e.Da,tr=f.iiiiiii=e.Ea,nr=f.vijii=e.Fa,ir=f.v=e.Ga,ar=f.vijjjj=e.Ha,cr=e.Ia,lr=e.Ja,or=e.Ka,sr=e.La,E=e.$,kt=e.__indirect_function_table}var bt={_:Ur,a:Mr,Z:Pr,g:Or,Y:Er,R:Br,Q:Lr,P:Hr,X:Kr,v:Gr,u:Xr,t:Yr,O:Qr,s:Zr,N:ke,M:Se,L:be,K:Ae,J:xr,I:et,H:Re,G:rt,F:tt,E:nt,D:he,C:lt,W:ft,V:ut,B:ye,U:yt,p:Bt,f:Tt,i:It,h:Nt,l:Ot,k:Wt,r:Lt,A:Pt,q:Mt,z:zt,y:Et,o:Vt,b:At,c:Ft,e:Ct,j:jt,d:Rt,m:Ut,x:Dt,n:Ht,w:qt,T:_e,S:mt};function At(e,r){var t=_();try{Z(e,r)}catch(n){if(u(t),n!==n+0)throw n;s(1,0)}}function Rt(e,r,t,n,i,a){var o=_();try{We(e,r,t,n,i,a)}catch(l){if(u(o),l!==l+0)throw l;s(1,0)}}function Ct(e,r,t,n){var i=_();try{He(e,r,t,n)}catch(a){if(u(i),a!==a+0)throw a;s(1,0)}}function Ft(e,r,t){var n=_();try{ze(e,r,t)}catch(i){if(u(n),i!==i+0)throw i;s(1,0)}}function Nt(e,r,t,n){var i=_();try{return qe(e,r,t,n)}catch(a){if(u(i),a!==a+0)throw a;s(1,0)}}function Tt(e,r){var t=_();try{return $e(e,r)}catch(n){if(u(t),n!==n+0)throw n;s(1,0)}}function jt(e,r,t,n,i){var a=_();try{Je(e,r,t,n,i)}catch(o){if(u(a),o!==o+0)throw o;s(1,0)}}function Ut(e,r,t,n,i,a,o){var l=_();try{Ke(e,r,t,n,i,a,o)}catch(y){if(u(l),y!==y+0)throw y;s(1,0)}}function It(e,r,t){var n=_();try{return Ve(e,r,t)}catch(i){if(u(n),i!==i+0)throw i;s(1,0)}}function Mt(e,r,t,n){var i=_();try{return Ge(e,r,t,n)}catch(a){if(u(i),a!==a+0)throw a;s(1,0)}}function Dt(e,r,t,n,i,a,o,l){var y=_();try{Ye(e,r,t,n,i,a,o,l)}catch(g){if(u(y),g!==g+0)throw g;s(1,0)}}function Pt(e,r,t,n){var i=_();try{return er(e,r,t,n)}catch(a){if(u(i),a!==a+0)throw a;s(1,0)}}function Ot(e,r,t,n,i){var a=_();try{return xe(e,r,t,n,i)}catch(o){if(u(a),o!==o+0)throw o;s(1,0)}}function Et(e,r,t,n){var i=_();try{return Xe(e,r,t,n)}catch(a){if(u(i),a!==a+0)throw a;return s(1,0),0n}}function Bt(e){var r=_();try{return rr(e)}catch(t){if(u(r),t!==t+0)throw t;s(1,0)}}function Lt(e,r,t,n,i,a,o){var l=_();try{return tr(e,r,t,n,i,a,o)}catch(y){if(u(l),y!==y+0)throw y;s(1,0)}}function Wt(e,r,t,n,i,a){var o=_();try{return Qe(e,r,t,n,i,a)}catch(l){if(u(o),l!==l+0)throw l;s(1,0)}}function Ht(e,r,t,n,i){var a=_();try{nr(e,r,t,n,i)}catch(o){if(u(a),o!==o+0)throw o;s(1,0)}}function zt(e,r){var t=_();try{return Ze(e,r)}catch(n){if(u(t),n!==n+0)throw n;s(1,0)}}function Vt(e){var r=_();try{ir(e)}catch(t){if(u(r),t!==t+0)throw t;s(1,0)}}function qt(e,r,t,n,i,a){var o=_();try{ar(e,r,t,n,i,a)}catch(l){if(u(o),l!==l+0)throw l;s(1,0)}}function fr(e=[]){var r=Ue;e.unshift(re);var t=e.length,n=Te((t+1)*4),i=n;e.forEach(o=>{v[i>>2]=ht(o),i+=4}),v[i>>2]=0;try{var a=r(t,n);return ve(a,!0),a}catch(o){return q(o)}}function $t(e=vr){function r(){if(d.calledRun=!0,!p){Sr(),ae?.(d);var t=!0;t||fr(e)}}r()}var S;return S=await jr(),$t(),oe?L=d:L=new Promise((e,r)=>{ae=e,ce=r}),L}var en=Kt;export{en as default};
//# sourceMappingURL=glulxe.js.map
