{
  "version": 3,
  "sources": ["../../node_modules/file-saver/src/FileSaver.js", "../../node_modules/js-cookie/dist/js.cookie.mjs", "../../node_modules/lodash-es/_freeGlobal.js", "../../node_modules/lodash-es/_root.js", "../../node_modules/lodash-es/_Symbol.js", "../../node_modules/lodash-es/_getRawTag.js", "../../node_modules/lodash-es/_objectToString.js", "../../node_modules/lodash-es/_baseGetTag.js", "../../node_modules/lodash-es/isObjectLike.js", "../../node_modules/lodash-es/isSymbol.js", "../../node_modules/lodash-es/_arrayMap.js", "../../node_modules/lodash-es/isArray.js", "../../node_modules/lodash-es/_baseToString.js", "../../node_modules/lodash-es/_trimmedEndIndex.js", "../../node_modules/lodash-es/_baseTrim.js", "../../node_modules/lodash-es/isObject.js", "../../node_modules/lodash-es/toNumber.js", "../../node_modules/lodash-es/toString.js", "../../node_modules/lodash-es/_basePropertyOf.js", "../../node_modules/lodash-es/now.js", "../../node_modules/lodash-es/debounce.js", "../../node_modules/lodash-es/throttle.js", "../../node_modules/lodash-es/_unescapeHtmlChar.js", "../../node_modules/lodash-es/unescape.js", "../../src/upstream/asyncglk/src/common/misc.ts", "../../src/upstream/asyncglk/src/blorb/iff.ts", "../../src/upstream/asyncglk/src/blorb/blorb.ts", "../../src/upstream/asyncglk/src/common/constants.ts", "../../src/upstream/asyncglk/src/dialog/common/common.ts", "../../src/upstream/asyncglk/src/glkote/common/glkote.ts", "../../node_modules/fflate/esm/browser.js", "../../src/upstream/asyncglk/src/common/file/browser.ts", "../../src/upstream/asyncglk/src/dialog/browser/browser.ts", "../../node_modules/path-browserify-esm/index.esm.js", "../../node_modules/svelte/src/runtime/internal/utils.js", "../../node_modules/svelte/src/runtime/internal/globals.js", "../../node_modules/svelte/src/runtime/internal/ResizeObserverSingleton.js", "../../node_modules/svelte/src/runtime/internal/dom.js", "../../node_modules/svelte/src/runtime/internal/lifecycle.js", "../../node_modules/svelte/src/runtime/internal/scheduler.js", "../../node_modules/svelte/src/runtime/internal/transitions.js", "../../node_modules/svelte/src/runtime/internal/each.js", "../../node_modules/svelte/src/shared/boolean_attributes.js", "../../node_modules/svelte/src/runtime/internal/Component.js", "../../node_modules/svelte/src/shared/version.js", "../../node_modules/svelte/src/runtime/internal/disclose-version/index.js", "../../src/upstream/asyncglk/src/dialog/browser/ui/BaseDialog.svelte", "../../src/upstream/asyncglk/src/dialog/browser/ui/AlertDialog.svelte", "../../src/upstream/asyncglk/src/dialog/browser/common.ts", "../../src/upstream/asyncglk/src/dialog/browser/download.ts", "../../node_modules/base32768/src/index.js", "../../src/upstream/asyncglk/src/dialog/browser/storage.ts", "../../src/upstream/asyncglk/src/dialog/browser/ui/DirTree.svelte", "../../src/upstream/asyncglk/src/dialog/browser/ui/FileListItem.svelte", "../../src/upstream/asyncglk/src/dialog/browser/ui/FileDialog.svelte", "../../src/upstream/asyncglk/src/glkote/web/shared.ts", "../../src/upstream/asyncglk/src/glkote/web/metrics.ts", "../../src/upstream/asyncglk/src/glkaudio/pkg/glkaudio.js", "../../src/upstream/asyncglk/src/glkote/web/schannels.ts", "../../node_modules/body-scroll-lock/lib/bodyScrollLock.esm.js", "../../src/upstream/asyncglk/src/glkote/web/input.ts", "../../src/upstream/asyncglk/src/glkote/web/windows.ts", "../../src/upstream/asyncglk/src/glkote/web/transcript-recorder.ts", "../../src/upstream/asyncglk/src/glkote/web/web.ts", "../../src/upstream/emglken/build/file-sizes.json", "../../src/common/formats.ts", "../../src/common/options.ts", "../../node_modules/pretty-bytes/index.js", "../../src/common/ui/LoadingPane.svelte", "../../src/common/launcher.ts"],
  "sourcesContent": ["/*\n* FileSaver.js\n* A saveAs() FileSaver implementation.\n*\n* By Eli Grey, http://eligrey.com\n*\n* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\n* source  : http://purl.eligrey.com/github/FileSaver.js\n*/\n\n// The one and only way of getting global scope in all environments\n// https://stackoverflow.com/q/3277182/1008999\nvar _global = typeof window === 'object' && window.window === window\n  ? window : typeof self === 'object' && self.self === self\n  ? self : typeof global === 'object' && global.global === global\n  ? global\n  : this\n\nfunction bom (blob, opts) {\n  if (typeof opts === 'undefined') opts = { autoBom: false }\n  else if (typeof opts !== 'object') {\n    console.warn('Deprecated: Expected third argument to be a object')\n    opts = { autoBom: !opts }\n  }\n\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n  if (opts.autoBom && /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })\n  }\n  return blob\n}\n\nfunction download (url, name, opts) {\n  var xhr = new XMLHttpRequest()\n  xhr.open('GET', url)\n  xhr.responseType = 'blob'\n  xhr.onload = function () {\n    saveAs(xhr.response, name, opts)\n  }\n  xhr.onerror = function () {\n    console.error('could not download file')\n  }\n  xhr.send()\n}\n\nfunction corsEnabled (url) {\n  var xhr = new XMLHttpRequest()\n  // use sync to avoid popup blocker\n  xhr.open('HEAD', url, false)\n  try {\n    xhr.send()\n  } catch (e) {}\n  return xhr.status >= 200 && xhr.status <= 299\n}\n\n// `a.click()` doesn't work for all browsers (#465)\nfunction click (node) {\n  try {\n    node.dispatchEvent(new MouseEvent('click'))\n  } catch (e) {\n    var evt = document.createEvent('MouseEvents')\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,\n                          20, false, false, false, false, 0, null)\n    node.dispatchEvent(evt)\n  }\n}\n\n// Detect WebView inside a native macOS app by ruling out all browsers\n// We just need to check for 'Safari' because all other browsers (besides Firefox) include that too\n// https://www.whatismybrowser.com/guides/the-latest-user-agent/macos\nvar isMacOSWebView = _global.navigator && /Macintosh/.test(navigator.userAgent) && /AppleWebKit/.test(navigator.userAgent) && !/Safari/.test(navigator.userAgent)\n\nvar saveAs = _global.saveAs || (\n  // probably in some web worker\n  (typeof window !== 'object' || window !== _global)\n    ? function saveAs () { /* noop */ }\n\n  // Use download attribute first if possible (#193 Lumia mobile) unless this is a macOS WebView\n  : ('download' in HTMLAnchorElement.prototype && !isMacOSWebView)\n  ? function saveAs (blob, name, opts) {\n    var URL = _global.URL || _global.webkitURL\n    var a = document.createElement('a')\n    name = name || blob.name || 'download'\n\n    a.download = name\n    a.rel = 'noopener' // tabnabbing\n\n    // TODO: detect chrome extensions & packaged apps\n    // a.target = '_blank'\n\n    if (typeof blob === 'string') {\n      // Support regular links\n      a.href = blob\n      if (a.origin !== location.origin) {\n        corsEnabled(a.href)\n          ? download(blob, name, opts)\n          : click(a, a.target = '_blank')\n      } else {\n        click(a)\n      }\n    } else {\n      // Support blobs\n      a.href = URL.createObjectURL(blob)\n      setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s\n      setTimeout(function () { click(a) }, 0)\n    }\n  }\n\n  // Use msSaveOrOpenBlob as a second approach\n  : 'msSaveOrOpenBlob' in navigator\n  ? function saveAs (blob, name, opts) {\n    name = name || blob.name || 'download'\n\n    if (typeof blob === 'string') {\n      if (corsEnabled(blob)) {\n        download(blob, name, opts)\n      } else {\n        var a = document.createElement('a')\n        a.href = blob\n        a.target = '_blank'\n        setTimeout(function () { click(a) })\n      }\n    } else {\n      navigator.msSaveOrOpenBlob(bom(blob, opts), name)\n    }\n  }\n\n  // Fallback to using FileReader and a popup\n  : function saveAs (blob, name, opts, popup) {\n    // Open a popup immediately do go around popup blocker\n    // Mostly only available on user interaction and the fileReader is async so...\n    popup = popup || open('', '_blank')\n    if (popup) {\n      popup.document.title =\n      popup.document.body.innerText = 'downloading...'\n    }\n\n    if (typeof blob === 'string') return download(blob, name, opts)\n\n    var force = blob.type === 'application/octet-stream'\n    var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari\n    var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent)\n\n    if ((isChromeIOS || (force && isSafari) || isMacOSWebView) && typeof FileReader !== 'undefined') {\n      // Safari doesn't allow downloading of blob URLs\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        var url = reader.result\n        url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')\n        if (popup) popup.location.href = url\n        else location = url\n        popup = null // reverse-tabnabbing #460\n      }\n      reader.readAsDataURL(blob)\n    } else {\n      var URL = _global.URL || _global.webkitURL\n      var url = URL.createObjectURL(blob)\n      if (popup) popup.location = url\n      else location.href = url\n      popup = null // reverse-tabnabbing #460\n      setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s\n    }\n  }\n)\n\n_global.saveAs = saveAs.saveAs = saveAs\n\nif (typeof module !== 'undefined') {\n  module.exports = saveAs;\n}\n", "/*! js-cookie v3.0.5 | MIT */\n/* eslint-disable no-var */\nfunction assign (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      target[key] = source[key];\n    }\n  }\n  return target\n}\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\nvar defaultConverter = {\n  read: function (value) {\n    if (value[0] === '\"') {\n      value = value.slice(1, -1);\n    }\n    return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n  },\n  write: function (value) {\n    return encodeURIComponent(value).replace(\n      /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n      decodeURIComponent\n    )\n  }\n};\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\n\nfunction init (converter, defaultAttributes) {\n  function set (name, value, attributes) {\n    if (typeof document === 'undefined') {\n      return\n    }\n\n    attributes = assign({}, defaultAttributes, attributes);\n\n    if (typeof attributes.expires === 'number') {\n      attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n    }\n    if (attributes.expires) {\n      attributes.expires = attributes.expires.toUTCString();\n    }\n\n    name = encodeURIComponent(name)\n      .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n      .replace(/[()]/g, escape);\n\n    var stringifiedAttributes = '';\n    for (var attributeName in attributes) {\n      if (!attributes[attributeName]) {\n        continue\n      }\n\n      stringifiedAttributes += '; ' + attributeName;\n\n      if (attributes[attributeName] === true) {\n        continue\n      }\n\n      // Considers RFC 6265 section 5.2:\n      // ...\n      // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n      //     character:\n      // Consume the characters of the unparsed-attributes up to,\n      // not including, the first %x3B (\";\") character.\n      // ...\n      stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n    }\n\n    return (document.cookie =\n      name + '=' + converter.write(value, name) + stringifiedAttributes)\n  }\n\n  function get (name) {\n    if (typeof document === 'undefined' || (arguments.length && !name)) {\n      return\n    }\n\n    // To prevent the for loop in the first place assign an empty array\n    // in case there are no cookies at all.\n    var cookies = document.cookie ? document.cookie.split('; ') : [];\n    var jar = {};\n    for (var i = 0; i < cookies.length; i++) {\n      var parts = cookies[i].split('=');\n      var value = parts.slice(1).join('=');\n\n      try {\n        var found = decodeURIComponent(parts[0]);\n        jar[found] = converter.read(value, found);\n\n        if (name === found) {\n          break\n        }\n      } catch (e) {}\n    }\n\n    return name ? jar[name] : jar\n  }\n\n  return Object.create(\n    {\n      set,\n      get,\n      remove: function (name, attributes) {\n        set(\n          name,\n          '',\n          assign({}, attributes, {\n            expires: -1\n          })\n        );\n      },\n      withAttributes: function (attributes) {\n        return init(this.converter, assign({}, this.attributes, attributes))\n      },\n      withConverter: function (converter) {\n        return init(assign({}, this.converter, converter), this.attributes)\n      }\n    },\n    {\n      attributes: { value: Object.freeze(defaultAttributes) },\n      converter: { value: Object.freeze(converter) }\n    }\n  )\n}\n\nvar api = init(defaultConverter, { path: '/' });\n/* eslint-enable no-var */\n\nexport { api as default };\n", "/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n", "import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n", "import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n", "import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n", "/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n", "import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n", "/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n", "import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nexport default isSymbol;\n", "/**\n * A specialized version of `_.map` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the new mapped array.\n */\nfunction arrayMap(array, iteratee) {\n  var index = -1,\n      length = array == null ? 0 : array.length,\n      result = Array(length);\n\n  while (++index < length) {\n    result[index] = iteratee(array[index], index, array);\n  }\n  return result;\n}\n\nexport default arrayMap;\n", "/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nexport default isArray;\n", "import Symbol from './_Symbol.js';\nimport arrayMap from './_arrayMap.js';\nimport isArray from './isArray.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolToString = symbolProto ? symbolProto.toString : undefined;\n\n/**\n * The base implementation of `_.toString` which doesn't convert nullish\n * values to empty strings.\n *\n * @private\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n */\nfunction baseToString(value) {\n  // Exit early for strings to avoid a performance hit in some environments.\n  if (typeof value == 'string') {\n    return value;\n  }\n  if (isArray(value)) {\n    // Recursively convert values (susceptible to call stack limits).\n    return arrayMap(value, baseToString) + '';\n  }\n  if (isSymbol(value)) {\n    return symbolToString ? symbolToString.call(value) : '';\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\nexport default baseToString;\n", "/** Used to match a single whitespace character. */\nvar reWhitespace = /\\s/;\n\n/**\n * Used by `_.trim` and `_.trimEnd` to get the index of the last non-whitespace\n * character of `string`.\n *\n * @private\n * @param {string} string The string to inspect.\n * @returns {number} Returns the index of the last non-whitespace character.\n */\nfunction trimmedEndIndex(string) {\n  var index = string.length;\n\n  while (index-- && reWhitespace.test(string.charAt(index))) {}\n  return index;\n}\n\nexport default trimmedEndIndex;\n", "import trimmedEndIndex from './_trimmedEndIndex.js';\n\n/** Used to match leading whitespace. */\nvar reTrimStart = /^\\s+/;\n\n/**\n * The base implementation of `_.trim`.\n *\n * @private\n * @param {string} string The string to trim.\n * @returns {string} Returns the trimmed string.\n */\nfunction baseTrim(string) {\n  return string\n    ? string.slice(0, trimmedEndIndex(string) + 1).replace(reTrimStart, '')\n    : string;\n}\n\nexport default baseTrim;\n", "/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n", "import baseTrim from './_baseTrim.js';\nimport isObject from './isObject.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = baseTrim(value);\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nexport default toNumber;\n", "import baseToString from './_baseToString.js';\n\n/**\n * Converts `value` to a string. An empty string is returned for `null`\n * and `undefined` values. The sign of `-0` is preserved.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n * @example\n *\n * _.toString(null);\n * // => ''\n *\n * _.toString(-0);\n * // => '-0'\n *\n * _.toString([1, 2, 3]);\n * // => '1,2,3'\n */\nfunction toString(value) {\n  return value == null ? '' : baseToString(value);\n}\n\nexport default toString;\n", "/**\n * The base implementation of `_.propertyOf` without support for deep paths.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Function} Returns the new accessor function.\n */\nfunction basePropertyOf(object) {\n  return function(key) {\n    return object == null ? undefined : object[key];\n  };\n}\n\nexport default basePropertyOf;\n", "import root from './_root.js';\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nexport default now;\n", "import isObject from './isObject.js';\nimport now from './now.js';\nimport toNumber from './toNumber.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nexport default debounce;\n", "import debounce from './debounce.js';\nimport isObject from './isObject.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a throttled function that only invokes `func` at most once per\n * every `wait` milliseconds. The throttled function comes with a `cancel`\n * method to cancel delayed `func` invocations and a `flush` method to\n * immediately invoke them. Provide `options` to indicate whether `func`\n * should be invoked on the leading and/or trailing edge of the `wait`\n * timeout. The `func` is invoked with the last arguments provided to the\n * throttled function. Subsequent calls to the throttled function return the\n * result of the last `func` invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the throttled function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.throttle` and `_.debounce`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to throttle.\n * @param {number} [wait=0] The number of milliseconds to throttle invocations to.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=true]\n *  Specify invoking on the leading edge of the timeout.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new throttled function.\n * @example\n *\n * // Avoid excessively updating the position while scrolling.\n * jQuery(window).on('scroll', _.throttle(updatePosition, 100));\n *\n * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.\n * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });\n * jQuery(element).on('click', throttled);\n *\n * // Cancel the trailing throttled invocation.\n * jQuery(window).on('popstate', throttled.cancel);\n */\nfunction throttle(func, wait, options) {\n  var leading = true,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  if (isObject(options)) {\n    leading = 'leading' in options ? !!options.leading : leading;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n  return debounce(func, wait, {\n    'leading': leading,\n    'maxWait': wait,\n    'trailing': trailing\n  });\n}\n\nexport default throttle;\n", "import basePropertyOf from './_basePropertyOf.js';\n\n/** Used to map HTML entities to characters. */\nvar htmlUnescapes = {\n  '&amp;': '&',\n  '&lt;': '<',\n  '&gt;': '>',\n  '&quot;': '\"',\n  '&#39;': \"'\"\n};\n\n/**\n * Used by `_.unescape` to convert HTML entities to characters.\n *\n * @private\n * @param {string} chr The matched character to unescape.\n * @returns {string} Returns the unescaped character.\n */\nvar unescapeHtmlChar = basePropertyOf(htmlUnescapes);\n\nexport default unescapeHtmlChar;\n", "import toString from './toString.js';\nimport unescapeHtmlChar from './_unescapeHtmlChar.js';\n\n/** Used to match HTML entities and HTML characters. */\nvar reEscapedHtml = /&(?:amp|lt|gt|quot|#39);/g,\n    reHasEscapedHtml = RegExp(reEscapedHtml.source);\n\n/**\n * The inverse of `_.escape`; this method converts the HTML entities\n * `&amp;`, `&lt;`, `&gt;`, `&quot;`, and `&#39;` in `string` to\n * their corresponding characters.\n *\n * **Note:** No other HTML entities are unescaped. To unescape additional\n * HTML entities use a third-party library like [_he_](https://mths.be/he).\n *\n * @static\n * @memberOf _\n * @since 0.6.0\n * @category String\n * @param {string} [string=''] The string to unescape.\n * @returns {string} Returns the unescaped string.\n * @example\n *\n * _.unescape('fred, barney, &amp; pebbles');\n * // => 'fred, barney, & pebbles'\n */\nfunction unescape(string) {\n  string = toString(string);\n  return (string && reHasEscapedHtml.test(string))\n    ? string.replace(reEscapedHtml, unescapeHtmlChar)\n    : string;\n}\n\nexport default unescape;\n", "/*\n\nMiscellaneous common things\n===========================\n\nCopyright (c) 2024 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nexport type GlkTypedArray = Uint8Array | Uint32Array\nexport type GlkTypedArrayConstructor = Uint8ArrayConstructor | Uint32ArrayConstructor\n\n/** A DataView with support for getting and setting arrays and four character codes */\nexport class FileView extends DataView {\n    constructor(array: Uint8Array);\n    constructor(buffer: ArrayBuffer, byteOffset?: number, byteLength?: number);\n    constructor(data: Uint8Array | ArrayBuffer, byteOffset?: number, byteLength?: number) {\n        if (data instanceof Uint8Array) {\n            super(data.buffer, data.byteOffset, data.byteLength)\n        }\n        else {\n            super(data, byteOffset, byteLength)\n        }\n    }\n\n    getFourCC(index: number) {\n        return String.fromCharCode(this.getUint8(index), this.getUint8(index + 1), this.getUint8(index + 2), this.getUint8(index + 3))\n    }\n\n    getUint8Subarray(index?: number, length?: number): Uint8Array {\n        return new Uint8Array(this.buffer, this.byteOffset + (index || 0), length)\n    }\n\n    setFourCC(index: number, text: string) {\n        this.setUint8(index, text.charCodeAt(0) )\n        this.setUint8(index + 1, text.charCodeAt(1))\n        this.setUint8(index + 2, text.charCodeAt(2))\n        this.setUint8(index + 3, text.charCodeAt(3))\n    }\n\n    setUint8Array(index: number, data: Uint8Array) {\n        const subarray = this.getUint8Subarray(index, data.length)\n        subarray.set(data)\n    }\n}\n\n/** Write a Uint32Array as a big-endian Uint8Array */\nexport function Array_to_BEBuffer(arr: Uint32Array) {\n    const buf = new Uint8Array(arr.length * 4)\n    const dv = new DataView(buf.buffer)\n    for (let i = 0; i < arr.length; i++) {\n        dv.setUint32(i * 4, arr[i])\n    }\n    return buf\n}\n\n/** Read a big-endian Uint8Array into a Uint32Array */\nexport function BEBuffer_to_Array(buf: Uint8Array) {\n    const dv = new DataView(buf.buffer, buf.byteOffset, buf.length)\n    const arr = new Uint32Array(buf.length / 4)\n    for (let i = 0; i < buf.length; i += 4) {\n        arr[i / 4] = dv.getUint32(i)\n    }\n    return arr\n}\n\n/** If we can determine that the browser is currently pinch zoomed */\nexport function is_pinch_zoomed() {\n    if (visualViewport) {\n        return (visualViewport.scale - 1) > 0.001\n    }\n    return false\n}\n\nexport function is_unicode_array(arr: GlkTypedArray) {\n    return arr.BYTES_PER_ELEMENT === 4\n}\n\nexport const utf8decoder = new TextDecoder()\nexport const utf8encoder = new TextEncoder()", "/*\n\nInterchange File Format\n=======================\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {FileView} from '../common/misc.js'\n\nexport interface IFFChunk {\n    data: Uint8Array,\n    offset: number,\n    type: string,\n}\n\n/** An Interchange File Format reader and writer */\nexport class IFF {\n    type = ''\n    chunks: IFFChunk[] = []\n\n    parse(data: Uint8Array) {\n        const view = new FileView(data)\n\n        // Check this is actually an IFF file\n        if (view.getFourCC(0) !== 'FORM') {\n            throw new Error('Not an IFF file')\n        }\n\n        // Parse the file\n        this.type = view.getFourCC(8)\n        let i = 12\n        // Adrift 5 Blorbs have an incorrect length, so just use the size of the buffer\n        //const length = view.getUint32(4) + 8\n        const length = data.length\n        while (i < length) {\n            const chunk_length = view.getUint32(i + 4)\n            if (chunk_length < 0 || (chunk_length + i) > length) {\n                throw new Error('IFF chunk out of range')\n            }\n            this.chunks.push({\n                data: view.getUint8Subarray(i + 8, chunk_length),\n                offset: i,\n                type: view.getFourCC(i),\n            })\n            i += 8 + chunk_length\n            if (i % 2) {\n                i++\n            }\n        }\n    }\n\n    write(): Uint8Array {\n        // First calculate the required buffer length\n        let buffer_length = 12\n        for (const chunk of this.chunks) {\n            buffer_length += 8 + chunk.data.length\n            if (buffer_length % 2) {\n                buffer_length++\n            }\n        }\n\n        // Now make the IFF file and return it\n        const view = new FileView(new ArrayBuffer(buffer_length))\n        view.setFourCC(0, 'FORM')\n        view.setUint32(4, buffer_length - 8)\n        view.setFourCC(8, this.type)\n        let i = 12\n        for (const chunk of this.chunks) {\n            view.setFourCC(i, chunk.type)\n            view.setUint32(i + 4, chunk.data.length)\n            view.setUint8Array(i + 8, chunk.data)\n            i += 8 + chunk.data.length\n            if (i % 2) {\n                i++\n            }\n        }\n        return view.getUint8Subarray()\n    }\n}", "/*\n\nBlorb Files and functions\n=========================\n\nCopyright (c) 2023 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {unescape} from 'lodash-es'\n\nimport {FileView, utf8decoder} from '../common/misc.js'\n\nimport {IFF} from './iff.js'\n\nexport interface ImageSize {\n    height: number,\n    width: number,\n}\n\nexport interface BlorbChunk {\n    /** Resource descriptions */\n    alttext?: string,\n    /** Whether a data chunk is binary */\n    binary?: boolean,\n    /** The original Chunk ID FourCC */\n    blorbtype?: string,\n    content?: Uint8Array,\n    /** Cached image dimensions */\n    imagesize?: ImageSize,\n    /** Image type */\n    type?: string,\n    /** External URL for image */\n    url?: string,\n    /** Resource usage */\n    usage: 'data' | 'exec' | 'pict' | 'sound',\n}\n\nexport interface ImageInfo extends BlorbChunk {\n    height?: number,\n    /** The resource number */\n    image: number,\n    width?: number,\n}\n\nexport interface BlorbDataChunk {\n    binary: boolean,\n    data: Uint8Array,\n}\n\n// The infomap format\nexport interface InfoMapResource {\n    height: number,\n    image: number,\n    url: string,\n    width: number,\n}\nexport type InfoMap = Record<string, InfoMapResource>\n\nconst BLORB_RESOURCE_INDEX_USAGES: Record<string, string> = {\n    Data: 'data',\n    Exec: 'exec',\n    Pict: 'pict',\n    'Snd ': 'sound',\n}\n\nconst UNKNOWN_IMAGE_TYPE = '????'\n\nexport class Blorb {\n    classname = 'Blorb'\n    /** Chunks are indexed with \"USE:NUMBER\" keys */\n    chunks: Record<string, BlorbChunk> = {}\n    private coverimagenum?: number\n    private debugdata?: Uint8Array\n    private is_inited = false\n    private metadata: Record<string, string> = {}\n\n    // The original Blorb library requires you to call init(), but I think it's better to pass the data into the constructor\n    constructor(data?: Uint8Array);\n    constructor(data?: Uint8Array) {\n        if (data) {\n            this.init(data)\n        }\n    }\n\n    init(data: Array<any>): void;\n    init(data: InfoMap, options: {format: 'infomap'}): void;\n    init(data: Uint8Array): void;\n    init(data: Array<any> | InfoMap | Uint8Array, options?: any) {\n        if (this.is_inited) {\n            return\n        }\n        if (data instanceof Uint8Array) {\n            const iff = new IFF()\n            iff.parse(data)\n            if (iff.type !== 'IFRS') {\n                throw new Error('Not a Blorb file')\n            }\n            if (iff.chunks[0].type !== 'RIdx') {\n                throw new Error('Malformed blorb: chunk 1 is not RIdx')\n            }\n\n            // Process the chunks\n            for (const iff_chunk of iff.chunks) {\n                switch (iff_chunk.type) {\n                    case 'Dbug': {\n                        // Process the debug chunk\n                        this.debugdata = iff_chunk.data\n                        break\n                    }\n                    case 'Fspc': {\n                        // Process the frontispiece chunk\n                        const view = new FileView(iff_chunk.data)\n                        this.coverimagenum = view.getUint32(0)\n                        break\n                    }\n                    case 'IFmd': {\n                        const xml = utf8decoder.decode(iff_chunk.data)\n                        // Normally parsing XML with regexes is super unwise, but the Babel spec places enough restrictions on the metadata XML that this should be safe\n                        const bibliographic = /<bibliographic>(.+)<\\/bibliographic>/is.exec(xml)\n                        const entry_pattern = /<(\\w+)>(.+)<\\/\\1>/gi\n                        const linebreak_pattern = /<br\\/>/g\n                        const whitespace_pattern = /\\s+/g\n                        if (bibliographic) {\n                            let result\n                            while ((result = entry_pattern.exec(bibliographic[1]))) {\n                                const tag = result[1].toLowerCase()\n                                let content = result[2].replace(whitespace_pattern, ' ')\n                                if (tag === 'description') {\n                                    content = content.replace(linebreak_pattern, '\\n')\n                                }\n                                this.metadata[tag] = unescape(content)\n                            }\n                        }\n                        break\n                    }\n                    case 'RDes': {\n                        // Process the resource description chunk\n                        const view = new FileView(iff_chunk.data)\n                        let i = 4\n                        while (i < view.byteLength) {\n                            const usage = BLORB_RESOURCE_INDEX_USAGES[view.getFourCC(i)]\n                            const resource_number = view.getUint32(i + 4)\n                            const text_length = view.getUint32(i + 8)\n                            const chunk = this.chunks[`${usage}:${resource_number}`]\n                            if (chunk) {\n                                chunk.alttext = utf8decoder.decode(view.getUint8Subarray(i + 12, text_length))\n                            }\n                            i += 12 + text_length\n                        }\n                        break\n                    }\n                    case 'RIdx': {\n                        // Process the resource index chunk\n                        const view = new FileView(iff_chunk.data)\n                        let i = 4\n                        while (i < view.byteLength) {\n                            const usage = view.getFourCC(i)\n                            const resource_number = view.getUint32(i + 4)\n                            const resource_offset = view.getUint32(i + 8)\n                            i += 12\n                            const resource_chunk = iff.chunks.filter(chunk => chunk.offset === resource_offset)[0]\n                            if (!resource_chunk) {\n                                throw new Error(`No Blorb chunk at offset ${resource_offset}`)\n                            }\n                            const type = resource_chunk.type\n                            const chunk: BlorbChunk = {\n                                blorbtype: type,\n                                // Embedded FORM chunks need to include the chunk headers for resource streams, so patch them now\n                                content: type === 'FORM' ? data.subarray(resource_chunk.offset, resource_chunk.offset + 8 + resource_chunk.data.length) : resource_chunk.data,\n                                usage: BLORB_RESOURCE_INDEX_USAGES[usage] as BlorbChunk['usage'],\n                            }\n                            if (usage === 'Pict') {\n                                if (type === 'JPEG') {\n                                    chunk.type = 'jpeg'\n                                }\n                                else if (type === 'PNG ') {\n                                    chunk.type = 'png'\n                                }\n                                else {\n                                    chunk.type = UNKNOWN_IMAGE_TYPE\n                                }\n                            }\n                            if (usage === 'Data') {\n                                chunk.binary = type === 'BINA' || type === 'FORM'\n                            }\n                            this.chunks[`${chunk.usage}:${resource_number}`] = chunk\n                        }\n                        break\n                    }\n                }\n            }\n        }\n        // Process the infomap format\n        else if (options?.format === 'infomap') {\n            for (const key in data) {\n                if (!Number.isInteger(+key)) {\n                    continue\n                }\n                const chunk: any = Object.assign({}, (data as InfoMap)[key])\n                delete chunk.image\n                if (chunk.height && chunk.width) {\n                    chunk.imagesize = {\n                        height: chunk.height,\n                        width: chunk.width,\n                    }\n                    delete chunk.height\n                    delete chunk.width\n                }\n                chunk.type = chunk.url.endsWith('.png') ? 'png' : 'jpeg'\n                chunk.usage = 'pict'\n                this.chunks[`pict:${key}`] = chunk\n            }\n        }\n        else if (Array.isArray(data) && data.length === 0) {\n            // Empty data, do nothing\n        }\n        else {\n            throw new Error('Unsupported Blorb.init data format')\n        }\n\n        this.is_inited = true\n    }\n\n    getlibrary(): null {\n        return null\n    }\n\n    get_chunk(usage: BlorbChunk['usage'], num: number): BlorbChunk | null {\n        return this.chunks[`${usage}:${num}`] || null\n    }\n\n    get_cover_pict(): number | null {\n        return this.coverimagenum ?? null\n    }\n\n    get_data_chunk(num: number): BlorbDataChunk | null {\n        const chunk = this.chunks[`data:${num}`]\n        if (!chunk?.content) {\n            return null\n        }\n        return {\n            binary: chunk.binary!,\n            data: chunk.content,\n        }\n    }\n    \n    get_debug_info(): Uint8Array | undefined {\n        return this.debugdata\n    }\n\n    /** Return the game file chunk, or null if there isn't one.\n     * If type is provided (GLUL or ZCOD) then the game file is checked to ensure it matches\n     */\n    get_exec_data(gametype?: 'GLUL' | 'ZCOD'): Uint8Array | null {\n        const chunk = this.chunks['exec:0']\n        if (!chunk?.content || (gametype && chunk.blorbtype !== gametype)) {\n            return null\n        }\n        return chunk.content\n    }\n\n    get_image_info(num: number): ImageInfo | null {\n        const chunk = this.chunks[`pict:${num}`]\n        if (!chunk) {\n            return null\n        }\n\n        // Try to extract the image sizes\n        if (!chunk.imagesize && chunk.content) {\n            if (chunk.type === 'jpeg') {\n                chunk.imagesize = get_jpeg_dimensions(chunk.content)\n            }\n            else if (chunk.type === 'png') {\n                chunk.imagesize = get_png_dimensions(chunk.content)\n            }\n        }\n\n        const img: ImageInfo = Object.assign({image: num}, chunk)\n        if (img.imagesize) {\n            img.height = img.imagesize.height\n            img.width = img.imagesize.width\n        }\n        return img\n    }\n\n    get_image_url(num: number): string | null {\n        const chunk = this.chunks[`pict:${num}`]\n        if (!chunk) {\n            return null\n        }\n\n        if (chunk.url) {\n            return chunk.url\n        }\n\n        if (chunk.type !== UNKNOWN_IMAGE_TYPE && chunk.content) {\n            chunk.url = URL.createObjectURL(new Blob([chunk.content], {type: `image/${chunk.type}`}))\n            return chunk.url\n        }\n\n        return null\n    }\n\n    get_metadata(field: string): string {\n        return this.metadata[field]\n    }\n\n    inited(): boolean {\n        return this.is_inited\n    }\n}\n\nexport function is_blorb(data: Uint8Array): boolean {\n    const view = new FileView(data)\n    return view.getFourCC(0) === 'FORM' && view.getFourCC(8) === 'IFRS'\n}\n\nfunction get_jpeg_dimensions(data: Uint8Array): ImageSize | undefined {\n    const view = new FileView(data)\n    let i = 0\n    while (i < view.byteLength) {\n        if (view.getUint8(i) !== 0xFF) {\n            return\n        }\n        while (view.getUint8(i) === 0xFF) {\n            i++\n        }\n        const marker = view.getUint8(i++)\n        // Markers with no data\n        if (marker === 0x01 || (marker >= 0xD0 && marker <= 0xD9)) {\n            continue\n        }\n        const chunklength = view.getUint16(i)\n        if (marker >= 0xC0 && marker <= 0xCF && marker !== 0xC8) {\n            if (chunklength < 7) {\n                // SOF block is too small\n                return\n            }\n            return {\n                height: view.getUint16(i + 3),\n                width: view.getUint16(i + 5),\n            }\n        }\n        i += chunklength\n    }\n}\n\nfunction get_png_dimensions(data: Uint8Array): ImageSize | undefined {\n    const view = new FileView(data)\n    if (view.getFourCC(0) !== '\\x89PNG') {\n        return\n    }\n\n    let i = 8\n    while (i < view.byteLength) {\n        const chunklength = view.getUint32(i)\n        const chunktype = view.getFourCC(i + 4)\n        i += 8\n        if (chunktype === 'IHDR') {\n            return {\n                height: view.getInt32(i + 4),\n                width: view.getInt32(i),\n            }\n        }\n        // Skip CRC\n        i += chunklength + 4\n    }\n}", "/*\n\nConstants\n=========\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport * as protocol from './protocol.js'\n\nexport const DEFAULT_METRICS: protocol.NormalisedMetrics = {\n    buffercharheight: 1,\n    buffercharwidth: 1,\n    buffermarginx: 0,\n    buffermarginy: 0,\n    graphicsmarginx: 0,\n    graphicsmarginy: 0,\n    gridcharheight: 1,\n    gridcharwidth: 1,\n    gridmarginx: 0,\n    gridmarginy: 0,\n    height: 50,\n    inspacingx: 0,\n    inspacingy: 0,\n    outspacingx: 0,\n    outspacingy: 0,\n    width: 80,\n}\n\nexport const KEY_CODES_TO_NAMES: Record<number, protocol.SpecialKeyCode> = {\n    8: 'delete', // Backspace to be precise\n    9: 'tab',\n    13: 'return',\n    27: 'escape',\n    33: 'pageup',\n    34: 'pagedown',\n    35: 'end',\n    36: 'home',\n    37: 'left',\n    38: 'up',\n    39: 'right',\n    40: 'down',\n    112: 'func1',\n    113: 'func2',\n    114: 'func3',\n    115: 'func4',\n    116: 'func5',\n    117: 'func6',\n    118: 'func7',\n    119: 'func8',\n    120: 'func9',\n    121: 'func10',\n    122: 'func11',\n    123: 'func12',\n}\n\nexport const KEY_CODE_DOWN = 40\nexport const KEY_CODE_RETURN = 13\nexport const KEY_CODE_UP = 38\n\nexport const NBSP = '\\xa0'\nexport const THINSPACE = '\\u2009'\n\nexport const OFFSCREEN_OFFSET = '-10000px'\n\nexport const PACKAGE_VERSION = '0.1.0'", "/*\n\nCommon Dialog functions\n=======================\n\nCopyright (c) 2024 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport type {FileType} from '../../common/protocol.js'\n\n/** File extensions for Glk file types */\nexport function filetype_to_extension(filetype: FileType): string {\n    switch (filetype) {\n        case 'command':\n        case 'transcript':\n            return '.txt'\n        case 'save':\n            return '.glksave'\n        default:\n            return '.glkdata'\n    }\n}\n\n/** Construct a file-filter list for a given usage type. */\nexport function filters_for_usage(usage: string | null) {\n    switch (usage) {\n        case 'data': \n            return [ { name: 'Glk Data File', extensions: ['glkdata'] } ]\n        case 'save': \n            return [ { name: 'Glk Save File', extensions: ['glksave'] } ]\n        case 'transcript': \n            return [ { name: 'Transcript File', extensions: ['txt'] } ]\n        case 'command': \n            return [ { name: 'Command File', extensions: ['txt'] } ]\n        default:\n            return []\n    }\n}\n\n/** Convert a native path to a POSIX path */\nexport function path_native_to_posix(path: string): string {\n    if (process.platform === 'win32') {\n        throw new Error('not implemented')\n    }\n    else {\n        return path\n    }\n}\n\n/** Convert a POSIX path to a native path */\nexport function path_posix_to_native(path: string): string {\n    if (process.platform === 'win32') {\n        throw new Error('not implemented')\n    }\n    else {\n        return path\n    }\n}", "/*\n\nGeneric GlkOte implementation\n=============================\n\nCopyright (c) 2024 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {Blorb} from '../../blorb/blorb.js'\nimport * as Constants from '../../common/constants.js'\nimport type {DownloadOptions}  from '../../common/file/interface.js'\nimport * as protocol from '../../common/protocol.js'\nimport {filetype_to_extension} from '../../dialog/common/common.js'\nimport type {Dialog} from '../../dialog/common/interface.js'\nimport type {GlkApi} from '../../glkapi/interface.js'\n\nexport interface GlkOte {\n    classname: string,\n    error(msg: any): void,\n    extevent(val: any): void,\n    getdomcontext(): HTMLElement | undefined,\n    getdomid(name: string): string,\n    getinterface(): GlkOteOptions,\n    getlibrary(name: string): Blorb | Dialog | null | undefined,\n    init(options: GlkOteOptions): void,\n    inited(): boolean,\n    log(msg: string): void,\n    save_allstate(): any,\n    setdomcontext(val: HTMLElement): void,\n    update(data: protocol.Update): void,\n    version: string,\n    warning(msg: any): void,\n}\n\nexport interface GlkOteOptions extends DownloadOptions {\n    accept(event: protocol.Event): void,\n    Blorb?: Blorb,\n    debug_commands?: boolean,\n    detect_external_links?: string | boolean,\n    Dialog?: Dialog,\n    dialog_dom_prefix?: string,\n    dom_prefix?: string,\n    errorcontent?: string,\n    errorpane?: string,\n    gameport?: string,\n    Glk?: GlkApi,\n    loadingpane?: string,\n    max_buffer_length?: number,\n    /** Cookie name to opt out of transcript recording. Default: `transcript_recording_opt_out` */\n    recording_cookie?: string,\n    /** Transcript recording service protocol format. Only `simple` is supported by AsyncGlk */\n    recording_format?: string,\n    /** Custom transcript recording handler function */\n    recording_handler?: (state: TranscriptRecordingData) => void,\n    /** Transcript recording label for this story */\n    recording_label?: string,\n    /** URL for the transcript recording service */\n    recording_url?: string,\n    regex_external_links?: RegExp,\n    /** Whether or not to set the <body> background colour to the page_margin_bg */\n    set_body_to_page_bg?: boolean | number,\n    windowport?: string,\n}\n\n/** Format of the transcript recorder data */\nexport interface TranscriptRecordingData {\n    /** The transcript record format is always 'simple */\n    format: 'simple',\n    /** Player input for char and line events */\n    input: string,\n    /** The label given to this story at the beginning */\n    label: string,\n    /** Combined output from buffer windows */\n    output: string,\n    /** Timestamp from when output returned to GlkOte (milliseconds) */\n    outtimestamp: number,\n    /** Session ID */\n    sessionId: string,\n    /** Timestamp from when GlkOte event was sent to VM (milliseconds) */\n    timestamp: number,\n}\n\nexport abstract class GlkOteBase implements GlkOte {\n    classname = 'GlkOte'\n    version = Constants.PACKAGE_VERSION\n\n    protected accept_func: (event: protocol.Event) => void = () => {}\n    protected autorestoring = false\n    Blorb?: Blorb\n    current_metrics = Object.assign({}, Constants.DEFAULT_METRICS)\n    protected Dialog?: Dialog\n    disabled = false\n    protected generation = 0\n    protected is_inited = false\n    options: GlkOteOptions = {} as GlkOteOptions\n    protected timer: ReturnType<typeof setTimeout> | null = null\n    protected waiting_for_update = false\n\n    async init(options: GlkOteOptions) {\n        if (!options) {\n            return this.error('no options provided')\n        }\n        if (!options.accept) {\n            return this.error('an accept function was not given to GlkOte')\n        }\n\n        this.options = options\n        this.accept_func = options.accept\n\n        if (options.Blorb) {\n            this.Blorb = options.Blorb\n        }\n        if (options.Dialog) {\n            this.Dialog = options.Dialog\n        }\n\n        this.is_inited = true\n\n        // Send an init event, which if is received by GlkApi, will then result in VM.start() being called\n        this.send_event({type: 'init'})\n    }\n\n    error(error: Error | string) {\n        throw (typeof error === 'string' ? new Error(error) : error)\n    }\n\n    extevent(value: any) {\n        this.send_event({\n            type: 'external',\n            value,\n        })\n    }\n\n    getdomcontext(): HTMLElement | undefined {\n        throw new Error('getdomcontext is not applicable to this GlkOte library')\n    }\n\n    getdomid(name: string): string {\n        throw new Error('getdomid is not applicable to this GlkOte library')\n    }\n\n    getinterface(): GlkOteOptions {\n        return this.options\n    }\n\n    getlibrary(name: string): Blorb | Dialog | null | undefined {\n        switch (name) {\n            case 'Blorb': return this.Blorb\n            case 'Dialog': return this.Dialog\n            default: return null\n        }\n    }\n\n    inited(): boolean {\n        return this.is_inited\n    }\n\n    log(msg: string) {\n        console.log(msg)\n    }\n\n    setdomcontext(val: HTMLElement) {\n        throw new Error('setdomcontext is not applicable to this GlkOte library')\n    }\n\n    update(data: protocol.Update) {\n        try {\n            this.autorestoring = false\n            this.waiting_for_update = false\n\n            if (data.type === 'error') {\n                return this.error(data.message)\n            }\n            if (data.type === 'pass') {\n                return\n            }\n            if (data.type === 'retry') {\n                setTimeout(() => this.send_event({type: 'refresh'}), 2000)\n                return\n            }\n            if (data.type !== 'update') {\n                return this.error(`Unknown update type: ${(data as any).type}`)\n            }\n\n            if (data.gen === this.generation) {\n                this.log(`Ignoring repeated generation number: ${data.gen}`)\n                return\n            }\n            this.generation = data.gen\n\n            if (this.disabled) {\n                this.disable(false)\n            }\n\n            // Now handle all the state updates\n            if (data.input) {\n                this.cancel_inputs(data.input)\n            }\n            if (data.windows) {\n                this.update_windows(data.windows)\n            }\n            if (data.content) {\n                this.update_content(data.content)\n            }\n            if (data.input) {\n                this.update_inputs(data.input)\n            }\n            if (data.schannels && this.Blorb) {\n                this.update_schannels(data.schannels)\n            }\n\n            if (data.timer !== undefined) {\n                if (this.timer) {\n                    clearInterval(this.timer)\n                    this.timer = null\n                }\n                if (data.timer) {\n                    this.timer = setInterval(() => this.ontimer(), data.timer)\n                }\n            }\n\n            if (data.specialinput) {\n                this.handle_specialinput(data.specialinput)\n            }\n\n            // Disable everything if requested\n            this.disabled = false\n            if (data.disable || data.specialinput) {\n                this.disable(true)\n            }\n\n            if (data.autorestore) {\n                this.autorestoring = true\n                this.autorestore(data.autorestore)\n            }\n\n            // Page background colour\n            if (typeof data.page_margin_bg !== 'undefined' && this.options.set_body_to_page_bg) {\n                this.set_page_bg(data.page_margin_bg)\n            }\n\n            if (data.disable) {\n                this.exit()\n            }\n        }\n        catch (err) {\n            this.error(err as Error)\n        }\n    }\n\n    warning(msg: any) {\n        console.warn(msg)\n    }\n\n    // AsyncGlk specific implementation methods\n    protected autorestore(data: any) {}\n\n    protected capabilities(): string[] {\n        return ['timer']\n    }\n\n    protected exit() {}\n\n    protected handle_specialinput(data: protocol.SpecialInput) {\n        if (data.type === 'fileref_prompt') {\n            const replyfunc = (ref: protocol.FileRef | null) => this.send_event({\n                type: 'specialresponse',\n                response: 'fileref_prompt',\n                value: ref,\n            })\n\n            try {\n                if (!this.Dialog) {\n                    setTimeout(() => replyfunc(null), 0)\n                }\n                else {\n                    if (this.Dialog.async) {\n                        this.Dialog.prompt(filetype_to_extension(data.filetype), data.filemode !== 'read').then(filename => {\n                            replyfunc(filename ? {filename} : null)\n                        })\n                    }\n                    else {\n                        this.Dialog.open(data.filemode !== 'read', data.filetype, data.gameid, replyfunc)\n                    }\n                }\n            }\n            catch (ex) {\n                this.log(`Unable to open file dialog: ${ex}`)\n                /* Return a failure. But we don't want to call send_response before\n                glkote_update has finished, so we defer the reply slightly. */\n                setTimeout(() => replyfunc(null), 0)\n            }\n        }\n        else {\n            this.error( `Request for unknown special input type: ${data.type}` )\n        }\n    }\n\n    protected ontimer() {\n        if (!this.disabled && this.timer) {\n            this.send_event({type: 'timer'})\n        }\n    }\n\n    save_allstate(): any {}\n\n    send_event(ev: Partial<protocol.Event>) {\n        if (this.disabled && ev.type !== 'specialresponse') {\n            return\n        }\n        if (this.waiting_for_update) {\n            console.log('Trying to send event when waiting for input', ev)\n            return\n        }\n        this.waiting_for_update = true\n        ev.gen = this.generation\n        switch (ev.type) {\n            case 'arrange':\n                ev.metrics = this.current_metrics\n                break\n            case 'init':\n                ev.metrics = this.current_metrics\n                ev.support = this.capabilities()\n                break\n            case 'specialresponse':\n                ev.response = 'fileref_prompt'\n                break\n        }\n        this.accept_func(ev as Required<protocol.Event>)\n    }\n\n    protected set_page_bg(colour: string) {}\n\n    protected update_schannels(windows: protocol.SoundChannelUpdate[]) {}\n\n    // Functions to be implemented in a subclass\n    protected abstract cancel_inputs(windows: protocol.InputUpdate[]): void\n    protected abstract disable(disable: boolean): void\n    protected abstract update_content(content: protocol.ContentUpdate[]): void\n    protected abstract update_inputs(windows: protocol.InputUpdate[]): void\n    protected abstract update_windows(windows: protocol.WindowUpdate[]): void\n}", "// DEFLATE is a complex format; to read this code, you should probably check the RFC first:\n// https://tools.ietf.org/html/rfc1951\n// You may also wish to take a look at the guide I made about this program:\n// https://gist.github.com/101arrowz/253f31eb5abc3d9275ab943003ffecad\n// Some of the following code is similar to that of UZIP.js:\n// https://github.com/photopea/UZIP.js\n// However, the vast majority of the codebase has diverged from UZIP.js to increase performance and reduce bundle size.\n// Sometimes 0 will appear where -1 would be more appropriate. This is because using a uint\n// is better for memory in most engines (I *think*).\nvar ch2 = {};\nvar wk = (function (c, id, msg, transfer, cb) {\n    var w = new Worker(ch2[id] || (ch2[id] = URL.createObjectURL(new Blob([\n        c + ';addEventListener(\"error\",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'\n    ], { type: 'text/javascript' }))));\n    w.onmessage = function (e) {\n        var d = e.data, ed = d.$e$;\n        if (ed) {\n            var err = new Error(ed[0]);\n            err['code'] = ed[1];\n            err.stack = ed[2];\n            cb(err, null);\n        }\n        else\n            cb(null, d);\n    };\n    w.postMessage(msg, transfer);\n    return w;\n});\n\n// aliases for shorter compressed code (most minifers don't do this)\nvar u8 = Uint8Array, u16 = Uint16Array, i32 = Int32Array;\n// fixed length extra bits\nvar fleb = new u8([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, /* unused */ 0, 0, /* impossible */ 0]);\n// fixed distance extra bits\nvar fdeb = new u8([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, /* unused */ 0, 0]);\n// code length index map\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\n// get base, reverse index map from extra bits\nvar freb = function (eb, start) {\n    var b = new u16(31);\n    for (var i = 0; i < 31; ++i) {\n        b[i] = start += 1 << eb[i - 1];\n    }\n    // numbers here are at max 18 bits\n    var r = new i32(b[30]);\n    for (var i = 1; i < 30; ++i) {\n        for (var j = b[i]; j < b[i + 1]; ++j) {\n            r[j] = ((j - b[i]) << 5) | i;\n        }\n    }\n    return { b: b, r: r };\n};\nvar _a = freb(fleb, 2), fl = _a.b, revfl = _a.r;\n// we can ignore the fact that the other numbers are wrong; they never happen anyway\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0), fd = _b.b, revfd = _b.r;\n// map of value to reverse (assuming 16 bits)\nvar rev = new u16(32768);\nfor (var i = 0; i < 32768; ++i) {\n    // reverse table algorithm from SO\n    var x = ((i & 0xAAAA) >> 1) | ((i & 0x5555) << 1);\n    x = ((x & 0xCCCC) >> 2) | ((x & 0x3333) << 2);\n    x = ((x & 0xF0F0) >> 4) | ((x & 0x0F0F) << 4);\n    rev[i] = (((x & 0xFF00) >> 8) | ((x & 0x00FF) << 8)) >> 1;\n}\n// create huffman tree from u8 \"map\": index -> code length for code index\n// mb (max bits) must be at most 15\n// TODO: optimize/split up?\nvar hMap = (function (cd, mb, r) {\n    var s = cd.length;\n    // index\n    var i = 0;\n    // u16 \"map\": index -> # of codes with bit length = index\n    var l = new u16(mb);\n    // length of cd must be 288 (total # of codes)\n    for (; i < s; ++i) {\n        if (cd[i])\n            ++l[cd[i] - 1];\n    }\n    // u16 \"map\": index -> minimum code for bit length = index\n    var le = new u16(mb);\n    for (i = 1; i < mb; ++i) {\n        le[i] = (le[i - 1] + l[i - 1]) << 1;\n    }\n    var co;\n    if (r) {\n        // u16 \"map\": index -> number of actual bits, symbol for code\n        co = new u16(1 << mb);\n        // bits to remove for reverser\n        var rvb = 15 - mb;\n        for (i = 0; i < s; ++i) {\n            // ignore 0 lengths\n            if (cd[i]) {\n                // num encoding both symbol and bits read\n                var sv = (i << 4) | cd[i];\n                // free bits\n                var r_1 = mb - cd[i];\n                // start value\n                var v = le[cd[i] - 1]++ << r_1;\n                // m is end value\n                for (var m = v | ((1 << r_1) - 1); v <= m; ++v) {\n                    // every 16 bit value starting with the code yields the same result\n                    co[rev[v] >> rvb] = sv;\n                }\n            }\n        }\n    }\n    else {\n        co = new u16(s);\n        for (i = 0; i < s; ++i) {\n            if (cd[i]) {\n                co[i] = rev[le[cd[i] - 1]++] >> (15 - cd[i]);\n            }\n        }\n    }\n    return co;\n});\n// fixed length tree\nvar flt = new u8(288);\nfor (var i = 0; i < 144; ++i)\n    flt[i] = 8;\nfor (var i = 144; i < 256; ++i)\n    flt[i] = 9;\nfor (var i = 256; i < 280; ++i)\n    flt[i] = 7;\nfor (var i = 280; i < 288; ++i)\n    flt[i] = 8;\n// fixed distance tree\nvar fdt = new u8(32);\nfor (var i = 0; i < 32; ++i)\n    fdt[i] = 5;\n// fixed length map\nvar flm = /*#__PURE__*/ hMap(flt, 9, 0), flrm = /*#__PURE__*/ hMap(flt, 9, 1);\n// fixed distance map\nvar fdm = /*#__PURE__*/ hMap(fdt, 5, 0), fdrm = /*#__PURE__*/ hMap(fdt, 5, 1);\n// find max of array\nvar max = function (a) {\n    var m = a[0];\n    for (var i = 1; i < a.length; ++i) {\n        if (a[i] > m)\n            m = a[i];\n    }\n    return m;\n};\n// read d, starting at bit p and mask with m\nvar bits = function (d, p, m) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8)) >> (p & 7)) & m;\n};\n// read d, starting at bit p continuing for at least 16 bits\nvar bits16 = function (d, p) {\n    var o = (p / 8) | 0;\n    return ((d[o] | (d[o + 1] << 8) | (d[o + 2] << 16)) >> (p & 7));\n};\n// get end of byte\nvar shft = function (p) { return ((p + 7) / 8) | 0; };\n// typed array slice - allows garbage collector to free original reference,\n// while being more compatible than .slice\nvar slc = function (v, s, e) {\n    if (s == null || s < 0)\n        s = 0;\n    if (e == null || e > v.length)\n        e = v.length;\n    // can't use .constructor in case user-supplied\n    return new u8(v.subarray(s, e));\n};\n/**\n * Codes for errors generated within this library\n */\nexport var FlateErrorCode = {\n    UnexpectedEOF: 0,\n    InvalidBlockType: 1,\n    InvalidLengthLiteral: 2,\n    InvalidDistance: 3,\n    StreamFinished: 4,\n    NoStreamHandler: 5,\n    InvalidHeader: 6,\n    NoCallback: 7,\n    InvalidUTF8: 8,\n    ExtraFieldTooLong: 9,\n    InvalidDate: 10,\n    FilenameTooLong: 11,\n    StreamFinishing: 12,\n    InvalidZipData: 13,\n    UnknownCompressionMethod: 14\n};\n// error codes\nvar ec = [\n    'unexpected EOF',\n    'invalid block type',\n    'invalid length/literal',\n    'invalid distance',\n    'stream finished',\n    'no stream handler',\n    ,\n    'no callback',\n    'invalid UTF-8 data',\n    'extra field too long',\n    'date not in range 1980-2099',\n    'filename too long',\n    'stream finishing',\n    'invalid zip data'\n    // determined by unknown compression method\n];\n;\nvar err = function (ind, msg, nt) {\n    var e = new Error(msg || ec[ind]);\n    e.code = ind;\n    if (Error.captureStackTrace)\n        Error.captureStackTrace(e, err);\n    if (!nt)\n        throw e;\n    return e;\n};\n// expands raw DEFLATE data\nvar inflt = function (dat, st, buf, dict) {\n    // source length       dict length\n    var sl = dat.length, dl = dict ? dict.length : 0;\n    if (!sl || st.f && !st.l)\n        return buf || new u8(0);\n    var noBuf = !buf;\n    // have to estimate size\n    var resize = noBuf || st.i != 2;\n    // no state\n    var noSt = st.i;\n    // Assumes roughly 33% compression ratio average\n    if (noBuf)\n        buf = new u8(sl * 3);\n    // ensure buffer can fit at least l elements\n    var cbuf = function (l) {\n        var bl = buf.length;\n        // need to increase size to fit\n        if (l > bl) {\n            // Double or set to necessary, whichever is greater\n            var nbuf = new u8(Math.max(bl * 2, l));\n            nbuf.set(buf);\n            buf = nbuf;\n        }\n    };\n    //  last chunk         bitpos           bytes\n    var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n    // total bits\n    var tbts = sl * 8;\n    do {\n        if (!lm) {\n            // BFINAL - this is only 1 when last chunk is next\n            final = bits(dat, pos, 1);\n            // type: 0 = no compression, 1 = fixed huffman, 2 = dynamic huffman\n            var type = bits(dat, pos + 1, 3);\n            pos += 3;\n            if (!type) {\n                // go to end of byte boundary\n                var s = shft(pos) + 4, l = dat[s - 4] | (dat[s - 3] << 8), t = s + l;\n                if (t > sl) {\n                    if (noSt)\n                        err(0);\n                    break;\n                }\n                // ensure size\n                if (resize)\n                    cbuf(bt + l);\n                // Copy over uncompressed data\n                buf.set(dat.subarray(s, t), bt);\n                // Get new bitpos, update byte count\n                st.b = bt += l, st.p = pos = t * 8, st.f = final;\n                continue;\n            }\n            else if (type == 1)\n                lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n            else if (type == 2) {\n                //  literal                            lengths\n                var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n                var tl = hLit + bits(dat, pos + 5, 31) + 1;\n                pos += 14;\n                // length+distance tree\n                var ldt = new u8(tl);\n                // code length tree\n                var clt = new u8(19);\n                for (var i = 0; i < hcLen; ++i) {\n                    // use index map to get real code\n                    clt[clim[i]] = bits(dat, pos + i * 3, 7);\n                }\n                pos += hcLen * 3;\n                // code lengths bits\n                var clb = max(clt), clbmsk = (1 << clb) - 1;\n                // code lengths map\n                var clm = hMap(clt, clb, 1);\n                for (var i = 0; i < tl;) {\n                    var r = clm[bits(dat, pos, clbmsk)];\n                    // bits read\n                    pos += r & 15;\n                    // symbol\n                    var s = r >> 4;\n                    // code length to copy\n                    if (s < 16) {\n                        ldt[i++] = s;\n                    }\n                    else {\n                        //  copy   count\n                        var c = 0, n = 0;\n                        if (s == 16)\n                            n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n                        else if (s == 17)\n                            n = 3 + bits(dat, pos, 7), pos += 3;\n                        else if (s == 18)\n                            n = 11 + bits(dat, pos, 127), pos += 7;\n                        while (n--)\n                            ldt[i++] = c;\n                    }\n                }\n                //    length tree                 distance tree\n                var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n                // max length bits\n                lbt = max(lt);\n                // max dist bits\n                dbt = max(dt);\n                lm = hMap(lt, lbt, 1);\n                dm = hMap(dt, dbt, 1);\n            }\n            else\n                err(1);\n            if (pos > tbts) {\n                if (noSt)\n                    err(0);\n                break;\n            }\n        }\n        // Make sure the buffer can hold this + the largest possible addition\n        // Maximum chunk size (practically, theoretically infinite) is 2^17\n        if (resize)\n            cbuf(bt + 131072);\n        var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n        var lpos = pos;\n        for (;; lpos = pos) {\n            // bits read, code\n            var c = lm[bits16(dat, pos) & lms], sym = c >> 4;\n            pos += c & 15;\n            if (pos > tbts) {\n                if (noSt)\n                    err(0);\n                break;\n            }\n            if (!c)\n                err(2);\n            if (sym < 256)\n                buf[bt++] = sym;\n            else if (sym == 256) {\n                lpos = pos, lm = null;\n                break;\n            }\n            else {\n                var add = sym - 254;\n                // no extra bits needed if less\n                if (sym > 264) {\n                    // index\n                    var i = sym - 257, b = fleb[i];\n                    add = bits(dat, pos, (1 << b) - 1) + fl[i];\n                    pos += b;\n                }\n                // dist\n                var d = dm[bits16(dat, pos) & dms], dsym = d >> 4;\n                if (!d)\n                    err(3);\n                pos += d & 15;\n                var dt = fd[dsym];\n                if (dsym > 3) {\n                    var b = fdeb[dsym];\n                    dt += bits16(dat, pos) & (1 << b) - 1, pos += b;\n                }\n                if (pos > tbts) {\n                    if (noSt)\n                        err(0);\n                    break;\n                }\n                if (resize)\n                    cbuf(bt + 131072);\n                var end = bt + add;\n                if (bt < dt) {\n                    var shift = dl - dt, dend = Math.min(dt, end);\n                    if (shift + bt < 0)\n                        err(3);\n                    for (; bt < dend; ++bt)\n                        buf[bt] = dict[shift + bt];\n                }\n                for (; bt < end; ++bt)\n                    buf[bt] = buf[bt - dt];\n            }\n        }\n        st.l = lm, st.p = lpos, st.b = bt, st.f = final;\n        if (lm)\n            final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n    } while (!final);\n    // don't reallocate for streams or user buffers\n    return bt != buf.length && noBuf ? slc(buf, 0, bt) : buf.subarray(0, bt);\n};\n// starting at p, write the minimum number of bits that can hold v to d\nvar wbits = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >> 8;\n};\n// starting at p, write the minimum number of bits (>8) that can hold v to d\nvar wbits16 = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) | 0;\n    d[o] |= v;\n    d[o + 1] |= v >> 8;\n    d[o + 2] |= v >> 16;\n};\n// creates code lengths from a frequency table\nvar hTree = function (d, mb) {\n    // Need extra info to make a tree\n    var t = [];\n    for (var i = 0; i < d.length; ++i) {\n        if (d[i])\n            t.push({ s: i, f: d[i] });\n    }\n    var s = t.length;\n    var t2 = t.slice();\n    if (!s)\n        return { t: et, l: 0 };\n    if (s == 1) {\n        var v = new u8(t[0].s + 1);\n        v[t[0].s] = 1;\n        return { t: v, l: 1 };\n    }\n    t.sort(function (a, b) { return a.f - b.f; });\n    // after i2 reaches last ind, will be stopped\n    // freq must be greater than largest possible number of symbols\n    t.push({ s: -1, f: 25001 });\n    var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\n    t[0] = { s: -1, f: l.f + r.f, l: l, r: r };\n    // efficient algorithm from UZIP.js\n    // i0 is lookbehind, i2 is lookahead - after processing two low-freq\n    // symbols that combined have high freq, will start processing i2 (high-freq,\n    // non-composite) symbols instead\n    // see https://reddit.com/r/photopea/comments/ikekht/uzipjs_questions/\n    while (i1 != s - 1) {\n        l = t[t[i0].f < t[i2].f ? i0++ : i2++];\n        r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\n        t[i1++] = { s: -1, f: l.f + r.f, l: l, r: r };\n    }\n    var maxSym = t2[0].s;\n    for (var i = 1; i < s; ++i) {\n        if (t2[i].s > maxSym)\n            maxSym = t2[i].s;\n    }\n    // code lengths\n    var tr = new u16(maxSym + 1);\n    // max bits in tree\n    var mbt = ln(t[i1 - 1], tr, 0);\n    if (mbt > mb) {\n        // more algorithms from UZIP.js\n        // TODO: find out how this code works (debt)\n        //  ind    debt\n        var i = 0, dt = 0;\n        //    left            cost\n        var lft = mbt - mb, cst = 1 << lft;\n        t2.sort(function (a, b) { return tr[b.s] - tr[a.s] || a.f - b.f; });\n        for (; i < s; ++i) {\n            var i2_1 = t2[i].s;\n            if (tr[i2_1] > mb) {\n                dt += cst - (1 << (mbt - tr[i2_1]));\n                tr[i2_1] = mb;\n            }\n            else\n                break;\n        }\n        dt >>= lft;\n        while (dt > 0) {\n            var i2_2 = t2[i].s;\n            if (tr[i2_2] < mb)\n                dt -= 1 << (mb - tr[i2_2]++ - 1);\n            else\n                ++i;\n        }\n        for (; i >= 0 && dt; --i) {\n            var i2_3 = t2[i].s;\n            if (tr[i2_3] == mb) {\n                --tr[i2_3];\n                ++dt;\n            }\n        }\n        mbt = mb;\n    }\n    return { t: new u8(tr), l: mbt };\n};\n// get the max length and assign length codes\nvar ln = function (n, l, d) {\n    return n.s == -1\n        ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1))\n        : (l[n.s] = d);\n};\n// length codes generation\nvar lc = function (c) {\n    var s = c.length;\n    // Note that the semicolon was intentional\n    while (s && !c[--s])\n        ;\n    var cl = new u16(++s);\n    //  ind      num         streak\n    var cli = 0, cln = c[0], cls = 1;\n    var w = function (v) { cl[cli++] = v; };\n    for (var i = 1; i <= s; ++i) {\n        if (c[i] == cln && i != s)\n            ++cls;\n        else {\n            if (!cln && cls > 2) {\n                for (; cls > 138; cls -= 138)\n                    w(32754);\n                if (cls > 2) {\n                    w(cls > 10 ? ((cls - 11) << 5) | 28690 : ((cls - 3) << 5) | 12305);\n                    cls = 0;\n                }\n            }\n            else if (cls > 3) {\n                w(cln), --cls;\n                for (; cls > 6; cls -= 6)\n                    w(8304);\n                if (cls > 2)\n                    w(((cls - 3) << 5) | 8208), cls = 0;\n            }\n            while (cls--)\n                w(cln);\n            cls = 1;\n            cln = c[i];\n        }\n    }\n    return { c: cl.subarray(0, cli), n: s };\n};\n// calculate the length of output from tree, code lengths\nvar clen = function (cf, cl) {\n    var l = 0;\n    for (var i = 0; i < cl.length; ++i)\n        l += cf[i] * cl[i];\n    return l;\n};\n// writes a fixed block\n// returns the new bit pos\nvar wfblk = function (out, pos, dat) {\n    // no need to write 00 as type: TypedArray defaults to 0\n    var s = dat.length;\n    var o = shft(pos + 2);\n    out[o] = s & 255;\n    out[o + 1] = s >> 8;\n    out[o + 2] = out[o] ^ 255;\n    out[o + 3] = out[o + 1] ^ 255;\n    for (var i = 0; i < s; ++i)\n        out[o + i + 4] = dat[i];\n    return (o + 4 + s) * 8;\n};\n// writes a block\nvar wblk = function (dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\n    wbits(out, p++, final);\n    ++lf[256];\n    var _a = hTree(lf, 15), dlt = _a.t, mlb = _a.l;\n    var _b = hTree(df, 15), ddt = _b.t, mdb = _b.l;\n    var _c = lc(dlt), lclt = _c.c, nlc = _c.n;\n    var _d = lc(ddt), lcdt = _d.c, ndc = _d.n;\n    var lcfreq = new u16(19);\n    for (var i = 0; i < lclt.length; ++i)\n        ++lcfreq[lclt[i] & 31];\n    for (var i = 0; i < lcdt.length; ++i)\n        ++lcfreq[lcdt[i] & 31];\n    var _e = hTree(lcfreq, 7), lct = _e.t, mlcb = _e.l;\n    var nlcc = 19;\n    for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\n        ;\n    var flen = (bl + 5) << 3;\n    var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\n    var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + 2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18];\n    if (bs >= 0 && flen <= ftlen && flen <= dtlen)\n        return wfblk(out, p, dat.subarray(bs, bs + bl));\n    var lm, ll, dm, dl;\n    wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\n    if (dtlen < ftlen) {\n        lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\n        var llm = hMap(lct, mlcb, 0);\n        wbits(out, p, nlc - 257);\n        wbits(out, p + 5, ndc - 1);\n        wbits(out, p + 10, nlcc - 4);\n        p += 14;\n        for (var i = 0; i < nlcc; ++i)\n            wbits(out, p + 3 * i, lct[clim[i]]);\n        p += 3 * nlcc;\n        var lcts = [lclt, lcdt];\n        for (var it = 0; it < 2; ++it) {\n            var clct = lcts[it];\n            for (var i = 0; i < clct.length; ++i) {\n                var len = clct[i] & 31;\n                wbits(out, p, llm[len]), p += lct[len];\n                if (len > 15)\n                    wbits(out, p, (clct[i] >> 5) & 127), p += clct[i] >> 12;\n            }\n        }\n    }\n    else {\n        lm = flm, ll = flt, dm = fdm, dl = fdt;\n    }\n    for (var i = 0; i < li; ++i) {\n        var sym = syms[i];\n        if (sym > 255) {\n            var len = (sym >> 18) & 31;\n            wbits16(out, p, lm[len + 257]), p += ll[len + 257];\n            if (len > 7)\n                wbits(out, p, (sym >> 23) & 31), p += fleb[len];\n            var dst = sym & 31;\n            wbits16(out, p, dm[dst]), p += dl[dst];\n            if (dst > 3)\n                wbits16(out, p, (sym >> 5) & 8191), p += fdeb[dst];\n        }\n        else {\n            wbits16(out, p, lm[sym]), p += ll[sym];\n        }\n    }\n    wbits16(out, p, lm[256]);\n    return p + ll[256];\n};\n// deflate options (nice << 13) | chain\nvar deo = /*#__PURE__*/ new i32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\n// empty\nvar et = /*#__PURE__*/ new u8(0);\n// compresses data into a raw DEFLATE buffer\nvar dflt = function (dat, lvl, plvl, pre, post, st) {\n    var s = st.z || dat.length;\n    var o = new u8(pre + s + 5 * (1 + Math.ceil(s / 7000)) + post);\n    // writing to this writes to the output buffer\n    var w = o.subarray(pre, o.length - post);\n    var lst = st.l;\n    var pos = (st.r || 0) & 7;\n    if (lvl) {\n        if (pos)\n            w[0] = st.r >> 3;\n        var opt = deo[lvl - 1];\n        var n = opt >> 13, c = opt & 8191;\n        var msk_1 = (1 << plvl) - 1;\n        //    prev 2-byte val map    curr 2-byte val map\n        var prev = st.p || new u16(32768), head = st.h || new u16(msk_1 + 1);\n        var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\n        var hsh = function (i) { return (dat[i] ^ (dat[i + 1] << bs1_1) ^ (dat[i + 2] << bs2_1)) & msk_1; };\n        // 24576 is an arbitrary number of maximum symbols per block\n        // 424 buffer for last block\n        var syms = new i32(25000);\n        // length/literal freq   distance freq\n        var lf = new u16(288), df = new u16(32);\n        //  l/lcnt  exbits  index          l/lind  waitdx          blkpos\n        var lc_1 = 0, eb = 0, i = st.i || 0, li = 0, wi = st.w || 0, bs = 0;\n        for (; i + 2 < s; ++i) {\n            // hash value\n            var hv = hsh(i);\n            // index mod 32768    previous index mod\n            var imod = i & 32767, pimod = head[hv];\n            prev[imod] = pimod;\n            head[hv] = imod;\n            // We always should modify head and prev, but only add symbols if\n            // this data is not yet processed (\"wait\" for wait index)\n            if (wi <= i) {\n                // bytes remaining\n                var rem = s - i;\n                if ((lc_1 > 7000 || li > 24576) && (rem > 423 || !lst)) {\n                    pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\n                    li = lc_1 = eb = 0, bs = i;\n                    for (var j = 0; j < 286; ++j)\n                        lf[j] = 0;\n                    for (var j = 0; j < 30; ++j)\n                        df[j] = 0;\n                }\n                //  len    dist   chain\n                var l = 2, d = 0, ch_1 = c, dif = imod - pimod & 32767;\n                if (rem > 2 && hv == hsh(i - dif)) {\n                    var maxn = Math.min(n, rem) - 1;\n                    var maxd = Math.min(32767, i);\n                    // max possible length\n                    // not capped at dif because decompressors implement \"rolling\" index population\n                    var ml = Math.min(258, rem);\n                    while (dif <= maxd && --ch_1 && imod != pimod) {\n                        if (dat[i + l] == dat[i + l - dif]) {\n                            var nl = 0;\n                            for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\n                                ;\n                            if (nl > l) {\n                                l = nl, d = dif;\n                                // break out early when we reach \"nice\" (we are satisfied enough)\n                                if (nl > maxn)\n                                    break;\n                                // now, find the rarest 2-byte sequence within this\n                                // length of literals and search for that instead.\n                                // Much faster than just using the start\n                                var mmd = Math.min(dif, nl - 2);\n                                var md = 0;\n                                for (var j = 0; j < mmd; ++j) {\n                                    var ti = i - dif + j & 32767;\n                                    var pti = prev[ti];\n                                    var cd = ti - pti & 32767;\n                                    if (cd > md)\n                                        md = cd, pimod = ti;\n                                }\n                            }\n                        }\n                        // check the previous match\n                        imod = pimod, pimod = prev[imod];\n                        dif += imod - pimod & 32767;\n                    }\n                }\n                // d will be nonzero only when a match was found\n                if (d) {\n                    // store both dist and len data in one int32\n                    // Make sure this is recognized as a len/dist with 28th bit (2^28)\n                    syms[li++] = 268435456 | (revfl[l] << 18) | revfd[d];\n                    var lin = revfl[l] & 31, din = revfd[d] & 31;\n                    eb += fleb[lin] + fdeb[din];\n                    ++lf[257 + lin];\n                    ++df[din];\n                    wi = i + l;\n                    ++lc_1;\n                }\n                else {\n                    syms[li++] = dat[i];\n                    ++lf[dat[i]];\n                }\n            }\n        }\n        for (i = Math.max(i, wi); i < s; ++i) {\n            syms[li++] = dat[i];\n            ++lf[dat[i]];\n        }\n        pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\n        if (!lst) {\n            st.r = (pos & 7) | w[(pos / 8) | 0] << 3;\n            // shft(pos) now 1 less if pos & 7 != 0\n            pos -= 7;\n            st.h = head, st.p = prev, st.i = i, st.w = wi;\n        }\n    }\n    else {\n        for (var i = st.w || 0; i < s + lst; i += 65535) {\n            // end\n            var e = i + 65535;\n            if (e >= s) {\n                // write final block\n                w[(pos / 8) | 0] = lst;\n                e = s;\n            }\n            pos = wfblk(w, pos + 1, dat.subarray(i, e));\n        }\n        st.i = s;\n    }\n    return slc(o, 0, pre + shft(pos) + post);\n};\n// CRC32 table\nvar crct = /*#__PURE__*/ (function () {\n    var t = new Int32Array(256);\n    for (var i = 0; i < 256; ++i) {\n        var c = i, k = 9;\n        while (--k)\n            c = ((c & 1) && -306674912) ^ (c >>> 1);\n        t[i] = c;\n    }\n    return t;\n})();\n// CRC32\nvar crc = function () {\n    var c = -1;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var cr = c;\n            for (var i = 0; i < d.length; ++i)\n                cr = crct[(cr & 255) ^ d[i]] ^ (cr >>> 8);\n            c = cr;\n        },\n        d: function () { return ~c; }\n    };\n};\n// Adler32\nvar adler = function () {\n    var a = 1, b = 0;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var n = a, m = b;\n            var l = d.length | 0;\n            for (var i = 0; i != l;) {\n                var e = Math.min(i + 2655, l);\n                for (; i < e; ++i)\n                    m += n += d[i];\n                n = (n & 65535) + 15 * (n >> 16), m = (m & 65535) + 15 * (m >> 16);\n            }\n            a = n, b = m;\n        },\n        d: function () {\n            a %= 65521, b %= 65521;\n            return (a & 255) << 24 | (a & 0xFF00) << 8 | (b & 255) << 8 | (b >> 8);\n        }\n    };\n};\n;\n// deflate with opts\nvar dopt = function (dat, opt, pre, post, st) {\n    if (!st) {\n        st = { l: 1 };\n        if (opt.dictionary) {\n            var dict = opt.dictionary.subarray(-32768);\n            var newDat = new u8(dict.length + dat.length);\n            newDat.set(dict);\n            newDat.set(dat, dict.length);\n            dat = newDat;\n            st.w = dict.length;\n        }\n    }\n    return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? (st.l ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : 20) : (12 + opt.mem), pre, post, st);\n};\n// Walmart object spread\nvar mrg = function (a, b) {\n    var o = {};\n    for (var k in a)\n        o[k] = a[k];\n    for (var k in b)\n        o[k] = b[k];\n    return o;\n};\n// worker clone\n// This is possibly the craziest part of the entire codebase, despite how simple it may seem.\n// The only parameter to this function is a closure that returns an array of variables outside of the function scope.\n// We're going to try to figure out the variable names used in the closure as strings because that is crucial for workerization.\n// We will return an object mapping of true variable name to value (basically, the current scope as a JS object).\n// The reason we can't just use the original variable names is minifiers mangling the toplevel scope.\n// This took me three weeks to figure out how to do.\nvar wcln = function (fn, fnStr, td) {\n    var dt = fn();\n    var st = fn.toString();\n    var ks = st.slice(st.indexOf('[') + 1, st.lastIndexOf(']')).replace(/\\s+/g, '').split(',');\n    for (var i = 0; i < dt.length; ++i) {\n        var v = dt[i], k = ks[i];\n        if (typeof v == 'function') {\n            fnStr += ';' + k + '=';\n            var st_1 = v.toString();\n            if (v.prototype) {\n                // for global objects\n                if (st_1.indexOf('[native code]') != -1) {\n                    var spInd = st_1.indexOf(' ', 8) + 1;\n                    fnStr += st_1.slice(spInd, st_1.indexOf('(', spInd));\n                }\n                else {\n                    fnStr += st_1;\n                    for (var t in v.prototype)\n                        fnStr += ';' + k + '.prototype.' + t + '=' + v.prototype[t].toString();\n                }\n            }\n            else\n                fnStr += st_1;\n        }\n        else\n            td[k] = v;\n    }\n    return fnStr;\n};\nvar ch = [];\n// clone bufs\nvar cbfs = function (v) {\n    var tl = [];\n    for (var k in v) {\n        if (v[k].buffer) {\n            tl.push((v[k] = new v[k].constructor(v[k])).buffer);\n        }\n    }\n    return tl;\n};\n// use a worker to execute code\nvar wrkr = function (fns, init, id, cb) {\n    if (!ch[id]) {\n        var fnStr = '', td_1 = {}, m = fns.length - 1;\n        for (var i = 0; i < m; ++i)\n            fnStr = wcln(fns[i], fnStr, td_1);\n        ch[id] = { c: wcln(fns[m], fnStr, td_1), e: td_1 };\n    }\n    var td = mrg({}, ch[id].e);\n    return wk(ch[id].c + ';onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage=' + init.toString() + '}', id, td, cbfs(td), cb);\n};\n// base async inflate fn\nvar bInflt = function () { return [u8, u16, i32, fleb, fdeb, clim, fl, fd, flrm, fdrm, rev, ec, hMap, max, bits, bits16, shft, slc, err, inflt, inflateSync, pbf, gopt]; };\nvar bDflt = function () { return [u8, u16, i32, fleb, fdeb, clim, revfl, revfd, flm, flt, fdm, fdt, rev, deo, et, hMap, wbits, wbits16, hTree, ln, lc, clen, wfblk, wblk, shft, slc, dflt, dopt, deflateSync, pbf]; };\n// gzip extra\nvar gze = function () { return [gzh, gzhl, wbytes, crc, crct]; };\n// gunzip extra\nvar guze = function () { return [gzs, gzl]; };\n// zlib extra\nvar zle = function () { return [zlh, wbytes, adler]; };\n// unzlib extra\nvar zule = function () { return [zls]; };\n// post buf\nvar pbf = function (msg) { return postMessage(msg, [msg.buffer]); };\n// get opts\nvar gopt = function (o) { return o && {\n    out: o.size && new u8(o.size),\n    dictionary: o.dictionary\n}; };\n// async helper\nvar cbify = function (dat, opts, fns, init, id, cb) {\n    var w = wrkr(fns, init, id, function (err, dat) {\n        w.terminate();\n        cb(err, dat);\n    });\n    w.postMessage([dat, opts], opts.consume ? [dat.buffer] : []);\n    return function () { w.terminate(); };\n};\n// auto stream\nvar astrm = function (strm) {\n    strm.ondata = function (dat, final) { return postMessage([dat, final], [dat.buffer]); };\n    return function (ev) {\n        if (ev.data.length) {\n            strm.push(ev.data[0], ev.data[1]);\n            postMessage([ev.data[0].length]);\n        }\n        else\n            strm.flush();\n    };\n};\n// async stream attach\nvar astrmify = function (fns, strm, opts, init, id, flush, ext) {\n    var t;\n    var w = wrkr(fns, init, id, function (err, dat) {\n        if (err)\n            w.terminate(), strm.ondata.call(strm, err);\n        else if (!Array.isArray(dat))\n            ext(dat);\n        else if (dat.length == 1) {\n            strm.queuedSize -= dat[0];\n            if (strm.ondrain)\n                strm.ondrain(dat[0]);\n        }\n        else {\n            if (dat[1])\n                w.terminate();\n            strm.ondata.call(strm, err, dat[0], dat[1]);\n        }\n    });\n    w.postMessage(opts);\n    strm.queuedSize = 0;\n    strm.push = function (d, f) {\n        if (!strm.ondata)\n            err(5);\n        if (t)\n            strm.ondata(err(4, 0, 1), null, !!f);\n        strm.queuedSize += d.length;\n        w.postMessage([d, t = f], [d.buffer]);\n    };\n    strm.terminate = function () { w.terminate(); };\n    if (flush) {\n        strm.flush = function () { w.postMessage([]); };\n    }\n};\n// read 2 bytes\nvar b2 = function (d, b) { return d[b] | (d[b + 1] << 8); };\n// read 4 bytes\nvar b4 = function (d, b) { return (d[b] | (d[b + 1] << 8) | (d[b + 2] << 16) | (d[b + 3] << 24)) >>> 0; };\nvar b8 = function (d, b) { return b4(d, b) + (b4(d, b + 4) * 4294967296); };\n// write bytes\nvar wbytes = function (d, b, v) {\n    for (; v; ++b)\n        d[b] = v, v >>>= 8;\n};\n// gzip header\nvar gzh = function (c, o) {\n    var fn = o.filename;\n    c[0] = 31, c[1] = 139, c[2] = 8, c[8] = o.level < 2 ? 4 : o.level == 9 ? 2 : 0, c[9] = 3; // assume Unix\n    if (o.mtime != 0)\n        wbytes(c, 4, Math.floor(new Date(o.mtime || Date.now()) / 1000));\n    if (fn) {\n        c[3] = 8;\n        for (var i = 0; i <= fn.length; ++i)\n            c[i + 10] = fn.charCodeAt(i);\n    }\n};\n// gzip footer: -8 to -4 = CRC, -4 to -0 is length\n// gzip start\nvar gzs = function (d) {\n    if (d[0] != 31 || d[1] != 139 || d[2] != 8)\n        err(6, 'invalid gzip data');\n    var flg = d[3];\n    var st = 10;\n    if (flg & 4)\n        st += (d[10] | d[11] << 8) + 2;\n    for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\n        ;\n    return st + (flg & 2);\n};\n// gzip length\nvar gzl = function (d) {\n    var l = d.length;\n    return (d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16 | d[l - 1] << 24) >>> 0;\n};\n// gzip header length\nvar gzhl = function (o) { return 10 + (o.filename ? o.filename.length + 1 : 0); };\n// zlib header\nvar zlh = function (c, o) {\n    var lv = o.level, fl = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\n    c[0] = 120, c[1] = (fl << 6) | (o.dictionary && 32);\n    c[1] |= 31 - ((c[0] << 8) | c[1]) % 31;\n    if (o.dictionary) {\n        var h = adler();\n        h.p(o.dictionary);\n        wbytes(c, 2, h.d());\n    }\n};\n// zlib start\nvar zls = function (d, dict) {\n    if ((d[0] & 15) != 8 || (d[0] >> 4) > 7 || ((d[0] << 8 | d[1]) % 31))\n        err(6, 'invalid zlib data');\n    if ((d[1] >> 5 & 1) == +!dict)\n        err(6, 'invalid zlib data: ' + (d[1] & 32 ? 'need' : 'unexpected') + ' dictionary');\n    return (d[1] >> 3 & 4) + 2;\n};\nfunction StrmOpt(opts, cb) {\n    if (typeof opts == 'function')\n        cb = opts, opts = {};\n    this.ondata = cb;\n    return opts;\n}\n/**\n * Streaming DEFLATE compression\n */\nvar Deflate = /*#__PURE__*/ (function () {\n    function Deflate(opts, cb) {\n        if (typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        this.o = opts || {};\n        this.s = { l: 0, i: 32768, w: 32768, z: 32768 };\n        // Buffer length must always be 0 mod 32768 for index calculations to be correct when modifying head and prev\n        // 98304 = 32768 (lookback) + 65536 (common chunk size)\n        this.b = new u8(98304);\n        if (this.o.dictionary) {\n            var dict = this.o.dictionary.subarray(-32768);\n            this.b.set(dict, 32768 - dict.length);\n            this.s.i = 32768 - dict.length;\n        }\n    }\n    Deflate.prototype.p = function (c, f) {\n        this.ondata(dopt(c, this.o, 0, 0, this.s), f);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Deflate.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (this.s.l)\n            err(4);\n        var endLen = chunk.length + this.s.z;\n        if (endLen > this.b.length) {\n            if (endLen > 2 * this.b.length - 32768) {\n                var newBuf = new u8(endLen & -32768);\n                newBuf.set(this.b.subarray(0, this.s.z));\n                this.b = newBuf;\n            }\n            var split = this.b.length - this.s.z;\n            this.b.set(chunk.subarray(0, split), this.s.z);\n            this.s.z = this.b.length;\n            this.p(this.b, false);\n            this.b.set(this.b.subarray(-32768));\n            this.b.set(chunk.subarray(split), 32768);\n            this.s.z = chunk.length - split + 32768;\n            this.s.i = 32766, this.s.w = 32768;\n        }\n        else {\n            this.b.set(chunk, this.s.z);\n            this.s.z += chunk.length;\n        }\n        this.s.l = final & 1;\n        if (this.s.z > this.s.w + 8191 || final) {\n            this.p(this.b, final || false);\n            this.s.w = this.s.i, this.s.i -= 2;\n        }\n    };\n    /**\n     * Flushes buffered uncompressed data. Useful to immediately retrieve the\n     * deflated output for small inputs.\n     */\n    Deflate.prototype.flush = function () {\n        if (!this.ondata)\n            err(5);\n        if (this.s.l)\n            err(4);\n        this.p(this.b, false);\n        this.s.w = this.s.i, this.s.i -= 2;\n    };\n    return Deflate;\n}());\nexport { Deflate };\n/**\n * Asynchronous streaming DEFLATE compression\n */\nvar AsyncDeflate = /*#__PURE__*/ (function () {\n    function AsyncDeflate(opts, cb) {\n        astrmify([\n            bDflt,\n            function () { return [astrm, Deflate]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Deflate(ev.data);\n            onmessage = astrm(strm);\n        }, 6, 1);\n    }\n    return AsyncDeflate;\n}());\nexport { AsyncDeflate };\nexport function deflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n    ], function (ev) { return pbf(deflateSync(ev.data[0], ev.data[1])); }, 0, cb);\n}\n/**\n * Compresses data with DEFLATE without any wrapper\n * @param data The data to compress\n * @param opts The compression options\n * @returns The deflated version of the data\n */\nexport function deflateSync(data, opts) {\n    return dopt(data, opts || {}, 0, 0);\n}\n/**\n * Streaming DEFLATE decompression\n */\nvar Inflate = /*#__PURE__*/ (function () {\n    function Inflate(opts, cb) {\n        // no StrmOpt here to avoid adding to workerizer\n        if (typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        var dict = opts && opts.dictionary && opts.dictionary.subarray(-32768);\n        this.s = { i: 0, b: dict ? dict.length : 0 };\n        this.o = new u8(32768);\n        this.p = new u8(0);\n        if (dict)\n            this.o.set(dict);\n    }\n    Inflate.prototype.e = function (c) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        if (!this.p.length)\n            this.p = c;\n        else if (c.length) {\n            var n = new u8(this.p.length + c.length);\n            n.set(this.p), n.set(c, this.p.length), this.p = n;\n        }\n    };\n    Inflate.prototype.c = function (final) {\n        this.s.i = +(this.d = final || false);\n        var bts = this.s.b;\n        var dt = inflt(this.p, this.s, this.o);\n        this.ondata(slc(dt, bts, this.s.b), this.d);\n        this.o = slc(dt, this.s.b - 32768), this.s.b = this.o.length;\n        this.p = slc(this.p, (this.s.p / 8) | 0), this.s.p &= 7;\n    };\n    /**\n     * Pushes a chunk to be inflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the final chunk\n     */\n    Inflate.prototype.push = function (chunk, final) {\n        this.e(chunk), this.c(final);\n    };\n    return Inflate;\n}());\nexport { Inflate };\n/**\n * Asynchronous streaming DEFLATE decompression\n */\nvar AsyncInflate = /*#__PURE__*/ (function () {\n    function AsyncInflate(opts, cb) {\n        astrmify([\n            bInflt,\n            function () { return [astrm, Inflate]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Inflate(ev.data);\n            onmessage = astrm(strm);\n        }, 7, 0);\n    }\n    return AsyncInflate;\n}());\nexport { AsyncInflate };\nexport function inflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt\n    ], function (ev) { return pbf(inflateSync(ev.data[0], gopt(ev.data[1]))); }, 1, cb);\n}\n/**\n * Expands DEFLATE data with no wrapper\n * @param data The data to decompress\n * @param opts The decompression options\n * @returns The decompressed version of the data\n */\nexport function inflateSync(data, opts) {\n    return inflt(data, { i: 2 }, opts && opts.out, opts && opts.dictionary);\n}\n// before you yell at me for not just using extends, my reason is that TS inheritance is hard to workerize.\n/**\n * Streaming GZIP compression\n */\nvar Gzip = /*#__PURE__*/ (function () {\n    function Gzip(opts, cb) {\n        this.c = crc();\n        this.l = 0;\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gzip.prototype.push = function (chunk, final) {\n        this.c.p(chunk);\n        this.l += chunk.length;\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Gzip.prototype.p = function (c, f) {\n        var raw = dopt(c, this.o, this.v && gzhl(this.o), f && 8, this.s);\n        if (this.v)\n            gzh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 8, this.c.d()), wbytes(raw, raw.length - 4, this.l);\n        this.ondata(raw, f);\n    };\n    /**\n     * Flushes buffered uncompressed data. Useful to immediately retrieve the\n     * GZIPped output for small inputs.\n     */\n    Gzip.prototype.flush = function () {\n        Deflate.prototype.flush.call(this);\n    };\n    return Gzip;\n}());\nexport { Gzip };\n/**\n * Asynchronous streaming GZIP compression\n */\nvar AsyncGzip = /*#__PURE__*/ (function () {\n    function AsyncGzip(opts, cb) {\n        astrmify([\n            bDflt,\n            gze,\n            function () { return [astrm, Deflate, Gzip]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Gzip(ev.data);\n            onmessage = astrm(strm);\n        }, 8, 1);\n    }\n    return AsyncGzip;\n}());\nexport { AsyncGzip };\nexport function gzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n        gze,\n        function () { return [gzipSync]; }\n    ], function (ev) { return pbf(gzipSync(ev.data[0], ev.data[1])); }, 2, cb);\n}\n/**\n * Compresses data with GZIP\n * @param data The data to compress\n * @param opts The compression options\n * @returns The gzipped version of the data\n */\nexport function gzipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var c = crc(), l = data.length;\n    c.p(data);\n    var d = dopt(data, opts, gzhl(opts), 8), s = d.length;\n    return gzh(d, opts), wbytes(d, s - 8, c.d()), wbytes(d, s - 4, l), d;\n}\n/**\n * Streaming single or multi-member GZIP decompression\n */\nvar Gunzip = /*#__PURE__*/ (function () {\n    function Gunzip(opts, cb) {\n        this.v = 1;\n        this.r = 0;\n        Inflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GUNZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gunzip.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        this.r += chunk.length;\n        if (this.v) {\n            var p = this.p.subarray(this.v - 1);\n            var s = p.length > 3 ? gzs(p) : 4;\n            if (s > p.length) {\n                if (!final)\n                    return;\n            }\n            else if (this.v > 1 && this.onmember) {\n                this.onmember(this.r - p.length);\n            }\n            this.p = p.subarray(s), this.v = 0;\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n        // process concatenated GZIP\n        if (this.s.f && !this.s.l && !final) {\n            this.v = shft(this.s.p) + 9;\n            this.s = { i: 0 };\n            this.o = new u8(0);\n            this.push(new u8(0), final);\n        }\n    };\n    return Gunzip;\n}());\nexport { Gunzip };\n/**\n * Asynchronous streaming single or multi-member GZIP decompression\n */\nvar AsyncGunzip = /*#__PURE__*/ (function () {\n    function AsyncGunzip(opts, cb) {\n        var _this = this;\n        astrmify([\n            bInflt,\n            guze,\n            function () { return [astrm, Inflate, Gunzip]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Gunzip(ev.data);\n            strm.onmember = function (offset) { return postMessage(offset); };\n            onmessage = astrm(strm);\n        }, 9, 0, function (offset) { return _this.onmember && _this.onmember(offset); });\n    }\n    return AsyncGunzip;\n}());\nexport { AsyncGunzip };\nexport function gunzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt,\n        guze,\n        function () { return [gunzipSync]; }\n    ], function (ev) { return pbf(gunzipSync(ev.data[0], ev.data[1])); }, 3, cb);\n}\n/**\n * Expands GZIP data\n * @param data The data to decompress\n * @param opts The decompression options\n * @returns The decompressed version of the data\n */\nexport function gunzipSync(data, opts) {\n    var st = gzs(data);\n    if (st + 8 > data.length)\n        err(6, 'invalid gzip data');\n    return inflt(data.subarray(st, -8), { i: 2 }, opts && opts.out || new u8(gzl(data)), opts && opts.dictionary);\n}\n/**\n * Streaming Zlib compression\n */\nvar Zlib = /*#__PURE__*/ (function () {\n    function Zlib(opts, cb) {\n        this.c = adler();\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be zlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Zlib.prototype.push = function (chunk, final) {\n        this.c.p(chunk);\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Zlib.prototype.p = function (c, f) {\n        var raw = dopt(c, this.o, this.v && (this.o.dictionary ? 6 : 2), f && 4, this.s);\n        if (this.v)\n            zlh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 4, this.c.d());\n        this.ondata(raw, f);\n    };\n    /**\n     * Flushes buffered uncompressed data. Useful to immediately retrieve the\n     * zlibbed output for small inputs.\n     */\n    Zlib.prototype.flush = function () {\n        Deflate.prototype.flush.call(this);\n    };\n    return Zlib;\n}());\nexport { Zlib };\n/**\n * Asynchronous streaming Zlib compression\n */\nvar AsyncZlib = /*#__PURE__*/ (function () {\n    function AsyncZlib(opts, cb) {\n        astrmify([\n            bDflt,\n            zle,\n            function () { return [astrm, Deflate, Zlib]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Zlib(ev.data);\n            onmessage = astrm(strm);\n        }, 10, 1);\n    }\n    return AsyncZlib;\n}());\nexport { AsyncZlib };\nexport function zlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bDflt,\n        zle,\n        function () { return [zlibSync]; }\n    ], function (ev) { return pbf(zlibSync(ev.data[0], ev.data[1])); }, 4, cb);\n}\n/**\n * Compress data with Zlib\n * @param data The data to compress\n * @param opts The compression options\n * @returns The zlib-compressed version of the data\n */\nexport function zlibSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var a = adler();\n    a.p(data);\n    var d = dopt(data, opts, opts.dictionary ? 6 : 2, 4);\n    return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\n}\n/**\n * Streaming Zlib decompression\n */\nvar Unzlib = /*#__PURE__*/ (function () {\n    function Unzlib(opts, cb) {\n        Inflate.call(this, opts, cb);\n        this.v = opts && opts.dictionary ? 2 : 1;\n    }\n    /**\n     * Pushes a chunk to be unzlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzlib.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            if (this.p.length < 6 && !final)\n                return;\n            this.p = this.p.subarray(zls(this.p, this.v - 1)), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 4)\n                err(6, 'invalid zlib data');\n            this.p = this.p.subarray(0, -4);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Unzlib;\n}());\nexport { Unzlib };\n/**\n * Asynchronous streaming Zlib decompression\n */\nvar AsyncUnzlib = /*#__PURE__*/ (function () {\n    function AsyncUnzlib(opts, cb) {\n        astrmify([\n            bInflt,\n            zule,\n            function () { return [astrm, Inflate, Unzlib]; }\n        ], this, StrmOpt.call(this, opts, cb), function (ev) {\n            var strm = new Unzlib(ev.data);\n            onmessage = astrm(strm);\n        }, 11, 0);\n    }\n    return AsyncUnzlib;\n}());\nexport { AsyncUnzlib };\nexport function unzlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return cbify(data, opts, [\n        bInflt,\n        zule,\n        function () { return [unzlibSync]; }\n    ], function (ev) { return pbf(unzlibSync(ev.data[0], gopt(ev.data[1]))); }, 5, cb);\n}\n/**\n * Expands Zlib data\n * @param data The data to decompress\n * @param opts The decompression options\n * @returns The decompressed version of the data\n */\nexport function unzlibSync(data, opts) {\n    return inflt(data.subarray(zls(data, opts && opts.dictionary), -4), { i: 2 }, opts && opts.out, opts && opts.dictionary);\n}\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzip as compress, AsyncGzip as AsyncCompress };\nexport { gzipSync as compressSync, Gzip as Compress };\n/**\n * Streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar Decompress = /*#__PURE__*/ (function () {\n    function Decompress(opts, cb) {\n        this.o = StrmOpt.call(this, opts, cb) || {};\n        this.G = Gunzip;\n        this.I = Inflate;\n        this.Z = Unzlib;\n    }\n    // init substream\n    // overriden by AsyncDecompress\n    Decompress.prototype.i = function () {\n        var _this = this;\n        this.s.ondata = function (dat, final) {\n            _this.ondata(dat, final);\n        };\n    };\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Decompress.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (!this.s) {\n            if (this.p && this.p.length) {\n                var n = new u8(this.p.length + chunk.length);\n                n.set(this.p), n.set(chunk, this.p.length);\n            }\n            else\n                this.p = chunk;\n            if (this.p.length > 2) {\n                this.s = (this.p[0] == 31 && this.p[1] == 139 && this.p[2] == 8)\n                    ? new this.G(this.o)\n                    : ((this.p[0] & 15) != 8 || (this.p[0] >> 4) > 7 || ((this.p[0] << 8 | this.p[1]) % 31))\n                        ? new this.I(this.o)\n                        : new this.Z(this.o);\n                this.i();\n                this.s.push(this.p, final);\n                this.p = null;\n            }\n        }\n        else\n            this.s.push(chunk, final);\n    };\n    return Decompress;\n}());\nexport { Decompress };\n/**\n * Asynchronous streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar AsyncDecompress = /*#__PURE__*/ (function () {\n    function AsyncDecompress(opts, cb) {\n        Decompress.call(this, opts, cb);\n        this.queuedSize = 0;\n        this.G = AsyncGunzip;\n        this.I = AsyncInflate;\n        this.Z = AsyncUnzlib;\n    }\n    AsyncDecompress.prototype.i = function () {\n        var _this = this;\n        this.s.ondata = function (err, dat, final) {\n            _this.ondata(err, dat, final);\n        };\n        this.s.ondrain = function (size) {\n            _this.queuedSize -= size;\n            if (_this.ondrain)\n                _this.ondrain(size);\n        };\n    };\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncDecompress.prototype.push = function (chunk, final) {\n        this.queuedSize += chunk.length;\n        Decompress.prototype.push.call(this, chunk, final);\n    };\n    return AsyncDecompress;\n}());\nexport { AsyncDecompress };\nexport function decompress(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzip(data, opts, cb)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflate(data, opts, cb)\n            : unzlib(data, opts, cb);\n}\n/**\n * Expands compressed GZIP, Zlib, or raw DEFLATE data, automatically detecting the format\n * @param data The data to decompress\n * @param opts The decompression options\n * @returns The decompressed version of the data\n */\nexport function decompressSync(data, opts) {\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzipSync(data, opts)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflateSync(data, opts)\n            : unzlibSync(data, opts);\n}\n// flatten a directory structure\nvar fltn = function (d, p, t, o) {\n    for (var k in d) {\n        var val = d[k], n = p + k, op = o;\n        if (Array.isArray(val))\n            op = mrg(o, val[1]), val = val[0];\n        if (val instanceof u8)\n            t[n] = [val, op];\n        else {\n            t[n += '/'] = [new u8(0), op];\n            fltn(val, n, t, o);\n        }\n    }\n};\n// text encoder\nvar te = typeof TextEncoder != 'undefined' && /*#__PURE__*/ new TextEncoder();\n// text decoder\nvar td = typeof TextDecoder != 'undefined' && /*#__PURE__*/ new TextDecoder();\n// text decoder stream\nvar tds = 0;\ntry {\n    td.decode(et, { stream: true });\n    tds = 1;\n}\ncatch (e) { }\n// decode UTF8\nvar dutf8 = function (d) {\n    for (var r = '', i = 0;;) {\n        var c = d[i++];\n        var eb = (c > 127) + (c > 223) + (c > 239);\n        if (i + eb > d.length)\n            return { s: r, r: slc(d, i - 1) };\n        if (!eb)\n            r += String.fromCharCode(c);\n        else if (eb == 3) {\n            c = ((c & 15) << 18 | (d[i++] & 63) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63)) - 65536,\n                r += String.fromCharCode(55296 | (c >> 10), 56320 | (c & 1023));\n        }\n        else if (eb & 1)\n            r += String.fromCharCode((c & 31) << 6 | (d[i++] & 63));\n        else\n            r += String.fromCharCode((c & 15) << 12 | (d[i++] & 63) << 6 | (d[i++] & 63));\n    }\n};\n/**\n * Streaming UTF-8 decoding\n */\nvar DecodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is decoded\n     */\n    function DecodeUTF8(cb) {\n        this.ondata = cb;\n        if (tds)\n            this.t = new TextDecoder();\n        else\n            this.p = et;\n    }\n    /**\n     * Pushes a chunk to be decoded from UTF-8 binary\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    DecodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        final = !!final;\n        if (this.t) {\n            this.ondata(this.t.decode(chunk, { stream: true }), final);\n            if (final) {\n                if (this.t.decode().length)\n                    err(8);\n                this.t = null;\n            }\n            return;\n        }\n        if (!this.p)\n            err(4);\n        var dat = new u8(this.p.length + chunk.length);\n        dat.set(this.p);\n        dat.set(chunk, this.p.length);\n        var _a = dutf8(dat), s = _a.s, r = _a.r;\n        if (final) {\n            if (r.length)\n                err(8);\n            this.p = null;\n        }\n        else\n            this.p = r;\n        this.ondata(s, final);\n    };\n    return DecodeUTF8;\n}());\nexport { DecodeUTF8 };\n/**\n * Streaming UTF-8 encoding\n */\nvar EncodeUTF8 = /*#__PURE__*/ (function () {\n    /**\n     * Creates a UTF-8 decoding stream\n     * @param cb The callback to call whenever data is encoded\n     */\n    function EncodeUTF8(cb) {\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be encoded to UTF-8\n     * @param chunk The string data to push\n     * @param final Whether this is the last chunk\n     */\n    EncodeUTF8.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        if (this.d)\n            err(4);\n        this.ondata(strToU8(chunk), this.d = final || false);\n    };\n    return EncodeUTF8;\n}());\nexport { EncodeUTF8 };\n/**\n * Converts a string into a Uint8Array for use with compression/decompression methods\n * @param str The string to encode\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless decoding a binary string.\n * @returns The string encoded in UTF-8/Latin-1 binary\n */\nexport function strToU8(str, latin1) {\n    if (latin1) {\n        var ar_1 = new u8(str.length);\n        for (var i = 0; i < str.length; ++i)\n            ar_1[i] = str.charCodeAt(i);\n        return ar_1;\n    }\n    if (te)\n        return te.encode(str);\n    var l = str.length;\n    var ar = new u8(str.length + (str.length >> 1));\n    var ai = 0;\n    var w = function (v) { ar[ai++] = v; };\n    for (var i = 0; i < l; ++i) {\n        if (ai + 5 > ar.length) {\n            var n = new u8(ai + 8 + ((l - i) << 1));\n            n.set(ar);\n            ar = n;\n        }\n        var c = str.charCodeAt(i);\n        if (c < 128 || latin1)\n            w(c);\n        else if (c < 2048)\n            w(192 | (c >> 6)), w(128 | (c & 63));\n        else if (c > 55295 && c < 57344)\n            c = 65536 + (c & 1023 << 10) | (str.charCodeAt(++i) & 1023),\n                w(240 | (c >> 18)), w(128 | ((c >> 12) & 63)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n        else\n            w(224 | (c >> 12)), w(128 | ((c >> 6) & 63)), w(128 | (c & 63));\n    }\n    return slc(ar, 0, ai);\n}\n/**\n * Converts a Uint8Array to a string\n * @param dat The data to decode to string\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless encoding to binary string.\n * @returns The original UTF-8/Latin-1 string\n */\nexport function strFromU8(dat, latin1) {\n    if (latin1) {\n        var r = '';\n        for (var i = 0; i < dat.length; i += 16384)\n            r += String.fromCharCode.apply(null, dat.subarray(i, i + 16384));\n        return r;\n    }\n    else if (td) {\n        return td.decode(dat);\n    }\n    else {\n        var _a = dutf8(dat), s = _a.s, r = _a.r;\n        if (r.length)\n            err(8);\n        return s;\n    }\n}\n;\n// deflate bit flag\nvar dbf = function (l) { return l == 1 ? 3 : l < 6 ? 2 : l == 9 ? 1 : 0; };\n// skip local zip header\nvar slzh = function (d, b) { return b + 30 + b2(d, b + 26) + b2(d, b + 28); };\n// read zip header\nvar zh = function (d, b, z) {\n    var fnl = b2(d, b + 28), fn = strFromU8(d.subarray(b + 46, b + 46 + fnl), !(b2(d, b + 8) & 2048)), es = b + 46 + fnl, bs = b4(d, b + 20);\n    var _a = z && bs == 4294967295 ? z64e(d, es) : [bs, b4(d, b + 24), b4(d, b + 42)], sc = _a[0], su = _a[1], off = _a[2];\n    return [b2(d, b + 10), sc, su, fn, es + b2(d, b + 30) + b2(d, b + 32), off];\n};\n// read zip64 extra field\nvar z64e = function (d, b) {\n    for (; b2(d, b) != 1; b += 4 + b2(d, b + 2))\n        ;\n    return [b8(d, b + 12), b8(d, b + 4), b8(d, b + 20)];\n};\n// extra field length\nvar exfl = function (ex) {\n    var le = 0;\n    if (ex) {\n        for (var k in ex) {\n            var l = ex[k].length;\n            if (l > 65535)\n                err(9);\n            le += l + 4;\n        }\n    }\n    return le;\n};\n// write zip header\nvar wzh = function (d, b, f, fn, u, c, ce, co) {\n    var fl = fn.length, ex = f.extra, col = co && co.length;\n    var exl = exfl(ex);\n    wbytes(d, b, ce != null ? 0x2014B50 : 0x4034B50), b += 4;\n    if (ce != null)\n        d[b++] = 20, d[b++] = f.os;\n    d[b] = 20, b += 2; // spec compliance? what's that?\n    d[b++] = (f.flag << 1) | (c < 0 && 8), d[b++] = u && 8;\n    d[b++] = f.compression & 255, d[b++] = f.compression >> 8;\n    var dt = new Date(f.mtime == null ? Date.now() : f.mtime), y = dt.getFullYear() - 1980;\n    if (y < 0 || y > 119)\n        err(10);\n    wbytes(d, b, (y << 25) | ((dt.getMonth() + 1) << 21) | (dt.getDate() << 16) | (dt.getHours() << 11) | (dt.getMinutes() << 5) | (dt.getSeconds() >> 1)), b += 4;\n    if (c != -1) {\n        wbytes(d, b, f.crc);\n        wbytes(d, b + 4, c < 0 ? -c - 2 : c);\n        wbytes(d, b + 8, f.size);\n    }\n    wbytes(d, b + 12, fl);\n    wbytes(d, b + 14, exl), b += 16;\n    if (ce != null) {\n        wbytes(d, b, col);\n        wbytes(d, b + 6, f.attrs);\n        wbytes(d, b + 10, ce), b += 14;\n    }\n    d.set(fn, b);\n    b += fl;\n    if (exl) {\n        for (var k in ex) {\n            var exf = ex[k], l = exf.length;\n            wbytes(d, b, +k);\n            wbytes(d, b + 2, l);\n            d.set(exf, b + 4), b += 4 + l;\n        }\n    }\n    if (col)\n        d.set(co, b), b += col;\n    return b;\n};\n// write zip footer (end of central directory)\nvar wzf = function (o, b, c, d, e) {\n    wbytes(o, b, 0x6054B50); // skip disk\n    wbytes(o, b + 8, c);\n    wbytes(o, b + 10, c);\n    wbytes(o, b + 12, d);\n    wbytes(o, b + 16, e);\n};\n/**\n * A pass-through stream to keep data uncompressed in a ZIP archive.\n */\nvar ZipPassThrough = /*#__PURE__*/ (function () {\n    /**\n     * Creates a pass-through stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     */\n    function ZipPassThrough(filename) {\n        this.filename = filename;\n        this.c = crc();\n        this.size = 0;\n        this.compression = 0;\n    }\n    /**\n     * Processes a chunk and pushes to the output stream. You can override this\n     * method in a subclass for custom behavior, but by default this passes\n     * the data through. You must call this.ondata(err, chunk, final) at some\n     * point in this method.\n     * @param chunk The chunk to process\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.process = function (chunk, final) {\n        this.ondata(null, chunk, final);\n    };\n    /**\n     * Pushes a chunk to be added. If you are subclassing this with a custom\n     * compression algorithm, note that you must push data from the source\n     * file only, pre-compression.\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipPassThrough.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            err(5);\n        this.c.p(chunk);\n        this.size += chunk.length;\n        if (final)\n            this.crc = this.c.d();\n        this.process(chunk, final || false);\n    };\n    return ZipPassThrough;\n}());\nexport { ZipPassThrough };\n// I don't extend because TypeScript extension adds 1kB of runtime bloat\n/**\n * Streaming DEFLATE compression for ZIP archives. Prefer using AsyncZipDeflate\n * for better performance\n */\nvar ZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function ZipDeflate(filename, opts) {\n        var _this = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new Deflate(opts, function (dat, final) {\n            _this.ondata(null, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n    }\n    ZipDeflate.prototype.process = function (chunk, final) {\n        try {\n            this.d.push(chunk, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    ZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return ZipDeflate;\n}());\nexport { ZipDeflate };\n/**\n * Asynchronous streaming DEFLATE compression for ZIP archives\n */\nvar AsyncZipDeflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous DEFLATE stream that can be added to ZIP archives\n     * @param filename The filename to associate with this data stream\n     * @param opts The compression options\n     */\n    function AsyncZipDeflate(filename, opts) {\n        var _this = this;\n        if (!opts)\n            opts = {};\n        ZipPassThrough.call(this, filename);\n        this.d = new AsyncDeflate(opts, function (err, dat, final) {\n            _this.ondata(err, dat, final);\n        });\n        this.compression = 8;\n        this.flag = dbf(opts.level);\n        this.terminate = this.d.terminate;\n    }\n    AsyncZipDeflate.prototype.process = function (chunk, final) {\n        this.d.push(chunk, final);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncZipDeflate.prototype.push = function (chunk, final) {\n        ZipPassThrough.prototype.push.call(this, chunk, final);\n    };\n    return AsyncZipDeflate;\n}());\nexport { AsyncZipDeflate };\n// TODO: Better tree shaking\n/**\n * A zippable archive to which files can incrementally be added\n */\nvar Zip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an empty ZIP archive to which files can be added\n     * @param cb The callback to call whenever data for the generated ZIP archive\n     *           is available\n     */\n    function Zip(cb) {\n        this.ondata = cb;\n        this.u = [];\n        this.d = 1;\n    }\n    /**\n     * Adds a file to the ZIP archive\n     * @param file The file stream to add\n     */\n    Zip.prototype.add = function (file) {\n        var _this = this;\n        if (!this.ondata)\n            err(5);\n        // finishing or finished\n        if (this.d & 2)\n            this.ondata(err(4 + (this.d & 1) * 8, 0, 1), null, false);\n        else {\n            var f = strToU8(file.filename), fl_1 = f.length;\n            var com = file.comment, o = com && strToU8(com);\n            var u = fl_1 != file.filename.length || (o && (com.length != o.length));\n            var hl_1 = fl_1 + exfl(file.extra) + 30;\n            if (fl_1 > 65535)\n                this.ondata(err(11, 0, 1), null, false);\n            var header = new u8(hl_1);\n            wzh(header, 0, file, f, u, -1);\n            var chks_1 = [header];\n            var pAll_1 = function () {\n                for (var _i = 0, chks_2 = chks_1; _i < chks_2.length; _i++) {\n                    var chk = chks_2[_i];\n                    _this.ondata(null, chk, false);\n                }\n                chks_1 = [];\n            };\n            var tr_1 = this.d;\n            this.d = 0;\n            var ind_1 = this.u.length;\n            var uf_1 = mrg(file, {\n                f: f,\n                u: u,\n                o: o,\n                t: function () {\n                    if (file.terminate)\n                        file.terminate();\n                },\n                r: function () {\n                    pAll_1();\n                    if (tr_1) {\n                        var nxt = _this.u[ind_1 + 1];\n                        if (nxt)\n                            nxt.r();\n                        else\n                            _this.d = 1;\n                    }\n                    tr_1 = 1;\n                }\n            });\n            var cl_1 = 0;\n            file.ondata = function (err, dat, final) {\n                if (err) {\n                    _this.ondata(err, dat, final);\n                    _this.terminate();\n                }\n                else {\n                    cl_1 += dat.length;\n                    chks_1.push(dat);\n                    if (final) {\n                        var dd = new u8(16);\n                        wbytes(dd, 0, 0x8074B50);\n                        wbytes(dd, 4, file.crc);\n                        wbytes(dd, 8, cl_1);\n                        wbytes(dd, 12, file.size);\n                        chks_1.push(dd);\n                        uf_1.c = cl_1, uf_1.b = hl_1 + cl_1 + 16, uf_1.crc = file.crc, uf_1.size = file.size;\n                        if (tr_1)\n                            uf_1.r();\n                        tr_1 = 1;\n                    }\n                    else if (tr_1)\n                        pAll_1();\n                }\n            };\n            this.u.push(uf_1);\n        }\n    };\n    /**\n     * Ends the process of adding files and prepares to emit the final chunks.\n     * This *must* be called after adding all desired files for the resulting\n     * ZIP file to work properly.\n     */\n    Zip.prototype.end = function () {\n        var _this = this;\n        if (this.d & 2) {\n            this.ondata(err(4 + (this.d & 1) * 8, 0, 1), null, true);\n            return;\n        }\n        if (this.d)\n            this.e();\n        else\n            this.u.push({\n                r: function () {\n                    if (!(_this.d & 1))\n                        return;\n                    _this.u.splice(-1, 1);\n                    _this.e();\n                },\n                t: function () { }\n            });\n        this.d = 3;\n    };\n    Zip.prototype.e = function () {\n        var bt = 0, l = 0, tl = 0;\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            tl += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0);\n        }\n        var out = new u8(tl + 22);\n        for (var _b = 0, _c = this.u; _b < _c.length; _b++) {\n            var f = _c[_b];\n            wzh(out, bt, f, f.f, f.u, -f.c - 2, l, f.o);\n            bt += 46 + f.f.length + exfl(f.extra) + (f.o ? f.o.length : 0), l += f.b;\n        }\n        wzf(out, bt, this.u.length, tl, l);\n        this.ondata(null, out, true);\n        this.d = 2;\n    };\n    /**\n     * A method to terminate any internal workers used by the stream. Subsequent\n     * calls to add() will fail.\n     */\n    Zip.prototype.terminate = function () {\n        for (var _i = 0, _a = this.u; _i < _a.length; _i++) {\n            var f = _a[_i];\n            f.t();\n        }\n        this.d = 2;\n    };\n    return Zip;\n}());\nexport { Zip };\nexport function zip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    var r = {};\n    fltn(data, '', r, opts);\n    var k = Object.keys(r);\n    var lft = k.length, o = 0, tot = 0;\n    var slft = lft, files = new Array(lft);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var cbd = function (a, b) {\n        mt(function () { cb(a, b); });\n    };\n    mt(function () { cbd = cb; });\n    var cbf = function () {\n        var out = new u8(tot + 22), oe = o, cdl = tot - o;\n        tot = 0;\n        for (var i = 0; i < slft; ++i) {\n            var f = files[i];\n            try {\n                var l = f.c.length;\n                wzh(out, tot, f, f.f, f.u, l);\n                var badd = 30 + f.f.length + exfl(f.extra);\n                var loc = tot + badd;\n                out.set(f.c, loc);\n                wzh(out, o, f, f.f, f.u, l, tot, f.m), o += 16 + badd + (f.m ? f.m.length : 0), tot = loc + l;\n            }\n            catch (e) {\n                return cbd(e, null);\n            }\n        }\n        wzf(out, o, files.length, cdl, oe);\n        cbd(null, out);\n    };\n    if (!lft)\n        cbf();\n    var _loop_1 = function (i) {\n        var fn = k[i];\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var c = crc(), size = file.length;\n        c.p(file);\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        var compression = p.level == 0 ? 0 : 8;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cbd(e, null);\n            }\n            else {\n                var l = d.length;\n                files[i] = mrg(p, {\n                    size: size,\n                    crc: c.d(),\n                    c: d,\n                    f: f,\n                    m: m,\n                    u: s != fn.length || (m && (com.length != ms)),\n                    compression: compression\n                });\n                o += 30 + s + exl + l;\n                tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n                if (!--lft)\n                    cbf();\n            }\n        };\n        if (s > 65535)\n            cbl(err(11, 0, 1), null);\n        if (!compression)\n            cbl(null, file);\n        else if (size < 160000) {\n            try {\n                cbl(null, deflateSync(file, p));\n            }\n            catch (e) {\n                cbl(e, null);\n            }\n        }\n        else\n            term.push(deflate(file, p, cbl));\n    };\n    // Cannot use lft because it can decrease\n    for (var i = 0; i < slft; ++i) {\n        _loop_1(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously creates a ZIP file. Prefer using `zip` for better performance\n * with more than one file.\n * @param data The directory structure for the ZIP archive\n * @param opts The main options, merged with per-file options\n * @returns The generated ZIP archive\n */\nexport function zipSync(data, opts) {\n    if (!opts)\n        opts = {};\n    var r = {};\n    var files = [];\n    fltn(data, '', r, opts);\n    var o = 0;\n    var tot = 0;\n    for (var fn in r) {\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var compression = p.level == 0 ? 0 : 8;\n        var f = strToU8(fn), s = f.length;\n        var com = p.comment, m = com && strToU8(com), ms = m && m.length;\n        var exl = exfl(p.extra);\n        if (s > 65535)\n            err(11);\n        var d = compression ? deflateSync(file, p) : file, l = d.length;\n        var c = crc();\n        c.p(file);\n        files.push(mrg(p, {\n            size: file.length,\n            crc: c.d(),\n            c: d,\n            f: f,\n            m: m,\n            u: s != fn.length || (m && (com.length != ms)),\n            o: o,\n            compression: compression\n        }));\n        o += 30 + s + exl + l;\n        tot += 76 + 2 * (s + exl) + (ms || 0) + l;\n    }\n    var out = new u8(tot + 22), oe = o, cdl = tot - o;\n    for (var i = 0; i < files.length; ++i) {\n        var f = files[i];\n        wzh(out, f.o, f, f.f, f.u, f.c.length);\n        var badd = 30 + f.f.length + exfl(f.extra);\n        out.set(f.c, f.o + badd);\n        wzh(out, o, f, f.f, f.u, f.c.length, f.o, f.m), o += 16 + badd + (f.m ? f.m.length : 0);\n    }\n    wzf(out, o, files.length, cdl, oe);\n    return out;\n}\n/**\n * Streaming pass-through decompression for ZIP archives\n */\nvar UnzipPassThrough = /*#__PURE__*/ (function () {\n    function UnzipPassThrough() {\n    }\n    UnzipPassThrough.prototype.push = function (data, final) {\n        this.ondata(null, data, final);\n    };\n    UnzipPassThrough.compression = 0;\n    return UnzipPassThrough;\n}());\nexport { UnzipPassThrough };\n/**\n * Streaming DEFLATE decompression for ZIP archives. Prefer AsyncZipInflate for\n * better performance.\n */\nvar UnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function UnzipInflate() {\n        var _this = this;\n        this.i = new Inflate(function (dat, final) {\n            _this.ondata(null, dat, final);\n        });\n    }\n    UnzipInflate.prototype.push = function (data, final) {\n        try {\n            this.i.push(data, final);\n        }\n        catch (e) {\n            this.ondata(e, null, final);\n        }\n    };\n    UnzipInflate.compression = 8;\n    return UnzipInflate;\n}());\nexport { UnzipInflate };\n/**\n * Asynchronous streaming DEFLATE decompression for ZIP archives\n */\nvar AsyncUnzipInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates a DEFLATE decompression that can be used in ZIP archives\n     */\n    function AsyncUnzipInflate(_, sz) {\n        var _this = this;\n        if (sz < 320000) {\n            this.i = new Inflate(function (dat, final) {\n                _this.ondata(null, dat, final);\n            });\n        }\n        else {\n            this.i = new AsyncInflate(function (err, dat, final) {\n                _this.ondata(err, dat, final);\n            });\n            this.terminate = this.i.terminate;\n        }\n    }\n    AsyncUnzipInflate.prototype.push = function (data, final) {\n        if (this.i.terminate)\n            data = slc(data, 0);\n        this.i.push(data, final);\n    };\n    AsyncUnzipInflate.compression = 8;\n    return AsyncUnzipInflate;\n}());\nexport { AsyncUnzipInflate };\n/**\n * A ZIP archive decompression stream that emits files as they are discovered\n */\nvar Unzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a ZIP decompression stream\n     * @param cb The callback to call whenever a file in the ZIP archive is found\n     */\n    function Unzip(cb) {\n        this.onfile = cb;\n        this.k = [];\n        this.o = {\n            0: UnzipPassThrough\n        };\n        this.p = et;\n    }\n    /**\n     * Pushes a chunk to be unzipped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzip.prototype.push = function (chunk, final) {\n        var _this = this;\n        if (!this.onfile)\n            err(5);\n        if (!this.p)\n            err(4);\n        if (this.c > 0) {\n            var len = Math.min(this.c, chunk.length);\n            var toAdd = chunk.subarray(0, len);\n            this.c -= len;\n            if (this.d)\n                this.d.push(toAdd, !this.c);\n            else\n                this.k[0].push(toAdd);\n            chunk = chunk.subarray(len);\n            if (chunk.length)\n                return this.push(chunk, final);\n        }\n        else {\n            var f = 0, i = 0, is = void 0, buf = void 0;\n            if (!this.p.length)\n                buf = chunk;\n            else if (!chunk.length)\n                buf = this.p;\n            else {\n                buf = new u8(this.p.length + chunk.length);\n                buf.set(this.p), buf.set(chunk, this.p.length);\n            }\n            var l = buf.length, oc = this.c, add = oc && this.d;\n            var _loop_2 = function () {\n                var _a;\n                var sig = b4(buf, i);\n                if (sig == 0x4034B50) {\n                    f = 1, is = i;\n                    this_1.d = null;\n                    this_1.c = 0;\n                    var bf = b2(buf, i + 6), cmp_1 = b2(buf, i + 8), u = bf & 2048, dd = bf & 8, fnl = b2(buf, i + 26), es = b2(buf, i + 28);\n                    if (l > i + 30 + fnl + es) {\n                        var chks_3 = [];\n                        this_1.k.unshift(chks_3);\n                        f = 2;\n                        var sc_1 = b4(buf, i + 18), su_1 = b4(buf, i + 22);\n                        var fn_1 = strFromU8(buf.subarray(i + 30, i += 30 + fnl), !u);\n                        if (sc_1 == 4294967295) {\n                            _a = dd ? [-2] : z64e(buf, i), sc_1 = _a[0], su_1 = _a[1];\n                        }\n                        else if (dd)\n                            sc_1 = -1;\n                        i += es;\n                        this_1.c = sc_1;\n                        var d_1;\n                        var file_1 = {\n                            name: fn_1,\n                            compression: cmp_1,\n                            start: function () {\n                                if (!file_1.ondata)\n                                    err(5);\n                                if (!sc_1)\n                                    file_1.ondata(null, et, true);\n                                else {\n                                    var ctr = _this.o[cmp_1];\n                                    if (!ctr)\n                                        file_1.ondata(err(14, 'unknown compression type ' + cmp_1, 1), null, false);\n                                    d_1 = sc_1 < 0 ? new ctr(fn_1) : new ctr(fn_1, sc_1, su_1);\n                                    d_1.ondata = function (err, dat, final) { file_1.ondata(err, dat, final); };\n                                    for (var _i = 0, chks_4 = chks_3; _i < chks_4.length; _i++) {\n                                        var dat = chks_4[_i];\n                                        d_1.push(dat, false);\n                                    }\n                                    if (_this.k[0] == chks_3 && _this.c)\n                                        _this.d = d_1;\n                                    else\n                                        d_1.push(et, true);\n                                }\n                            },\n                            terminate: function () {\n                                if (d_1 && d_1.terminate)\n                                    d_1.terminate();\n                            }\n                        };\n                        if (sc_1 >= 0)\n                            file_1.size = sc_1, file_1.originalSize = su_1;\n                        this_1.onfile(file_1);\n                    }\n                    return \"break\";\n                }\n                else if (oc) {\n                    if (sig == 0x8074B50) {\n                        is = i += 12 + (oc == -2 && 8), f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                    else if (sig == 0x2014B50) {\n                        is = i -= 4, f = 3, this_1.c = 0;\n                        return \"break\";\n                    }\n                }\n            };\n            var this_1 = this;\n            for (; i < l - 4; ++i) {\n                var state_1 = _loop_2();\n                if (state_1 === \"break\")\n                    break;\n            }\n            this.p = et;\n            if (oc < 0) {\n                var dat = f ? buf.subarray(0, is - 12 - (oc == -2 && 8) - (b4(buf, is - 16) == 0x8074B50 && 4)) : buf.subarray(0, i);\n                if (add)\n                    add.push(dat, !!f);\n                else\n                    this.k[+(f == 2)].push(dat);\n            }\n            if (f & 2)\n                return this.push(buf.subarray(i), final);\n            this.p = buf.subarray(i);\n        }\n        if (final) {\n            if (this.c)\n                err(13);\n            this.p = null;\n        }\n    };\n    /**\n     * Registers a decoder with the stream, allowing for files compressed with\n     * the compression type provided to be expanded correctly\n     * @param decoder The decoder constructor\n     */\n    Unzip.prototype.register = function (decoder) {\n        this.o[decoder.compression] = decoder;\n    };\n    return Unzip;\n}());\nexport { Unzip };\nvar mt = typeof queueMicrotask == 'function' ? queueMicrotask : typeof setTimeout == 'function' ? setTimeout : function (fn) { fn(); };\nexport function unzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        err(7);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var files = {};\n    var cbd = function (a, b) {\n        mt(function () { cb(a, b); });\n    };\n    mt(function () { cbd = cb; });\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558) {\n            cbd(err(13, 0, 1), null);\n            return tAll;\n        }\n    }\n    ;\n    var lft = b2(data, e + 8);\n    if (lft) {\n        var c = lft;\n        var o = b4(data, e + 16);\n        var z = o == 4294967295 || c == 65535;\n        if (z) {\n            var ze = b4(data, e - 12);\n            z = b4(data, ze) == 0x6064B50;\n            if (z) {\n                c = lft = b4(data, ze + 32);\n                o = b4(data, ze + 48);\n            }\n        }\n        var fltr = opts && opts.filter;\n        var _loop_3 = function (i) {\n            var _a = zh(data, o, z), c_1 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n            o = no;\n            var cbl = function (e, d) {\n                if (e) {\n                    tAll();\n                    cbd(e, null);\n                }\n                else {\n                    if (d)\n                        files[fn] = d;\n                    if (!--lft)\n                        cbd(null, files);\n                }\n            };\n            if (!fltr || fltr({\n                name: fn,\n                size: sc,\n                originalSize: su,\n                compression: c_1\n            })) {\n                if (!c_1)\n                    cbl(null, slc(data, b, b + sc));\n                else if (c_1 == 8) {\n                    var infl = data.subarray(b, b + sc);\n                    // Synchronously decompress under 512KB, or barely-compressed data\n                    if (su < 524288 || sc > 0.8 * su) {\n                        try {\n                            cbl(null, inflateSync(infl, { out: new u8(su) }));\n                        }\n                        catch (e) {\n                            cbl(e, null);\n                        }\n                    }\n                    else\n                        term.push(inflate(infl, { size: su }, cbl));\n                }\n                else\n                    cbl(err(14, 'unknown compression type ' + c_1, 1), null);\n            }\n            else\n                cbl(null, null);\n        };\n        for (var i = 0; i < c; ++i) {\n            _loop_3(i);\n        }\n    }\n    else\n        cbd(null, {});\n    return tAll;\n}\n/**\n * Synchronously decompresses a ZIP archive. Prefer using `unzip` for better\n * performance with more than one file.\n * @param data The raw compressed ZIP file\n * @param opts The ZIP extraction options\n * @returns The decompressed files\n */\nexport function unzipSync(data, opts) {\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558)\n            err(13);\n    }\n    ;\n    var c = b2(data, e + 8);\n    if (!c)\n        return {};\n    var o = b4(data, e + 16);\n    var z = o == 4294967295 || c == 65535;\n    if (z) {\n        var ze = b4(data, e - 12);\n        z = b4(data, ze) == 0x6064B50;\n        if (z) {\n            c = b4(data, ze + 32);\n            o = b4(data, ze + 48);\n        }\n    }\n    var fltr = opts && opts.filter;\n    for (var i = 0; i < c; ++i) {\n        var _a = zh(data, o, z), c_2 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        if (!fltr || fltr({\n            name: fn,\n            size: sc,\n            originalSize: su,\n            compression: c_2\n        })) {\n            if (!c_2)\n                files[fn] = slc(data, b, b + sc);\n            else if (c_2 == 8)\n                files[fn] = inflateSync(data.subarray(b, b + sc), { out: new u8(su) });\n            else\n                err(14, 'unknown compression type ' + c_2);\n        }\n    }\n    return files;\n}\n", "/*\n\nFile processing functions for the browser\n=========================================\n\nCopyright (c) 2024 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {gunzipSync} from 'fflate'\n\nimport type {DownloadOptions, ProgressCallback} from './interface.js'\n\n/** Fetch a resource */\nconst resource_map: Map<string, any> = new Map()\nexport async function fetch_resource(options: DownloadOptions, path: string, progress_callback?: ProgressCallback) {\n    // Check the cache\n    const cached = resource_map.get(path)\n    if (cached) {\n        return cached\n    }\n\n    const response = fetch_resource_inner(options, path, progress_callback)\n    // Fill the cache with the promise, and then when the resource has been obtained, update the cache\n    resource_map.set(path, response)\n    response.then((resource: any) => {\n        resource_map.set(path, resource)\n    })\n    return response\n}\n\n/** Actually fetch a resource */\nasync function fetch_resource_inner(options: DownloadOptions, path: string, progress_callback?: ProgressCallback) {\n    // Handle embedded resources in single file mode\n    if (options.single_file) {\n        const node = document.getElementById(path) as HTMLScriptElement\n        const data_base64 = node.text\n        if (path.endsWith('.js')) {\n            return import(`data:text/javascript,${encodeURIComponent(data_base64)}`)\n        }\n        if (!path.endsWith('.wasm')) {\n            throw new Error(`Can't load ${path} in single file mode`)\n        }\n        let data = await parse_base64(data_base64)\n        if (node.type.endsWith(';gzip')) {\n            data = gunzipSync(data)\n        }\n        return data\n    }\n\n    // Handle when lib_path is a proper URL (such as import.meta.url), as well as the old style path fragment\n    const lib_path = options.lib_path ?? import.meta.url\n    let url: URL | string\n    try {\n        url = new URL(path, lib_path)\n    }\n    catch {\n        url = lib_path + path\n    }\n\n    if (path.endsWith('.js')) {\n        return import(url + '')\n    }\n\n    // Something else, like a .wasm\n    const response = await fetch(url)\n    return read_response(response, progress_callback)\n}\n\n/** Parse Base 64 into a Uint8Array */\nexport async function parse_base64(data: string): Promise<Uint8Array> {\n    // Firefox has a data URL limit of 32MB, so we have to chunk large data\n    const chunk_length = 30_000_000\n    if (data.length < chunk_length) {\n        return parse_base64_with_data_url(data)\n    }\n    const chunks: Uint8Array[] = []\n    let i = 0\n    while (i < data.length) {\n        chunks.push(await parse_base64_with_data_url(data.substring(i, i += chunk_length)))\n    }\n    const blob = new Blob(chunks)\n    return new Uint8Array(await blob.arrayBuffer())\n}\n\nasync function parse_base64_with_data_url(data: string) {\n    // Parse base64 using a trick from https://stackoverflow.com/a/54123275/2854284\n    const response = await fetch(`data:application/octet-stream;base64,${data}`)\n    if (!response.ok) {\n        throw new Error(`Could not parse base64: ${response.status}`)\n    }\n    return new Uint8Array(await response.arrayBuffer())\n}\n\n/** Read a response, with optional progress notifications */\nexport async function read_response(response: Response, progress_callback?: ProgressCallback): Promise<Uint8Array> {\n    if (!response.ok) {\n        throw new Error(`Could not fetch ${response.url}, got ${response.status}`)\n    }\n\n    if (!progress_callback) {\n        return new Uint8Array(await response.arrayBuffer())\n    }\n\n    // Read the response, calling the callback with each chunk\n    const chunks: Array<[number, Uint8Array]> = []\n    let length = 0\n    const reader = response.body!.getReader()\n    for (;;) {\n        const {done, value} = await reader.read()\n        if (done) {\n            break\n        }\n        chunks.push([length, value])\n        progress_callback(value.length)\n        length += value.length\n    }\n\n    // Join the chunks together\n    const result = new Uint8Array(length)\n    for (const [offset, chunk] of chunks) {\n        result.set(chunk, offset)\n    }\n    return result\n}", "/*\n\nBrowser Dialog\n==============\n\nCopyright (c) 2024 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {saveAs as filesave_saveAs} from 'file-saver'\nimport path from 'path-browserify-esm'\n\nimport type {DownloadOptions, ProgressCallback} from '../../common/file/interface.js'\nimport type {DialogDirectories, DialogOptions} from '../common/interface.js'\nimport {show_alert} from './common.js'\nimport {DownloadProvider, read_uploaded_file} from './download.js'\nimport type {BrowseableProvider, BrowserDialog, DirEntry, FilesMetadata, Provider} from './interface.js'\nimport {WebStorageProvider} from './storage.js'\nimport FileDialog from './ui/FileDialog.svelte'\n\nexport class ProviderBasedBrowserDialog implements BrowserDialog {\n    'async' = true as const\n    private controller?: DialogController\n    private dirs: DialogDirectories = {\n        storyfile: '',\n        system_cwd: '/',\n        temp: '/tmp',\n        working: '/usr',\n    }\n    private downloader: DownloadProvider | undefined\n    private providers: (Provider | BrowseableProvider)[] = []\n\n    async init(options: DialogOptions & DownloadOptions): Promise<void> {\n        this.downloader = new DownloadProvider(options)\n        try {\n            this.providers = [\n                this.downloader,\n                new WebStorageProvider('/tmp', sessionStorage, this.dirs),\n                new WebStorageProvider('/', localStorage, this.dirs, true),\n            ]\n        }\n        catch {\n            this.providers = [\n                this.downloader,\n            ]\n        }\n\n        for (const [i, provider] of this.providers.entries()) {\n            const next = this.providers[i + 1]\n            if (next) {\n                provider.next = next\n            }\n            // Set up the Svelte UI\n            if (provider.browseable) {\n                this.controller = new DialogController(provider as BrowseableProvider)\n            }\n        }\n    }\n\n    async download(url: string, progress_callback?: ProgressCallback): Promise<string> {\n        const file_path = await this.downloader!.download(url, progress_callback)\n        this.setup(file_path)\n        return file_path\n    }\n\n    get_dirs(): DialogDirectories {\n        return this.dirs\n    }\n\n    async prompt(extension: string, save: boolean): Promise<string | null> {\n        if (this.controller) {\n            return this.controller.prompt(extension, save)\n        }\n        else {\n            await show_alert(`Cannot ${save ? 'save' : 'open'}`, 'LocalStorage is not currently supported in this browser. You should be able to enable it in your browser settings; it may be under a setting about cookies.')\n            return null\n        }\n    }\n\n    set_storyfile_dir(path: string): Partial<DialogDirectories> {\n        return {\n            storyfile: path,\n        }\n    }\n\n    async upload(file: File) {\n        const file_path = await this.downloader!.upload(file)\n        this.setup(file_path)\n        return file_path\n    }\n\n    async delete(path: string) {\n        await this.providers[0].delete(path)\n    }\n\n    async exists(path: string): Promise<boolean> {\n        return !!(await this.providers[0].exists(path))\n    }\n\n    async read(path: string): Promise<Uint8Array | null> {\n        return this.providers[0].read(path)\n    }\n\n    async write(files: Record<string, Uint8Array>) {\n        await this.providers[0].write(files)\n    }\n\n    private setup(file_path: string) {\n        const parsed_path = path.parse(file_path)\n        this.dirs.storyfile = parsed_path.dir\n        this.dirs.working = '/usr/' + parsed_path.name.toLowerCase().trim()\n        this.controller?.update_working(this.dirs.working)\n    }\n}\n\n/** Controller for FileDialog */\nexport class DialogController {\n    private dialog: FileDialog\n    private metadata: FilesMetadata = {}\n    private provider: BrowseableProvider\n\n    constructor(provider: BrowseableProvider) {\n        this.dialog = new FileDialog({\n            target: document.body,\n            props: {\n                controller: this,\n            },\n        })\n        this.provider = provider\n    }\n\n    async prompt(extension: string, save: boolean): Promise<string | null> {\n        const action = save ? 'Save' : 'Open'\n        const filter = extension_to_filter(extension)\n        this.metadata = await this.provider.metadata()\n        return this.dialog.prompt({\n            filter,\n            metadata: this.metadata,\n            save,\n            submit_label: action,\n            title: `${action} a ${filter?.title}`,\n        })\n    }\n\n    async delete(file: DirEntry) {\n        if (file.dir) {\n            const dir_path = file.full_path + '/'\n            for (const path of Object.keys(this.metadata)) {\n                if (path.startsWith(dir_path)) {\n                    delete this.metadata[path]\n                    await this.provider.delete(path)\n                }\n            }\n        }\n        else {\n            await this.provider.delete(file.full_path)\n            delete this.metadata[file.full_path]\n        }\n        await this.update()\n    }\n\n    async download(file: DirEntry) {\n        const data = (await this.provider.read(file.full_path))!\n        filesave_saveAs(new Blob([data]), file.name)\n    }\n\n    async new_folder(path: string) {\n        // Consider making this a function of the provider, to better support providers which can store actual empty folders\n        const now = Date.now()\n        const dir_path = path + '/.dir'\n        await this.provider.write({[dir_path]: new Uint8Array(0)})\n        this.metadata[dir_path] = {\n            atime: now,\n            mtime: now,\n        }\n        this.dialog.$set({\n            cur_dir: path,\n            metadata: this.metadata,\n        })\n    }\n\n    async rename(file: DirEntry, new_file_name: string) {\n        const parsed_path = path.parse(file.full_path)\n        const new_path = parsed_path.dir + '/' + new_file_name\n        await this.provider.rename(file.dir, file.full_path, new_path)\n        await this.update(true)\n    }\n\n    async update(refresh: boolean = false) {\n        if (refresh) {\n            this.metadata = await this.provider.metadata()\n        }\n        this.dialog.$set({metadata: this.metadata})\n    }\n\n    update_working(path: string) {\n        this.dialog.$set({cur_dir: path})\n    }\n\n    async upload(files: Record<string, File>) {\n        const now = Date.now()\n        const read_files: Record<string, Uint8Array> = {}\n        for (const [path, data] of Object.entries(files)) {\n            read_files[path] = await read_uploaded_file(data)\n            this.metadata[path] = {\n                atime: now,\n                mtime: now,\n            }\n        }\n        await this.provider.write(read_files)\n        await this.update()\n    }\n}\n\nexport interface Filter {\n    extensions: string[]\n    label?: string\n}\n\nfunction extension_to_filter(extension: string): (Filter & {title: string}) | undefined {\n    switch (extension) {\n        case '.glkdata':\n            return {\n                extensions: ['.glkdata'],\n                label: 'Data file',\n                title: 'data file',\n            }\n        case '.glksave':\n            return {\n                extensions: ['.glksave', '.sav'],\n                label: 'Save file',\n                title: 'savefile',\n            }\n        case '.txt':\n            return {\n                extensions: ['.txt'],\n                label: 'Transcript or log',\n                title: 'log',\n            }\n    }\n}", "// 'path' module extracted from Node.js v8.11.1 (only the posix part)\n// transplited with Babel\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nfunction assertPath(path) {\n  if (typeof path !== 'string') {\n    throw new TypeError('Path must be a string. Received ' + JSON.stringify(path));\n  }\n}\n\n// Resolves . and .. elements in a path with directory names\nfunction normalizeStringPosix(path, allowAboveRoot) {\n  var res = '';\n  var lastSegmentLength = 0;\n  var lastSlash = -1;\n  var dots = 0;\n  var code;\n  for (var i = 0; i <= path.length; ++i) {\n    if (i < path.length)\n      code = path.charCodeAt(i);\n    else if (code === 47 /*/*/)\n      break;\n    else\n      code = 47 /*/*/;\n    if (code === 47 /*/*/) {\n      if (lastSlash === i - 1 || dots === 1) {\n        // NOOP\n      } else if (lastSlash !== i - 1 && dots === 2) {\n        if (res.length < 2 || lastSegmentLength !== 2 || res.charCodeAt(res.length - 1) !== 46 /*.*/ || res.charCodeAt(res.length - 2) !== 46 /*.*/) {\n          if (res.length > 2) {\n            var lastSlashIndex = res.lastIndexOf('/');\n            if (lastSlashIndex !== res.length - 1) {\n              if (lastSlashIndex === -1) {\n                res = '';\n                lastSegmentLength = 0;\n              } else {\n                res = res.slice(0, lastSlashIndex);\n                lastSegmentLength = res.length - 1 - res.lastIndexOf('/');\n              }\n              lastSlash = i;\n              dots = 0;\n              continue;\n            }\n          } else if (res.length === 2 || res.length === 1) {\n            res = '';\n            lastSegmentLength = 0;\n            lastSlash = i;\n            dots = 0;\n            continue;\n          }\n        }\n        if (allowAboveRoot) {\n          if (res.length > 0)\n            res += '/..';\n          else\n            res = '..';\n          lastSegmentLength = 2;\n        }\n      } else {\n        if (res.length > 0)\n          res += '/' + path.slice(lastSlash + 1, i);\n        else\n          res = path.slice(lastSlash + 1, i);\n        lastSegmentLength = i - lastSlash - 1;\n      }\n      lastSlash = i;\n      dots = 0;\n    } else if (code === 46 /*.*/ && dots !== -1) {\n      ++dots;\n    } else {\n      dots = -1;\n    }\n  }\n  return res;\n}\n\nfunction _format(sep, pathObject) {\n  var dir = pathObject.dir || pathObject.root;\n  var base = pathObject.base || (pathObject.name || '') + (pathObject.ext || '');\n  if (!dir) {\n    return base;\n  }\n  if (dir === pathObject.root) {\n    return dir + base;\n  }\n  return dir + sep + base;\n}\n//let process_cwd = undefined;\n\nvar posix = {\n\n  //*new\n  process_cwd:'',\n  setCWD:function setCWD(_cwd){\n    posix.process_cwd=_cwd;\n  },\n\n  // path.resolve([from ...], to)\n  resolve: function resolve() {\n    var resolvedPath = '';\n    var resolvedAbsolute = false;\n    var cwd;\n\n    for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n      var path;\n      if (i >= 0)\n        path = arguments[i];\n      else {\n        if (cwd === undefined)\n          cwd = posix.process_cwd;//*process.cwd();\n        path = cwd;\n      }\n\n      assertPath(path);\n\n      // Skip empty entries\n      if (path.length === 0) {\n        continue;\n      }\n      \n      //*new\n      if (path + '/' === resolvedPath) {\n        continue;\n      }\n\n      resolvedPath = path + '/' + resolvedPath;\n\n      resolvedAbsolute = path.charCodeAt(0) === 47 /*/*/;\n    }\n\n    // At this point the path should be resolved to a full absolute path, but\n    // handle relative paths to be safe (might happen when process.cwd() fails)\n\n    // Normalize the path\n    resolvedPath = normalizeStringPosix(resolvedPath, !resolvedAbsolute);\n\n    if (resolvedAbsolute) {\n      if (resolvedPath.length > 0)\n        return '/' + resolvedPath;\n      else\n        return '/';\n    } else if (resolvedPath.length > 0) {\n      return resolvedPath;\n    } else {\n      return '.';\n    }\n  },\n\n  normalize: function normalize(path) {\n    assertPath(path);\n\n    if (path.length === 0) return '.';\n\n    var isAbsolute = path.charCodeAt(0) === 47 /*/*/;\n    var trailingSeparator = path.charCodeAt(path.length - 1) === 47 /*/*/;\n\n    // Normalize the path\n    path = normalizeStringPosix(path, !isAbsolute);\n\n    if (path.length === 0 && !isAbsolute) path = '.';\n    if (path.length > 0 && trailingSeparator) path += '/';\n\n    if (isAbsolute) return '/' + path;\n    return path;\n  },\n\n  isAbsolute: function isAbsolute(path) {\n    assertPath(path);\n    return path.length > 0 && path.charCodeAt(0) === 47 /*/*/;\n  },\n\n  join: function join() {\n    if (arguments.length === 0)\n      return '.';\n    var joined;\n    for (var i = 0; i < arguments.length; ++i) {\n      var arg = arguments[i];\n      assertPath(arg);\n      if (arg.length > 0) {\n        if (joined === undefined)\n          joined = arg;\n        else\n          joined += '/' + arg;\n      }\n    }\n    if (joined === undefined)\n      return '.';\n    return posix.normalize(joined);\n  },\n\n  relative: function relative(from, to) {\n    assertPath(from);\n    assertPath(to);\n\n    if (from === to) return '';\n\n    //*new\n    const from2=from.replaceAll('\\\\','/');\n    const to2=to.replaceAll('\\\\','/');\n    if(from2!=from && to2!=to){\n      return posix.relative(from2,to2).replaceAll('/','\\\\');\n    }else if(from2!=from){\n      return posix.relative(from2,to).replaceAll('/','\\\\');\n    }else if(to2!=to){\n      return posix.relative(from,to2);\n    }\n    \n    from = posix.resolve(from);\n    to = posix.resolve(to);\n\n    if (from === to) return '';\n\n    // Trim any leading backslashes\n    var fromStart = 1;\n    for (; fromStart < from.length; ++fromStart) {\n      if (from.charCodeAt(fromStart) !== 47 /*/*/)\n        break;\n    }\n    var fromEnd = from.length;\n    var fromLen = fromEnd - fromStart;\n\n    // Trim any leading backslashes\n    var toStart = 1;\n    for (; toStart < to.length; ++toStart) {\n      if (to.charCodeAt(toStart) !== 47 /*/*/)\n        break;\n    }\n    var toEnd = to.length;\n    var toLen = toEnd - toStart;\n\n    // Compare paths to find the longest common path from root\n    var length = fromLen < toLen ? fromLen : toLen;\n    var lastCommonSep = -1;\n    var i = 0;\n    for (; i <= length; ++i) {\n      if (i === length) {\n        if (toLen > length) {\n          if (to.charCodeAt(toStart + i) === 47 /*/*/) {\n            // We get here if `from` is the exact base path for `to`.\n            // For example: from='/foo/bar'; to='/foo/bar/baz'\n            return to.slice(toStart + i + 1);\n          } else if (i === 0) {\n            // We get here if `from` is the root\n            // For example: from='/'; to='/foo'\n            return to.slice(toStart + i);\n          }\n        } else if (fromLen > length) {\n          if (from.charCodeAt(fromStart + i) === 47 /*/*/) {\n            // We get here if `to` is the exact base path for `from`.\n            // For example: from='/foo/bar/baz'; to='/foo/bar'\n            lastCommonSep = i;\n          } else if (i === 0) {\n            // We get here if `to` is the root.\n            // For example: from='/foo'; to='/'\n            lastCommonSep = 0;\n          }\n        }\n        break;\n      }\n      var fromCode = from.charCodeAt(fromStart + i);\n      var toCode = to.charCodeAt(toStart + i);\n      if (fromCode !== toCode)\n        break;\n      else if (fromCode === 47 /*/*/)\n        lastCommonSep = i;\n    }\n\n    var out = '';\n    // Generate the relative path based on the path difference between `to`\n    // and `from`\n    for (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i) {\n      if (i === fromEnd || from.charCodeAt(i) === 47 /*/*/) {\n        if (out.length === 0)\n          out += '..';\n        else\n          out += '/..';\n      }\n    }\n\n    // Lastly, append the rest of the destination (`to`) path that comes after\n    // the common path parts\n    if (out.length > 0)\n      return out + to.slice(toStart + lastCommonSep);\n    else {\n      toStart += lastCommonSep;\n      if (to.charCodeAt(toStart) === 47 /*/*/)\n        ++toStart;\n      return to.slice(toStart);\n    }\n  },\n\n  _makeLong: function _makeLong(path) {\n    return path;\n  },\n\n  dirname: function dirname(path) {\n    assertPath(path);\n    if (path.length === 0) return '.';\n    var code = path.charCodeAt(0);\n    var hasRoot = code === 47 /*/*/;\n    var end = -1;\n    var matchedSlash = true;\n    for (var i = path.length - 1; i >= 1; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47 /*/*/) {\n          if (!matchedSlash) {\n            end = i;\n            break;\n          }\n        } else {\n        // We saw the first non-path separator\n        matchedSlash = false;\n      }\n    }\n\n    if (end === -1) return hasRoot ? '/' : '.';\n    if (hasRoot && end === 1) return '//';\n    return path.slice(0, end);\n  },\n\n  basename: function basename(path, ext) {\n    if (ext !== undefined && typeof ext !== 'string') throw new TypeError('\"ext\" argument must be a string');\n    assertPath(path);\n\n    var start = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i;\n\n    if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {\n      if (ext.length === path.length && ext === path) return '';\n      var extIdx = ext.length - 1;\n      var firstNonSlashEnd = -1;\n      for (i = path.length - 1; i >= 0; --i) {\n        var code = path.charCodeAt(i);\n        if (code === 47 /*/*/) {\n            // If we reached a path separator that was not part of a set of path\n            // separators at the end of the string, stop now\n            if (!matchedSlash) {\n              start = i + 1;\n              break;\n            }\n          } else {\n          if (firstNonSlashEnd === -1) {\n            // We saw the first non-path separator, remember this index in case\n            // we need it if the extension ends up not matching\n            matchedSlash = false;\n            firstNonSlashEnd = i + 1;\n          }\n          if (extIdx >= 0) {\n            // Try to match the explicit extension\n            if (code === ext.charCodeAt(extIdx)) {\n              if (--extIdx === -1) {\n                // We matched the extension, so mark this as the end of our path\n                // component\n                end = i;\n              }\n            } else {\n              // Extension does not match, so our result is the entire path\n              // component\n              extIdx = -1;\n              end = firstNonSlashEnd;\n            }\n          }\n        }\n      }\n\n      if (start === end) end = firstNonSlashEnd;else if (end === -1) end = path.length;\n      return path.slice(start, end);\n    } else {\n      for (i = path.length - 1; i >= 0; --i) {\n        if (path.charCodeAt(i) === 47 /*/*/) {\n            // If we reached a path separator that was not part of a set of path\n            // separators at the end of the string, stop now\n            if (!matchedSlash) {\n              start = i + 1;\n              break;\n            }\n          } else if (end === -1) {\n          // We saw the first non-path separator, mark this as the end of our\n          // path component\n          matchedSlash = false;\n          end = i + 1;\n        }\n      }\n\n      if (end === -1) return '';\n      return path.slice(start, end);\n    }\n  },\n\n  extname: function extname(path) {\n    assertPath(path);\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n    for (var i = path.length - 1; i >= 0; --i) {\n      var code = path.charCodeAt(i);\n      if (code === 47 /*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            startPart = i + 1;\n            break;\n          }\n          continue;\n        }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46 /*.*/) {\n          // If this is our first dot, mark it as the start of our extension\n          if (startDot === -1)\n            startDot = i;\n          else if (preDotState !== 1)\n            preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 || end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {\n      return '';\n    }\n    return path.slice(startDot, end);\n  },\n\n  format: function format(pathObject) {\n    if (pathObject === null || typeof pathObject !== 'object') {\n      throw new TypeError('The \"pathObject\" argument must be of type Object. Received type ' + typeof pathObject);\n    }\n    return _format('/', pathObject);\n  },\n\n  parse: function parse(path) {\n    assertPath(path);\n\n    var ret = { root: '', dir: '', base: '', ext: '', name: '' };\n    if (path.length === 0) return ret;\n    var code = path.charCodeAt(0);\n    var isAbsolute = code === 47 /*/*/;\n    var start;\n    if (isAbsolute) {\n      ret.root = '/';\n      start = 1;\n    } else {\n      start = 0;\n    }\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i = path.length - 1;\n\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n\n    // Get non-dir info\n    for (; i >= start; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47 /*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            startPart = i + 1;\n            break;\n          }\n          continue;\n        }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46 /*.*/) {\n          // If this is our first dot, mark it as the start of our extension\n          if (startDot === -1) startDot = i;else if (preDotState !== 1) preDotState = 1;\n        } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 || end === -1 ||\n    // We saw a non-dot character immediately before the dot\n    preDotState === 0 ||\n    // The (right-most) trimmed path component is exactly '..'\n    preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {\n      if (end !== -1) {\n        if (startPart === 0 && isAbsolute) ret.base = ret.name = path.slice(1, end);else ret.base = ret.name = path.slice(startPart, end);\n      }\n    } else {\n      if (startPart === 0 && isAbsolute) {\n        ret.name = path.slice(1, startDot);\n        ret.base = path.slice(1, end);\n      } else {\n        ret.name = path.slice(startPart, startDot);\n        ret.base = path.slice(startPart, end);\n      }\n      ret.ext = path.slice(startDot, end);\n    }\n\n    if (startPart > 0) ret.dir = path.slice(0, startPart - 1);else if (isAbsolute) ret.dir = '/';\n\n    return ret;\n  },\n\n  sep: '/',\n  delimiter: ':',\n  win32: null,\n  posix: null\n};\n\nposix.posix = posix;\n\n//module.exports = posix;\n\n//*\nexport {\n  posix as default\n};\n", "/** @returns {void} */\nexport function noop() {}\n\nexport const identity = (x) => x;\n\n/**\n * @template T\n * @template S\n * @param {T} tar\n * @param {S} src\n * @returns {T & S}\n */\nexport function assign(tar, src) {\n\t// @ts-ignore\n\tfor (const k in src) tar[k] = src[k];\n\treturn /** @type {T & S} */ (tar);\n}\n\n// Adapted from https://github.com/then/is-promise/blob/master/index.js\n// Distributed under MIT License https://github.com/then/is-promise/blob/master/LICENSE\n/**\n * @param {any} value\n * @returns {value is PromiseLike<any>}\n */\nexport function is_promise(value) {\n\treturn (\n\t\t!!value &&\n\t\t(typeof value === 'object' || typeof value === 'function') &&\n\t\ttypeof (/** @type {any} */ (value).then) === 'function'\n\t);\n}\n\n/** @returns {void} */\nexport function add_location(element, file, line, column, char) {\n\telement.__svelte_meta = {\n\t\tloc: { file, line, column, char }\n\t};\n}\n\nexport function run(fn) {\n\treturn fn();\n}\n\nexport function blank_object() {\n\treturn Object.create(null);\n}\n\n/**\n * @param {Function[]} fns\n * @returns {void}\n */\nexport function run_all(fns) {\n\tfns.forEach(run);\n}\n\n/**\n * @param {any} thing\n * @returns {thing is Function}\n */\nexport function is_function(thing) {\n\treturn typeof thing === 'function';\n}\n\n/** @returns {boolean} */\nexport function safe_not_equal(a, b) {\n\treturn a != a ? b == b : a !== b || (a && typeof a === 'object') || typeof a === 'function';\n}\n\nlet src_url_equal_anchor;\n\n/**\n * @param {string} element_src\n * @param {string} url\n * @returns {boolean}\n */\nexport function src_url_equal(element_src, url) {\n\tif (element_src === url) return true;\n\tif (!src_url_equal_anchor) {\n\t\tsrc_url_equal_anchor = document.createElement('a');\n\t}\n\t// This is actually faster than doing URL(..).href\n\tsrc_url_equal_anchor.href = url;\n\treturn element_src === src_url_equal_anchor.href;\n}\n\n/** @param {string} srcset */\nfunction split_srcset(srcset) {\n\treturn srcset.split(',').map((src) => src.trim().split(' ').filter(Boolean));\n}\n\n/**\n * @param {HTMLSourceElement | HTMLImageElement} element_srcset\n * @param {string | undefined | null} srcset\n * @returns {boolean}\n */\nexport function srcset_url_equal(element_srcset, srcset) {\n\tconst element_urls = split_srcset(element_srcset.srcset);\n\tconst urls = split_srcset(srcset || '');\n\n\treturn (\n\t\turls.length === element_urls.length &&\n\t\turls.every(\n\t\t\t([url, width], i) =>\n\t\t\t\twidth === element_urls[i][1] &&\n\t\t\t\t// We need to test both ways because Vite will create an a full URL with\n\t\t\t\t// `new URL(asset, import.meta.url).href` for the client when `base: './'`, and the\n\t\t\t\t// relative URLs inside srcset are not automatically resolved to absolute URLs by\n\t\t\t\t// browsers (in contrast to img.src). This means both SSR and DOM code could\n\t\t\t\t// contain relative or absolute URLs.\n\t\t\t\t(src_url_equal(element_urls[i][0], url) || src_url_equal(url, element_urls[i][0]))\n\t\t)\n\t);\n}\n\n/** @returns {boolean} */\nexport function not_equal(a, b) {\n\treturn a != a ? b == b : a !== b;\n}\n\n/** @returns {boolean} */\nexport function is_empty(obj) {\n\treturn Object.keys(obj).length === 0;\n}\n\n/** @returns {void} */\nexport function validate_store(store, name) {\n\tif (store != null && typeof store.subscribe !== 'function') {\n\t\tthrow new Error(`'${name}' is not a store with a 'subscribe' method`);\n\t}\n}\n\nexport function subscribe(store, ...callbacks) {\n\tif (store == null) {\n\t\tfor (const callback of callbacks) {\n\t\t\tcallback(undefined);\n\t\t}\n\t\treturn noop;\n\t}\n\tconst unsub = store.subscribe(...callbacks);\n\treturn unsub.unsubscribe ? () => unsub.unsubscribe() : unsub;\n}\n\n/**\n * Get the current value from a store by subscribing and immediately unsubscribing.\n *\n * https://svelte.dev/docs/svelte-store#get\n * @template T\n * @param {import('../store/public.js').Readable<T>} store\n * @returns {T}\n */\nexport function get_store_value(store) {\n\tlet value;\n\tsubscribe(store, (_) => (value = _))();\n\treturn value;\n}\n\n/** @returns {void} */\nexport function component_subscribe(component, store, callback) {\n\tcomponent.$$.on_destroy.push(subscribe(store, callback));\n}\n\nexport function create_slot(definition, ctx, $$scope, fn) {\n\tif (definition) {\n\t\tconst slot_ctx = get_slot_context(definition, ctx, $$scope, fn);\n\t\treturn definition[0](slot_ctx);\n\t}\n}\n\nfunction get_slot_context(definition, ctx, $$scope, fn) {\n\treturn definition[1] && fn ? assign($$scope.ctx.slice(), definition[1](fn(ctx))) : $$scope.ctx;\n}\n\nexport function get_slot_changes(definition, $$scope, dirty, fn) {\n\tif (definition[2] && fn) {\n\t\tconst lets = definition[2](fn(dirty));\n\t\tif ($$scope.dirty === undefined) {\n\t\t\treturn lets;\n\t\t}\n\t\tif (typeof lets === 'object') {\n\t\t\tconst merged = [];\n\t\t\tconst len = Math.max($$scope.dirty.length, lets.length);\n\t\t\tfor (let i = 0; i < len; i += 1) {\n\t\t\t\tmerged[i] = $$scope.dirty[i] | lets[i];\n\t\t\t}\n\t\t\treturn merged;\n\t\t}\n\t\treturn $$scope.dirty | lets;\n\t}\n\treturn $$scope.dirty;\n}\n\n/** @returns {void} */\nexport function update_slot_base(\n\tslot,\n\tslot_definition,\n\tctx,\n\t$$scope,\n\tslot_changes,\n\tget_slot_context_fn\n) {\n\tif (slot_changes) {\n\t\tconst slot_context = get_slot_context(slot_definition, ctx, $$scope, get_slot_context_fn);\n\t\tslot.p(slot_context, slot_changes);\n\t}\n}\n\n/** @returns {void} */\nexport function update_slot(\n\tslot,\n\tslot_definition,\n\tctx,\n\t$$scope,\n\tdirty,\n\tget_slot_changes_fn,\n\tget_slot_context_fn\n) {\n\tconst slot_changes = get_slot_changes(slot_definition, $$scope, dirty, get_slot_changes_fn);\n\tupdate_slot_base(slot, slot_definition, ctx, $$scope, slot_changes, get_slot_context_fn);\n}\n\n/** @returns {any[] | -1} */\nexport function get_all_dirty_from_scope($$scope) {\n\tif ($$scope.ctx.length > 32) {\n\t\tconst dirty = [];\n\t\tconst length = $$scope.ctx.length / 32;\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tdirty[i] = -1;\n\t\t}\n\t\treturn dirty;\n\t}\n\treturn -1;\n}\n\n/** @returns {{}} */\nexport function exclude_internal_props(props) {\n\tconst result = {};\n\tfor (const k in props) if (k[0] !== '$') result[k] = props[k];\n\treturn result;\n}\n\n/** @returns {{}} */\nexport function compute_rest_props(props, keys) {\n\tconst rest = {};\n\tkeys = new Set(keys);\n\tfor (const k in props) if (!keys.has(k) && k[0] !== '$') rest[k] = props[k];\n\treturn rest;\n}\n\n/** @returns {{}} */\nexport function compute_slots(slots) {\n\tconst result = {};\n\tfor (const key in slots) {\n\t\tresult[key] = true;\n\t}\n\treturn result;\n}\n\n/** @returns {(this: any, ...args: any[]) => void} */\nexport function once(fn) {\n\tlet ran = false;\n\treturn function (...args) {\n\t\tif (ran) return;\n\t\tran = true;\n\t\tfn.call(this, ...args);\n\t};\n}\n\nexport function null_to_empty(value) {\n\treturn value == null ? '' : value;\n}\n\nexport function set_store_value(store, ret, value) {\n\tstore.set(value);\n\treturn ret;\n}\n\nexport const has_prop = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);\n\nexport function action_destroyer(action_result) {\n\treturn action_result && is_function(action_result.destroy) ? action_result.destroy : noop;\n}\n\n/** @param {number | string} value\n * @returns {[number, string]}\n */\nexport function split_css_unit(value) {\n\tconst split = typeof value === 'string' && value.match(/^\\s*(-?[\\d.]+)([^\\s]*)\\s*$/);\n\treturn split ? [parseFloat(split[1]), split[2] || 'px'] : [/** @type {number} */ (value), 'px'];\n}\n\nexport const contenteditable_truthy_values = ['', true, 1, 'true', 'contenteditable'];\n", "/** @type {typeof globalThis} */\nexport const globals =\n\ttypeof window !== 'undefined'\n\t\t? window\n\t\t: typeof globalThis !== 'undefined'\n\t\t? globalThis\n\t\t: // @ts-ignore Node typings have this\n\t\t  global;\n", "import { globals } from './globals.js';\n\n/**\n * Resize observer singleton.\n * One listener per element only!\n * https://groups.google.com/a/chromium.org/g/blink-dev/c/z6ienONUb5A/m/F5-VcUZtBAAJ\n */\nexport class ResizeObserverSingleton {\n\t/**\n\t * @private\n\t * @readonly\n\t * @type {WeakMap<Element, import('./private.js').Listener>}\n\t */\n\t_listeners = 'WeakMap' in globals ? new WeakMap() : undefined;\n\n\t/**\n\t * @private\n\t * @type {ResizeObserver}\n\t */\n\t_observer = undefined;\n\n\t/** @type {ResizeObserverOptions} */\n\toptions;\n\n\t/** @param {ResizeObserverOptions} options */\n\tconstructor(options) {\n\t\tthis.options = options;\n\t}\n\n\t/**\n\t * @param {Element} element\n\t * @param {import('./private.js').Listener} listener\n\t * @returns {() => void}\n\t */\n\tobserve(element, listener) {\n\t\tthis._listeners.set(element, listener);\n\t\tthis._getObserver().observe(element, this.options);\n\t\treturn () => {\n\t\t\tthis._listeners.delete(element);\n\t\t\tthis._observer.unobserve(element); // this line can probably be removed\n\t\t};\n\t}\n\n\t/**\n\t * @private\n\t */\n\t_getObserver() {\n\t\treturn (\n\t\t\tthis._observer ??\n\t\t\t(this._observer = new ResizeObserver((entries) => {\n\t\t\t\tfor (const entry of entries) {\n\t\t\t\t\tResizeObserverSingleton.entries.set(entry.target, entry);\n\t\t\t\t\tthis._listeners.get(entry.target)?.(entry);\n\t\t\t\t}\n\t\t\t}))\n\t\t);\n\t}\n}\n\n// Needs to be written like this to pass the tree-shake-test\nResizeObserverSingleton.entries = 'WeakMap' in globals ? new WeakMap() : undefined;\n", "import { contenteditable_truthy_values, has_prop } from './utils.js';\n\nimport { ResizeObserverSingleton } from './ResizeObserverSingleton.js';\n\n// Track which nodes are claimed during hydration. Unclaimed nodes can then be removed from the DOM\n// at the end of hydration without touching the remaining nodes.\nlet is_hydrating = false;\n\n/**\n * @returns {void}\n */\nexport function start_hydrating() {\n\tis_hydrating = true;\n}\n\n/**\n * @returns {void}\n */\nexport function end_hydrating() {\n\tis_hydrating = false;\n}\n\n/**\n * @param {number} low\n * @param {number} high\n * @param {(index: number) => number} key\n * @param {number} value\n * @returns {number}\n */\nfunction upper_bound(low, high, key, value) {\n\t// Return first index of value larger than input value in the range [low, high)\n\twhile (low < high) {\n\t\tconst mid = low + ((high - low) >> 1);\n\t\tif (key(mid) <= value) {\n\t\t\tlow = mid + 1;\n\t\t} else {\n\t\t\thigh = mid;\n\t\t}\n\t}\n\treturn low;\n}\n\n/**\n * @param {NodeEx} target\n * @returns {void}\n */\nfunction init_hydrate(target) {\n\tif (target.hydrate_init) return;\n\ttarget.hydrate_init = true;\n\t// We know that all children have claim_order values since the unclaimed have been detached if target is not <head>\n\n\tlet children = /** @type {ArrayLike<NodeEx2>} */ (target.childNodes);\n\t// If target is <head>, there may be children without claim_order\n\tif (target.nodeName === 'HEAD') {\n\t\tconst my_children = [];\n\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\tconst node = children[i];\n\t\t\tif (node.claim_order !== undefined) {\n\t\t\t\tmy_children.push(node);\n\t\t\t}\n\t\t}\n\t\tchildren = my_children;\n\t}\n\t/*\n\t * Reorder claimed children optimally.\n\t * We can reorder claimed children optimally by finding the longest subsequence of\n\t * nodes that are already claimed in order and only moving the rest. The longest\n\t * subsequence of nodes that are claimed in order can be found by\n\t * computing the longest increasing subsequence of .claim_order values.\n\t *\n\t * This algorithm is optimal in generating the least amount of reorder operations\n\t * possible.\n\t *\n\t * Proof:\n\t * We know that, given a set of reordering operations, the nodes that do not move\n\t * always form an increasing subsequence, since they do not move among each other\n\t * meaning that they must be already ordered among each other. Thus, the maximal\n\t * set of nodes that do not move form a longest increasing subsequence.\n\t */\n\t// Compute longest increasing subsequence\n\t// m: subsequence length j => index k of smallest value that ends an increasing subsequence of length j\n\tconst m = new Int32Array(children.length + 1);\n\t// Predecessor indices + 1\n\tconst p = new Int32Array(children.length);\n\tm[0] = -1;\n\tlet longest = 0;\n\tfor (let i = 0; i < children.length; i++) {\n\t\tconst current = children[i].claim_order;\n\t\t// Find the largest subsequence length such that it ends in a value less than our current value\n\t\t// upper_bound returns first greater value, so we subtract one\n\t\t// with fast path for when we are on the current longest subsequence\n\t\tconst seq_len =\n\t\t\t(longest > 0 && children[m[longest]].claim_order <= current\n\t\t\t\t? longest + 1\n\t\t\t\t: upper_bound(1, longest, (idx) => children[m[idx]].claim_order, current)) - 1;\n\t\tp[i] = m[seq_len] + 1;\n\t\tconst new_len = seq_len + 1;\n\t\t// We can guarantee that current is the smallest value. Otherwise, we would have generated a longer sequence.\n\t\tm[new_len] = i;\n\t\tlongest = Math.max(new_len, longest);\n\t}\n\t// The longest increasing subsequence of nodes (initially reversed)\n\n\t/**\n\t * @type {NodeEx2[]}\n\t */\n\tconst lis = [];\n\t// The rest of the nodes, nodes that will be moved\n\n\t/**\n\t * @type {NodeEx2[]}\n\t */\n\tconst to_move = [];\n\tlet last = children.length - 1;\n\tfor (let cur = m[longest] + 1; cur != 0; cur = p[cur - 1]) {\n\t\tlis.push(children[cur - 1]);\n\t\tfor (; last >= cur; last--) {\n\t\t\tto_move.push(children[last]);\n\t\t}\n\t\tlast--;\n\t}\n\tfor (; last >= 0; last--) {\n\t\tto_move.push(children[last]);\n\t}\n\tlis.reverse();\n\t// We sort the nodes being moved to guarantee that their insertion order matches the claim order\n\tto_move.sort((a, b) => a.claim_order - b.claim_order);\n\t// Finally, we move the nodes\n\tfor (let i = 0, j = 0; i < to_move.length; i++) {\n\t\twhile (j < lis.length && to_move[i].claim_order >= lis[j].claim_order) {\n\t\t\tj++;\n\t\t}\n\t\tconst anchor = j < lis.length ? lis[j] : null;\n\t\ttarget.insertBefore(to_move[i], anchor);\n\t}\n}\n\n/**\n * @param {Node} target\n * @param {Node} node\n * @returns {void}\n */\nexport function append(target, node) {\n\ttarget.appendChild(node);\n}\n\n/**\n * @param {Node} target\n * @param {string} style_sheet_id\n * @param {string} styles\n * @returns {void}\n */\nexport function append_styles(target, style_sheet_id, styles) {\n\tconst append_styles_to = get_root_for_style(target);\n\tif (!append_styles_to.getElementById(style_sheet_id)) {\n\t\tconst style = element('style');\n\t\tstyle.id = style_sheet_id;\n\t\tstyle.textContent = styles;\n\t\tappend_stylesheet(append_styles_to, style);\n\t}\n}\n\n/**\n * @param {Node} node\n * @returns {ShadowRoot | Document}\n */\nexport function get_root_for_style(node) {\n\tif (!node) return document;\n\tconst root = node.getRootNode ? node.getRootNode() : node.ownerDocument;\n\tif (root && /** @type {ShadowRoot} */ (root).host) {\n\t\treturn /** @type {ShadowRoot} */ (root);\n\t}\n\treturn node.ownerDocument;\n}\n\n/**\n * @param {Node} node\n * @returns {CSSStyleSheet}\n */\nexport function append_empty_stylesheet(node) {\n\tconst style_element = element('style');\n\t// For transitions to work without 'style-src: unsafe-inline' Content Security Policy,\n\t// these empty tags need to be allowed with a hash as a workaround until we move to the Web Animations API.\n\t// Using the hash for the empty string (for an empty tag) works in all browsers except Safari.\n\t// So as a workaround for the workaround, when we append empty style tags we set their content to /* empty */.\n\t// The hash 'sha256-9OlNO0DNEeaVzHL4RZwCLsBHA8WBQ8toBp/4F5XV2nc=' will then work even in Safari.\n\tstyle_element.textContent = '/* empty */';\n\tappend_stylesheet(get_root_for_style(node), style_element);\n\treturn style_element.sheet;\n}\n\n/**\n * @param {ShadowRoot | Document} node\n * @param {HTMLStyleElement} style\n * @returns {CSSStyleSheet}\n */\nfunction append_stylesheet(node, style) {\n\tappend(/** @type {Document} */ (node).head || node, style);\n\treturn style.sheet;\n}\n\n/**\n * @param {NodeEx} target\n * @param {NodeEx} node\n * @returns {void}\n */\nexport function append_hydration(target, node) {\n\tif (is_hydrating) {\n\t\tinit_hydrate(target);\n\t\tif (\n\t\t\ttarget.actual_end_child === undefined ||\n\t\t\t(target.actual_end_child !== null && target.actual_end_child.parentNode !== target)\n\t\t) {\n\t\t\ttarget.actual_end_child = target.firstChild;\n\t\t}\n\t\t// Skip nodes of undefined ordering\n\t\twhile (target.actual_end_child !== null && target.actual_end_child.claim_order === undefined) {\n\t\t\ttarget.actual_end_child = target.actual_end_child.nextSibling;\n\t\t}\n\t\tif (node !== target.actual_end_child) {\n\t\t\t// We only insert if the ordering of this node should be modified or the parent node is not target\n\t\t\tif (node.claim_order !== undefined || node.parentNode !== target) {\n\t\t\t\ttarget.insertBefore(node, target.actual_end_child);\n\t\t\t}\n\t\t} else {\n\t\t\ttarget.actual_end_child = node.nextSibling;\n\t\t}\n\t} else if (node.parentNode !== target || node.nextSibling !== null) {\n\t\ttarget.appendChild(node);\n\t}\n}\n\n/**\n * @param {Node} target\n * @param {Node} node\n * @param {Node} [anchor]\n * @returns {void}\n */\nexport function insert(target, node, anchor) {\n\ttarget.insertBefore(node, anchor || null);\n}\n\n/**\n * @param {NodeEx} target\n * @param {NodeEx} node\n * @param {NodeEx} [anchor]\n * @returns {void}\n */\nexport function insert_hydration(target, node, anchor) {\n\tif (is_hydrating && !anchor) {\n\t\tappend_hydration(target, node);\n\t} else if (node.parentNode !== target || node.nextSibling != anchor) {\n\t\ttarget.insertBefore(node, anchor || null);\n\t}\n}\n\n/**\n * @param {Node} node\n * @returns {void}\n */\nexport function detach(node) {\n\tif (node.parentNode) {\n\t\tnode.parentNode.removeChild(node);\n\t}\n}\n\n/**\n * @returns {void} */\nexport function destroy_each(iterations, detaching) {\n\tfor (let i = 0; i < iterations.length; i += 1) {\n\t\tif (iterations[i]) iterations[i].d(detaching);\n\t}\n}\n\n/**\n * @template {keyof HTMLElementTagNameMap} K\n * @param {K} name\n * @returns {HTMLElementTagNameMap[K]}\n */\nexport function element(name) {\n\treturn document.createElement(name);\n}\n\n/**\n * @template {keyof HTMLElementTagNameMap} K\n * @param {K} name\n * @param {string} is\n * @returns {HTMLElementTagNameMap[K]}\n */\nexport function element_is(name, is) {\n\treturn document.createElement(name, { is });\n}\n\n/**\n * @template T\n * @template {keyof T} K\n * @param {T} obj\n * @param {K[]} exclude\n * @returns {Pick<T, Exclude<keyof T, K>>}\n */\nexport function object_without_properties(obj, exclude) {\n\tconst target = /** @type {Pick<T, Exclude<keyof T, K>>} */ ({});\n\tfor (const k in obj) {\n\t\tif (\n\t\t\thas_prop(obj, k) &&\n\t\t\t// @ts-ignore\n\t\t\texclude.indexOf(k) === -1\n\t\t) {\n\t\t\t// @ts-ignore\n\t\t\ttarget[k] = obj[k];\n\t\t}\n\t}\n\treturn target;\n}\n\n/**\n * @template {keyof SVGElementTagNameMap} K\n * @param {K} name\n * @returns {SVGElement}\n */\nexport function svg_element(name) {\n\treturn document.createElementNS('http://www.w3.org/2000/svg', name);\n}\n\n/**\n * @param {string} data\n * @returns {Text}\n */\nexport function text(data) {\n\treturn document.createTextNode(data);\n}\n\n/**\n * @returns {Text} */\nexport function space() {\n\treturn text(' ');\n}\n\n/**\n * @returns {Text} */\nexport function empty() {\n\treturn text('');\n}\n\n/**\n * @param {string} content\n * @returns {Comment}\n */\nexport function comment(content) {\n\treturn document.createComment(content);\n}\n\n/**\n * @param {EventTarget} node\n * @param {string} event\n * @param {EventListenerOrEventListenerObject} handler\n * @param {boolean | AddEventListenerOptions | EventListenerOptions} [options]\n * @returns {() => void}\n */\nexport function listen(node, event, handler, options) {\n\tnode.addEventListener(event, handler, options);\n\treturn () => node.removeEventListener(event, handler, options);\n}\n\n/**\n * @returns {(event: any) => any} */\nexport function prevent_default(fn) {\n\treturn function (event) {\n\t\tevent.preventDefault();\n\t\t// @ts-ignore\n\t\treturn fn.call(this, event);\n\t};\n}\n\n/**\n * @returns {(event: any) => any} */\nexport function stop_propagation(fn) {\n\treturn function (event) {\n\t\tevent.stopPropagation();\n\t\t// @ts-ignore\n\t\treturn fn.call(this, event);\n\t};\n}\n\n/**\n * @returns {(event: any) => any} */\nexport function stop_immediate_propagation(fn) {\n\treturn function (event) {\n\t\tevent.stopImmediatePropagation();\n\t\t// @ts-ignore\n\t\treturn fn.call(this, event);\n\t};\n}\n\n/**\n * @returns {(event: any) => void} */\nexport function self(fn) {\n\treturn function (event) {\n\t\t// @ts-ignore\n\t\tif (event.target === this) fn.call(this, event);\n\t};\n}\n\n/**\n * @returns {(event: any) => void} */\nexport function trusted(fn) {\n\treturn function (event) {\n\t\t// @ts-ignore\n\t\tif (event.isTrusted) fn.call(this, event);\n\t};\n}\n\n/**\n * @param {Element} node\n * @param {string} attribute\n * @param {string} [value]\n * @returns {void}\n */\nexport function attr(node, attribute, value) {\n\tif (value == null) node.removeAttribute(attribute);\n\telse if (node.getAttribute(attribute) !== value) node.setAttribute(attribute, value);\n}\n/**\n * List of attributes that should always be set through the attr method,\n * because updating them through the property setter doesn't work reliably.\n * In the example of `width`/`height`, the problem is that the setter only\n * accepts numeric values, but the attribute can also be set to a string like `50%`.\n * If this list becomes too big, rethink this approach.\n */\nconst always_set_through_set_attribute = ['width', 'height'];\n\n/**\n * @param {Element & ElementCSSInlineStyle} node\n * @param {{ [x: string]: string }} attributes\n * @returns {void}\n */\nexport function set_attributes(node, attributes) {\n\t// @ts-ignore\n\tconst descriptors = Object.getOwnPropertyDescriptors(node.__proto__);\n\tfor (const key in attributes) {\n\t\tif (attributes[key] == null) {\n\t\t\tnode.removeAttribute(key);\n\t\t} else if (key === 'style') {\n\t\t\tnode.style.cssText = attributes[key];\n\t\t} else if (key === '__value') {\n\t\t\t/** @type {any} */ (node).value = node[key] = attributes[key];\n\t\t} else if (\n\t\t\tdescriptors[key] &&\n\t\t\tdescriptors[key].set &&\n\t\t\talways_set_through_set_attribute.indexOf(key) === -1\n\t\t) {\n\t\t\tnode[key] = attributes[key];\n\t\t} else {\n\t\t\tattr(node, key, attributes[key]);\n\t\t}\n\t}\n}\n\n/**\n * @param {Element & ElementCSSInlineStyle} node\n * @param {{ [x: string]: string }} attributes\n * @returns {void}\n */\nexport function set_svg_attributes(node, attributes) {\n\tfor (const key in attributes) {\n\t\tattr(node, key, attributes[key]);\n\t}\n}\n\n/**\n * @param {Record<string, unknown>} data_map\n * @returns {void}\n */\nexport function set_custom_element_data_map(node, data_map) {\n\tObject.keys(data_map).forEach((key) => {\n\t\tset_custom_element_data(node, key, data_map[key]);\n\t});\n}\n\n/**\n * @returns {void} */\nexport function set_custom_element_data(node, prop, value) {\n\tconst lower = prop.toLowerCase(); // for backwards compatibility with existing behavior we do lowercase first\n\tif (lower in node) {\n\t\tnode[lower] = typeof node[lower] === 'boolean' && value === '' ? true : value;\n\t} else if (prop in node) {\n\t\tnode[prop] = typeof node[prop] === 'boolean' && value === '' ? true : value;\n\t} else {\n\t\tattr(node, prop, value);\n\t}\n}\n\n/**\n * @param {string} tag\n */\nexport function set_dynamic_element_data(tag) {\n\treturn /-/.test(tag) ? set_custom_element_data_map : set_attributes;\n}\n\n/**\n * @returns {void}\n */\nexport function xlink_attr(node, attribute, value) {\n\tnode.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\n\n/**\n * @param {HTMLElement} node\n * @returns {string}\n */\nexport function get_svelte_dataset(node) {\n\treturn node.dataset.svelteH;\n}\n\n/**\n * @returns {unknown[]} */\nexport function get_binding_group_value(group, __value, checked) {\n\tconst value = new Set();\n\tfor (let i = 0; i < group.length; i += 1) {\n\t\tif (group[i].checked) value.add(group[i].__value);\n\t}\n\tif (!checked) {\n\t\tvalue.delete(__value);\n\t}\n\treturn Array.from(value);\n}\n\n/**\n * @param {HTMLInputElement[]} group\n * @returns {{ p(...inputs: HTMLInputElement[]): void; r(): void; }}\n */\nexport function init_binding_group(group) {\n\t/**\n\t * @type {HTMLInputElement[]} */\n\tlet _inputs;\n\treturn {\n\t\t/* push */ p(...inputs) {\n\t\t\t_inputs = inputs;\n\t\t\t_inputs.forEach((input) => group.push(input));\n\t\t},\n\t\t/* remove */ r() {\n\t\t\t_inputs.forEach((input) => group.splice(group.indexOf(input), 1));\n\t\t}\n\t};\n}\n\n/**\n * @param {number[]} indexes\n * @returns {{ u(new_indexes: number[]): void; p(...inputs: HTMLInputElement[]): void; r: () => void; }}\n */\nexport function init_binding_group_dynamic(group, indexes) {\n\t/**\n\t * @type {HTMLInputElement[]} */\n\tlet _group = get_binding_group(group);\n\n\t/**\n\t * @type {HTMLInputElement[]} */\n\tlet _inputs;\n\n\tfunction get_binding_group(group) {\n\t\tfor (let i = 0; i < indexes.length; i++) {\n\t\t\tgroup = group[indexes[i]] = group[indexes[i]] || [];\n\t\t}\n\t\treturn group;\n\t}\n\n\t/**\n\t * @returns {void} */\n\tfunction push() {\n\t\t_inputs.forEach((input) => _group.push(input));\n\t}\n\n\t/**\n\t * @returns {void} */\n\tfunction remove() {\n\t\t_inputs.forEach((input) => _group.splice(_group.indexOf(input), 1));\n\t}\n\treturn {\n\t\t/* update */ u(new_indexes) {\n\t\t\tindexes = new_indexes;\n\t\t\tconst new_group = get_binding_group(group);\n\t\t\tif (new_group !== _group) {\n\t\t\t\tremove();\n\t\t\t\t_group = new_group;\n\t\t\t\tpush();\n\t\t\t}\n\t\t},\n\t\t/* push */ p(...inputs) {\n\t\t\t_inputs = inputs;\n\t\t\tpush();\n\t\t},\n\t\t/* remove */ r: remove\n\t};\n}\n\n/** @returns {number} */\nexport function to_number(value) {\n\treturn value === '' ? null : +value;\n}\n\n/** @returns {any[]} */\nexport function time_ranges_to_array(ranges) {\n\tconst array = [];\n\tfor (let i = 0; i < ranges.length; i += 1) {\n\t\tarray.push({ start: ranges.start(i), end: ranges.end(i) });\n\t}\n\treturn array;\n}\n\n/**\n * @param {Element} element\n * @returns {ChildNode[]}\n */\nexport function children(element) {\n\treturn Array.from(element.childNodes);\n}\n\n/**\n * @param {ChildNodeArray} nodes\n * @returns {void}\n */\nfunction init_claim_info(nodes) {\n\tif (nodes.claim_info === undefined) {\n\t\tnodes.claim_info = { last_index: 0, total_claimed: 0 };\n\t}\n}\n\n/**\n * @template {ChildNodeEx} R\n * @param {ChildNodeArray} nodes\n * @param {(node: ChildNodeEx) => node is R} predicate\n * @param {(node: ChildNodeEx) => ChildNodeEx | undefined} process_node\n * @param {() => R} create_node\n * @param {boolean} dont_update_last_index\n * @returns {R}\n */\nfunction claim_node(nodes, predicate, process_node, create_node, dont_update_last_index = false) {\n\t// Try to find nodes in an order such that we lengthen the longest increasing subsequence\n\tinit_claim_info(nodes);\n\tconst result_node = (() => {\n\t\t// We first try to find an element after the previous one\n\t\tfor (let i = nodes.claim_info.last_index; i < nodes.length; i++) {\n\t\t\tconst node = nodes[i];\n\t\t\tif (predicate(node)) {\n\t\t\t\tconst replacement = process_node(node);\n\t\t\t\tif (replacement === undefined) {\n\t\t\t\t\tnodes.splice(i, 1);\n\t\t\t\t} else {\n\t\t\t\t\tnodes[i] = replacement;\n\t\t\t\t}\n\t\t\t\tif (!dont_update_last_index) {\n\t\t\t\t\tnodes.claim_info.last_index = i;\n\t\t\t\t}\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\t\t// Otherwise, we try to find one before\n\t\t// We iterate in reverse so that we don't go too far back\n\t\tfor (let i = nodes.claim_info.last_index - 1; i >= 0; i--) {\n\t\t\tconst node = nodes[i];\n\t\t\tif (predicate(node)) {\n\t\t\t\tconst replacement = process_node(node);\n\t\t\t\tif (replacement === undefined) {\n\t\t\t\t\tnodes.splice(i, 1);\n\t\t\t\t} else {\n\t\t\t\t\tnodes[i] = replacement;\n\t\t\t\t}\n\t\t\t\tif (!dont_update_last_index) {\n\t\t\t\t\tnodes.claim_info.last_index = i;\n\t\t\t\t} else if (replacement === undefined) {\n\t\t\t\t\t// Since we spliced before the last_index, we decrease it\n\t\t\t\t\tnodes.claim_info.last_index--;\n\t\t\t\t}\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\t\t// If we can't find any matching node, we create a new one\n\t\treturn create_node();\n\t})();\n\tresult_node.claim_order = nodes.claim_info.total_claimed;\n\tnodes.claim_info.total_claimed += 1;\n\treturn result_node;\n}\n\n/**\n * @param {ChildNodeArray} nodes\n * @param {string} name\n * @param {{ [key: string]: boolean }} attributes\n * @param {(name: string) => Element | SVGElement} create_element\n * @returns {Element | SVGElement}\n */\nfunction claim_element_base(nodes, name, attributes, create_element) {\n\treturn claim_node(\n\t\tnodes,\n\t\t/** @returns {node is Element | SVGElement} */\n\t\t(node) => node.nodeName === name,\n\t\t/** @param {Element} node */\n\t\t(node) => {\n\t\t\tconst remove = [];\n\t\t\tfor (let j = 0; j < node.attributes.length; j++) {\n\t\t\t\tconst attribute = node.attributes[j];\n\t\t\t\tif (!attributes[attribute.name]) {\n\t\t\t\t\tremove.push(attribute.name);\n\t\t\t\t}\n\t\t\t}\n\t\t\tremove.forEach((v) => node.removeAttribute(v));\n\t\t\treturn undefined;\n\t\t},\n\t\t() => create_element(name)\n\t);\n}\n\n/**\n * @param {ChildNodeArray} nodes\n * @param {string} name\n * @param {{ [key: string]: boolean }} attributes\n * @returns {Element | SVGElement}\n */\nexport function claim_element(nodes, name, attributes) {\n\treturn claim_element_base(nodes, name, attributes, element);\n}\n\n/**\n * @param {ChildNodeArray} nodes\n * @param {string} name\n * @param {{ [key: string]: boolean }} attributes\n * @returns {Element | SVGElement}\n */\nexport function claim_svg_element(nodes, name, attributes) {\n\treturn claim_element_base(nodes, name, attributes, svg_element);\n}\n\n/**\n * @param {ChildNodeArray} nodes\n * @returns {Text}\n */\nexport function claim_text(nodes, data) {\n\treturn claim_node(\n\t\tnodes,\n\t\t/** @returns {node is Text} */\n\t\t(node) => node.nodeType === 3,\n\t\t/** @param {Text} node */\n\t\t(node) => {\n\t\t\tconst data_str = '' + data;\n\t\t\tif (node.data.startsWith(data_str)) {\n\t\t\t\tif (node.data.length !== data_str.length) {\n\t\t\t\t\treturn node.splitText(data_str.length);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnode.data = data_str;\n\t\t\t}\n\t\t},\n\t\t() => text(data),\n\t\ttrue // Text nodes should not update last index since it is likely not worth it to eliminate an increasing subsequence of actual elements\n\t);\n}\n\n/**\n * @returns {Text} */\nexport function claim_space(nodes) {\n\treturn claim_text(nodes, ' ');\n}\n\n/**\n * @param {ChildNodeArray} nodes\n * @returns {Comment}\n */\nexport function claim_comment(nodes, data) {\n\treturn claim_node(\n\t\tnodes,\n\t\t/** @returns {node is Comment} */\n\t\t(node) => node.nodeType === 8,\n\t\t/** @param {Comment} node */\n\t\t(node) => {\n\t\t\tnode.data = '' + data;\n\t\t\treturn undefined;\n\t\t},\n\t\t() => comment(data),\n\t\ttrue\n\t);\n}\n\nfunction get_comment_idx(nodes, text, start) {\n\tfor (let i = start; i < nodes.length; i += 1) {\n\t\tconst node = nodes[i];\n\t\tif (node.nodeType === 8 /* comment node */ && node.textContent.trim() === text) {\n\t\t\treturn i;\n\t\t}\n\t}\n\treturn -1;\n}\n\n/**\n * @param {boolean} is_svg\n * @returns {HtmlTagHydration}\n */\nexport function claim_html_tag(nodes, is_svg) {\n\t// find html opening tag\n\tconst start_index = get_comment_idx(nodes, 'HTML_TAG_START', 0);\n\tconst end_index = get_comment_idx(nodes, 'HTML_TAG_END', start_index + 1);\n\tif (start_index === -1 || end_index === -1) {\n\t\treturn new HtmlTagHydration(is_svg);\n\t}\n\n\tinit_claim_info(nodes);\n\tconst html_tag_nodes = nodes.splice(start_index, end_index - start_index + 1);\n\tdetach(html_tag_nodes[0]);\n\tdetach(html_tag_nodes[html_tag_nodes.length - 1]);\n\tconst claimed_nodes = html_tag_nodes.slice(1, html_tag_nodes.length - 1);\n\tif (claimed_nodes.length === 0) {\n\t\treturn new HtmlTagHydration(is_svg);\n\t}\n\tfor (const n of claimed_nodes) {\n\t\tn.claim_order = nodes.claim_info.total_claimed;\n\t\tnodes.claim_info.total_claimed += 1;\n\t}\n\treturn new HtmlTagHydration(is_svg, claimed_nodes);\n}\n\n/**\n * @param {Text} text\n * @param {unknown} data\n * @returns {void}\n */\nexport function set_data(text, data) {\n\tdata = '' + data;\n\tif (text.data === data) return;\n\ttext.data = /** @type {string} */ (data);\n}\n\n/**\n * @param {Text} text\n * @param {unknown} data\n * @returns {void}\n */\nexport function set_data_contenteditable(text, data) {\n\tdata = '' + data;\n\tif (text.wholeText === data) return;\n\ttext.data = /** @type {string} */ (data);\n}\n\n/**\n * @param {Text} text\n * @param {unknown} data\n * @param {string} attr_value\n * @returns {void}\n */\nexport function set_data_maybe_contenteditable(text, data, attr_value) {\n\tif (~contenteditable_truthy_values.indexOf(attr_value)) {\n\t\tset_data_contenteditable(text, data);\n\t} else {\n\t\tset_data(text, data);\n\t}\n}\n\n/**\n * @returns {void} */\nexport function set_input_value(input, value) {\n\tinput.value = value == null ? '' : value;\n}\n\n/**\n * @returns {void} */\nexport function set_input_type(input, type) {\n\ttry {\n\t\tinput.type = type;\n\t} catch (e) {\n\t\t// do nothing\n\t}\n}\n\n/**\n * @returns {void} */\nexport function set_style(node, key, value, important) {\n\tif (value == null) {\n\t\tnode.style.removeProperty(key);\n\t} else {\n\t\tnode.style.setProperty(key, value, important ? 'important' : '');\n\t}\n}\n\n/**\n * @returns {void} */\nexport function select_option(select, value, mounting) {\n\tfor (let i = 0; i < select.options.length; i += 1) {\n\t\tconst option = select.options[i];\n\t\tif (option.__value === value) {\n\t\t\toption.selected = true;\n\t\t\treturn;\n\t\t}\n\t}\n\tif (!mounting || value !== undefined) {\n\t\tselect.selectedIndex = -1; // no option should be selected\n\t}\n}\n\n/**\n * @returns {void} */\nexport function select_options(select, value) {\n\tfor (let i = 0; i < select.options.length; i += 1) {\n\t\tconst option = select.options[i];\n\t\toption.selected = ~value.indexOf(option.__value);\n\t}\n}\n\nexport function select_value(select) {\n\tconst selected_option = select.querySelector(':checked');\n\treturn selected_option && selected_option.__value;\n}\n\nexport function select_multiple_value(select) {\n\treturn [].map.call(select.querySelectorAll(':checked'), (option) => option.__value);\n}\n// unfortunately this can't be a constant as that wouldn't be tree-shakeable\n// so we cache the result instead\n\n/**\n * @type {boolean} */\nlet crossorigin;\n\n/**\n * @returns {boolean} */\nexport function is_crossorigin() {\n\tif (crossorigin === undefined) {\n\t\tcrossorigin = false;\n\t\ttry {\n\t\t\tif (typeof window !== 'undefined' && window.parent) {\n\t\t\t\tvoid window.parent.document;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tcrossorigin = true;\n\t\t}\n\t}\n\treturn crossorigin;\n}\n\n/**\n * @param {HTMLElement} node\n * @param {() => void} fn\n * @returns {() => void}\n */\nexport function add_iframe_resize_listener(node, fn) {\n\tconst computed_style = getComputedStyle(node);\n\tif (computed_style.position === 'static') {\n\t\tnode.style.position = 'relative';\n\t}\n\tconst iframe = element('iframe');\n\tiframe.setAttribute(\n\t\t'style',\n\t\t'display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; ' +\n\t\t\t'overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;'\n\t);\n\tiframe.setAttribute('aria-hidden', 'true');\n\tiframe.tabIndex = -1;\n\tconst crossorigin = is_crossorigin();\n\n\t/**\n\t * @type {() => void}\n\t */\n\tlet unsubscribe;\n\tif (crossorigin) {\n\t\tiframe.src = \"data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}</script>\";\n\t\tunsubscribe = listen(\n\t\t\twindow,\n\t\t\t'message',\n\t\t\t/** @param {MessageEvent} event */ (event) => {\n\t\t\t\tif (event.source === iframe.contentWindow) fn();\n\t\t\t}\n\t\t);\n\t} else {\n\t\tiframe.src = 'about:blank';\n\t\tiframe.onload = () => {\n\t\t\tunsubscribe = listen(iframe.contentWindow, 'resize', fn);\n\t\t\t// make sure an initial resize event is fired _after_ the iframe is loaded (which is asynchronous)\n\t\t\t// see https://github.com/sveltejs/svelte/issues/4233\n\t\t\tfn();\n\t\t};\n\t}\n\tappend(node, iframe);\n\treturn () => {\n\t\tif (crossorigin) {\n\t\t\tunsubscribe();\n\t\t} else if (unsubscribe && iframe.contentWindow) {\n\t\t\tunsubscribe();\n\t\t}\n\t\tdetach(iframe);\n\t};\n}\nexport const resize_observer_content_box = /* @__PURE__ */ new ResizeObserverSingleton({\n\tbox: 'content-box'\n});\nexport const resize_observer_border_box = /* @__PURE__ */ new ResizeObserverSingleton({\n\tbox: 'border-box'\n});\nexport const resize_observer_device_pixel_content_box = /* @__PURE__ */ new ResizeObserverSingleton(\n\t{ box: 'device-pixel-content-box' }\n);\nexport { ResizeObserverSingleton };\n\n/**\n * @returns {void} */\nexport function toggle_class(element, name, toggle) {\n\t// The `!!` is required because an `undefined` flag means flipping the current state.\n\telement.classList.toggle(name, !!toggle);\n}\n\n/**\n * @template T\n * @param {string} type\n * @param {T} [detail]\n * @param {{ bubbles?: boolean, cancelable?: boolean }} [options]\n * @returns {CustomEvent<T>}\n */\nexport function custom_event(type, detail, { bubbles = false, cancelable = false } = {}) {\n\treturn new CustomEvent(type, { detail, bubbles, cancelable });\n}\n\n/**\n * @param {string} selector\n * @param {HTMLElement} parent\n * @returns {ChildNodeArray}\n */\nexport function query_selector_all(selector, parent = document.body) {\n\treturn Array.from(parent.querySelectorAll(selector));\n}\n\n/**\n * @param {string} nodeId\n * @param {HTMLElement} head\n * @returns {any[]}\n */\nexport function head_selector(nodeId, head) {\n\tconst result = [];\n\tlet started = 0;\n\tfor (const node of head.childNodes) {\n\t\tif (node.nodeType === 8 /* comment node */) {\n\t\t\tconst comment = node.textContent.trim();\n\t\t\tif (comment === `HEAD_${nodeId}_END`) {\n\t\t\t\tstarted -= 1;\n\t\t\t\tresult.push(node);\n\t\t\t} else if (comment === `HEAD_${nodeId}_START`) {\n\t\t\t\tstarted += 1;\n\t\t\t\tresult.push(node);\n\t\t\t}\n\t\t} else if (started > 0) {\n\t\t\tresult.push(node);\n\t\t}\n\t}\n\treturn result;\n}\n/** */\nexport class HtmlTag {\n\t/**\n\t * @private\n\t * @default false\n\t */\n\tis_svg = false;\n\t/** parent for creating node */\n\te = undefined;\n\t/** html tag nodes */\n\tn = undefined;\n\t/** target */\n\tt = undefined;\n\t/** anchor */\n\ta = undefined;\n\tconstructor(is_svg = false) {\n\t\tthis.is_svg = is_svg;\n\t\tthis.e = this.n = null;\n\t}\n\n\t/**\n\t * @param {string} html\n\t * @returns {void}\n\t */\n\tc(html) {\n\t\tthis.h(html);\n\t}\n\n\t/**\n\t * @param {string} html\n\t * @param {HTMLElement | SVGElement} target\n\t * @param {HTMLElement | SVGElement} anchor\n\t * @returns {void}\n\t */\n\tm(html, target, anchor = null) {\n\t\tif (!this.e) {\n\t\t\tif (this.is_svg)\n\t\t\t\tthis.e = svg_element(/** @type {keyof SVGElementTagNameMap} */ (target.nodeName));\n\t\t\t/** #7364  target for <template> may be provided as #document-fragment(11) */ else\n\t\t\t\tthis.e = element(\n\t\t\t\t\t/** @type {keyof HTMLElementTagNameMap} */ (\n\t\t\t\t\t\ttarget.nodeType === 11 ? 'TEMPLATE' : target.nodeName\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\tthis.t =\n\t\t\t\ttarget.tagName !== 'TEMPLATE'\n\t\t\t\t\t? target\n\t\t\t\t\t: /** @type {HTMLTemplateElement} */ (target).content;\n\t\t\tthis.c(html);\n\t\t}\n\t\tthis.i(anchor);\n\t}\n\n\t/**\n\t * @param {string} html\n\t * @returns {void}\n\t */\n\th(html) {\n\t\tthis.e.innerHTML = html;\n\t\tthis.n = Array.from(\n\t\t\tthis.e.nodeName === 'TEMPLATE' ? this.e.content.childNodes : this.e.childNodes\n\t\t);\n\t}\n\n\t/**\n\t * @returns {void} */\n\ti(anchor) {\n\t\tfor (let i = 0; i < this.n.length; i += 1) {\n\t\t\tinsert(this.t, this.n[i], anchor);\n\t\t}\n\t}\n\n\t/**\n\t * @param {string} html\n\t * @returns {void}\n\t */\n\tp(html) {\n\t\tthis.d();\n\t\tthis.h(html);\n\t\tthis.i(this.a);\n\t}\n\n\t/**\n\t * @returns {void} */\n\td() {\n\t\tthis.n.forEach(detach);\n\t}\n}\n\nexport class HtmlTagHydration extends HtmlTag {\n\t/** @type {Element[]} hydration claimed nodes */\n\tl = undefined;\n\n\tconstructor(is_svg = false, claimed_nodes) {\n\t\tsuper(is_svg);\n\t\tthis.e = this.n = null;\n\t\tthis.l = claimed_nodes;\n\t}\n\n\t/**\n\t * @param {string} html\n\t * @returns {void}\n\t */\n\tc(html) {\n\t\tif (this.l) {\n\t\t\tthis.n = this.l;\n\t\t} else {\n\t\t\tsuper.c(html);\n\t\t}\n\t}\n\n\t/**\n\t * @returns {void} */\n\ti(anchor) {\n\t\tfor (let i = 0; i < this.n.length; i += 1) {\n\t\t\tinsert_hydration(this.t, this.n[i], anchor);\n\t\t}\n\t}\n}\n\n/**\n * @param {NamedNodeMap} attributes\n * @returns {{}}\n */\nexport function attribute_to_object(attributes) {\n\tconst result = {};\n\tfor (const attribute of attributes) {\n\t\tresult[attribute.name] = attribute.value;\n\t}\n\treturn result;\n}\n\nconst escaped = {\n\t'\"': '&quot;',\n\t'&': '&amp;',\n\t'<': '&lt;'\n};\n\nconst regex_attribute_characters_to_escape = /[\"&<]/g;\n\n/**\n * Note that the attribute itself should be surrounded in double quotes\n * @param {any} attribute\n */\nfunction escape_attribute(attribute) {\n\treturn String(attribute).replace(regex_attribute_characters_to_escape, (match) => escaped[match]);\n}\n\n/**\n * @param {Record<string, string>} attributes\n */\nexport function stringify_spread(attributes) {\n\tlet str = ' ';\n\tfor (const key in attributes) {\n\t\tif (attributes[key] != null) {\n\t\t\tstr += `${key}=\"${escape_attribute(attributes[key])}\" `;\n\t\t}\n\t}\n\n\treturn str;\n}\n\n/**\n * @param {HTMLElement} element\n * @returns {{}}\n */\nexport function get_custom_elements_slots(element) {\n\tconst result = {};\n\telement.childNodes.forEach(\n\t\t/** @param {Element} node */ (node) => {\n\t\t\tresult[node.slot || 'default'] = true;\n\t\t}\n\t);\n\treturn result;\n}\n\nexport function construct_svelte_component(component, props) {\n\treturn new component(props);\n}\n\n/**\n * @typedef {Node & {\n * \tclaim_order?: number;\n * \thydrate_init?: true;\n * \tactual_end_child?: NodeEx;\n * \tchildNodes: NodeListOf<NodeEx>;\n * }} NodeEx\n */\n\n/** @typedef {ChildNode & NodeEx} ChildNodeEx */\n\n/** @typedef {NodeEx & { claim_order: number }} NodeEx2 */\n\n/**\n * @typedef {ChildNodeEx[] & {\n * \tclaim_info?: {\n * \t\tlast_index: number;\n * \t\ttotal_claimed: number;\n * \t};\n * }} ChildNodeArray\n */\n", "import { custom_event } from './dom.js';\n\nexport let current_component;\n\n/** @returns {void} */\nexport function set_current_component(component) {\n\tcurrent_component = component;\n}\n\nexport function get_current_component() {\n\tif (!current_component) throw new Error('Function called outside component initialization');\n\treturn current_component;\n}\n\n/**\n * Schedules a callback to run immediately before the component is updated after any state change.\n *\n * The first time the callback runs will be before the initial `onMount`\n *\n * https://svelte.dev/docs/svelte#beforeupdate\n * @param {() => any} fn\n * @returns {void}\n */\nexport function beforeUpdate(fn) {\n\tget_current_component().$$.before_update.push(fn);\n}\n\n/**\n * The `onMount` function schedules a callback to run as soon as the component has been mounted to the DOM.\n * It must be called during the component's initialisation (but doesn't need to live *inside* the component;\n * it can be called from an external module).\n *\n * If a function is returned _synchronously_ from `onMount`, it will be called when the component is unmounted.\n *\n * `onMount` does not run inside a [server-side component](https://svelte.dev/docs#run-time-server-side-component-api).\n *\n * https://svelte.dev/docs/svelte#onmount\n * @template T\n * @param {() => import('./private.js').NotFunction<T> | Promise<import('./private.js').NotFunction<T>> | (() => any)} fn\n * @returns {void}\n */\nexport function onMount(fn) {\n\tget_current_component().$$.on_mount.push(fn);\n}\n\n/**\n * Schedules a callback to run immediately after the component has been updated.\n *\n * The first time the callback runs will be after the initial `onMount`\n *\n * https://svelte.dev/docs/svelte#afterupdate\n * @param {() => any} fn\n * @returns {void}\n */\nexport function afterUpdate(fn) {\n\tget_current_component().$$.after_update.push(fn);\n}\n\n/**\n * Schedules a callback to run immediately before the component is unmounted.\n *\n * Out of `onMount`, `beforeUpdate`, `afterUpdate` and `onDestroy`, this is the\n * only one that runs inside a server-side component.\n *\n * https://svelte.dev/docs/svelte#ondestroy\n * @param {() => any} fn\n * @returns {void}\n */\nexport function onDestroy(fn) {\n\tget_current_component().$$.on_destroy.push(fn);\n}\n\n/**\n * Creates an event dispatcher that can be used to dispatch [component events](https://svelte.dev/docs#template-syntax-component-directives-on-eventname).\n * Event dispatchers are functions that can take two arguments: `name` and `detail`.\n *\n * Component events created with `createEventDispatcher` create a\n * [CustomEvent](https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent).\n * These events do not [bubble](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events#Event_bubbling_and_capture).\n * The `detail` argument corresponds to the [CustomEvent.detail](https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/detail)\n * property and can contain any type of data.\n *\n * The event dispatcher can be typed to narrow the allowed event names and the type of the `detail` argument:\n * ```ts\n * const dispatch = createEventDispatcher<{\n *  loaded: never; // does not take a detail argument\n *  change: string; // takes a detail argument of type string, which is required\n *  optional: number | null; // takes an optional detail argument of type number\n * }>();\n * ```\n *\n * https://svelte.dev/docs/svelte#createeventdispatcher\n * @template {Record<string, any>} [EventMap=any]\n * @returns {import('./public.js').EventDispatcher<EventMap>}\n */\nexport function createEventDispatcher() {\n\tconst component = get_current_component();\n\treturn (type, detail, { cancelable = false } = {}) => {\n\t\tconst callbacks = component.$$.callbacks[type];\n\t\tif (callbacks) {\n\t\t\t// TODO are there situations where events could be dispatched\n\t\t\t// in a server (non-DOM) environment?\n\t\t\tconst event = custom_event(/** @type {string} */ (type), detail, { cancelable });\n\t\t\tcallbacks.slice().forEach((fn) => {\n\t\t\t\tfn.call(component, event);\n\t\t\t});\n\t\t\treturn !event.defaultPrevented;\n\t\t}\n\t\treturn true;\n\t};\n}\n\n/**\n * Associates an arbitrary `context` object with the current component and the specified `key`\n * and returns that object. The context is then available to children of the component\n * (including slotted content) with `getContext`.\n *\n * Like lifecycle functions, this must be called during component initialisation.\n *\n * https://svelte.dev/docs/svelte#setcontext\n * @template T\n * @param {any} key\n * @param {T} context\n * @returns {T}\n */\nexport function setContext(key, context) {\n\tget_current_component().$$.context.set(key, context);\n\treturn context;\n}\n\n/**\n * Retrieves the context that belongs to the closest parent component with the specified `key`.\n * Must be called during component initialisation.\n *\n * https://svelte.dev/docs/svelte#getcontext\n * @template T\n * @param {any} key\n * @returns {T}\n */\nexport function getContext(key) {\n\treturn get_current_component().$$.context.get(key);\n}\n\n/**\n * Retrieves the whole context map that belongs to the closest parent component.\n * Must be called during component initialisation. Useful, for example, if you\n * programmatically create a component and want to pass the existing context to it.\n *\n * https://svelte.dev/docs/svelte#getallcontexts\n * @template {Map<any, any>} [T=Map<any, any>]\n * @returns {T}\n */\nexport function getAllContexts() {\n\treturn get_current_component().$$.context;\n}\n\n/**\n * Checks whether a given `key` has been set in the context of a parent component.\n * Must be called during component initialisation.\n *\n * https://svelte.dev/docs/svelte#hascontext\n * @param {any} key\n * @returns {boolean}\n */\nexport function hasContext(key) {\n\treturn get_current_component().$$.context.has(key);\n}\n\n// TODO figure out if we still want to support\n// shorthand events, or if we want to implement\n// a real bubbling mechanism\n/**\n * @param component\n * @param event\n * @returns {void}\n */\nexport function bubble(component, event) {\n\tconst callbacks = component.$$.callbacks[event.type];\n\tif (callbacks) {\n\t\t// @ts-ignore\n\t\tcallbacks.slice().forEach((fn) => fn.call(this, event));\n\t}\n}\n", "import { run_all } from './utils.js';\nimport { current_component, set_current_component } from './lifecycle.js';\n\nexport const dirty_components = [];\nexport const intros = { enabled: false };\nexport const binding_callbacks = [];\n\nlet render_callbacks = [];\n\nconst flush_callbacks = [];\n\nconst resolved_promise = /* @__PURE__ */ Promise.resolve();\n\nlet update_scheduled = false;\n\n/** @returns {void} */\nexport function schedule_update() {\n\tif (!update_scheduled) {\n\t\tupdate_scheduled = true;\n\t\tresolved_promise.then(flush);\n\t}\n}\n\n/** @returns {Promise<void>} */\nexport function tick() {\n\tschedule_update();\n\treturn resolved_promise;\n}\n\n/** @returns {void} */\nexport function add_render_callback(fn) {\n\trender_callbacks.push(fn);\n}\n\n/** @returns {void} */\nexport function add_flush_callback(fn) {\n\tflush_callbacks.push(fn);\n}\n\n// flush() calls callbacks in this order:\n// 1. All beforeUpdate callbacks, in order: parents before children\n// 2. All bind:this callbacks, in reverse order: children before parents.\n// 3. All afterUpdate callbacks, in order: parents before children. EXCEPT\n//    for afterUpdates called during the initial onMount, which are called in\n//    reverse order: children before parents.\n// Since callbacks might update component values, which could trigger another\n// call to flush(), the following steps guard against this:\n// 1. During beforeUpdate, any updated components will be added to the\n//    dirty_components array and will cause a reentrant call to flush(). Because\n//    the flush index is kept outside the function, the reentrant call will pick\n//    up where the earlier call left off and go through all dirty components. The\n//    current_component value is saved and restored so that the reentrant call will\n//    not interfere with the \"parent\" flush() call.\n// 2. bind:this callbacks cannot trigger new flush() calls.\n// 3. During afterUpdate, any updated components will NOT have their afterUpdate\n//    callback called a second time; the seen_callbacks set, outside the flush()\n//    function, guarantees this behavior.\nconst seen_callbacks = new Set();\n\nlet flushidx = 0; // Do *not* move this inside the flush() function\n\n/** @returns {void} */\nexport function flush() {\n\t// Do not reenter flush while dirty components are updated, as this can\n\t// result in an infinite loop. Instead, let the inner flush handle it.\n\t// Reentrancy is ok afterwards for bindings etc.\n\tif (flushidx !== 0) {\n\t\treturn;\n\t}\n\tconst saved_component = current_component;\n\tdo {\n\t\t// first, call beforeUpdate functions\n\t\t// and update components\n\t\ttry {\n\t\t\twhile (flushidx < dirty_components.length) {\n\t\t\t\tconst component = dirty_components[flushidx];\n\t\t\t\tflushidx++;\n\t\t\t\tset_current_component(component);\n\t\t\t\tupdate(component.$$);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// reset dirty state to not end up in a deadlocked state and then rethrow\n\t\t\tdirty_components.length = 0;\n\t\t\tflushidx = 0;\n\t\t\tthrow e;\n\t\t}\n\t\tset_current_component(null);\n\t\tdirty_components.length = 0;\n\t\tflushidx = 0;\n\t\twhile (binding_callbacks.length) binding_callbacks.pop()();\n\t\t// then, once components are updated, call\n\t\t// afterUpdate functions. This may cause\n\t\t// subsequent updates...\n\t\tfor (let i = 0; i < render_callbacks.length; i += 1) {\n\t\t\tconst callback = render_callbacks[i];\n\t\t\tif (!seen_callbacks.has(callback)) {\n\t\t\t\t// ...so guard against infinite loops\n\t\t\t\tseen_callbacks.add(callback);\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t\trender_callbacks.length = 0;\n\t} while (dirty_components.length);\n\twhile (flush_callbacks.length) {\n\t\tflush_callbacks.pop()();\n\t}\n\tupdate_scheduled = false;\n\tseen_callbacks.clear();\n\tset_current_component(saved_component);\n}\n\n/** @returns {void} */\nfunction update($$) {\n\tif ($$.fragment !== null) {\n\t\t$$.update();\n\t\trun_all($$.before_update);\n\t\tconst dirty = $$.dirty;\n\t\t$$.dirty = [-1];\n\t\t$$.fragment && $$.fragment.p($$.ctx, dirty);\n\t\t$$.after_update.forEach(add_render_callback);\n\t}\n}\n\n/**\n * Useful for example to execute remaining `afterUpdate` callbacks before executing `destroy`.\n * @param {Function[]} fns\n * @returns {void}\n */\nexport function flush_render_callbacks(fns) {\n\tconst filtered = [];\n\tconst targets = [];\n\trender_callbacks.forEach((c) => (fns.indexOf(c) === -1 ? filtered.push(c) : targets.push(c)));\n\ttargets.forEach((c) => c());\n\trender_callbacks = filtered;\n}\n", "import { identity as linear, is_function, noop, run_all } from './utils.js';\nimport { now } from './environment.js';\nimport { loop } from './loop.js';\nimport { create_rule, delete_rule } from './style_manager.js';\nimport { custom_event } from './dom.js';\nimport { add_render_callback } from './scheduler.js';\n\n/**\n * @type {Promise<void> | null}\n */\nlet promise;\n\n/**\n * @returns {Promise<void>}\n */\nfunction wait() {\n\tif (!promise) {\n\t\tpromise = Promise.resolve();\n\t\tpromise.then(() => {\n\t\t\tpromise = null;\n\t\t});\n\t}\n\treturn promise;\n}\n\n/**\n * @param {Element} node\n * @param {INTRO | OUTRO | boolean} direction\n * @param {'start' | 'end'} kind\n * @returns {void}\n */\nfunction dispatch(node, direction, kind) {\n\tnode.dispatchEvent(custom_event(`${direction ? 'intro' : 'outro'}${kind}`));\n}\n\nconst outroing = new Set();\n\n/**\n * @type {Outro}\n */\nlet outros;\n\n/**\n * @returns {void} */\nexport function group_outros() {\n\toutros = {\n\t\tr: 0,\n\t\tc: [],\n\t\tp: outros // parent group\n\t};\n}\n\n/**\n * @returns {void} */\nexport function check_outros() {\n\tif (!outros.r) {\n\t\trun_all(outros.c);\n\t}\n\toutros = outros.p;\n}\n\n/**\n * @param {import('./private.js').Fragment} block\n * @param {0 | 1} [local]\n * @returns {void}\n */\nexport function transition_in(block, local) {\n\tif (block && block.i) {\n\t\toutroing.delete(block);\n\t\tblock.i(local);\n\t}\n}\n\n/**\n * @param {import('./private.js').Fragment} block\n * @param {0 | 1} local\n * @param {0 | 1} [detach]\n * @param {() => void} [callback]\n * @returns {void}\n */\nexport function transition_out(block, local, detach, callback) {\n\tif (block && block.o) {\n\t\tif (outroing.has(block)) return;\n\t\toutroing.add(block);\n\t\toutros.c.push(() => {\n\t\t\toutroing.delete(block);\n\t\t\tif (callback) {\n\t\t\t\tif (detach) block.d(1);\n\t\t\t\tcallback();\n\t\t\t}\n\t\t});\n\t\tblock.o(local);\n\t} else if (callback) {\n\t\tcallback();\n\t}\n}\n\n/**\n * @type {import('../transition/public.js').TransitionConfig}\n */\nconst null_transition = { duration: 0 };\n\n/**\n * @param {Element & ElementCSSInlineStyle} node\n * @param {TransitionFn} fn\n * @param {any} params\n * @returns {{ start(): void; invalidate(): void; end(): void; }}\n */\nexport function create_in_transition(node, fn, params) {\n\t/**\n\t * @type {TransitionOptions} */\n\tconst options = { direction: 'in' };\n\tlet config = fn(node, params, options);\n\tlet running = false;\n\tlet animation_name;\n\tlet task;\n\tlet uid = 0;\n\n\t/**\n\t * @returns {void} */\n\tfunction cleanup() {\n\t\tif (animation_name) delete_rule(node, animation_name);\n\t}\n\n\t/**\n\t * @returns {void} */\n\tfunction go() {\n\t\tconst {\n\t\t\tdelay = 0,\n\t\t\tduration = 300,\n\t\t\teasing = linear,\n\t\t\ttick = noop,\n\t\t\tcss\n\t\t} = config || null_transition;\n\t\tif (css) animation_name = create_rule(node, 0, 1, duration, delay, easing, css, uid++);\n\t\ttick(0, 1);\n\t\tconst start_time = now() + delay;\n\t\tconst end_time = start_time + duration;\n\t\tif (task) task.abort();\n\t\trunning = true;\n\t\tadd_render_callback(() => dispatch(node, true, 'start'));\n\t\ttask = loop((now) => {\n\t\t\tif (running) {\n\t\t\t\tif (now >= end_time) {\n\t\t\t\t\ttick(1, 0);\n\t\t\t\t\tdispatch(node, true, 'end');\n\t\t\t\t\tcleanup();\n\t\t\t\t\treturn (running = false);\n\t\t\t\t}\n\t\t\t\tif (now >= start_time) {\n\t\t\t\t\tconst t = easing((now - start_time) / duration);\n\t\t\t\t\ttick(t, 1 - t);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn running;\n\t\t});\n\t}\n\tlet started = false;\n\treturn {\n\t\tstart() {\n\t\t\tif (started) return;\n\t\t\tstarted = true;\n\t\t\tdelete_rule(node);\n\t\t\tif (is_function(config)) {\n\t\t\t\tconfig = config(options);\n\t\t\t\twait().then(go);\n\t\t\t} else {\n\t\t\t\tgo();\n\t\t\t}\n\t\t},\n\t\tinvalidate() {\n\t\t\tstarted = false;\n\t\t},\n\t\tend() {\n\t\t\tif (running) {\n\t\t\t\tcleanup();\n\t\t\t\trunning = false;\n\t\t\t}\n\t\t}\n\t};\n}\n\n/**\n * @param {Element & ElementCSSInlineStyle} node\n * @param {TransitionFn} fn\n * @param {any} params\n * @returns {{ end(reset: any): void; }}\n */\nexport function create_out_transition(node, fn, params) {\n\t/** @type {TransitionOptions} */\n\tconst options = { direction: 'out' };\n\tlet config = fn(node, params, options);\n\tlet running = true;\n\tlet animation_name;\n\tconst group = outros;\n\tgroup.r += 1;\n\t/** @type {boolean} */\n\tlet original_inert_value;\n\n\t/**\n\t * @returns {void} */\n\tfunction go() {\n\t\tconst {\n\t\t\tdelay = 0,\n\t\t\tduration = 300,\n\t\t\teasing = linear,\n\t\t\ttick = noop,\n\t\t\tcss\n\t\t} = config || null_transition;\n\n\t\tif (css) animation_name = create_rule(node, 1, 0, duration, delay, easing, css);\n\n\t\tconst start_time = now() + delay;\n\t\tconst end_time = start_time + duration;\n\t\tadd_render_callback(() => dispatch(node, false, 'start'));\n\n\t\tif ('inert' in node) {\n\t\t\toriginal_inert_value = /** @type {HTMLElement} */ (node).inert;\n\t\t\tnode.inert = true;\n\t\t}\n\n\t\tloop((now) => {\n\t\t\tif (running) {\n\t\t\t\tif (now >= end_time) {\n\t\t\t\t\ttick(0, 1);\n\t\t\t\t\tdispatch(node, false, 'end');\n\t\t\t\t\tif (!--group.r) {\n\t\t\t\t\t\t// this will result in `end()` being called,\n\t\t\t\t\t\t// so we don't need to clean up here\n\t\t\t\t\t\trun_all(group.c);\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (now >= start_time) {\n\t\t\t\t\tconst t = easing((now - start_time) / duration);\n\t\t\t\t\ttick(1 - t, t);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn running;\n\t\t});\n\t}\n\n\tif (is_function(config)) {\n\t\twait().then(() => {\n\t\t\t// @ts-ignore\n\t\t\tconfig = config(options);\n\t\t\tgo();\n\t\t});\n\t} else {\n\t\tgo();\n\t}\n\n\treturn {\n\t\tend(reset) {\n\t\t\tif (reset && 'inert' in node) {\n\t\t\t\tnode.inert = original_inert_value;\n\t\t\t}\n\t\t\tif (reset && config.tick) {\n\t\t\t\tconfig.tick(1, 0);\n\t\t\t}\n\t\t\tif (running) {\n\t\t\t\tif (animation_name) delete_rule(node, animation_name);\n\t\t\t\trunning = false;\n\t\t\t}\n\t\t}\n\t};\n}\n\n/**\n * @param {Element & ElementCSSInlineStyle} node\n * @param {TransitionFn} fn\n * @param {any} params\n * @param {boolean} intro\n * @returns {{ run(b: 0 | 1): void; end(): void; }}\n */\nexport function create_bidirectional_transition(node, fn, params, intro) {\n\t/**\n\t * @type {TransitionOptions} */\n\tconst options = { direction: 'both' };\n\tlet config = fn(node, params, options);\n\tlet t = intro ? 0 : 1;\n\n\t/**\n\t * @type {Program | null} */\n\tlet running_program = null;\n\n\t/**\n\t * @type {PendingProgram | null} */\n\tlet pending_program = null;\n\tlet animation_name = null;\n\n\t/** @type {boolean} */\n\tlet original_inert_value;\n\n\t/**\n\t * @returns {void} */\n\tfunction clear_animation() {\n\t\tif (animation_name) delete_rule(node, animation_name);\n\t}\n\n\t/**\n\t * @param {PendingProgram} program\n\t * @param {number} duration\n\t * @returns {Program}\n\t */\n\tfunction init(program, duration) {\n\t\tconst d = /** @type {Program['d']} */ (program.b - t);\n\t\tduration *= Math.abs(d);\n\t\treturn {\n\t\t\ta: t,\n\t\t\tb: program.b,\n\t\t\td,\n\t\t\tduration,\n\t\t\tstart: program.start,\n\t\t\tend: program.start + duration,\n\t\t\tgroup: program.group\n\t\t};\n\t}\n\n\t/**\n\t * @param {INTRO | OUTRO} b\n\t * @returns {void}\n\t */\n\tfunction go(b) {\n\t\tconst {\n\t\t\tdelay = 0,\n\t\t\tduration = 300,\n\t\t\teasing = linear,\n\t\t\ttick = noop,\n\t\t\tcss\n\t\t} = config || null_transition;\n\n\t\t/**\n\t\t * @type {PendingProgram} */\n\t\tconst program = {\n\t\t\tstart: now() + delay,\n\t\t\tb\n\t\t};\n\n\t\tif (!b) {\n\t\t\t// @ts-ignore todo: improve typings\n\t\t\tprogram.group = outros;\n\t\t\toutros.r += 1;\n\t\t}\n\n\t\tif ('inert' in node) {\n\t\t\tif (b) {\n\t\t\t\tif (original_inert_value !== undefined) {\n\t\t\t\t\t// aborted/reversed outro \u2014 restore previous inert value\n\t\t\t\t\tnode.inert = original_inert_value;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toriginal_inert_value = /** @type {HTMLElement} */ (node).inert;\n\t\t\t\tnode.inert = true;\n\t\t\t}\n\t\t}\n\n\t\tif (running_program || pending_program) {\n\t\t\tpending_program = program;\n\t\t} else {\n\t\t\t// if this is an intro, and there's a delay, we need to do\n\t\t\t// an initial tick and/or apply CSS animation immediately\n\t\t\tif (css) {\n\t\t\t\tclear_animation();\n\t\t\t\tanimation_name = create_rule(node, t, b, duration, delay, easing, css);\n\t\t\t}\n\t\t\tif (b) tick(0, 1);\n\t\t\trunning_program = init(program, duration);\n\t\t\tadd_render_callback(() => dispatch(node, b, 'start'));\n\t\t\tloop((now) => {\n\t\t\t\tif (pending_program && now > pending_program.start) {\n\t\t\t\t\trunning_program = init(pending_program, duration);\n\t\t\t\t\tpending_program = null;\n\t\t\t\t\tdispatch(node, running_program.b, 'start');\n\t\t\t\t\tif (css) {\n\t\t\t\t\t\tclear_animation();\n\t\t\t\t\t\tanimation_name = create_rule(\n\t\t\t\t\t\t\tnode,\n\t\t\t\t\t\t\tt,\n\t\t\t\t\t\t\trunning_program.b,\n\t\t\t\t\t\t\trunning_program.duration,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\teasing,\n\t\t\t\t\t\t\tconfig.css\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (running_program) {\n\t\t\t\t\tif (now >= running_program.end) {\n\t\t\t\t\t\ttick((t = running_program.b), 1 - t);\n\t\t\t\t\t\tdispatch(node, running_program.b, 'end');\n\t\t\t\t\t\tif (!pending_program) {\n\t\t\t\t\t\t\t// we're done\n\t\t\t\t\t\t\tif (running_program.b) {\n\t\t\t\t\t\t\t\t// intro \u2014 we can tidy up immediately\n\t\t\t\t\t\t\t\tclear_animation();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// outro \u2014 needs to be coordinated\n\t\t\t\t\t\t\t\tif (!--running_program.group.r) run_all(running_program.group.c);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\trunning_program = null;\n\t\t\t\t\t} else if (now >= running_program.start) {\n\t\t\t\t\t\tconst p = now - running_program.start;\n\t\t\t\t\t\tt = running_program.a + running_program.d * easing(p / running_program.duration);\n\t\t\t\t\t\ttick(t, 1 - t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn !!(running_program || pending_program);\n\t\t\t});\n\t\t}\n\t}\n\treturn {\n\t\trun(b) {\n\t\t\tif (is_function(config)) {\n\t\t\t\twait().then(() => {\n\t\t\t\t\tconst opts = { direction: b ? 'in' : 'out' };\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\tconfig = config(opts);\n\t\t\t\t\tgo(b);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tgo(b);\n\t\t\t}\n\t\t},\n\t\tend() {\n\t\t\tclear_animation();\n\t\t\trunning_program = pending_program = null;\n\t\t}\n\t};\n}\n\n/** @typedef {1} INTRO */\n/** @typedef {0} OUTRO */\n/** @typedef {{ direction: 'in' | 'out' | 'both' }} TransitionOptions */\n/** @typedef {(node: Element, params: any, options: TransitionOptions) => import('../transition/public.js').TransitionConfig} TransitionFn */\n\n/**\n * @typedef {Object} Outro\n * @property {number} r\n * @property {Function[]} c\n * @property {Object} p\n */\n\n/**\n * @typedef {Object} PendingProgram\n * @property {number} start\n * @property {INTRO|OUTRO} b\n * @property {Outro} [group]\n */\n\n/**\n * @typedef {Object} Program\n * @property {number} a\n * @property {INTRO|OUTRO} b\n * @property {1|-1} d\n * @property {number} duration\n * @property {number} start\n * @property {number} end\n * @property {Outro} [group]\n */\n", "import { transition_in, transition_out } from './transitions.js';\nimport { run_all } from './utils.js';\n\n// general each functions:\n\nexport function ensure_array_like(array_like_or_iterator) {\n\treturn array_like_or_iterator?.length !== undefined\n\t\t? array_like_or_iterator\n\t\t: Array.from(array_like_or_iterator);\n}\n\n// keyed each functions:\n\n/** @returns {void} */\nexport function destroy_block(block, lookup) {\n\tblock.d(1);\n\tlookup.delete(block.key);\n}\n\n/** @returns {void} */\nexport function outro_and_destroy_block(block, lookup) {\n\ttransition_out(block, 1, 1, () => {\n\t\tlookup.delete(block.key);\n\t});\n}\n\n/** @returns {void} */\nexport function fix_and_destroy_block(block, lookup) {\n\tblock.f();\n\tdestroy_block(block, lookup);\n}\n\n/** @returns {void} */\nexport function fix_and_outro_and_destroy_block(block, lookup) {\n\tblock.f();\n\toutro_and_destroy_block(block, lookup);\n}\n\n/** @returns {any[]} */\nexport function update_keyed_each(\n\told_blocks,\n\tdirty,\n\tget_key,\n\tdynamic,\n\tctx,\n\tlist,\n\tlookup,\n\tnode,\n\tdestroy,\n\tcreate_each_block,\n\tnext,\n\tget_context\n) {\n\tlet o = old_blocks.length;\n\tlet n = list.length;\n\tlet i = o;\n\tconst old_indexes = {};\n\twhile (i--) old_indexes[old_blocks[i].key] = i;\n\tconst new_blocks = [];\n\tconst new_lookup = new Map();\n\tconst deltas = new Map();\n\tconst updates = [];\n\ti = n;\n\twhile (i--) {\n\t\tconst child_ctx = get_context(ctx, list, i);\n\t\tconst key = get_key(child_ctx);\n\t\tlet block = lookup.get(key);\n\t\tif (!block) {\n\t\t\tblock = create_each_block(key, child_ctx);\n\t\t\tblock.c();\n\t\t} else if (dynamic) {\n\t\t\t// defer updates until all the DOM shuffling is done\n\t\t\tupdates.push(() => block.p(child_ctx, dirty));\n\t\t}\n\t\tnew_lookup.set(key, (new_blocks[i] = block));\n\t\tif (key in old_indexes) deltas.set(key, Math.abs(i - old_indexes[key]));\n\t}\n\tconst will_move = new Set();\n\tconst did_move = new Set();\n\t/** @returns {void} */\n\tfunction insert(block) {\n\t\ttransition_in(block, 1);\n\t\tblock.m(node, next);\n\t\tlookup.set(block.key, block);\n\t\tnext = block.first;\n\t\tn--;\n\t}\n\twhile (o && n) {\n\t\tconst new_block = new_blocks[n - 1];\n\t\tconst old_block = old_blocks[o - 1];\n\t\tconst new_key = new_block.key;\n\t\tconst old_key = old_block.key;\n\t\tif (new_block === old_block) {\n\t\t\t// do nothing\n\t\t\tnext = new_block.first;\n\t\t\to--;\n\t\t\tn--;\n\t\t} else if (!new_lookup.has(old_key)) {\n\t\t\t// remove old block\n\t\t\tdestroy(old_block, lookup);\n\t\t\to--;\n\t\t} else if (!lookup.has(new_key) || will_move.has(new_key)) {\n\t\t\tinsert(new_block);\n\t\t} else if (did_move.has(old_key)) {\n\t\t\to--;\n\t\t} else if (deltas.get(new_key) > deltas.get(old_key)) {\n\t\t\tdid_move.add(new_key);\n\t\t\tinsert(new_block);\n\t\t} else {\n\t\t\twill_move.add(old_key);\n\t\t\to--;\n\t\t}\n\t}\n\twhile (o--) {\n\t\tconst old_block = old_blocks[o];\n\t\tif (!new_lookup.has(old_block.key)) destroy(old_block, lookup);\n\t}\n\twhile (n) insert(new_blocks[n - 1]);\n\trun_all(updates);\n\treturn new_blocks;\n}\n\n/** @returns {void} */\nexport function validate_each_keys(ctx, list, get_context, get_key) {\n\tconst keys = new Map();\n\tfor (let i = 0; i < list.length; i++) {\n\t\tconst key = get_key(get_context(ctx, list, i));\n\t\tif (keys.has(key)) {\n\t\t\tlet value = '';\n\t\t\ttry {\n\t\t\t\tvalue = `with value '${String(key)}' `;\n\t\t\t} catch (e) {\n\t\t\t\t// can't stringify\n\t\t\t}\n\t\t\tthrow new Error(\n\t\t\t\t`Cannot have duplicate keys in a keyed each: Keys at index ${keys.get(\n\t\t\t\t\tkey\n\t\t\t\t)} and ${i} ${value}are duplicates`\n\t\t\t);\n\t\t}\n\t\tkeys.set(key, i);\n\t}\n}\n", "const _boolean_attributes = /** @type {const} */ ([\n\t'allowfullscreen',\n\t'allowpaymentrequest',\n\t'async',\n\t'autofocus',\n\t'autoplay',\n\t'checked',\n\t'controls',\n\t'default',\n\t'defer',\n\t'disabled',\n\t'formnovalidate',\n\t'hidden',\n\t'inert',\n\t'ismap',\n\t'loop',\n\t'multiple',\n\t'muted',\n\t'nomodule',\n\t'novalidate',\n\t'open',\n\t'playsinline',\n\t'readonly',\n\t'required',\n\t'reversed',\n\t'selected'\n]);\n\n/**\n * List of HTML boolean attributes (e.g. `<input disabled>`).\n * Source: https://html.spec.whatwg.org/multipage/indices.html\n *\n * @type {Set<string>}\n */\nexport const boolean_attributes = new Set([..._boolean_attributes]);\n\n/** @typedef {typeof _boolean_attributes[number]} BooleanAttributes */\n", "import {\n\tadd_render_callback,\n\tflush,\n\tflush_render_callbacks,\n\tschedule_update,\n\tdirty_components\n} from './scheduler.js';\nimport { current_component, set_current_component } from './lifecycle.js';\nimport { blank_object, is_empty, is_function, run, run_all, noop } from './utils.js';\nimport {\n\tchildren,\n\tdetach,\n\tstart_hydrating,\n\tend_hydrating,\n\tget_custom_elements_slots,\n\tinsert,\n\telement,\n\tattr\n} from './dom.js';\nimport { transition_in } from './transitions.js';\n\n/** @returns {void} */\nexport function bind(component, name, callback) {\n\tconst index = component.$$.props[name];\n\tif (index !== undefined) {\n\t\tcomponent.$$.bound[index] = callback;\n\t\tcallback(component.$$.ctx[index]);\n\t}\n}\n\n/** @returns {void} */\nexport function create_component(block) {\n\tblock && block.c();\n}\n\n/** @returns {void} */\nexport function claim_component(block, parent_nodes) {\n\tblock && block.l(parent_nodes);\n}\n\n/** @returns {void} */\nexport function mount_component(component, target, anchor) {\n\tconst { fragment, after_update } = component.$$;\n\tfragment && fragment.m(target, anchor);\n\t// onMount happens before the initial afterUpdate\n\tadd_render_callback(() => {\n\t\tconst new_on_destroy = component.$$.on_mount.map(run).filter(is_function);\n\t\t// if the component was destroyed immediately\n\t\t// it will update the `$$.on_destroy` reference to `null`.\n\t\t// the destructured on_destroy may still reference to the old array\n\t\tif (component.$$.on_destroy) {\n\t\t\tcomponent.$$.on_destroy.push(...new_on_destroy);\n\t\t} else {\n\t\t\t// Edge case - component was destroyed immediately,\n\t\t\t// most likely as a result of a binding initialising\n\t\t\trun_all(new_on_destroy);\n\t\t}\n\t\tcomponent.$$.on_mount = [];\n\t});\n\tafter_update.forEach(add_render_callback);\n}\n\n/** @returns {void} */\nexport function destroy_component(component, detaching) {\n\tconst $$ = component.$$;\n\tif ($$.fragment !== null) {\n\t\tflush_render_callbacks($$.after_update);\n\t\trun_all($$.on_destroy);\n\t\t$$.fragment && $$.fragment.d(detaching);\n\t\t// TODO null out other refs, including component.$$ (but need to\n\t\t// preserve final state?)\n\t\t$$.on_destroy = $$.fragment = null;\n\t\t$$.ctx = [];\n\t}\n}\n\n/** @returns {void} */\nfunction make_dirty(component, i) {\n\tif (component.$$.dirty[0] === -1) {\n\t\tdirty_components.push(component);\n\t\tschedule_update();\n\t\tcomponent.$$.dirty.fill(0);\n\t}\n\tcomponent.$$.dirty[(i / 31) | 0] |= 1 << i % 31;\n}\n\n// TODO: Document the other params\n/**\n * @param {SvelteComponent} component\n * @param {import('./public.js').ComponentConstructorOptions} options\n *\n * @param {import('./utils.js')['not_equal']} not_equal Used to compare props and state values.\n * @param {(target: Element | ShadowRoot) => void} [append_styles] Function that appends styles to the DOM when the component is first initialised.\n * This will be the `add_css` function from the compiled component.\n *\n * @returns {void}\n */\nexport function init(\n\tcomponent,\n\toptions,\n\tinstance,\n\tcreate_fragment,\n\tnot_equal,\n\tprops,\n\tappend_styles = null,\n\tdirty = [-1]\n) {\n\tconst parent_component = current_component;\n\tset_current_component(component);\n\t/** @type {import('./private.js').T$$} */\n\tconst $$ = (component.$$ = {\n\t\tfragment: null,\n\t\tctx: [],\n\t\t// state\n\t\tprops,\n\t\tupdate: noop,\n\t\tnot_equal,\n\t\tbound: blank_object(),\n\t\t// lifecycle\n\t\ton_mount: [],\n\t\ton_destroy: [],\n\t\ton_disconnect: [],\n\t\tbefore_update: [],\n\t\tafter_update: [],\n\t\tcontext: new Map(options.context || (parent_component ? parent_component.$$.context : [])),\n\t\t// everything else\n\t\tcallbacks: blank_object(),\n\t\tdirty,\n\t\tskip_bound: false,\n\t\troot: options.target || parent_component.$$.root\n\t});\n\tappend_styles && append_styles($$.root);\n\tlet ready = false;\n\t$$.ctx = instance\n\t\t? instance(component, options.props || {}, (i, ret, ...rest) => {\n\t\t\t\tconst value = rest.length ? rest[0] : ret;\n\t\t\t\tif ($$.ctx && not_equal($$.ctx[i], ($$.ctx[i] = value))) {\n\t\t\t\t\tif (!$$.skip_bound && $$.bound[i]) $$.bound[i](value);\n\t\t\t\t\tif (ready) make_dirty(component, i);\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t  })\n\t\t: [];\n\t$$.update();\n\tready = true;\n\trun_all($$.before_update);\n\t// `false` as a special case of no DOM component\n\t$$.fragment = create_fragment ? create_fragment($$.ctx) : false;\n\tif (options.target) {\n\t\tif (options.hydrate) {\n\t\t\tstart_hydrating();\n\t\t\t// TODO: what is the correct type here?\n\t\t\t// @ts-expect-error\n\t\t\tconst nodes = children(options.target);\n\t\t\t$$.fragment && $$.fragment.l(nodes);\n\t\t\tnodes.forEach(detach);\n\t\t} else {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\t$$.fragment && $$.fragment.c();\n\t\t}\n\t\tif (options.intro) transition_in(component.$$.fragment);\n\t\tmount_component(component, options.target, options.anchor);\n\t\tend_hydrating();\n\t\tflush();\n\t}\n\tset_current_component(parent_component);\n}\n\nexport let SvelteElement;\n\nif (typeof HTMLElement === 'function') {\n\tSvelteElement = class extends HTMLElement {\n\t\t/** The Svelte component constructor */\n\t\t$$ctor;\n\t\t/** Slots */\n\t\t$$s;\n\t\t/** The Svelte component instance */\n\t\t$$c;\n\t\t/** Whether or not the custom element is connected */\n\t\t$$cn = false;\n\t\t/** Component props data */\n\t\t$$d = {};\n\t\t/** `true` if currently in the process of reflecting component props back to attributes */\n\t\t$$r = false;\n\t\t/** @type {Record<string, CustomElementPropDefinition>} Props definition (name, reflected, type etc) */\n\t\t$$p_d = {};\n\t\t/** @type {Record<string, Function[]>} Event listeners */\n\t\t$$l = {};\n\t\t/** @type {Map<Function, Function>} Event listener unsubscribe functions */\n\t\t$$l_u = new Map();\n\n\t\tconstructor($$componentCtor, $$slots, use_shadow_dom) {\n\t\t\tsuper();\n\t\t\tthis.$$ctor = $$componentCtor;\n\t\t\tthis.$$s = $$slots;\n\t\t\tif (use_shadow_dom) {\n\t\t\t\tthis.attachShadow({ mode: 'open' });\n\t\t\t}\n\t\t}\n\n\t\taddEventListener(type, listener, options) {\n\t\t\t// We can't determine upfront if the event is a custom event or not, so we have to\n\t\t\t// listen to both. If someone uses a custom event with the same name as a regular\n\t\t\t// browser event, this fires twice - we can't avoid that.\n\t\t\tthis.$$l[type] = this.$$l[type] || [];\n\t\t\tthis.$$l[type].push(listener);\n\t\t\tif (this.$$c) {\n\t\t\t\tconst unsub = this.$$c.$on(type, listener);\n\t\t\t\tthis.$$l_u.set(listener, unsub);\n\t\t\t}\n\t\t\tsuper.addEventListener(type, listener, options);\n\t\t}\n\n\t\tremoveEventListener(type, listener, options) {\n\t\t\tsuper.removeEventListener(type, listener, options);\n\t\t\tif (this.$$c) {\n\t\t\t\tconst unsub = this.$$l_u.get(listener);\n\t\t\t\tif (unsub) {\n\t\t\t\t\tunsub();\n\t\t\t\t\tthis.$$l_u.delete(listener);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.$$l[type]) {\n\t\t\t\tconst idx = this.$$l[type].indexOf(listener);\n\t\t\t\tif (idx >= 0) {\n\t\t\t\t\tthis.$$l[type].splice(idx, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tasync connectedCallback() {\n\t\t\tthis.$$cn = true;\n\t\t\tif (!this.$$c) {\n\t\t\t\t// We wait one tick to let possible child slot elements be created/mounted\n\t\t\t\tawait Promise.resolve();\n\t\t\t\tif (!this.$$cn || this.$$c) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tfunction create_slot(name) {\n\t\t\t\t\treturn () => {\n\t\t\t\t\t\tlet node;\n\t\t\t\t\t\tconst obj = {\n\t\t\t\t\t\t\tc: function create() {\n\t\t\t\t\t\t\t\tnode = element('slot');\n\t\t\t\t\t\t\t\tif (name !== 'default') {\n\t\t\t\t\t\t\t\t\tattr(node, 'name', name);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t * @param {HTMLElement} target\n\t\t\t\t\t\t\t * @param {HTMLElement} [anchor]\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\tm: function mount(target, anchor) {\n\t\t\t\t\t\t\t\tinsert(target, node, anchor);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\td: function destroy(detaching) {\n\t\t\t\t\t\t\t\tif (detaching) {\n\t\t\t\t\t\t\t\t\tdetach(node);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn obj;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tconst $$slots = {};\n\t\t\t\tconst existing_slots = get_custom_elements_slots(this);\n\t\t\t\tfor (const name of this.$$s) {\n\t\t\t\t\tif (name in existing_slots) {\n\t\t\t\t\t\t$$slots[name] = [create_slot(name)];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (const attribute of this.attributes) {\n\t\t\t\t\t// this.$$data takes precedence over this.attributes\n\t\t\t\t\tconst name = this.$$g_p(attribute.name);\n\t\t\t\t\tif (!(name in this.$$d)) {\n\t\t\t\t\t\tthis.$$d[name] = get_custom_element_value(name, attribute.value, this.$$p_d, 'toProp');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Port over props that were set programmatically before ce was initialized\n\t\t\t\tfor (const key in this.$$p_d) {\n\t\t\t\t\tif (!(key in this.$$d) && this[key] !== undefined) {\n\t\t\t\t\t\tthis.$$d[key] = this[key]; // don't transform, these were set through JavaScript\n\t\t\t\t\t\tdelete this[key]; // remove the property that shadows the getter/setter\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.$$c = new this.$$ctor({\n\t\t\t\t\ttarget: this.shadowRoot || this,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\t...this.$$d,\n\t\t\t\t\t\t$$slots,\n\t\t\t\t\t\t$$scope: {\n\t\t\t\t\t\t\tctx: []\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Reflect component props as attributes\n\t\t\t\tconst reflect_attributes = () => {\n\t\t\t\t\tthis.$$r = true;\n\t\t\t\t\tfor (const key in this.$$p_d) {\n\t\t\t\t\t\tthis.$$d[key] = this.$$c.$$.ctx[this.$$c.$$.props[key]];\n\t\t\t\t\t\tif (this.$$p_d[key].reflect) {\n\t\t\t\t\t\t\tconst attribute_value = get_custom_element_value(\n\t\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t\tthis.$$d[key],\n\t\t\t\t\t\t\t\tthis.$$p_d,\n\t\t\t\t\t\t\t\t'toAttribute'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (attribute_value == null) {\n\t\t\t\t\t\t\t\tthis.removeAttribute(this.$$p_d[key].attribute || key);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.setAttribute(this.$$p_d[key].attribute || key, attribute_value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.$$r = false;\n\t\t\t\t};\n\t\t\t\tthis.$$c.$$.after_update.push(reflect_attributes);\n\t\t\t\treflect_attributes(); // once initially because after_update is added too late for first render\n\n\t\t\t\tfor (const type in this.$$l) {\n\t\t\t\t\tfor (const listener of this.$$l[type]) {\n\t\t\t\t\t\tconst unsub = this.$$c.$on(type, listener);\n\t\t\t\t\t\tthis.$$l_u.set(listener, unsub);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.$$l = {};\n\t\t\t}\n\t\t}\n\n\t\t// We don't need this when working within Svelte code, but for compatibility of people using this outside of Svelte\n\t\t// and setting attributes through setAttribute etc, this is helpful\n\t\tattributeChangedCallback(attr, _oldValue, newValue) {\n\t\t\tif (this.$$r) return;\n\t\t\tattr = this.$$g_p(attr);\n\t\t\tthis.$$d[attr] = get_custom_element_value(attr, newValue, this.$$p_d, 'toProp');\n\t\t\tthis.$$c?.$set({ [attr]: this.$$d[attr] });\n\t\t}\n\n\t\tdisconnectedCallback() {\n\t\t\tthis.$$cn = false;\n\t\t\t// In a microtask, because this could be a move within the DOM\n\t\t\tPromise.resolve().then(() => {\n\t\t\t\tif (!this.$$cn && this.$$c) {\n\t\t\t\t\tthis.$$c.$destroy();\n\t\t\t\t\tthis.$$c = undefined;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t$$g_p(attribute_name) {\n\t\t\treturn (\n\t\t\t\tObject.keys(this.$$p_d).find(\n\t\t\t\t\t(key) =>\n\t\t\t\t\t\tthis.$$p_d[key].attribute === attribute_name ||\n\t\t\t\t\t\t(!this.$$p_d[key].attribute && key.toLowerCase() === attribute_name)\n\t\t\t\t) || attribute_name\n\t\t\t);\n\t\t}\n\t};\n}\n\n/**\n * @param {string} prop\n * @param {any} value\n * @param {Record<string, CustomElementPropDefinition>} props_definition\n * @param {'toAttribute' | 'toProp'} [transform]\n */\nfunction get_custom_element_value(prop, value, props_definition, transform) {\n\tconst type = props_definition[prop]?.type;\n\tvalue = type === 'Boolean' && typeof value !== 'boolean' ? value != null : value;\n\tif (!transform || !props_definition[prop]) {\n\t\treturn value;\n\t} else if (transform === 'toAttribute') {\n\t\tswitch (type) {\n\t\t\tcase 'Object':\n\t\t\tcase 'Array':\n\t\t\t\treturn value == null ? null : JSON.stringify(value);\n\t\t\tcase 'Boolean':\n\t\t\t\treturn value ? '' : null;\n\t\t\tcase 'Number':\n\t\t\t\treturn value == null ? null : value;\n\t\t\tdefault:\n\t\t\t\treturn value;\n\t\t}\n\t} else {\n\t\tswitch (type) {\n\t\t\tcase 'Object':\n\t\t\tcase 'Array':\n\t\t\t\treturn value && JSON.parse(value);\n\t\t\tcase 'Boolean':\n\t\t\t\treturn value; // conversion already handled above\n\t\t\tcase 'Number':\n\t\t\t\treturn value != null ? +value : value;\n\t\t\tdefault:\n\t\t\t\treturn value;\n\t\t}\n\t}\n}\n\n/**\n * @internal\n *\n * Turn a Svelte component into a custom element.\n * @param {import('./public.js').ComponentType} Component  A Svelte component constructor\n * @param {Record<string, CustomElementPropDefinition>} props_definition  The props to observe\n * @param {string[]} slots  The slots to create\n * @param {string[]} accessors  Other accessors besides the ones for props the component has\n * @param {boolean} use_shadow_dom  Whether to use shadow DOM\n * @param {(ce: new () => HTMLElement) => new () => HTMLElement} [extend]\n */\nexport function create_custom_element(\n\tComponent,\n\tprops_definition,\n\tslots,\n\taccessors,\n\tuse_shadow_dom,\n\textend\n) {\n\tlet Class = class extends SvelteElement {\n\t\tconstructor() {\n\t\t\tsuper(Component, slots, use_shadow_dom);\n\t\t\tthis.$$p_d = props_definition;\n\t\t}\n\t\tstatic get observedAttributes() {\n\t\t\treturn Object.keys(props_definition).map((key) =>\n\t\t\t\t(props_definition[key].attribute || key).toLowerCase()\n\t\t\t);\n\t\t}\n\t};\n\tObject.keys(props_definition).forEach((prop) => {\n\t\tObject.defineProperty(Class.prototype, prop, {\n\t\t\tget() {\n\t\t\t\treturn this.$$c && prop in this.$$c ? this.$$c[prop] : this.$$d[prop];\n\t\t\t},\n\t\t\tset(value) {\n\t\t\t\tvalue = get_custom_element_value(prop, value, props_definition);\n\t\t\t\tthis.$$d[prop] = value;\n\t\t\t\tthis.$$c?.$set({ [prop]: value });\n\t\t\t}\n\t\t});\n\t});\n\taccessors.forEach((accessor) => {\n\t\tObject.defineProperty(Class.prototype, accessor, {\n\t\t\tget() {\n\t\t\t\treturn this.$$c?.[accessor];\n\t\t\t}\n\t\t});\n\t});\n\tif (extend) {\n\t\t// @ts-expect-error - assigning here is fine\n\t\tClass = extend(Class);\n\t}\n\tComponent.element = /** @type {any} */ (Class);\n\treturn Class;\n}\n\n/**\n * Base class for Svelte components. Used when dev=false.\n *\n * @template {Record<string, any>} [Props=any]\n * @template {Record<string, any>} [Events=any]\n */\nexport class SvelteComponent {\n\t/**\n\t * ### PRIVATE API\n\t *\n\t * Do not use, may change at any time\n\t *\n\t * @type {any}\n\t */\n\t$$ = undefined;\n\t/**\n\t * ### PRIVATE API\n\t *\n\t * Do not use, may change at any time\n\t *\n\t * @type {any}\n\t */\n\t$$set = undefined;\n\n\t/** @returns {void} */\n\t$destroy() {\n\t\tdestroy_component(this, 1);\n\t\tthis.$destroy = noop;\n\t}\n\n\t/**\n\t * @template {Extract<keyof Events, string>} K\n\t * @param {K} type\n\t * @param {((e: Events[K]) => void) | null | undefined} callback\n\t * @returns {() => void}\n\t */\n\t$on(type, callback) {\n\t\tif (!is_function(callback)) {\n\t\t\treturn noop;\n\t\t}\n\t\tconst callbacks = this.$$.callbacks[type] || (this.$$.callbacks[type] = []);\n\t\tcallbacks.push(callback);\n\t\treturn () => {\n\t\t\tconst index = callbacks.indexOf(callback);\n\t\t\tif (index !== -1) callbacks.splice(index, 1);\n\t\t};\n\t}\n\n\t/**\n\t * @param {Partial<Props>} props\n\t * @returns {void}\n\t */\n\t$set(props) {\n\t\tif (this.$$set && !is_empty(props)) {\n\t\t\tthis.$$.skip_bound = true;\n\t\t\tthis.$$set(props);\n\t\t\tthis.$$.skip_bound = false;\n\t\t}\n\t}\n}\n\n/**\n * @typedef {Object} CustomElementPropDefinition\n * @property {string} [attribute]\n * @property {boolean} [reflect]\n * @property {'String'|'Boolean'|'Number'|'Array'|'Object'} [type]\n */\n", "// generated during release, do not modify\n\n/**\n * The current version, as set in package.json.\n *\n * https://svelte.dev/docs/svelte-compiler#svelte-version\n * @type {string}\n */\nexport const VERSION = '4.2.20';\nexport const PUBLIC_VERSION = '4';\n", "import { PUBLIC_VERSION } from '../../../shared/version.js';\n\nif (typeof window !== 'undefined')\n\t// @ts-ignore\n\t(window.__svelte || (window.__svelte = { v: new Set() })).v.add(PUBLIC_VERSION);\n", "<script lang=\"ts\">\n    import '../../../common/ui/common.css'\n\n    import {is_pinch_zoomed} from '../../../common/misc.js'\n\n    let dialog: HTMLDialogElement\n    export let extra_class = ''\n    /** Whether or not the dialog should use the full viewport in mobile browsers*/\n    export let fullscreen = false\n    let promise_resolve: (res: string | boolean) => void\n    let title = ''\n\n    export async function open(_title: string): Promise<string | boolean> {\n        title = _title\n        const promise: Promise<string | boolean> = new Promise((resolve) => promise_resolve = resolve)\n        dialog.showModal()\n        if (visualViewport) {\n            visualViewport.addEventListener('resize', on_visualViewport_resize)\n            if (fullscreen) {\n                // Try to account for this by setting the dialog to the viewport height\n                dialog.style.height = visualViewport.height + 'px'\n            }\n            dialog.style.top = (visualViewport.height - dialog.offsetHeight) / 2 + 'px'\n        }\n        return promise\n    }\n\n    export function resolve(val: string | boolean) {\n        dialog.close()\n        if (visualViewport) {\n            visualViewport.removeEventListener('resize', on_visualViewport_resize)\n            dialog.style.height = ''\n        }\n        promise_resolve(val)\n    }\n\n    function on_close() {\n        resolve(false)\n    }\n\n    function on_visualViewport_resize() {\n        // Don't do anything if the window is pinch zoomed\n        if (is_pinch_zoomed()){\n            return\n        }\n\n        // The iOS virtual keyboard does not change the layout height, but it does change the viewport\n        if (fullscreen) {\n            // Try to account for this by setting the dialog to the viewport height\n            dialog.style.height = visualViewport!.height + 'px'\n        }\n        // And ensure it's centred vertically\n        dialog.style.top = (visualViewport!.height - dialog.offsetHeight) / 2 + 'px'\n    }\n</script>\n\n<style>\n    dialog {\n        box-sizing: border-box;\n        background: var(--asyncglk-ui-bg);\n        border-color: var(--asyncglk-ui-border);\n        color: var(--asyncglk-ui-fg);\n        font-family: sans-serif;\n        max-width: 500px;\n        min-width: 300px;\n        user-select: none;\n    }\n\n    dialog.fullscreen {\n        height: 100%;\n        width: 100%;\n    }\n\n    dialog.manually_positioned {\n        margin-top: 0;\n    }\n\n    @media screen and (max-width: 767px) {\n        dialog.fullscreen {\n            border: none !important;\n            max-height: none !important;\n            max-width: none !important;\n        }\n    }\n\n    dialog::backdrop {\n        background: linear-gradient(rgba(64, 64, 64, 25%), rgba(64, 64, 64, 40%));\n    }\n\n    .inner > :global(div) {\n        margin: 4px 0;\n    }\n\n    .head #title {\n        font: bold 20px sans-serif;\n        margin: 0;\n    }\n\n    .head .close {\n        background: none;\n        border: none;\n        padding: 10px;\n        position: absolute;\n        right: 10px;\n        top: 10px;\n    }\n\n    dialog :global(.foot) {\n        text-align: right;\n    }\n</style>\n\n<dialog bind:this={dialog}\n    class:fullscreen\n    class=\"asyncglk_ui {extra_class}\"\n    class:manually_positioned={typeof visualViewport !== 'undefined'}\n    on:close={on_close}\n>\n    <div class=\"inner\">\n        <div class=\"head\">\n            <div id=\"title\">{title}&nbsp;</div>\n            <button class=\"close\" aria-label=\"Close\" on:click={on_close}>✖</button>\n        </div>\n        <slot></slot>\n    </div>\n</dialog>", "<script lang=\"ts\">\n    import {type AlertMode, ALERT_MODE_ALERT, ALERT_MODE_PROMPT} from '../common.js'\n    import BaseDialog from './BaseDialog.svelte'\n\n    let base_dialog: BaseDialog\n    export let initial: string | undefined = undefined\n    export let message: string\n    export let mode: AlertMode\n    export let title: string\n    let val_input: HTMLTextAreaElement\n\n    export function open(): Promise<string | boolean> {\n        const promise = base_dialog.open(title)\n        if (val_input) {\n            val_input.value = initial || ''\n            val_input.focus()\n        }\n        return promise\n    }\n\n    function on_cancel() {\n        base_dialog.resolve(false)\n    }\n\n    function on_create_input(node: HTMLTextAreaElement) {\n        val_input = node\n        val_input.focus()\n        val_input.value = initial || ''\n    }\n\n    function on_input_keydown(ev: KeyboardEvent) {\n        if (ev.code === 'Enter') {\n            on_submit()\n            ev.preventDefault()\n        }\n    }\n\n    function on_submit() {\n        if (mode === ALERT_MODE_PROMPT) {\n            const val = val_input.value.trim()\n            base_dialog.resolve(val || false)\n        }\n        else {\n            base_dialog.resolve(true)\n        }\n    }\n</script>\n\n<style>\n    #val_input {\n        box-sizing: border-box;\n        resize: none;\n        width: 100%;\n    }\n</style>\n\n<BaseDialog bind:this={base_dialog}>\n    <p>{message}</p>\n    <div>\n        {#if mode === ALERT_MODE_PROMPT}\n            <textarea id=\"val_input\" autocapitalize=\"off\" rows=\"1\" on:keydown={on_input_keydown} use:on_create_input></textarea>\n        {/if}\n    </div>\n    <div class=\"foot uirow\">\n        <div>\n            {#if mode !== ALERT_MODE_ALERT}\n                <button class=\"close\" on:click={on_cancel}>Cancel</button>\n            {/if}\n            <button class=\"submit\" on:click={on_submit}>Ok</button>\n        </div>\n    </div>\n</BaseDialog>", "/*\n\nCommon implementations\n======================\n\nCopyright (c) 2024 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport type {Provider} from './interface.js'\nimport AlertDialog from './ui/AlertDialog.svelte'\n\nexport const ALERT_MODE_ALERT = 0\nexport const ALERT_MODE_CONFIRM = 1\nexport const ALERT_MODE_PROMPT = 2\nexport type AlertMode = typeof ALERT_MODE_ALERT | typeof ALERT_MODE_CONFIRM | typeof ALERT_MODE_PROMPT\n\nexport class NullProvider implements Provider {\n    browseable = false\n    next: Provider = this\n    async delete(_path: string) {}\n    async exists(_path: string) {\n        return null\n    }\n    async read(_path: string) {\n        return null\n    }\n    async write(_files: Record<string, Uint8Array>) {}\n}\n\nexport async function show_alert(title: string, message: string) {\n    const alert = new AlertDialog({\n        target: document.body,\n        props: {\n            message,\n            mode: ALERT_MODE_ALERT,\n            title,\n        },\n    })\n    await alert.open()\n    alert.$destroy()\n}", "/*\n\nDownload/upload provider\n========================\n\nCopyright (c) 2025 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\n// The download provider stores its own files just in a map (maybe to be cached in the future), but if files are written next to them, then they need to be done so in another provider\n\nimport {gunzipSync} from 'fflate'\n\nimport type {DownloadOptions, ProgressCallback} from '../../common/file/interface.js'\nimport {parse_base64, read_response} from '../../common/file/browser.js'\nimport {NullProvider} from './common.js'\nimport type {Provider} from './interface.js'\nimport {utf8decoder} from '../../common/misc.js'\n\nexport class DownloadProvider implements Provider {\n    browseable = false\n    next = new NullProvider()\n    private options: DownloadOptions\n    private store: Map<string, Uint8Array> = new Map()\n\n    constructor(options: DownloadOptions) {\n        this.options = options\n    }\n\n    async download(url: string, progress_callback?: ProgressCallback): Promise<string> {\n        const [final_url, data] = await fetch_storyfile(this.options, url, progress_callback)\n        const path = url_to_path(final_url)\n        this.store.set(path, data)\n        return path\n    }\n\n    async upload(file: File) {\n        const data = await read_uploaded_file(file)\n        const path = '/upload/' + file.name\n        this.store.set(path, data)\n        return path\n    }\n\n    async delete(path: string) {\n        if (this.store.has(path)) {\n            this.store.delete(path)\n        }\n        else {\n            return this.next.delete(path)\n        }\n    }\n\n    async exists(path: string): Promise<boolean | null> {\n        if (this.store.has(path)) {\n            return true\n        }\n        else {\n            return this.next.exists(path)\n        }\n    }\n\n    async read(path: string): Promise<Uint8Array | null> {\n        if (this.store.has(path)) {\n            return this.store.get(path)!\n        }\n        else {\n            return this.next.read(path)\n        }\n        // TODO: try downloading a sibling file\n    }\n\n    write(files: Record<string, Uint8Array>) {\n        return this.next.write(files)\n    }\n}\n\n/** Fetch a storyfile, using the proxy if necessary, and handling JSified stories */\nasync function fetch_storyfile(options: DownloadOptions, url: string, progress_callback?: ProgressCallback): Promise<[string, Uint8Array]> {\n    // Handle a relative URL\n    const story_url = new URL(url, document.URL)\n    url = story_url + ''\n    const story_domain = story_url.hostname\n    const same_protocol = story_url.protocol === document.location.protocol\n    const same_domain = story_domain === document.location.hostname\n    let response: Response\n\n    // Load an embedded storyfile\n    if (story_url.protocol === 'embedded:') {\n        const node = document.getElementById(story_url.pathname) as HTMLScriptElement\n        const data_base64 = node.text\n        let data = await parse_base64(data_base64)\n        if (node.type.endsWith(';gzip')) {\n            data = gunzipSync(data)\n        }\n        return [url, data]\n    }\n\n    // Only directly access files same origin files or those from the list of reliable domains\n    let direct_access = (same_protocol && same_domain) || story_url.protocol === 'data:'\n    const direct_domains = options.direct_domains\n    if (!direct_access && direct_domains) {\n        for (const domain of direct_domains) {\n            if (story_domain.endsWith(domain)) {\n                // all direct domains require HTTPS\n                story_url.protocol = 'https:'\n                direct_access = true\n                break\n            }\n        }\n    }\n\n    if (direct_access) {\n        try {\n            response = await fetch('' + story_url)\n            // If we were redirected get the final URL\n            url = response.url ?? url\n        }\n        // We can't specifically detect CORS errors but that's probably what happened\n        catch {\n            throw new Error('Failed to fetch storyfile (possible CORS error)')\n        }\n    }\n\n    // Otherwise use the proxy\n    else {\n        if (options.use_proxy && options.proxy_url) {\n            response = await fetch(`${options.proxy_url}?url=${story_url}`)\n            // If the proxy was redirected get the final URL\n            url = response.headers.get('Final-Url') ?? url\n        }\n        else {\n            throw new Error('Storyfile not in list of direct domains and proxy disabled')\n        }\n    }\n\n    if (!response.ok) {\n        throw new Error(`Could not fetch storyfile, got ${response.status}`)\n    }\n\n    // It would be nice to check here if the file was compressed, but we can only read the Content-Encoding header for same domain files\n\n    const data = await read_response(response, progress_callback)\n\n    // Handle JSified stories\n    if (url.endsWith('.js')) {\n        const text = utf8decoder.decode(data)\n        const matched = /processBase64Zcode\\(['\"]([a-zA-Z0-9+/=]+)['\"]\\)/.exec(text)\n        if (!matched) {\n            throw new Error('Abnormal JSified story')\n        }\n\n        return [url, await parse_base64(matched[1])]\n    }\n\n    return [url, data]\n}\n\n/** Read an uploaded file and return it as a Uint8Array */\nexport function read_uploaded_file(file: File): Promise<Uint8Array> {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader()\n        reader.onerror = () => reject(reader.error)\n        reader.onload = () => resolve(new Uint8Array(reader.result as ArrayBuffer))\n        reader.readAsArrayBuffer(file)\n    })\n}\n\nfunction url_to_path(url: string) {\n    if (url.startsWith('https:')) {\n        return '/download/https/' + url.substring(8)\n    }\n    else {\n        return '/download/http/' + url.substring(7)\n    }\n}", "/**\r\n  Base32768 is a binary-to-text encoding optimised for UTF-16-encoded text.\r\n  (e.g. Windows, Java, JavaScript)\r\n*/\r\n\r\n// Z is a number, usually a uint15 but sometimes a uint7\r\n\r\nconst BITS_PER_CHAR = 15 // Base32768 is a 15-bit encoding\r\nconst BITS_PER_BYTE = 8\r\n\r\nconst pairStrings = [\r\n  '\u04A0\u04BF\u0500\u051F\u0680\u06BF\u0760\u079F\u07C0\u07DF\u1000\u101F\u10A0\u10BF\u1100\u115F\u1180\u119F\u11E0\u123F\u1260\u127F\u12E0\u12FF\u1320\u133F\u13A0\u13DF\u1420\u165F\u16A0\u16DF\u1780\u179F\u1820\u185F\u18C0\u18DF\u1980\u199F\u19E0\u19FF\u1A20\u1A3F\u1BC0\u1BDF\u1C00\u1C1F\u1D00\u1D1F\u21E0\u21FF\u22C0\u22DF\u2340\u23DF\u2400\u241F\u2500\u275F\u2780\u27BF\u2800\u297F\u29A0\u29BF\u2A20\u2A5F\u2A80\u2ABF\u2AE0\u2B5F\u2C00\u2C1F\u2C80\u2CDF\u2D00\u2D1F\u2D40\u2D5F\u2EA0\u2EDF\u31C0\u31DF\u3400\u4D9F\u4DC0\u9FBF\uA000\uA47F\uA4A0\uA4BF\uA500\uA5FF\uA640\uA65F\uA6A0\uA6DF\uA700\uA75F\uA780\uA79F\uA840\uA85F',\r\n  '\u0180\u019F\u0240\u029F'\r\n]\r\n\r\nconst lookupE = {}\r\nconst lookupD = {}\r\npairStrings.forEach((pairString, r) => {\r\n  // Decompression\r\n  const encodeRepertoire = []\r\n  pairString.match(/../gu).forEach(pair => {\r\n    const first = pair.codePointAt(0)\r\n    const last = pair.codePointAt(1)\r\n    for (let codePoint = first; codePoint <= last; codePoint++) {\r\n      encodeRepertoire.push(String.fromCodePoint(codePoint))\r\n    }\r\n  })\r\n\r\n  const numZBits = BITS_PER_CHAR - BITS_PER_BYTE * r // 0 -> 15, 1 -> 7\r\n  lookupE[numZBits] = encodeRepertoire\r\n  encodeRepertoire.forEach((chr, z) => {\r\n    lookupD[chr] = [numZBits, z]\r\n  })\r\n})\r\n\r\nconst encode = uint8Array => {\r\n  const length = uint8Array.length\r\n\r\n  let str = ''\r\n  let z = 0\r\n  let numZBits = 0\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    const uint8 = uint8Array[i]\r\n\r\n    // Take most significant bit first\r\n    for (let j = BITS_PER_BYTE - 1; j >= 0; j--) {\r\n      const bit = (uint8 >> j) & 1\r\n\r\n      z = (z << 1) + bit\r\n      numZBits++\r\n\r\n      if (numZBits === BITS_PER_CHAR) {\r\n        str += lookupE[numZBits][z]\r\n        z = 0\r\n        numZBits = 0\r\n      }\r\n    }\r\n  }\r\n\r\n  if (numZBits !== 0) {\r\n    // Final bits require special treatment.\r\n\r\n    // z = bbbbbbcccccccc, numZBits = 14, padBits = 1\r\n    // z = bbbbbcccccccc, numZBits = 13, padBits = 2\r\n    // z = bbbbcccccccc, numZBits = 12, padBits = 3\r\n    // z = bbbcccccccc, numZBits = 11, padBits = 4\r\n    // z = bbcccccccc, numZBits = 10, padBits = 5\r\n    // z = bcccccccc, numZBits = 9, padBits = 6\r\n    // z = cccccccc, numZBits = 8, padBits = 7\r\n    // => Pad `z` out to 15 bits using 1s, then encode as normal (r = 0)\r\n\r\n    // z = ccccccc, numZBits = 7, padBits = 0\r\n    // z = cccccc, numZBits = 6, padBits = 1\r\n    // z = ccccc, numZBits = 5, padBits = 2\r\n    // z = cccc, numZBits = 4, padBits = 3\r\n    // z = ccc, numZBits = 3, padBits = 4\r\n    // z = cc, numZBits = 2, padBits = 5\r\n    // z = c, numZBits = 1, padBits = 6\r\n    // => Pad `z` out to 7 bits using 1s, then encode specially (r = 1)\r\n\r\n    while (!(numZBits in lookupE)) {\r\n      z = (z << 1) + 1\r\n      numZBits++\r\n    }\r\n\r\n    str += lookupE[numZBits][z]\r\n  }\r\n\r\n  return str\r\n}\r\n\r\nconst decode = str => {\r\n  const length = str.length\r\n\r\n  // This length is a guess. There's a chance we allocate one more byte here\r\n  // than we actually need. But we can count and slice it off later\r\n  const uint8Array = new Uint8Array(Math.floor(length * BITS_PER_CHAR / BITS_PER_BYTE))\r\n  let numUint8s = 0\r\n  let uint8 = 0\r\n  let numUint8Bits = 0\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    const chr = str.charAt(i)\r\n\r\n    if (!(chr in lookupD)) {\r\n      throw new Error(`Unrecognised Base32768 character: ${chr}`)\r\n    }\r\n\r\n    const [numZBits, z] = lookupD[chr]\r\n\r\n    if (numZBits !== BITS_PER_CHAR && i !== length - 1) {\r\n      throw new Error('Secondary character found before end of input at position ' + String(i))\r\n    }\r\n\r\n    // Take most significant bit first\r\n    for (let j = numZBits - 1; j >= 0; j--) {\r\n      const bit = (z >> j) & 1\r\n\r\n      uint8 = (uint8 << 1) + bit\r\n      numUint8Bits++\r\n\r\n      if (numUint8Bits === BITS_PER_BYTE) {\r\n        uint8Array[numUint8s] = uint8\r\n        numUint8s++\r\n        uint8 = 0\r\n        numUint8Bits = 0\r\n      }\r\n    }\r\n  }\r\n\r\n  // Final padding bits! Requires special consideration!\r\n  // Remember how we always pad with 1s?\r\n  // Note: there could be 0 such bits, check still works though\r\n  if (uint8 !== ((1 << numUint8Bits) - 1)) {\r\n    throw new Error('Padding mismatch')\r\n  }\r\n\r\n  return new Uint8Array(uint8Array.buffer, 0, numUint8s)\r\n}\r\n\r\nexport { encode, decode }\r\n", "/*\n\nWeb storage provider\n====================\n\nCopyright (c) 2024 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {decode as base32768_decode, encode as base32768_encode} from 'base32768'\n\nimport type {DialogDirectories} from '../common/interface.js'\nimport {NullProvider, show_alert} from './common.js'\nimport type {BrowseableProvider, FilesMetadata} from './interface.js'\n\n//type WebStorageFileMetadata = Pick<FileData, 'atime' | 'mtime'>\n\nconst METADATA_KEY = 'dialog_metadata'\nconst STORAGE_VERSION_KEY = 'dialog_storage_version'\n\nconst enum MetadataUpdateOperation {\n    DELETE = 1,\n    READ = 2,\n    RENAME = 3,\n    WRITE = 4,\n}\n\nexport class WebStorageProvider implements BrowseableProvider {\n    browseable: boolean\n    private dirs: DialogDirectories\n    private _metadata: FilesMetadata = {}\n    next = new NullProvider()\n    private prefix: string\n    private store: Storage\n    /** Whether or not we are doing multiple operations in one transaction */\n    private transaction: boolean = false\n\n    constructor(prefix: string, store: Storage, dirs: DialogDirectories, browseable?: boolean) {\n        this.browseable = browseable ?? false\n        this.dirs = dirs\n        this.prefix = prefix\n        this.store = store\n\n        if (store === localStorage) {\n            migrate_localStorage()\n        }\n    }\n\n    async delete(path: string) {\n        if (path.startsWith(this.prefix)) {\n            this.store.removeItem(path)\n            await this.update_metadata(path, MetadataUpdateOperation.DELETE)\n        }\n        else {\n            return this.next.delete(path)\n        }\n    }\n\n    async exists(path: string): Promise<boolean | null> {\n        if (path.startsWith(this.prefix)) {\n            return this.store.getItem(path) !== null\n        }\n        else {\n            return this.next.exists(path)\n        }\n    }\n\n    async metadata(): Promise<FilesMetadata> {\n        this._metadata = JSON.parse(this.store.getItem(METADATA_KEY) || '{}') as FilesMetadata\n        // Add a fake .dir file to the working folder\n        this._metadata[this.dirs.working + '/.dir'] = {atime: 0, mtime: 0}\n        return this._metadata\n    }\n\n    async read(path: string): Promise<Uint8Array | null> {\n        if (path.startsWith(this.prefix)) {\n            const res = this.store.getItem(path)\n            if (res !== null) {\n                await this.update_metadata(path, MetadataUpdateOperation.READ)\n                return base32768_decode(res)\n            }\n            return null\n        }\n        else {\n            return this.next.read(path)\n        }\n    }\n\n    async rename(dir: boolean, old_path: string, new_path: string): Promise<void> {\n        await this.transaction_start()\n        if (dir) {\n            for (const path of Object.keys(this._metadata)) {\n                if (path.startsWith(old_path)) {\n                    const new_file_path = path.replace(old_path, new_path)\n                    await this.rename_file(path, new_file_path)\n                }\n            }\n        }\n        else {\n            await this.rename_file(old_path, new_path)\n        }\n        this.transaction_end()\n    }\n\n    private async rename_file(old_path: string, new_path: string) {\n        const data = await this.read(old_path)\n        await this.write({new_path: data!})\n        await this.update_metadata(new_path, MetadataUpdateOperation.RENAME, old_path)\n        await this.delete(old_path)\n    }\n\n    private async transaction_start() {\n        const old_transaction = this.transaction\n        this.transaction = true\n        if (!old_transaction) {\n            await this.metadata()\n        }\n        return old_transaction\n    }\n\n    private transaction_end() {\n        this.transaction = false\n        // Remove the fake .dir file from the working folder\n        delete this._metadata![this.dirs.working + '/.dir']\n        this.store.setItem(METADATA_KEY, JSON.stringify(this._metadata))\n    }\n\n    private async update_metadata(path: string, op: MetadataUpdateOperation, old_path?: string) {\n        const now = Date.now()\n        if (!this.transaction) {\n            await this.metadata()\n        }\n        switch (op) {\n            case MetadataUpdateOperation.DELETE:\n                delete this._metadata![path]\n                break\n            case MetadataUpdateOperation.READ:\n                this._metadata![path].atime = now\n                break\n            case MetadataUpdateOperation.RENAME:\n                this._metadata![path] = this._metadata![old_path!]\n                delete this._metadata![old_path!]\n                break\n            case MetadataUpdateOperation.WRITE:\n                if (!this._metadata![path]) {\n                    this._metadata![path] = {\n                        atime: now,\n                        mtime: now,\n                    }\n                }\n                this._metadata![path].mtime = now\n        }\n        if (!this.transaction) {\n            // Write the metadata via transaction_end\n            this.transaction_end()\n        }\n    }\n\n    async write(files: Record<string, Uint8Array>) {\n        const was_already_in_transaction = await this.transaction_start()\n        let wrote_files = false, next_files = false\n        for (const [path, data] of Object.entries(files)) {\n            if (path.startsWith(this.prefix)) {\n                wrote_files = true\n                try {\n                    this.store.setItem(path, base32768_encode(data))\n                    this.update_metadata(path, MetadataUpdateOperation.WRITE)\n                }\n                catch {\n                    // TODO: remove autosaves first\n                    show_alert('localStorage full', `The file ${path.replace(/\\//g, '/\\u200b')} could not be written as your browser's localStorage is full! Please delete some files, and then try again.`)\n                }\n                delete files[path]\n            }\n            else {\n                next_files = true\n            }\n        }\n        if (!was_already_in_transaction) {\n            this.transaction = false\n            if (wrote_files) {\n                this.transaction_end()\n            }\n        }\n        if (next_files) {\n            this.next.write(files)\n        }\n    }\n}\n\nconst DIALOG_V1_TYPES_TO_EXTS: Record<string, string> = {\n    data: 'glkdata',\n    save: 'glksave',\n    transcript: 'txt',\n}\nexport function migrate_localStorage() {\n    const now = Date.now()\n    const version = parseInt(localStorage.getItem(STORAGE_VERSION_KEY) || '0', 10)\n    if (version < 2) {\n        console.log('Dialog: updating localStorage to version 2')\n        const metadata: FilesMetadata = {}\n        for (let [key, data] of Object.entries<string>(localStorage)) {\n            if (key.startsWith('autosave:')) {\n                // We're not keeping any old autosaves\n                localStorage.removeItem(key)\n            }\n            if (key.startsWith('content:')) {\n                const key_data = /^content:(\\w+):(\\w*):(.+)$/.exec(key)\n                if (key_data) {\n                    const path = `/usr/${key_data[3]}.${DIALOG_V1_TYPES_TO_EXTS[key_data[1]] || key_data[1]}`\n                    if (data !== '' && version < 1) {\n                        data = base32768_encode(/\\[[,\\d]*\\]/.test(data) ? JSON.parse(data) : Uint8Array.from(data, ch => ch.charCodeAt(0)))\n                    }\n                    localStorage.setItem(path, data)\n                    const dirent_key = 'dirent' + key.substring(7)\n                    const dirent = localStorage.getItem(dirent_key) || ''\n                    const dirent_data = /^created:\\d+,modified:(\\d+)$/.exec(dirent)\n                    metadata[path] = {\n                        atime: parseInt(dirent_data?.[1] || '', 10) || now,\n                        mtime: parseInt(dirent_data?.[1] || '', 10) || now,\n                    }\n                    localStorage.removeItem(dirent_key)\n                }\n                localStorage.removeItem(key)\n            }\n        }\n        localStorage.setItem(METADATA_KEY, JSON.stringify(metadata))\n        localStorage.setItem(STORAGE_VERSION_KEY, '2')\n    }\n    if (version > 2) {\n        throw new Error('dialog_storage_version is newer than this library supports')\n    }\n}", "<script lang=\"ts\">\n    export let cur_dir: string\n    let dir_tree: string[]\n\n    $: dir_tree = cur_dir.substring(1).split('/')\n\n    function on_click(ev: MouseEvent) {\n        const target = ev.target as HTMLButtonElement\n        cur_dir = target.dataset.path!\n    }\n</script>\n\n<style>\n    #dirtree {\n        display: flex;\n        flex-wrap: wrap;\n        line-height: 28px;\n    }\n\n    button {\n        padding: 0;\n    }\n\n    span.slash {\n        padding: 0 5px;\n    }\n</style>\n\n<div id=\"dirtree\">\n    {#each dir_tree as dir, i}\n        {#if i !== 0}\n            <span class=\"slash\">&nbsp;/&nbsp;</span>\n        {/if}\n        {#if dir_tree[i + 1]}\n            <span><button\n                class=\"flat\"\n                data-path={'/' + dir_tree.slice(0, i + 1).join('/')}\n                on:click={on_click}\n            >{dir === 'usr' ? 'My files' : dir}</button></span>\n        {:else}\n            <span>{dir === 'usr' ? 'My files' : dir}</span>\n        {/if}\n    {/each}\n</div>", "<script lang=\"ts\">\n    // Icons from Heroicons: https://heroicons.com/outline\n\n    import {createEventDispatcher} from 'svelte'\n\n    import type {DirEntry} from '../interface.js'\n\n    const dispatch = createEventDispatcher()\n\n    export let data: DirEntry\n    export let selected: boolean\n    export let selected_file: DirEntry | undefined\n\n    /*function file_icon(filename: string) {\n        if (filename.endsWith('.glksave') || filename.endsWith('.sav')) {\n            return '🖫'\n        }\n        else if (filename.endsWith('.txt')) {\n            return '🗎'\n        }\n        return '🗋'\n    }*/\n\n    function on_click() {\n        selected_file = data\n    }\n\n    function on_delete() {\n        dispatch('file_delete', data)\n    }\n\n    function on_doubleclick() {\n        dispatch('file_doubleclicked', data)\n    }\n\n    function on_download() {\n        dispatch('file_download', data)\n    }\n\n    function on_keydown(ev: KeyboardEvent) {\n        if (ev.code === 'ArrowDown') {\n            const next = (ev.target as HTMLElement).nextElementSibling as HTMLElement | null\n            if (next) {\n                next.click()\n                next.focus()\n            }\n        }\n        if (ev.code === 'ArrowUp') {\n            const prev = (ev.target as HTMLElement).previousElementSibling as HTMLElement | null\n            if (prev) {\n                prev.click()\n                prev.focus()\n            }\n        }\n        if (ev.code === 'Enter') {\n            dispatch('file_doubleclicked', data)\n            ev.preventDefault()\n        }\n    }\n\n    function on_open() {\n        dispatch('file_doubleclicked', data)\n    }\n\n    function on_rename() {\n        dispatch('file_rename', data)\n    }\n</script>\n\n<style>\n    div.filelistitem.selected {\n        background: var(--asyncglk-ui-selected);\n        padding-bottom: 2px;\n    }\n\n    div.filelistitem button.flat {\n        display: flex;\n        padding: 0;\n        width: 100%;\n    }\n\n    .icon svg {\n        display: block;\n    }\n\n    .name {\n        flex: 1;\n        padding: 3px 0 3px 8px;\n        text-align: left;\n    }\n\n    .actions, .date {\n        padding: 2px 20px;\n    }\n</style>\n\n<div\n    class=\"filelistitem\"\n    class:selected\n>\n    <button\n        aria-selected=\"{selected}\"\n        class=\"flat\"\n        on:click={on_click}\n        on:dblclick|preventDefault|stopPropagation={on_doubleclick}\n        on:keydown={on_keydown}\n        role=\"option\"\n    >\n        <div class=\"icon\" aria-hidden=\"true\">\n            {#if data.dir}\n                <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" height=\"20px\" width=\"20px\" stroke-width=\"1.5\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z\" />\n                </svg>\n            {:else if data.name.endsWith('.glksave') || data.name.endsWith('.sav')}\n                <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" height=\"20px\" width=\"20px\" stroke-width=\"1.5\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M10.125 2.25h-4.5c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9M10.125 2.25h.375a9 9 0 0 1 9 9v.375M10.125 2.25A3.375 3.375 0 0 1 13.5 5.625v1.5c0 .621.504 1.125 1.125 1.125h1.5a3.375 3.375 0 0 1 3.375 3.375M9 15l2.25 2.25L15 12\" />\n                </svg>\n            {:else if data.name.endsWith('.txt')}\n                <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" height=\"20px\" width=\"20px\" stroke-width=\"1.5\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z\" />\n                </svg>\n            {:else}\n                <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" height=\"20px\" width=\"20px\" stroke-width=\"1.5\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z\" />\n                </svg>\n            {/if}\n        </div>\n        <div class=\"name\">{data.name}</div>\n    </button>\n    {#if selected}\n        {#if !data.dir && data.meta}\n            <div class=\"date\">Last modified: {(new Date(data.meta.mtime)).toDateString()}</div>\n        {/if}\n        <div class=\"actions\">\n            {#if data.dir}\n                <button on:click={on_open}>Open</button>\n            {:else}\n                <button on:click={on_download}>Download</button>\n            {/if}\n            <button on:click={on_rename}>Rename</button>\n            <button on:click={on_delete}>Delete</button>\n        </div>\n    {/if}\n</div>", "<script context=\"module\" lang=\"ts\">\n    import type {Filter} from '../browser.js'\n    import type {DirEntry, FilesMetadata} from '../interface.js'\n\n    export interface PromptOptions {\n        filter?: Filter\n        metadata: FilesMetadata\n        save: boolean\n        submit_label: string,\n        title: string\n    }\n</script>\n\n<script lang=\"ts\">\n    import path from 'path-browserify-esm'\n\n    import {DialogController} from '../browser.js'\n    import {type AlertMode, ALERT_MODE_CONFIRM, ALERT_MODE_PROMPT} from '../common.js'\n\n    import AlertDialog from './AlertDialog.svelte'\n    import BaseDialog from './BaseDialog.svelte'\n    import DirTree from './DirTree.svelte'\n    import FileListItem from './FileListItem.svelte'\n\n    let base_dialog: BaseDialog\n    export let controller: DialogController\n    export let cur_dir: string = '/usr'\n    let cur_direntry: DirEntry[] = []\n    let cur_filter: string = ''\n    let filename_input: HTMLTextAreaElement\n    let filter: Filter | undefined\n    export let metadata: FilesMetadata = {}\n    let saving: boolean\n    let selected_file: DirEntry | undefined\n    let submit_label = ''\n    let upload_files: HTMLInputElement\n\n    // Regex from https://stackoverflow.com/a/23522755/2854284\n    const is_safari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent)\n\n    $: selected_file = (cur_dir, undefined)\n    $: cur_direntry = filter_files(cur_dir, cur_filter, metadata)\n\n    $: {\n        if (saving && filename_input && selected_file && !selected_file.dir) {\n            filename_input.value = selected_file.name\n        }\n    }\n\n    export function prompt(opts: PromptOptions): Promise<string | null> {\n        metadata = opts.metadata\n        if (opts.filter?.extensions.join() !== filter?.extensions.join()) {\n            if (cur_filter !== '*') {\n                cur_filter = opts.filter?.extensions.join() ?? '*'\n            }\n            filter = opts.filter\n            if (!filter) {\n                cur_filter = '*'\n            }\n        }\n        saving = opts.save\n        submit_label = opts.submit_label\n        selected_file = undefined\n        const promise = base_dialog.open(opts.title)\n        if (saving && filename_input) {\n            filename_input.focus()\n            filename_input.value = ''\n        }\n        return promise.then(res => {\n            return typeof res === 'string' ? res : null\n        })\n    }\n\n    // Filter the metadata down to the current directory\n    function filter_files(cur_dir: string, filter: string, metadata: FilesMetadata): DirEntry[] {\n        const files: Record<string, DirEntry> = {}\n        const working = cur_dir + '/'\n        const working_length = working.length\n        for (const [full_path, meta] of Object.entries(metadata)) {\n            if (full_path.startsWith(working)) {\n                const subset_file_path = full_path.substring(working_length)\n                const parsed_path = path.parse(subset_file_path)\n                if (parsed_path.dir) {\n                    if (!parsed_path.dir.includes('/') && !files[parsed_path.dir]) {\n                        files[parsed_path.dir] = {\n                            dir: true,\n                            full_path: working + parsed_path.dir,\n                            name: parsed_path.dir,\n                        }\n                    }\n                }\n                else {\n                    files[parsed_path.base] = {\n                        dir: false,\n                        full_path,\n                        meta,\n                        name: parsed_path.base,\n                    }\n                }\n            }\n        }\n        const files_list = Object.values(files).filter(file => {\n            if (file.name.endsWith('.dir')) {\n                return false\n            }\n            if (file.dir || filter === '*') {\n                return true\n            }\n            const filters = filter.split(',')\n            for (const ext of filters) {\n                if (file.name.endsWith(ext)) {\n                    return true\n                }\n            }\n            return false\n        }).sort((a, b) => {\n            if (a.dir !== b.dir) {\n                return +b.dir - +a.dir\n            }\n            return a.name.localeCompare(b.name)\n        })\n        return files_list\n    }\n\n    async function open_alert_dialog(mode: AlertMode, title: string, message: string, initial?: string): Promise<string | boolean> {\n        const dialog = new AlertDialog({\n            target: document.body,\n            props: {\n                initial,\n                message,\n                mode,\n                title,\n            },\n        })\n        const result = await dialog.open()\n        await dialog.$destroy()\n        return result\n    }\n\n    async function check_overwrite(filename: string) {\n        // TODO: also check with default extension\n        for (const entry of cur_direntry) {\n            if (filename === entry.name) {\n                return !!(await open_alert_dialog(ALERT_MODE_CONFIRM, 'Overwrite file', `Are you sure you want to overwrite ${filename}?`))\n            }\n        }\n        return true\n    }\n\n    function on_add_file() {\n        upload_files.click()\n    }\n\n    function on_close() {\n        base_dialog.resolve(false)\n    }\n\n    function on_create_input(node: HTMLTextAreaElement) {\n        filename_input = node\n        filename_input.focus()\n        filename_input.value = ''\n    }\n\n    async function on_file_delete(ev: CustomEvent) {\n        const file: DirEntry = ev.detail\n        if (await open_alert_dialog(ALERT_MODE_CONFIRM, 'Delete file', `Are you sure you want to delete ${file.dir ? 'the folder ' : ''}${file.name}?`)) {\n            controller.delete(file)\n        }\n    }\n\n    function on_file_doubleclicked(ev: CustomEvent) {\n        const file: DirEntry = ev.detail\n        if (file.dir) {\n            cur_dir = file.full_path\n        }\n        else {\n            filename_input.value = file.name\n            on_submit()\n        }\n    }\n\n    function on_file_download(ev: CustomEvent) {\n        const file: DirEntry = ev.detail\n        controller.download(file)\n    }\n\n    async function on_file_rename(ev: CustomEvent) {\n        const file: DirEntry = ev.detail\n        const file_type = file.dir ? 'folder' : 'file'\n        const new_file_name = await open_alert_dialog(ALERT_MODE_PROMPT, `Rename ${file_type}`, `Enter new ${file_type} name`, file.name) as string | undefined\n        if (new_file_name) {\n            if (await check_overwrite(new_file_name)) {\n                controller.rename(file, new_file_name)\n            }\n        }\n    }\n\n    function on_input_keydown(ev: KeyboardEvent) {\n        if (ev.code === 'Enter') {\n            on_submit()\n            ev.preventDefault()\n        }\n    }\n\n    async function on_new_folder() {\n        const new_folder_name = await open_alert_dialog(ALERT_MODE_PROMPT, 'New folder', 'Enter new folder name')\n        if (new_folder_name) {\n            const path = cur_dir + '/' + new_folder_name\n            controller.new_folder(path)\n        }\n    }\n\n    async function on_submit() {\n        if (saving) {\n            const filename = filename_input.value.trim()\n            if (await check_overwrite(filename)) {\n                base_dialog.resolve(filename ? cur_dir + '/' + filename : false)\n            }\n        }\n        else {\n            base_dialog.resolve(selected_file?.full_path ?? false)\n        }\n    }\n\n    async function on_upload_files() {\n        if (upload_files.files) {\n            const files: Record<string, File> = {}\n            let have_files = false\n            for (const file of upload_files.files) {\n                if (await check_overwrite(file.name)) {\n                    files[cur_dir + '/' + file.name] = file\n                    have_files = true\n                }\n            }\n            if (have_files) {\n                controller.upload(files)\n            }\n        }\n        upload_files.value = ''\n    }\n</script>\n\n<style>\n    /* TODO: consider changing to an ID rather than a class, however that would need a regtest-html update */\n    :global(dialog.asyncglk_file_dialog) {\n        max-height: 500px !important;\n        max-width: 700px !important;\n    }\n\n    :global(dialog.asyncglk_file_dialog .inner) {\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n        width: 100%;\n    }\n\n    #actions {\n        float: right;\n        text-align: right;\n    }\n\n    #filelist {\n        border: 2px solid var(--asyncglk-ui-border);\n        flex: 1;\n        overflow-y: scroll;\n        padding: 6px;\n    }\n\n    .filename {\n        display: flex;\n    }\n\n    #filename_input {\n        flex-grow: 1;\n        margin-left: 6px;\n        resize: none;\n    }\n\n    #filter {\n        float: left;\n    }\n\n    #dialog_filter {\n        min-width: 100px;\n    }\n\n    #storage_warning {\n        font-size: 80%;\n        margin: 0;\n        text-align: center;\n    }\n\n    #add_file {\n        display: none;\n    }\n</style>\n\n<BaseDialog\n    bind:this={base_dialog}\n    extra_class=\"asyncglk_file_dialog {!saving ? 'selecting' : ''}\"\n    fullscreen\n>\n    <div>\n        <div id=\"actions\">\n            <button on:click={on_add_file}>Add file</button>\n            <button on:click={on_new_folder}>New Folder</button>\n        </div>\n        <DirTree bind:cur_dir/>\n    </div>\n    <div id=\"filelist\" role=\"listbox\">\n        {#each cur_direntry as file}\n            <FileListItem\n                data={file}\n                bind:selected_file\n                selected={file.full_path === selected_file?.full_path}\n                on:file_delete={on_file_delete}\n                on:file_doubleclicked={on_file_doubleclicked}\n                on:file_download={on_file_download}\n                on:file_rename={on_file_rename}\n            />\n        {/each}\n    </div>\n    {#if saving}\n        <div class=\"filename\">\n            <label for=\"filename_input\">File name:</label>\n            <textarea id=\"filename_input\" autocapitalize=\"off\" rows=\"1\" on:keydown={on_input_keydown} use:on_create_input></textarea>\n        </div>\n    {/if}\n    <div class=\"foot uirow\">\n        <div id=\"filter\">\n            {#if filter}\n                <label for=\"dialog_filter\">File type:</label>\n                <select id=\"dialog_filter\" bind:value={cur_filter}>\n                    {#if filter.label}\n                        <option value=\"{filter.extensions.join()}\">{filter.label}</option>\n                    {:else}\n                        <option value=\"{filter.extensions.join()}\">{filter.extensions[0]} file</option>\n                    {/if}\n                    <option value=\"*\">All files</option>\n                </select>\n            {/if}\n        </div>\n        <div>\n            <button class=\"close\" on:click={on_close}>Cancel</button>\n            <button class=\"submit\" on:click={on_submit}>{submit_label}</button>\n        </div>\n    </div>\n    {#if saving}\n        <div id=\"storage_warning\">\n            {#if is_safari}\n                Warning: Files saved in this browser will be lost if you don't visit again within a week.\n            {:else}\n                Note: Files saved in this browser may be lost by clearing cookies, or depending on your browser settings.\n            {/if}\n        </div>\n    {/if}\n    <input bind:this={upload_files} id=\"add_file\" type=\"file\" multiple on:change={on_upload_files}>\n</BaseDialog>", "/*\n\nWeb GlkOte shared things\n========================\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport * as protocol from '../../common/protocol.js'\n\n/** Create an element with specified classes */\nexport function create(tag: string, className:string): JQuery<HTMLElement> {\n    return $(`<${tag}>`, {'class': className})\n}\n\n/** Manage the DOM elements used by GlkOte */\nexport class DOM {\n    context_element?: HTMLElement\n    errorcontent_id: string\n    errorpane_id: string\n    gameport_id: string\n    loadingpane_id: string\n    prefix: string\n    windowport_id: string\n\n    constructor(options: {\n        context_element?: HTMLElement,\n        errorcontent_id: string,\n        errorpane_id: string,\n        gameport_id: string,\n        loadingpane_id: string,\n        prefix: string,\n        windowport_id: string,\n    }) {\n        this.context_element = options.context_element\n        this.errorcontent_id = options.errorcontent_id\n        this.errorpane_id = options.errorpane_id\n        this.gameport_id = options.gameport_id\n        this.loadingpane_id = options.loadingpane_id\n        this.prefix = options.prefix\n        this.windowport_id = options.windowport_id\n    }\n\n    /** Create an element, adding prefix to the ID */\n    create(tag: string, id: string, props?: string | any): JQuery<HTMLElement> {\n        props ??= {}\n        // Handle class name as props\n        if (typeof props === 'string') {\n            props = {\n                class: props,\n            }\n        }\n        props.id = this.prefix + id\n        return $(`<${tag}>`, props)\n    }\n\n    gameport(): JQuery<HTMLElement> {\n        return $(`#${this.gameport_id}`, this.context_element)\n    }\n\n    /** Return a jQuery search for an element ID, using prefix and context_element */\n    id(id: string): JQuery<HTMLElement> {\n        return $(`#${this.prefix}${id}`, this.context_element)\n    }\n\n    windowport(): JQuery<HTMLElement> {\n        return $(`#${this.windowport_id}`, this.context_element)\n    }\n}\n\nexport type EventFunc = (event: Partial<protocol.Event>) => void\n\n/** Is any input element focused? */\nexport function is_input_focused() {\n    const activeElement_tagName = document.activeElement?.tagName\n    return activeElement_tagName === 'INPUT' || activeElement_tagName === 'TEXTAREA'\n}\n\n/** Try to detect iOS */\n// From https://stackoverflow.com/a/58065241/2854284\nexport const is_iOS = /iPad|iPhone|iPod/.test(navigator.platform) || (navigator.platform === 'MacIntel' && (navigator.maxTouchPoints ?? 0) > 1)", "/*\n\nMetrics and resize handlers\n===========================\n\nCopyright (c) 2023 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {throttle} from 'lodash-es'\n\nimport {is_pinch_zoomed} from '../../common/misc.js'\nimport * as protocol from '../../common/protocol.js'\n\nimport {create, is_input_focused, is_iOS} from './shared.js'\nimport WebGlkOte from './web.js'\n\nfunction get_size(el: JQuery<HTMLElement>): {height: number, width: number} {\n    return {\n        height: el.outerHeight()!,\n        width: el.outerWidth()!,\n    }\n}\n\n/** Compare two metrics to see if they differ enough to send an arrange event */\nfunction metrics_differ(newmetrics: protocol.NormalisedMetrics, oldmetrics: protocol.NormalisedMetrics): boolean {\n    return (oldmetrics.buffercharheight !== newmetrics.buffercharheight ||\n        oldmetrics.buffercharwidth !== newmetrics.buffercharwidth ||\n        oldmetrics.gridcharheight !== newmetrics.gridcharheight ||\n        oldmetrics.gridcharwidth !== newmetrics.gridcharwidth ||\n        oldmetrics.height !== newmetrics.height ||\n        oldmetrics.width !== newmetrics.width)\n}\n\nexport default class Metrics {\n    /** When we don't know how high the screen is, use a height we've saved before, or, at the very beginning, a rough estimate */\n    private height_with_keyboard = (visualViewport?.height || window.innerHeight) / 2\n    private loaded: Promise<void>\n    private glkote: WebGlkOte\n    // Shares the current_metrics and DOM of WebGlkOte\n    private metrics: protocol.NormalisedMetrics\n    private observer?: ResizeObserver\n\n    constructor(glkote: WebGlkOte) {\n        this.glkote = glkote\n        this.metrics = glkote.current_metrics\n\n        // AsyncGlk may have started after a DOMContentLoaded event, but Metrics needs the page to be fully loaded so that the CSS and fonts are in use\n        // If the page is fast and already loaded by the time we get here (or, apparently, always for file: pages) then just use an auto-resolved promise\n        if (document.readyState === 'complete') {\n            this.loaded = Promise.resolve()\n        }\n        else {\n            this.loaded = new Promise((resolve: any) => {\n                window.addEventListener('load', resolve, {once: true})\n            })\n        }\n\n        // Use a resize observer on #gameport, or else a resize handler on window\n        if (window.ResizeObserver) {\n            this.observer = new ResizeObserver(this.on_gameport_resize)\n            this.observer.observe(this.glkote.dom.gameport()[0])\n        }\n        else {\n            $(window).on('resize', this.on_gameport_resize)\n        }\n\n        // iOS sends repeated visualViewport:resize events, so throttle it\n        if (is_iOS) {\n            this.on_visualViewport_resize = throttle(this.on_visualViewport_resize, 700)\n        }\n        if (visualViewport) {\n            $(visualViewport).on('resize', this.on_visualViewport_resize)\n        }\n    }\n\n    destroy() {\n        if (this.observer) {\n            this.observer.disconnect()\n        }\n        else {\n            $(window).off('resize', this.on_gameport_resize)\n        }\n        if (visualViewport) {\n            $(visualViewport).off('resize', this.on_visualViewport_resize)\n        }\n    }\n\n    async measure() {\n        // Ensure #gameport exists\n        const dom = this.glkote.dom\n        const gameport = dom.gameport()\n        if (!gameport.length) {\n            throw new Error(`Cannot find gameport element #${dom.gameport_id}`)\n        }\n\n        // Old versions of GlkOte used a pre-existing #layouttestpane, remove it if it exists\n        dom.id('layouttestpane').remove()\n\n        // Create a layout test pane\n        const layout_test_pane = dom.create('div', 'layout_test_pane')\n        layout_test_pane.text('This should not be visible')\n\n        // Create the test windows\n        const line = $('<div>')\n        create('span', 'Style_normal').text('12345678').appendTo(line)\n\n        const bufwin = create('div', 'WindowFrame BufferWindow')\n        const bufinnerwin = create('div', 'BufferWindowInner').appendTo(bufwin)\n        const bufline1 = line.clone().addClass('BufferLine').appendTo(bufinnerwin)\n        const bufline2 = line.clone().addClass('BufferLine').appendTo(bufinnerwin)\n        create('span', 'InvisibleCursor').appendTo(bufline2)\n        const bufspan = bufline1.children('span')\n        layout_test_pane.append(bufwin)\n\n        const graphwin = create('div', 'WindowFrame GraphicsWindow')\n        const graphcanvas = $('<canvas>', {\n            height: 32,\n            width: 64,\n        }).appendTo(graphwin)\n        layout_test_pane.append(graphwin)\n\n        const gridwin = create('div', 'WindowFrame GridWindow')\n        const gridline1 = line.clone().addClass('GridLine').appendTo(gridwin)\n        const gridline2 = line.clone().addClass('GridLine').appendTo(gridwin)\n        const gridspan = gridline1.children('span')\n        layout_test_pane.append(gridwin)\n\n        gameport.append(layout_test_pane)\n\n        // Wait first for the load event for the CSS to be loaded\n        await this.loaded\n        // And then for the actual font(s) to be loaded\n        const font_family = getComputedStyle(gridwin[0]).getPropertyValue('--glkote-grid-mono-family').split(',')[0].replace(/\"/g, '')\n        await document.fonts.load(`14px ${font_family}`)\n\n        // Measure the gameport height/width, excluding border and padding\n        this.metrics.height = gameport.height()!\n        this.metrics.width = gameport.width()!\n\n        // Measure the buffer window\n        const bufwinsize = get_size(bufwin)\n        const bufspansize = get_size(bufspan)\n        const bufline1size = get_size(bufline1)\n        const bufline2size = get_size(bufline2)\n        // A minimum of 1, but not necessarily an integer\n        this.metrics.buffercharheight = Math.max(1, bufline2.position().top - bufline1.position().top)\n        this.metrics.buffercharwidth = Math.max(1, bufspan.width()! / 8)\n        this.metrics.buffermarginx = bufwinsize.width - bufspansize.width\n        this.metrics.buffermarginy = bufwinsize.height - (bufline1size.height + bufline2size.height)\n\n        // Measure the graphics window\n        const graphicswinsize = get_size(graphwin)\n        const canvassize = get_size(graphcanvas)\n        this.metrics.graphicsmarginx = graphicswinsize.width - canvassize.width\n        this.metrics.graphicsmarginy = graphicswinsize.height - canvassize.height\n\n        // Measure the grid window\n        const gridwinsize = get_size(gridwin)\n        const gridspansize = get_size(gridspan)\n        const gridline1size = get_size(gridline1)\n        const gridline2size = get_size(gridline2)\n        // A minimum of 1, but not necessarily an integer\n        this.metrics.gridcharheight = Math.max(1, gridline2.position().top - gridline1.position().top)\n        this.metrics.gridcharwidth = Math.max(1, gridspan.width()! / 8)\n        this.metrics.gridmarginx = gridwinsize.width - gridspansize.width\n        this.metrics.gridmarginy = gridwinsize.height - (gridline1size.height + gridline2size.height)\n\n        // Clean up\n        layout_test_pane.remove()\n    }\n\n    on_gameport_resize = throttle(async () => {\n        // Delay again if not yet inited or disabled\n        if (this.glkote.disabled || !this.glkote.inited()) {\n            this.on_gameport_resize()\n            return\n        }\n        const oldmetrics = Object.assign({}, this.metrics)\n        await this.measure()\n        if (metrics_differ(this.metrics, oldmetrics)) {\n            this.glkote.send_event({type: 'arrange'})\n        }\n    }, 200, {leading: false})\n\n    on_visualViewport_resize = () => {\n        // If the keyboard is active, then store the height for later\n        const height = visualViewport!.height\n        if (is_input_focused()) {\n            this.height_with_keyboard = height\n        }\n\n        // The iOS virtual keyboard does not change the gameport height, but it does change the viewport\n        // Try to account for this by setting the gameport to the viewport height\n        this.set_gameport_height(height)\n    }\n\n    /** Update the gameport height and then send new metrics */\n    set_gameport_height(height: number) {\n        // Don't do anything if the window is pinch zoomed\n        if (is_pinch_zoomed()){\n            return\n        }\n\n        if (!height) {\n            height = this.height_with_keyboard\n        }\n\n        // We set the outer height to account for any padding or margin\n        this.glkote.dom.gameport().outerHeight(height, true)\n\n        // Safari might have scrolled weirdly, so try to put it right\n        window.scrollTo(0, 0)\n\n        // Measure and send the new metrics\n        this.on_gameport_resize()\n    }\n}", "let wasm;\n\nlet cachedUint8ArrayMemory0 = null;\n\nfunction getUint8ArrayMemory0() {\n    if (cachedUint8ArrayMemory0 === null || cachedUint8ArrayMemory0.byteLength === 0) {\n        cachedUint8ArrayMemory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachedUint8ArrayMemory0;\n}\n\nlet WASM_VECTOR_LEN = 0;\n\nfunction passArray8ToWasm0(arg, malloc) {\n    const ptr = malloc(arg.length * 1, 1) >>> 0;\n    getUint8ArrayMemory0().set(arg, ptr / 1);\n    WASM_VECTOR_LEN = arg.length;\n    return ptr;\n}\n\nlet cachedDataViewMemory0 = null;\n\nfunction getDataViewMemory0() {\n    if (cachedDataViewMemory0 === null || cachedDataViewMemory0.buffer.detached === true || (cachedDataViewMemory0.buffer.detached === undefined && cachedDataViewMemory0.buffer !== wasm.memory.buffer)) {\n        cachedDataViewMemory0 = new DataView(wasm.memory.buffer);\n    }\n    return cachedDataViewMemory0;\n}\n\nfunction getArrayU8FromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return getUint8ArrayMemory0().subarray(ptr / 1, ptr / 1 + len);\n}\n/**\n * @param {Uint8Array} buffer\n * @returns {Uint8Array}\n */\nexport function decode(buffer) {\n    try {\n        const retptr = wasm.__wbindgen_add_to_stack_pointer(-16);\n        const ptr0 = passArray8ToWasm0(buffer, wasm.__wbindgen_malloc);\n        const len0 = WASM_VECTOR_LEN;\n        wasm.decode(retptr, ptr0, len0);\n        var r0 = getDataViewMemory0().getInt32(retptr + 4 * 0, true);\n        var r1 = getDataViewMemory0().getInt32(retptr + 4 * 1, true);\n        var v2 = getArrayU8FromWasm0(r0, r1).slice();\n        wasm.__wbindgen_free(r0, r1 * 1, 1);\n        return v2;\n    } finally {\n        wasm.__wbindgen_add_to_stack_pointer(16);\n    }\n}\n\nasync function __wbg_load(module, imports) {\n    if (typeof Response === 'function' && module instanceof Response) {\n        if (typeof WebAssembly.instantiateStreaming === 'function') {\n            try {\n                return await WebAssembly.instantiateStreaming(module, imports);\n\n            } catch (e) {\n                if (module.headers.get('Content-Type') != 'application/wasm') {\n                    console.warn(\"`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", e);\n\n                } else {\n                    throw e;\n                }\n            }\n        }\n\n        const bytes = await module.arrayBuffer();\n        return await WebAssembly.instantiate(bytes, imports);\n\n    } else {\n        const instance = await WebAssembly.instantiate(module, imports);\n\n        if (instance instanceof WebAssembly.Instance) {\n            return { instance, module };\n\n        } else {\n            return instance;\n        }\n    }\n}\n\nfunction __wbg_get_imports() {\n    const imports = {};\n    imports.wbg = {};\n\n    return imports;\n}\n\nfunction __wbg_init_memory(imports, memory) {\n\n}\n\nfunction __wbg_finalize_init(instance, module) {\n    wasm = instance.exports;\n    __wbg_init.__wbindgen_wasm_module = module;\n    cachedDataViewMemory0 = null;\n    cachedUint8ArrayMemory0 = null;\n\n\n\n    return wasm;\n}\n\nfunction initSync(module) {\n    if (wasm !== undefined) return wasm;\n\n\n    if (typeof module !== 'undefined') {\n        if (Object.getPrototypeOf(module) === Object.prototype) {\n            ({module} = module)\n        } else {\n            console.warn('using deprecated parameters for `initSync()`; pass a single object instead')\n        }\n    }\n\n    const imports = __wbg_get_imports();\n\n    __wbg_init_memory(imports);\n\n    if (!(module instanceof WebAssembly.Module)) {\n        module = new WebAssembly.Module(module);\n    }\n\n    const instance = new WebAssembly.Instance(module, imports);\n\n    return __wbg_finalize_init(instance, module);\n}\n\nasync function __wbg_init(module_or_path) {\n    if (wasm !== undefined) return wasm;\n\n\n    if (typeof module_or_path !== 'undefined') {\n        if (Object.getPrototypeOf(module_or_path) === Object.prototype) {\n            ({module_or_path} = module_or_path)\n        } else {\n            console.warn('using deprecated parameters for the initialization function; pass a single object instead')\n        }\n    }\n\n    if (typeof module_or_path === 'undefined') {\n        module_or_path = new URL('glkaudio_bg.wasm', import.meta.url);\n    }\n    const imports = __wbg_get_imports();\n\n    if (typeof module_or_path === 'string' || (typeof Request === 'function' && module_or_path instanceof Request) || (typeof URL === 'function' && module_or_path instanceof URL)) {\n        module_or_path = fetch(module_or_path);\n    }\n\n    __wbg_init_memory(imports);\n\n    const { instance, module } = await __wbg_load(await module_or_path, imports);\n\n    return __wbg_finalize_init(instance, module);\n}\n\nexport { initSync };\nexport default __wbg_init;\nexport {wasm}\n", "/*\n\nWeb GlkOte Sound Channels\n=========================\n\nCopyright (c) 2024 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {fetch_resource, parse_base64} from '../../common/file/browser.js'\nimport * as protocol from '../../common/protocol.js'\nimport WebGlkOte from './web.js'\n\nimport GlkAudio_init, {decode as GlkAudio_decode, wasm as GlkAudio_is_ready} from 'glkaudio'\n\n// From https://github.com/compulim/web-speech-cognitive-services/issues/34\nconst priming_mp3 = 'SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU3LjU2LjEwMQAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU3LjY0AAAAAAAAAAAAAAAAJAUHAAAAAAAAAYYoRBqpAAAAAAD/+xDEAAPAAAGkAAAAIAAANIAAAARMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EMQpg8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV'\n\nexport class SoundChannelManager extends Map<number, SoundChannel> {\n    private context: AudioContext\n    private glkote: WebGlkOte\n\n    constructor(glkote: WebGlkOte) {\n        super()\n        this.glkote = glkote\n        this.context = new AudioContext()\n\n        // Try to prime the audio system so that sounds starting after a timer will work\n        this.prime()\n    }\n\n    async update(schannels: protocol.SoundChannelUpdate[]) {\n        const wanted_schannels = []\n        for (const schannel of schannels) {\n            const {id, ops} = schannel\n            wanted_schannels.push(id)\n\n            // Add new channels\n            if (!this.has(id)) {\n                this.set(id, new SoundChannel(this.glkote, this.context))\n            }\n\n            // Do operations\n            if (ops) {\n                this.get(id)!.do_ops(ops)\n            }\n        }\n\n        // Remove unwanted channels\n        for (const [id, schannel] of this) {\n            if (!wanted_schannels.includes(id)) {\n                schannel.delete()\n                this.delete(id)\n            }\n        }\n    }\n\n    private async prime() {\n        const context = this.context\n\n        const source = this.context.createBufferSource()\n        const data = await parse_base64(priming_mp3)\n        source.buffer = await context.decodeAudioData(data.buffer)\n\n        source.connect(context.destination)\n        source.start()\n        setTimeout(() => {\n            source.disconnect()\n            source.stop()\n        }, 10)\n    }\n}\n\nexport class SoundChannel {\n    private buffer: AudioBuffer | null = null\n    private context: AudioContext\n    private gain: GainNode\n    private glkote: WebGlkOte\n    private notify = 0\n    private paused = false\n    private paused_time = 0\n    private repeats = 0\n    private snd = 0\n    private source: AudioBufferSourceNode | null = null\n    private start_time = 0\n    private vol_timer = 0\n\n    constructor(glkote: WebGlkOte, context: AudioContext) {\n        this.context = context\n        this.glkote = glkote\n        this.gain = context.createGain()\n        this.gain.connect(context.destination)\n    }\n\n    delete() {\n        this.stop()\n        if (this.vol_timer) {\n            clearTimeout(this.vol_timer)\n        }\n        this.gain.disconnect()\n    }\n\n    async do_ops(ops: protocol.SoundChannelOperation[]) {\n        const context = this.context\n        for (const op of ops) {\n            switch (op.op) {\n                case 'pause':\n                    if (!this.paused) {\n                        this.paused = true\n                        this.paused_time = context.currentTime - this.start_time\n                        this.stop()\n                    }\n                    break\n\n                case 'play': {\n                    this.stop()\n\n                    this.notify = op.notify ?? 0\n                    this.paused_time = 0\n                    this.repeats = op.repeats ?? 1\n                    this.snd = op.snd\n\n                    // Get the data from Blorb\n                    const chunk = this.glkote.Blorb!.get_chunk('sound', op.snd)\n                    if (!chunk) {\n                        continue\n                    }\n\n                    // Decode\n                    // TODO: cache decoded, or try streaming\n                    try {\n                        this.buffer = await context.decodeAudioData(chunk.content!.slice().buffer)\n                    }\n                    catch {\n                        // Load the glkaudio library if it hasn't been yet\n                        if (!GlkAudio_is_ready) {\n                            await GlkAudio_init({module_or_path: fetch_resource(this.glkote.options, 'glkaudio_bg.wasm')})\n                        }\n                        const decoded = GlkAudio_decode(chunk.content!)\n                        this.buffer = await context.decodeAudioData(decoded.buffer)\n                    }\n\n                    if (!this.paused) {\n                        this.play()\n                    }\n\n                    break\n                }\n\n                case 'stop':\n                    this.stop()\n                    this.buffer = null\n                    break\n\n                case 'unpause':\n                    if (this.paused) {\n                        if (this.buffer) {\n                            this.play()\n                        }\n                        else {\n                            this.paused = false\n                        }\n                    }\n                    break\n\n                case 'volume': {\n                    const currentTime = context.currentTime\n                    const gain = this.gain.gain\n\n                    // Cancel any current gain changes\n                    const current_value = gain.value\n                    gain.cancelScheduledValues(currentTime)\n                    gain.value = current_value\n                    if (this.vol_timer) {\n                        clearTimeout(this.vol_timer)\n                    }\n\n                    const notify = () => {\n                        this.glkote.send_event({\n                            type: 'volume',\n                            notify: op.notify,\n                        })\n                    }\n\n                    if (op.dur) {\n                        gain.setValueAtTime(current_value || 0.0001, currentTime)\n                        gain.exponentialRampToValueAtTime(op.vol || 0.0001, currentTime + (op.dur) / 1000)\n                        if (op.notify) {\n                            // Handle Typescript thinking this is the Node version, which doesn't return a number\n                            this.vol_timer = setTimeout(notify, op.dur) as any as number\n                        }\n                    }\n                    else {\n                        gain.value = op.vol\n                        if (op.notify) {\n                            notify()\n                        }\n                        this.vol_timer = 0\n                    }\n                    break\n                }\n            }\n        }\n    }\n\n    private on_stop = () => {\n        this.stop()\n\n        // Repeat\n        if (this.repeats !== 0) {\n            this.play()\n        }\n        else if (this.notify) {\n            this.glkote.send_event({\n                type: 'sound',\n                notify: this.notify,\n                snd: this.snd,\n            })\n        }\n    }\n\n    private play() {\n        // Create a new audio node\n        const source = this.context.createBufferSource()\n        this.source = source\n        source.addEventListener('ended', this.on_stop)\n        source.buffer = this.buffer!\n        source.connect(this.gain)\n        // Do we need to do source.loop=true for seamless repeats?\n\n        // Handle unpausing\n        this.start_time = this.context.currentTime - this.paused_time\n        source.start(0, this.paused_time)\n        if (this.paused) {\n            this.paused = false\n            this.paused_time = 0\n        }\n        else if (this.repeats > 0) {\n            this.repeats--\n        }\n    }\n\n    private stop() {\n        const source = this.source\n        if (source) {\n            source.removeEventListener('ended', this.on_stop)\n            source.stop()\n            source.disconnect()\n            this.source = null\n        }\n    }\n}", "function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\n// Older browsers don't support event options, feature detect it.\n\n// Adopted and modified solution from Bohdan Didukh (2017)\n// https://stackoverflow.com/questions/41594997/ios-10-safari-prevent-scrolling-behind-a-fixed-overlay-and-maintain-scroll-posi\n\nvar hasPassiveEvents = false;\nif (typeof window !== 'undefined') {\n  var passiveTestOptions = {\n    get passive() {\n      hasPassiveEvents = true;\n      return undefined;\n    }\n  };\n  window.addEventListener('testPassive', null, passiveTestOptions);\n  window.removeEventListener('testPassive', null, passiveTestOptions);\n}\n\nvar isIosDevice = typeof window !== 'undefined' && window.navigator && window.navigator.platform && (/iP(ad|hone|od)/.test(window.navigator.platform) || window.navigator.platform === 'MacIntel' && window.navigator.maxTouchPoints > 1);\n\n\nvar locks = [];\nvar documentListenerAdded = false;\nvar initialClientY = -1;\nvar previousBodyOverflowSetting = void 0;\nvar previousBodyPosition = void 0;\nvar previousBodyPaddingRight = void 0;\n\n// returns true if `el` should be allowed to receive touchmove events.\nvar allowTouchMove = function allowTouchMove(el) {\n  return locks.some(function (lock) {\n    if (lock.options.allowTouchMove && lock.options.allowTouchMove(el)) {\n      return true;\n    }\n\n    return false;\n  });\n};\n\nvar preventDefault = function preventDefault(rawEvent) {\n  var e = rawEvent || window.event;\n\n  // For the case whereby consumers adds a touchmove event listener to document.\n  // Recall that we do document.addEventListener('touchmove', preventDefault, { passive: false })\n  // in disableBodyScroll - so if we provide this opportunity to allowTouchMove, then\n  // the touchmove event on document will break.\n  if (allowTouchMove(e.target)) {\n    return true;\n  }\n\n  // Do not prevent if the event has more than one touch (usually meaning this is a multi touch gesture like pinch to zoom).\n  if (e.touches.length > 1) return true;\n\n  if (e.preventDefault) e.preventDefault();\n\n  return false;\n};\n\nvar setOverflowHidden = function setOverflowHidden(options) {\n  // If previousBodyPaddingRight is already set, don't set it again.\n  if (previousBodyPaddingRight === undefined) {\n    var _reserveScrollBarGap = !!options && options.reserveScrollBarGap === true;\n    var scrollBarGap = window.innerWidth - document.documentElement.clientWidth;\n\n    if (_reserveScrollBarGap && scrollBarGap > 0) {\n      var computedBodyPaddingRight = parseInt(window.getComputedStyle(document.body).getPropertyValue('padding-right'), 10);\n      previousBodyPaddingRight = document.body.style.paddingRight;\n      document.body.style.paddingRight = computedBodyPaddingRight + scrollBarGap + 'px';\n    }\n  }\n\n  // If previousBodyOverflowSetting is already set, don't set it again.\n  if (previousBodyOverflowSetting === undefined) {\n    previousBodyOverflowSetting = document.body.style.overflow;\n    document.body.style.overflow = 'hidden';\n  }\n};\n\nvar restoreOverflowSetting = function restoreOverflowSetting() {\n  if (previousBodyPaddingRight !== undefined) {\n    document.body.style.paddingRight = previousBodyPaddingRight;\n\n    // Restore previousBodyPaddingRight to undefined so setOverflowHidden knows it\n    // can be set again.\n    previousBodyPaddingRight = undefined;\n  }\n\n  if (previousBodyOverflowSetting !== undefined) {\n    document.body.style.overflow = previousBodyOverflowSetting;\n\n    // Restore previousBodyOverflowSetting to undefined\n    // so setOverflowHidden knows it can be set again.\n    previousBodyOverflowSetting = undefined;\n  }\n};\n\nvar setPositionFixed = function setPositionFixed() {\n  return window.requestAnimationFrame(function () {\n    // If previousBodyPosition is already set, don't set it again.\n    if (previousBodyPosition === undefined) {\n      previousBodyPosition = {\n        position: document.body.style.position,\n        top: document.body.style.top,\n        left: document.body.style.left\n      };\n\n      // Update the dom inside an animation frame \n      var _window = window,\n          scrollY = _window.scrollY,\n          scrollX = _window.scrollX,\n          innerHeight = _window.innerHeight;\n\n      document.body.style.position = 'fixed';\n      document.body.style.top = -scrollY;\n      document.body.style.left = -scrollX;\n\n      setTimeout(function () {\n        return window.requestAnimationFrame(function () {\n          // Attempt to check if the bottom bar appeared due to the position change\n          var bottomBarHeight = innerHeight - window.innerHeight;\n          if (bottomBarHeight && scrollY >= innerHeight) {\n            // Move the content further up so that the bottom bar doesn't hide it\n            document.body.style.top = -(scrollY + bottomBarHeight);\n          }\n        });\n      }, 300);\n    }\n  });\n};\n\nvar restorePositionSetting = function restorePositionSetting() {\n  if (previousBodyPosition !== undefined) {\n    // Convert the position from \"px\" to Int\n    var y = -parseInt(document.body.style.top, 10);\n    var x = -parseInt(document.body.style.left, 10);\n\n    // Restore styles\n    document.body.style.position = previousBodyPosition.position;\n    document.body.style.top = previousBodyPosition.top;\n    document.body.style.left = previousBodyPosition.left;\n\n    // Restore scroll\n    window.scrollTo(x, y);\n\n    previousBodyPosition = undefined;\n  }\n};\n\n// https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight#Problems_and_solutions\nvar isTargetElementTotallyScrolled = function isTargetElementTotallyScrolled(targetElement) {\n  return targetElement ? targetElement.scrollHeight - targetElement.scrollTop <= targetElement.clientHeight : false;\n};\n\nvar handleScroll = function handleScroll(event, targetElement) {\n  var clientY = event.targetTouches[0].clientY - initialClientY;\n\n  if (allowTouchMove(event.target)) {\n    return false;\n  }\n\n  if (targetElement && targetElement.scrollTop === 0 && clientY > 0) {\n    // element is at the top of its scroll.\n    return preventDefault(event);\n  }\n\n  if (isTargetElementTotallyScrolled(targetElement) && clientY < 0) {\n    // element is at the bottom of its scroll.\n    return preventDefault(event);\n  }\n\n  event.stopPropagation();\n  return true;\n};\n\nexport var disableBodyScroll = function disableBodyScroll(targetElement, options) {\n  // targetElement must be provided\n  if (!targetElement) {\n    // eslint-disable-next-line no-console\n    console.error('disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.');\n    return;\n  }\n\n  // disableBodyScroll must not have been called on this targetElement before\n  if (locks.some(function (lock) {\n    return lock.targetElement === targetElement;\n  })) {\n    return;\n  }\n\n  var lock = {\n    targetElement: targetElement,\n    options: options || {}\n  };\n\n  locks = [].concat(_toConsumableArray(locks), [lock]);\n\n  if (isIosDevice) {\n    setPositionFixed();\n  } else {\n    setOverflowHidden(options);\n  }\n\n  if (isIosDevice) {\n    targetElement.ontouchstart = function (event) {\n      if (event.targetTouches.length === 1) {\n        // detect single touch.\n        initialClientY = event.targetTouches[0].clientY;\n      }\n    };\n    targetElement.ontouchmove = function (event) {\n      if (event.targetTouches.length === 1) {\n        // detect single touch.\n        handleScroll(event, targetElement);\n      }\n    };\n\n    if (!documentListenerAdded) {\n      document.addEventListener('touchmove', preventDefault, hasPassiveEvents ? { passive: false } : undefined);\n      documentListenerAdded = true;\n    }\n  }\n};\n\nexport var clearAllBodyScrollLocks = function clearAllBodyScrollLocks() {\n  if (isIosDevice) {\n    // Clear all locks ontouchstart/ontouchmove handlers, and the references.\n    locks.forEach(function (lock) {\n      lock.targetElement.ontouchstart = null;\n      lock.targetElement.ontouchmove = null;\n    });\n\n    if (documentListenerAdded) {\n      document.removeEventListener('touchmove', preventDefault, hasPassiveEvents ? { passive: false } : undefined);\n      documentListenerAdded = false;\n    }\n\n    // Reset initial clientY.\n    initialClientY = -1;\n  }\n\n  if (isIosDevice) {\n    restorePositionSetting();\n  } else {\n    restoreOverflowSetting();\n  }\n\n  locks = [];\n};\n\nexport var enableBodyScroll = function enableBodyScroll(targetElement) {\n  if (!targetElement) {\n    // eslint-disable-next-line no-console\n    console.error('enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.');\n    return;\n  }\n\n  locks = locks.filter(function (lock) {\n    return lock.targetElement !== targetElement;\n  });\n\n  if (isIosDevice) {\n    targetElement.ontouchstart = null;\n    targetElement.ontouchmove = null;\n\n    if (documentListenerAdded && locks.length === 0) {\n      document.removeEventListener('touchmove', preventDefault, hasPassiveEvents ? { passive: false } : undefined);\n      documentListenerAdded = false;\n    }\n  }\n\n  if (isIosDevice) {\n    restorePositionSetting();\n  } else {\n    restoreOverflowSetting();\n  }\n};\n\n", "/*\n\nGlkOte input handlers\n=====================\n\nCopyright (c) 2024 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {debounce} from 'lodash-es'\n\nimport {KEY_CODE_DOWN, KEY_CODE_RETURN, KEY_CODE_UP, KEY_CODES_TO_NAMES, OFFSCREEN_OFFSET} from '../../common/constants.js'\nimport {is_pinch_zoomed} from '../../common/misc.js'\nimport * as protocol from '../../common/protocol.js'\n\nimport {is_input_focused, is_iOS} from './shared.js'\nimport {apply_text_run_styles, type Window} from './windows.js'\n\nconst MAX_HISTORY_LENGTH = 25\n\nexport class TextInput {\n    el: JQuery<HTMLElement>\n    history_index = 0\n    is_line = false\n    /** Whether this input has been refocused since it was last reset */\n    refocused = false\n    window: Window\n\n    constructor(win: Window) {\n        this.window = win\n\n        // We use a textarea rather than an input because mobile Chrome shows an extra bar which can't be removed\n        // See https://github.com/curiousdannii/asyncglk/issues/30\n        this.el = $('<textarea>', {\n            'aria-hidden': 'true',\n            autocapitalize: 'off',\n            class: 'Input',\n            data: {\n                window: win,\n            },\n            on: {\n                blur: () => this.onblur(),\n                focus: () => this.onfocus(),\n                input: (ev: any) => this.oninput(ev),\n                keydown: (ev: JQuery.KeyDownEvent) => this.onkeydown(ev),\n                keypress: (ev: JQuery.KeyPressEvent) => this.onkeypress(ev),\n            },\n            rows: 1,\n        })\n            .prop('disabled', true)\n            .appendTo(win.frameel)\n    }\n\n    destroy() {\n        this.el.remove()\n    }\n\n    private onblur() {\n        // If this input lost focus and no other input gained focus, then tell the metrics to resize the gameport\n        // This is to support iOS better, which delays its `visualViewport:resize` event significantly (~700ms)\n        if (is_iOS && !is_input_focused()) {\n            this.set_gameport_height(true)\n        }\n    }\n\n    private onfocus() {\n        // Ensure a buffer window is scrolled down\n        if (this.window.type === 'buffer' && !is_pinch_zoomed()) {\n            this.window.scroll_to_bottom()\n        }\n        // In iOS tell the metrics to resize the gameport because its `visualViewport:resize` event is slowww\n        if (is_iOS) {\n            this.set_gameport_height(false)\n        }\n    }\n\n    /** The keydown and keypress inputs are unreliable in mobile browsers with virtual keyboards. This handler can handle character input for printable characters, but not function/arrow keys */\n    private oninput(ev: any) {\n        // This input shouldn't be active\n        if (!this.window.inputs?.type) {\n            this.el.trigger('blur')\n            return false\n        }\n\n        if (this.window.inputs.type === 'char') {\n            const char = ev.target.value[0]\n            this.submit_char(char)\n            // Even though we have reset and emptied the input, Android acts as though it still has spaces within it, and won't send backspace keydown events until the phantom spaces have all been deleted. Refocusing seems to fix it.\n            if (char === ' ') {\n                this.el.trigger('blur').trigger('focus')\n            }\n            return false\n        }\n    }\n\n    private onkeydown(ev: JQuery.KeyDownEvent) {\n        // This input shouldn't be active\n        if (!this.window.inputs?.type) {\n            this.el.trigger('blur')\n            return false\n        }\n\n        const keycode = ev.which\n        if (!keycode) {\n            return\n        }\n\n        if (this.is_line) {\n            // History\n            if (keycode === KEY_CODE_DOWN || keycode === KEY_CODE_UP) {\n                const history = this.window.manager.history\n                let changed\n                if (keycode === KEY_CODE_DOWN && this.history_index > 0) {\n                    this.history_index--\n                    changed = 1\n                }\n                else if (keycode === KEY_CODE_UP && this.history_index < history.length) {\n                    this.history_index++\n                    changed = 1\n                }\n                if (changed) {\n                    this.el.val(this.history_index === 0 ? '' : history[this.history_index - 1])\n                }\n                return false\n            }\n\n            // Terminator for this input\n            else if (this.window.inputs!.terminators) {\n                const terminator = KEY_CODES_TO_NAMES[keycode] as protocol.TerminatorCode\n                if (this.window.inputs!.terminators.includes(terminator)) {\n                    this.submit_line(ev.target.value, terminator)\n                    return false\n                }\n            }\n        }\n        // Character input\n        else {\n            const code = KEY_CODES_TO_NAMES[keycode]\n            if (code) {\n                this.submit_char(code)\n                return false\n            }\n        }\n\n        // Don't propagate, so that document.keydown doesn't trigger\n        ev.stopPropagation()\n    }\n\n    private onkeypress(ev: JQuery.KeyPressEvent) {\n        // This input shouldn't be active\n        if (!this.window.inputs?.type) {\n            this.el.trigger('blur')\n            return false\n        }\n\n        const keycode = ev.which\n        if (!keycode) {\n            return\n        }\n\n        // Submit line input\n        if (this.is_line) {\n            if (keycode === KEY_CODE_RETURN) {\n                this.submit_line(ev.target.value)\n                return false\n            }\n        }\n        // Character input\n        else {\n            const code = keycode === KEY_CODE_RETURN ? 'return' : String.fromCharCode(keycode)\n            this.submit_char(code)\n            return false\n        }\n    }\n\n    /** Refocus the input, if it wouldn't obscure part of the update */\n    // On Android this forces the window to be scrolled down to the bottom, so only refocus if the virtual keyboard doesn't make the window too small for the full update text to be seen\n    refocus() {\n        if (this.refocused || document.activeElement === this.el[0]) {\n            return\n        }\n        this.refocused = true\n        if (this.window.type === 'buffer') {\n            const updateheight = this.window.innerel.outerHeight()! - this.window.updatescrolltop\n            if (updateheight > this.window.height_above_keyboard) {\n                // If there's not enough space, then tell the metrics to resize the gameport\n                // This is to support iOS better, which delays its `visualViewport:resize` event significantly (~700ms)\n                if (is_iOS) {\n                    this.set_gameport_height(true)\n                }\n                return\n            }\n        }\n        this.el[0].focus({preventScroll: true})\n    }\n\n    reset() {\n        this.history_index = 0\n        this.refocused = false\n        this.el\n            .attr({\n                'aria-hidden': 'true',\n                class: 'Input',\n            })\n            .css({\n                'background-color': '',\n                color: '',\n                left: OFFSCREEN_OFFSET,\n                top: '',\n                width: '',\n            })\n            .val('')\n        const inputparent = this.window.type === 'buffer' ? this.window.innerel : this.window.frameel\n        if (!this.el.parent().is(inputparent)) {\n            this.el.appendTo(inputparent)\n        }\n    }\n\n    private set_gameport_height = debounce((full_screen: boolean) => {\n        this.window.manager.glkote.metrics_calculator.set_gameport_height(full_screen ? window.innerHeight : 0)\n    }, 50)\n\n    private submit_char(val: string) {\n        this.window.send_text_event({\n            type: 'char',\n            value: val,\n        })\n    }\n\n    private submit_line(val: string, terminator?: protocol.TerminatorCode) {\n        // Insert a history item if it's not blank and also not the same as the last one\n        const history = this.window.manager.history\n        if (val && val !== history[0]) {\n            history.unshift(val)\n            if (history.length > MAX_HISTORY_LENGTH) {\n                history.length = MAX_HISTORY_LENGTH\n            }\n        }\n\n        this.window.send_text_event({\n            type: 'line',\n            terminator,\n            value: val,\n        })\n    }\n\n    update() {\n        // Start from a clean slate\n        this.reset()\n\n        const update = this.window.inputs!\n        if (update.type !== 'char' && update.type !== 'line') {\n            return\n        }\n        this.is_line = update.type === 'line'\n\n        // Common options for both character and line input\n        this.el\n            .attr({\n                'aria-hidden': 'false',\n                maxlength: this.is_line ? update.maxlen! : 1,\n            })\n            .prop('disabled', false)\n            .val(update.initial || '')\n\n        if (this.is_line) {\n            if (this.window.type === 'graphics') {\n                throw new Error(`Cannot request line input in graphics window ${this.window.id}`)\n            }\n            this.el.addClass('LineInput')\n        }\n\n        // Position the input element within the window\n        switch (this.window.type) {\n            case 'buffer':\n                (this.window.lastline || this.window.innerel).append(this.el)\n                break\n            case 'grid': {\n                const metrics = this.window.metrics\n                this.el.css({\n                    left: update.xpos! * metrics.gridcharwidth + (metrics.gridmarginx / 2),\n                    top: update.ypos! * metrics.gridcharheight + (metrics.gridmarginy / 2),\n                    width: (update.maxlen || 1) * metrics.gridcharwidth,\n                })\n                break\n            }\n        }\n\n        // Set text style\n        if (this.window.type !== 'graphics') {\n            const css_styles = this.window.last_run_styles\n            if (css_styles) {\n                const reverse = !!css_styles.reverse\n                this.el.toggleClass('reverse', reverse)\n                apply_text_run_styles(css_styles, reverse, this.el)\n            }\n        }\n    }\n}", "/*\n\nGlkOte windows\n==============\n\nCopyright (c) 2024 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport {disableBodyScroll, enableBodyScroll} from 'body-scroll-lock'\nimport {debounce} from 'lodash-es'\n\nimport {Blorb} from '../../blorb/blorb.js'\nimport {NBSP} from '../../common/constants.js'\nimport {is_pinch_zoomed} from '../../common/misc.js'\nimport * as protocol from '../../common/protocol.js'\n\nimport {TextInput} from './input.js'\nimport {create, DOM, type EventFunc, is_iOS} from './shared.js'\nimport WebGlkOte from './web.js'\n\nexport type Window = BufferWindow | GraphicsWindow | GridWindow\ntype WindowCodes = 'buffer' | 'graphics' | 'grid'\n\nfunction no_text_selected(): boolean {\n    return (window.getSelection() + '') === ''\n}\n\ninterface WindowConstructorOptions {\n    blorb?: Blorb\n    dom: DOM,\n    id: number,\n    manager: Windows,\n    metrics: protocol.NormalisedMetrics,\n    rock: number,\n    styles?: protocol.WindowStyles,\n    type: WindowCodes,\n}\n\nabstract class WindowBase {\n    blorb?: Blorb\n    desired = true\n    dom: DOM\n    frameel: JQuery<HTMLElement>\n    id: number\n    inputs?: protocol.InputUpdate\n    manager: Windows\n    metrics: protocol.NormalisedMetrics\n    textinput: TextInput\n    type: WindowCodes\n\n    constructor(options: WindowConstructorOptions) {\n        this.blorb = options.blorb\n        this.dom = options.dom\n        this.id = options.id\n        this.manager = options.manager\n        this.metrics = options.metrics\n        this.type = options.type\n\n        this.frameel = this.dom.create('div', `window${options.id}`, {\n            class: `WindowFrame ${window_types[this.type]} WindowRock_${options.rock}`,\n            click: (ev: JQuery.ClickEvent) => this.onclick(ev),\n        })\n            .appendTo(this.dom.windowport())\n\n        // (this as any as Window) is a silly hack to work around Typescript's abstract class rules\n        this.textinput = new TextInput(this as any as Window)\n    }\n\n    destroy(remove_frame: boolean) {\n        this.textinput.destroy()\n        if (remove_frame) {\n            this.frameel.remove()\n        }\n        else {\n            this.inputs = undefined\n        }\n    }\n\n    // Dummy function which is only needed for buffer windows\n    measure_height() {}\n\n    protected onclick(ev: JQuery.ClickEvent) {\n        if (this.inputs?.type && no_text_selected()) {\n            this.textinput.el.trigger('focus')\n            return false\n        }\n    }\n\n    send_text_event(ev: Partial<protocol.CharEvent | protocol.LineEvent>) {\n        // Measure the height of the window, which should account for a virtual keyboard\n        this.measure_height()\n        this.textinput.reset()\n        // Clear the input type so we won't accidentally send it again\n        this.inputs!.type = undefined\n        // We're the last active window\n        this.manager.active_window = this as any as Window\n        // Set the event's window prop and send it\n        ev.window = this.id\n        this.manager.send_event(ev)\n    }\n}\n\n// Apply text run styles, accounting for reverse mode\nexport function apply_text_run_styles(orig_styles: protocol.CSSProperties, reverse: boolean, el: JQuery<HTMLElement>) {\n    // Make a copy of the styles, I'm not sure this is strictly necessary but better to be safe\n    const styles = Object.assign({}, orig_styles)\n    // Swap colours if reverse mode\n    if (reverse) {\n        const bg = styles['background-color']\n        const fg = styles.color\n        if (bg) {\n            styles.color = bg\n        }\n        else {\n            delete styles.color\n        }\n        if (fg) {\n            styles['background-color'] = fg\n        }\n        else {\n            delete styles['background-color']\n        }\n        delete styles.reverse\n    }\n    el.css(styles)\n}\n\n// Split a string into words, with whitespace included after the words it follows\nfunction split_after_spaces(text: string): string[] {\n    const res: string[] = ['']\n    const whitespace = /\\s/\n    let prev_whitespace = false\n    for (const c of text) {\n        const is_whitespace = whitespace.test(c)\n        if (!is_whitespace && prev_whitespace) {\n            res.unshift('')\n        }\n        res[0] += c\n        prev_whitespace = is_whitespace\n    }\n    res.reverse()\n    return res\n}\n\nabstract class TextualWindow extends WindowBase {\n    bg?: string\n    fg?: string\n    last_run_styles?: protocol.CSSProperties\n    styles?: protocol.WindowStyles\n\n    constructor(options: WindowConstructorOptions) {\n        super(options)\n\n        // We need the `this` object provided by jQuery, so we can't use an arrow function handler like we normally do\n        const onlink = (target: HTMLElement) => this.onlink(target)\n        this.frameel.on('click', 'a', function() {onlink(this)})\n\n        // Add stylehints\n        if (options.styles) {\n            this.styles = options.styles\n            this.add_stylehints()\n        }\n    }\n\n    /** Format CSS rules and add to the window */\n    add_stylehints() {\n        const windowid = `#window${this.id}`\n        const styles: protocol.WindowStyles = {}\n        if (this.styles) {\n            // Copy all the styles\n            for (const [selector, original_styles] of Object.entries(this.styles)) {\n                const full_selector = `${windowid} ${selector}`.trim()\n                const css_styles = styles[full_selector] = Object.assign({}, original_styles)\n\n                // Create a .reverse rule for when text runs are reverse mode\n                if (selector) {\n                    const bg = css_styles['background-color']\n                    const fg = css_styles.color\n                    if (bg || fg) {\n                        const reverse_styles: protocol.CSSProperties = styles[`${full_selector}.reverse`] = {}\n                        if (bg) {\n                            reverse_styles.color = bg\n                        }\n                        if (fg) {\n                            reverse_styles['background-color'] = fg\n                        }\n                    }\n\n                    // Monospace mode - handled in create_text_run\n                    delete css_styles.monospace\n\n                    // In reverse mode don't set colour styles\n                    if (css_styles.reverse) {\n                        delete css_styles['background-color']\n                        delete css_styles.color\n                    }\n                    delete css_styles.reverse\n\n                    // Check if we have any properties left\n                    if (Object.keys(css_styles).length === 0) {\n                        delete styles[full_selector]\n                    }\n                }\n            }\n\n            // Copy styles for the <input>\n            // May not play nice with reverse\n            if (styles[`${windowid} .Style_input`]) {\n                styles[`${windowid} .LineInput`] = styles[`${windowid} .Style_input`]\n            }\n        }\n\n        // Set window background colour, for normal and reverse mode\n        const normal_styles = styles[`${windowid} .Style_normal`]\n        const bg = this.bg || normal_styles?.['background-color']\n        const fg = this.fg || normal_styles?.color\n        if (bg || fg) {\n            if (!styles[windowid]) {\n                styles[windowid] = {}\n            }\n            styles[windowid]['background-color'] = bg || `var(--glkote-${this.type}-bg)`\n            styles[`${windowid}.reverse`] = {\n                'background-color': fg || `var(--glkote-${this.type}-reverse-bg)`,\n            }\n        }\n\n        // Finally output the styles\n        if (Object.keys(styles).length) {\n            this.frameel.children('style').remove()\n            this.frameel.prepend(`<style>${Object.entries(styles).map(rule => {\n                const [selector, properties] = rule\n                return `${selector} {${Object.entries(properties).map(property => {\n                    const [name, value] = property\n                    return `${name}: ${value}`\n                }).join('; ')}}`\n            }).join('\\n')}</style>`)\n        }\n    }\n\n    create_text_run(run: protocol.TextRun, split_words?: boolean): JQuery<HTMLElement> {\n        const run_style = run.style\n        // Is this run or this style monospace mode?\n        const monospace_val = run.css_styles?.monospace ?? this.styles?.[`.Style_${run_style}`]?.monospace\n        let monospace_class = ''\n        // Only add the class if we're changing the default font-family for this style\n        if (typeof monospace_val !== 'undefined') {\n            if (run_style === 'preformatted') {\n                if (!monospace_val) {\n                    monospace_class = ' proportional'\n                }\n            }\n            else if (monospace_val) {\n                monospace_class = ' monospace'\n            }\n        }\n        // Is this run or this style reverse mode?\n        const reverse = run.css_styles?.reverse ?? this.styles?.[`.Style_${run_style}`]?.reverse\n        // Create a template span and apply classes and styles\n        const el = create('span', `Style_${run_style}${reverse ? ' reverse' : ''}${monospace_class}`)\n        if (run.css_styles) {\n            apply_text_run_styles(run.css_styles, !!reverse, el)\n        }\n        // Split words if instructed to, or if this text run is monospaced\n        if (typeof split_words === 'undefined') {\n            split_words = !!monospace_val || run_style === 'preformatted'\n        }\n        const els = split_words\n            ? $(split_after_spaces(run.text).map(text => el.clone().text(text)[0]))\n            : el.text(run.text)\n        // Wrap in a link\n        if (run.hyperlink) {\n            return $('<a>', {\n                data: {\n                    glklink: run.hyperlink,\n                },\n                href: '#',\n            })\n                .append(els)\n        }\n        return els\n    }\n\n    onlink(target: HTMLElement) {\n        const linkval = $(target).data('glklink')\n        if (linkval) {\n            if (this.inputs?.hyperlink) {\n                this.manager.send_event({\n                    type: 'hyperlink',\n                    value: linkval,\n                    window: this.id,\n                })\n            }\n            return false\n        }\n    }\n\n    /** Refresh styles after a cleared window */\n    refresh_styles(bg?: string, fg?: string) {\n        let styles_need_refreshing\n        if (typeof bg !== 'undefined' && bg !== this.bg) {\n            this.bg = bg\n            styles_need_refreshing = 1\n        }\n        if (typeof fg !== 'undefined' && fg !== this.fg) {\n            this.fg = fg\n            styles_need_refreshing = 1\n        }\n        if (styles_need_refreshing) {\n            this.add_stylehints()\n        }\n    }\n}\n\nconst inline_alignment_classes: Record<string, string> = {\n    inlinecenter: 'ImageInlineCenter',\n    inlinedown: 'ImageInlineDown',\n    inlineup: 'ImageInlineUp',\n    marginleft: 'ImageMarginLeft',\n    marginright: 'ImageMarginRight',\n}\n\nexport class BufferWindow extends TextualWindow {\n    type = 'buffer' as const\n    /** How much height is available with the keyboard active */\n    height_above_keyboard: number\n    innerel: JQuery<HTMLElement>\n    private is_scrolled_down = true\n    lastline?: JQuery<HTMLElement>\n    updatescrolltop = 0\n\n    constructor(options: WindowConstructorOptions) {\n        super(options)\n        this.frameel.attr({\n            'aria-live': 'polite',\n            role: 'log',\n            tabindex: -1,\n        })\n            .on('scroll', this.onscroll)\n\n        if (is_iOS) {\n            disableBodyScroll(this.frameel[0])\n        }\n\n        this.innerel = create('div', 'BufferWindowInner')\n            .append(this.textinput.el)\n            .appendTo(this.frameel)\n        this.height_above_keyboard = this.frameel.height()!\n    }\n\n    destroy(remove_frame: boolean) {\n        if (is_iOS) {\n            enableBodyScroll(this.frameel[0])\n        }\n\n        super.destroy(remove_frame)\n    }\n\n    /** Measure the height of the window that is currently visible (excluding virtual keyboards for example) */\n    measure_height() {\n        this.height_above_keyboard = this.frameel.height()!\n    }\n\n    protected onclick(_: JQuery.ClickEvent) {\n        if (this.inputs?.type && no_text_selected()) {\n            // Check that we've scrolled to the bottom (if there is actually text in this window)\n            if (this.lastline && this.height_above_keyboard) {\n                const rect = this.lastline[0].getBoundingClientRect()\n                if (rect.bottom < 0 || rect.top > document.documentElement.clientHeight) {\n                    return false\n                }\n            }\n            this.textinput.el.trigger('focus')\n            return false\n        }\n    }\n\n    // When the frame element is scrolled, update whether it's scrolled to the bottom\n    private onscroll = () => {\n        const frameel = this.frameel[0]\n        this.is_scrolled_down = frameel.scrollHeight - frameel.scrollTop - frameel.clientHeight < 1\n    }\n\n    // Scroll to the bottom, unless `after_metrics_change` is set, in which case only scroll if we *should* be at the bottom (used after updating metrics)\n    scroll_to_bottom(after_metrics_change?: boolean) {\n        if (!after_metrics_change || this.is_scrolled_down) {\n            this.frameel.scrollTop(this.innerel.height()!)\n            this.is_scrolled_down = true\n        }\n    }\n\n    update(data: protocol.BufferWindowContentUpdate) {\n        if (data.clear) {\n            // Reset the text input before removing the window's buffer lines so that it won't be detached from the document (which would then remove its event handlers)\n            this.textinput.reset()\n            this.innerel.children('.BufferLine').remove()\n            this.is_scrolled_down = true\n            this.lastline = undefined\n            this.last_run_styles = undefined\n            this.refresh_styles(data.bg, data.fg)\n        }\n\n        // If the text field is missing, just do nothing\n        if (!data.text) {\n            return\n        }\n\n        // Tell ARIA that we're busy while we're updating the window\n        this.frameel.attr('aria-busy', 'true')\n\n        // Get the scrolltop for this update\n        this.updatescrolltop = Math.max(0, (this.lastline?.position().top || 0) - 20)\n\n        let line_index = 0\n        while (line_index < data.text.length) {\n            const line = data.text[line_index++]\n            const content = line.content\n            let divel: JQuery<HTMLElement> | undefined\n            let line_has_style\n            if (line.append && this.lastline) {\n                divel = this.lastline\n                line_has_style = 1\n            }\n            else {\n                divel = create('div', 'BufferLine')\n                this.innerel.append(divel)\n                this.lastline = divel\n                if (!content?.length) {\n                    divel.addClass('BlankPara')\n                    divel.append(create('span', 'BlankLineSpace').text(NBSP))\n                    continue\n                }\n            }\n            if (line.flowbreak) {\n                divel.addClass('FlowBreak')\n            }\n\n            if (!content?.length) {\n                continue\n            }\n            for (let run_index = 0; run_index < content.length; run_index++) {\n                let run: protocol.TextRun\n                const instruction = content[run_index]\n                if (typeof instruction === 'string') {\n                    run = {\n                        style: content[run_index++] as string,\n                        text: content[run_index] as string,\n                    }\n                }\n                else if ('special' in instruction && instruction.special === 'image') {\n                    const el = $('<img>', {\n                        alt: instruction.alttext || `Image ${instruction.image}`,\n                        class: inline_alignment_classes[instruction.alignment || 'inlineup'],\n                        height: instruction.height,\n                        src: this.blorb && this.blorb.get_image_url(instruction.image!) || instruction.url!,\n                        width: instruction.width,\n                    })\n                    if (instruction.hyperlink) {\n                        $('<a>', {\n                            data: {\n                                glklink: instruction.hyperlink,\n                            },\n                            href: '#',\n                        })\n                            .append(el)\n                            .appendTo(divel)\n                        continue\n                    }\n                    divel.append(el)\n                    continue\n                }\n                else {\n                    run = instruction as protocol.TextRun\n                }\n                if (!line_has_style) {\n                    line_has_style = 1\n                    divel.addClass(`Style_${run.style}_par`)\n                }\n                divel.append(this.create_text_run(run, line_index === data.text.length ? true : undefined))\n                // Store the last text run for setting styles in the input\n                this.last_run_styles = run.css_styles\n            }\n        }\n\n        // Scroll down\n        if (!is_pinch_zoomed()) {\n            this.frameel.scrollTop(this.updatescrolltop)\n        }\n\n        // TODO: Trim log?\n\n        this.frameel.attr('aria-busy', 'false')\n    }\n}\n\nexport class GraphicsWindow extends WindowBase {\n    type = 'graphics' as const\n    buffer: JQuery<HTMLCanvasElement>\n    canvas: JQuery<HTMLCanvasElement>\n    fillcolour = ''\n    framequeue: protocol.GraphicsWindowOperation[][] = []\n    /** Height in CSS pixels */\n    height = 0\n    image_cache: Map<number | string, HTMLImageElement> = new Map()\n    /** Width in CSS pixels */\n    width = 0\n\n    constructor(options: WindowConstructorOptions) {\n        super(options)\n        // Create the canvas\n        this.canvas = this.dom.create('canvas', `win${options.id}_canvas`, {\n            data: {\n                window: this,\n            },\n        }) as JQuery<HTMLCanvasElement>\n        this.frameel.append(this.canvas)\n        this.manager.canvasResizeObserver?.observe(this.canvas[0])\n\n        // And a buffer canvas to reduce flicker\n        this.buffer = this.dom.create('canvas', `win${options.id}_buffer`) as JQuery<HTMLCanvasElement>\n    }\n\n    // Clear the image cache 5 seconds after the last frame, so that the cache can be useful for animations, but we don't waste memory for images which are only updated each turn\n    clear_cache = debounce(() => {\n        this.image_cache.clear()\n    }, 5000)\n\n    // Decode and cache an image\n    decode_image(key: number | string, url: string): Promise<void> {\n        const image = new Image()\n        image.src = url\n        return image.decode()\n            .then(() => {\n                this.image_cache.set(key, image)\n            })\n            .catch(() => {})\n    }\n\n    destroy(remove_frame: boolean) {\n        this.manager.canvasResizeObserver?.unobserve(this.canvas[0])\n        super.destroy(remove_frame)\n    }\n\n    onclick(ev: JQuery.ClickEvent) {\n        if (this.inputs?.mouse && ev.button === 0) {\n            this.inputs.mouse = false\n            this.manager.send_event({\n                type: 'mouse',\n                window: this.id,\n                x: Math.floor(ev.offsetX - this.metrics.graphicsmarginx / 2),\n                y: Math.floor(ev.offsetY - this.metrics.graphicsmarginy / 2),\n            })\n            return false\n        }\n        return super.onclick(ev)\n    }\n\n    set_dimensions(height: number, width: number) {\n        // First set the things which use CSS pixels\n        this.canvas.css({height, width})\n        this.height = height\n        this.width = width\n        // Then the canvas dimensions using devicePixelRatio\n        const dPR = devicePixelRatio\n        height = height * dPR\n        width = width * dPR\n        this.buffer.attr({height, width})\n        this.canvas.attr({height, width})\n        // The resize observer will handle setting true pixel sizes if supported\n    }\n\n    // This function is async because images must be loaded asynchrounously, and each operation painted in sequence, but the rest of GlkOte doesn't need to await it\n    async update() {\n        const buffercontext = this.buffer[0].getContext('2d')!\n\n        // If we're slow loading images then more than one frame may have arrived, so go through the queue now\n        for (let i = 0; i < this.framequeue.length; i++) {\n            const frame = this.framequeue[i]\n\n            // Stop if the window is collapsed\n            if (!this.height || !this.width) {\n                break\n            }\n            // There shouldn't be any empty frames, but check just in case\n            if (!frame.length) {\n                continue\n            }\n\n            // Preload images\n            const loading_images = []\n            for (const op of frame) {\n                if (op.special === 'image') {\n                    const key = op.url || op.image!\n                    if (this.image_cache.has(key)) {\n                        continue\n                    }\n                    const url = op.url || this.blorb && this.blorb.get_image_url(op.image!)\n                    if (url) {\n                        loading_images.push(this.decode_image(key, url))\n                    }\n                }\n            }\n            await Promise.all(loading_images)\n\n            const dPR = devicePixelRatio\n            for (const op of frame) {\n                switch (op.special) {\n                    case 'fill':\n                        buffercontext.fillStyle = op.color || this.fillcolour\n                        if (Number.isFinite(op.x)) {\n                            buffercontext.fillRect(op.x! * dPR, op.y! * dPR, op.width! * dPR, op.height! * dPR)\n                        }\n                        else {\n                            buffercontext.fillRect(0, 0, parseInt(this.buffer.attr('width')!), parseInt(this.buffer.attr('height')!))\n                        }\n                        break\n                    case 'image': {\n                        const image = this.image_cache.get(op.url || op.image!)\n                        if (image) {\n                            buffercontext.drawImage(image, op.x * dPR, op.y * dPR, op.width * dPR, op.height * dPR)\n                        }\n                        break\n                    }\n                    case 'setcolor':\n                        this.fillcolour = op.color\n                        break\n                }\n            }\n        }\n        // Now that all operations/frames are finished, draw the buffer to the main canvas (as long as it hasn't been collapsed)\n        if (this.height && this.width) {\n            this.canvas[0].getContext('2d')!.drawImage(this.buffer[0], 0, 0)\n        }\n\n        // Empty the queue\n        this.framequeue.length = 0\n        // And queue the cache to be cleared, if more frames don't arrive soon\n        this.clear_cache()\n    }\n}\n\nclass GridWindow extends TextualWindow {\n    type = 'grid' as const\n    height = 0\n    lines: JQuery<HTMLElement>[] = []\n    width = 0\n\n    constructor(options: WindowConstructorOptions) {\n        super(options)\n        this.frameel.attr({\n            'aria-atomic': 'true',\n            'aria-live': 'off',\n            role: 'status',\n        })\n    }\n\n    onclick(ev: JQuery.ClickEvent) {\n        if (this.inputs?.mouse && ev.button === 0 && no_text_selected()) {\n            this.inputs.mouse = false\n            this.manager.send_event({\n                type: 'mouse',\n                window: this.id,\n                x: Math.floor((ev.offsetX - this.metrics.gridmarginx / 2) / this.metrics.gridcharwidth),\n                y: Math.floor((ev.offsetY - this.metrics.gridmarginy / 2) / this.metrics.gridcharheight),\n            })\n            return false\n        }\n        return super.onclick(ev)\n    }\n\n    update(data: protocol.GridWindowContentUpdate) {\n        if (data.clear) {\n            this.last_run_styles = undefined\n            this.refresh_styles(data.bg, data.fg)\n        }\n\n        // Tell ARIA that we're busy while we're updating the window\n        this.frameel.attr('aria-busy', 'true')\n\n        for (const line of data.lines) {\n            const lineel = this.lines[line.line]\n            if (!lineel.length) {\n                throw new Error(`Got content for nonexistent line ${line.line} of window ${this.id}`)\n            }\n\n            const content = line.content\n            if (!content || !content.length) {\n                lineel.text(NBSP)\n            }\n            else {\n                lineel.empty()\n                for (let i = 0; i < content.length; i++) {\n                    let run: protocol.TextRun\n                    if (typeof content[i] === 'string') {\n                        run = {\n                            style: content[i++] as string,\n                            text: content[i] as string,\n                        }\n                    }\n                    else {\n                        run = content[i] as protocol.TextRun\n                    }\n                    lineel.append(this.create_text_run(run, false))\n                    // Store the last text run for setting styles in the input\n                    this.last_run_styles = run.css_styles\n                }\n            }\n        }\n\n        // Apply the class of 'reverse' to the window if all the text in it is reversed\n        this.frameel.toggleClass('reverse', $(`#window${this.id} span:not(.reverse)`).length === 0)\n\n        // If there are more than 4 lines, set aria-live to polite\n            .attr({\n                'aria-busy': 'false',\n                'aria-live': this.lines.length > 3 ? 'polite' : 'off',\n            })\n    }\n}\n\nconst window_classes: Record<string, new (opt: WindowConstructorOptions) => Window> = {\n    buffer: BufferWindow,\n    graphics: GraphicsWindow,\n    grid: GridWindow,\n}\n\nconst window_types: Record<string, string> = {\n    buffer: 'BufferWindow',\n    graphics: 'GraphicsWindow',\n    grid: 'GridWindow',\n}\n\nexport default class Windows extends Map<number, Window> {\n    active_window?: Window\n    blorb?: Blorb // Note will be set after this is constructed, in WebGlkOte.init\n    canvasResizeObserver?: ResizeObserver // Will only be created if the browser's ResizeObserver supports devicePixelContentBoxSize\n    private dom: DOM\n    glkote: WebGlkOte\n    history: string[] = []\n    private metrics: protocol.NormalisedMetrics\n    send_event: EventFunc\n\n    constructor(glkote: WebGlkOte) {\n        super()\n        this.dom = glkote.dom\n        this.glkote = glkote\n        this.metrics = glkote.current_metrics\n        if (window.ResizeObserver) {\n            // We can use a ResizeObserver to get true pixel dimensions for canvases, but it's not supported in all browsers, so test\n            const testRO = new ResizeObserver((entries) => {\n                if (typeof entries?.[0].devicePixelContentBoxSize?.[0].blockSize !== 'undefined') {\n                    this.canvasResizeObserver = new ResizeObserver((entries: ResizeObserverEntry[]) => this.oncanvasresize(entries))\n                }\n                testRO.disconnect()\n            })\n            testRO.observe(document.body)\n        }\n        this.send_event = ev => glkote.send_event(ev)\n\n        $(document).on('keydown', this.onkeydown)\n        this.dom.gameport().on('click', () => this.onclick())\n    }\n\n    // Clean up after a GlkOte.exit() call, but don't empty the HTML\n    destroy() {\n        for (const win of this.values()) {\n            win.destroy(false)\n            this.delete(win.id)\n        }\n        $(document).off('keydown', this.onkeydown)\n    }\n\n    cancel_inputs(windows: protocol.InputUpdate[]) {\n        const newinputs: Record<number, protocol.InputUpdate> = {}\n        for (const window of windows) {\n            newinputs[window.id] = window\n        }\n\n        for (const win of this.values()) {\n            const update = newinputs[win.id]\n            if (!update && win.inputs) {\n                if (win.textinput.el.is(':focus')) {\n                    this.active_window = win\n                }\n                win.textinput.el.prop('disabled', true)\n                delete win.inputs\n            }\n        }\n    }\n\n    // Use a resize observer to set true pixel sizes on graphics windows\n    private oncanvasresize(entries: ResizeObserverEntry[]) {\n        for (const entry of entries) {\n            const box = entry.devicePixelContentBoxSize![0]\n            const height = box.blockSize\n            const width = box.inlineSize\n            const win: GraphicsWindow = $(entry.target).data('window')\n            win.buffer.attr({height, width})\n            win.canvas.attr({height, width})\n        }\n        this.send_event({type: 'redraw'})\n    }\n\n    // If the gameport receives a click event, then find one window with active text input to focus\n    private onclick() {\n        if (!this.glkote.disabled && no_text_selected()) {\n            for (const window of this.values()) {\n                if (window.inputs?.type) {\n                    window.frameel.trigger('click')\n                    break\n                }\n            }\n        }\n    }\n\n    // On document.keypress events, redirect to a window\n    private onkeydown = (ev: JQuery.KeyDownEvent) => {\n        // Don't fire on inputs or focused buffer windows\n        if (!this.glkote.disabled && ev.target.nodeName !== 'input' && !(ev.target.nodeName === 'div' && $(ev.target).is('.BufferWindow:focus'))) {\n            // Look first for a window with active text input, but as a fallback any buffer window\n            const windows = [...this.values()]\n            const window = windows.filter(win => win.inputs?.type)[0] || windows.filter(win => win.type === 'buffer')[0]\n            if (window) {\n                window.frameel.trigger('click')\n                // After focusing, the keypress event will fire, but not the keydown, meaning that function keys won't be recognised\n                // So manually trigger the keydown event in the input (as long as it is actually focused)\n                if (window.textinput.el.is(':focus')) {\n                    window.textinput.el.trigger(ev)\n                }\n                // Otherwise focus the window so that nav keys will work\n                else if (window.type === 'buffer') {\n                    window.frameel.trigger('focus')\n                }\n            }\n        }\n    }\n\n    update(windows: protocol.WindowUpdate[]) {\n        // Mark all windows as non-desired\n        for (const win of this.values()) {\n            win.desired = false\n        }\n\n        // Go through each window in this update\n        for (const update of windows) {\n            const id = update.id\n            const type = update.type\n\n            // Is there an existing window?\n            let win = this.get(id)\n\n            // Create it if not\n            if (!win) {\n                win = new (window_classes[type])({\n                    blorb: this.blorb,\n                    dom: this.dom,\n                    id,\n                    manager: this,\n                    metrics: this.metrics,\n                    rock: update.rock,\n                    styles: update.styles,\n                    type,\n                })\n                this.set(id, win)\n            }\n            else {\n                if (win.type !== type) {\n                    throw new Error(`Window ${id} was created with type ${win.type}, but now is described as type ${type}`)\n                }\n            }\n            win.desired = true\n\n            // Ensure graphics windows are the right size\n            if (win.type === 'graphics') {\n                if (win.height !== update.graphheight || win.width !== update.graphwidth) {\n                    win.set_dimensions(update.graphheight!, update.graphwidth!)\n                }\n            }\n\n            // Ensure grid windows have the right number of lines\n            if (win.type === 'grid') {\n                if (update.gridheight! > win.height) {\n                    for (let i = win.height; i < update.gridheight!; i++) {\n                        const line = this.dom.create('div', `win${win.id}_ln${i}`, 'GridLine')\n                        line.append(NBSP)\n                        win.frameel.append(line)\n                        win.lines[i] = line\n                    }\n                }\n                if (update.gridheight! < win.height) {\n                    for (let i = update.gridheight!; i < win.height; i++) {\n                        this.dom.id(`win${win.id}_ln${i}`).remove()\n                    }\n                }\n                win.height = update.gridheight!\n                win.lines.length = win.height\n                win.width = update.gridwidth!\n            }\n\n            // Update the position of the window\n            win.frameel.css({\n                height: update.height,\n                left: update.left,\n                top: update.top,\n                width: update.width,\n            })\n                .toggleClass('hidden', !!update.hidden)\n            if (win.type === 'buffer') {\n                win.scroll_to_bottom(true)\n            }\n        }\n\n        const windowstoclose: Window[] = []\n        for (const win of this.values()) {\n            if (!win.desired) {\n                windowstoclose.push(win)\n            }\n        }\n        for (const win of windowstoclose) {\n            win.destroy(true)\n            this.delete(win.id)\n        }\n    }\n\n    update_content(content: protocol.ContentUpdate[]) {\n        for (const update of content) {\n            const win = this.get(update.id)\n            if (!win) {\n                throw new Error(`Got content update for window ${update.id}, which does not exist`)\n            }\n            // TODO: check for pending line input\n\n            switch (win.type) {\n                case 'buffer': win.update(update as protocol.BufferWindowContentUpdate); break\n                case 'graphics':\n                    // Queue this frame, but only run the update function if this is the only frame\n                    win.framequeue.push((update as protocol.GraphicsWindowContentUpdate).draw)\n                    if (win.framequeue.length === 1) {\n                        win.update()\n                    }\n                    break\n                case 'grid': win.update(update as protocol.GridWindowContentUpdate); break\n            }\n        }\n    }\n\n    update_inputs(windows: protocol.InputUpdate[]) {\n        for (const update of windows) {\n            const win = this.get(update.id)\n            if (!win) {\n                throw new Error(`Got input update for window ${update.id}, which does not exist`)\n            }\n\n            const oldgen = win.inputs?.gen\n            win.inputs = update\n            if (update.type){\n                if (update.gen !== oldgen) {\n                    win.textinput.update()\n                }\n            }\n        }\n\n        // Refocus an <input>\n        // On Android this forces the window to be scrolled down to the bottom, so only refocus if the virtual keyboard doesn't make the window too small for the full update text to be seen\n        if (this.active_window) {\n            // Refocus the same window if it hasn't been deleted and still wants input\n            if (this.has(this.active_window.id) && this.active_window.inputs?.type) {\n                this.active_window.textinput.refocus()\n            }\n            // Look for any window with text input\n            else {\n                [...this.values()].filter(win => win.inputs?.type)[0]?.textinput.refocus()\n            }\n        }\n    }\n}", "/*\n\nGlkOte transcript recording handler\n===================================\n\nCopyright (c) 2022 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport * as protocol from '../../common/protocol.js'\nimport type {GlkOteOptions, TranscriptRecordingData} from '../common/glkote.js'\n\nimport Windows from './windows.js'\n\nexport default class TranscriptRecorder {\n    enabled = false\n    handler: (state: TranscriptRecordingData) => void = state => this.web_handler(state)\n    event?: Partial<protocol.Event>\n    label = ''\n    session = Date.now() + Math.ceil(Math.random() * 10000).toString(16)\n    timestamp?: number\n    url = ''\n    private windows: Windows\n\n    constructor(options: GlkOteOptions, windows: Windows) {\n        this.windows = windows\n        if (options.recording_handler) {\n            this.enabled = true\n            this.handler = options.recording_handler\n            this.url = '(custom handler)'\n        }\n        if (options.recording_url) {\n            this.enabled = true\n            this.url = options.recording_url\n        }\n        this.label = options.recording_label ?? ''\n        if (this.enabled) {\n            console.log(`Transcript recording active: session ${this.session} \"${this.label}\", destination ${this.url}`)\n        }\n    }\n\n    // Store the event for later\n    record_event(ev: Partial<protocol.Event>) {\n        this.event = ev\n        this.timestamp = Date.now()\n    }\n\n    // Record an event-output pair\n    record_update(state: protocol.StateUpdate) {\n        if (!state.content) {\n            return\n        }\n\n        // Check the event type\n        const event = this.event!\n        const eventtype = event.type\n        let input = ''\n        if (eventtype === 'char' || eventtype === 'line') {\n            input = (event as protocol.CharEvent | protocol.LineEvent).value\n        }\n        else if (!(!eventtype || eventtype === 'external' || eventtype === 'init' || eventtype === 'specialresponse')) {\n            return\n        }\n\n        // Collect the buffer window outputs\n        let output = ''\n        for (const update of state.content) {\n            const win = this.windows.get(update.id)\n            if (!win || win.type !== 'buffer') {\n                continue\n            }\n            const textdata = (update as protocol.BufferWindowContentUpdate).text || []\n            for (const data of textdata) {\n                if (!data.append) {\n                    output += '\\n'\n                }\n                const content = data.content\n                if (!content?.length) {\n                    continue\n                }\n                for (let run_index = 0; run_index < content.length; run_index++) {\n                    const instruction = content[run_index]\n                    if (typeof instruction === 'string') {\n                        output += content[++run_index]\n                    }\n                    else if ('text' in instruction) {\n                        output += instruction.text\n                    }\n                }\n            }\n        }\n\n        this.handler({\n            format: 'simple',\n            input,\n            label: this.label,\n            output,\n            outtimestamp: Date.now(),\n            sessionId: this.session,\n            timestamp: this.timestamp!,\n        })\n    }\n\n    async web_handler(state: TranscriptRecordingData) {\n        try {\n            const response = await fetch(this.url, {\n                body: JSON.stringify(state),\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                method: 'POST',\n            })\n\n            if (!response.ok) {\n                throw new Error(`Could not submit transcript update, got ${response.status}`)\n            }\n        }\n        catch (err: any) {\n            this.enabled = false\n            console.log(`Transcript recording failed; disabling. Error: ${err as Error}`)\n        }\n    }\n}", "/*\n\nWeb GlkOte implementation\n=========================\n\nCopyright (c) 2023 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/asyncglk\n\n*/\n\nimport * as GlkOte from '../common/glkote.js'\nimport * as protocol from '../../common/protocol.js'\n\nimport Metrics from './metrics.js'\nimport {SoundChannelManager} from './schannels.js'\nimport {DOM, is_iOS} from './shared.js'\nimport TranscriptRecorder from './transcript-recorder.js'\nimport Windows, {GraphicsWindow} from './windows.js'\n\ninterface AutosaveState {\n    graphics_bg?: Array<[number, string]>,\n    history?: Array<string>,\n    transcript_recorder_session?: string,\n}\n\n/** A GlkOte implementation for the web\n * \n * WebGlkOte requires the following HTML divs to be present (though the id names can be varied through the options):\n * \n * ```\n *     <div id=\"gameport\">\n *         <div id=\"windowport\"></div>\n *         <div id=\"loadingpane\">Loading...</div>\n *         <div id=\"errorpane\" style=\"display:none;\"><div id=\"errorcontent\"></div></div>\n *     </div>\n * ```\n */\nexport default class WebGlkOte extends GlkOte.GlkOteBase implements GlkOte.GlkOte {\n    dom: DOM = new DOM({\n        context_element: undefined,\n        errorcontent_id: 'errorcontent',\n        errorpane_id: 'errorpane',\n        gameport_id: 'gameport',\n        loadingpane_id: 'loadingpane',\n        prefix: '',\n        windowport_id: 'windowport',\n    })\n    metrics_calculator: Metrics\n    private schannels?: SoundChannelManager\n    private showing_error = false\n    private showing_loading = true\n    private transcript_recorder?: TranscriptRecorder\n    private windows: Windows\n\n    constructor() {\n        super()\n\n        this.metrics_calculator = new Metrics(this)\n        this.windows = new Windows(this)\n    }\n\n    async init(options: GlkOte.GlkOteOptions) {\n        try {\n            if (!options) {\n                throw new Error('no options provided')\n            }\n\n            if (typeof jQuery === 'undefined') {\n                throw new Error('jQuery is not loaded')\n            }\n\n            // Set DOM IDs\n            if (options.dom_prefix) {\n                this.dom.prefix = options.dom_prefix\n            }\n            if (options.errorcontent) {\n                this.dom.errorcontent_id = options.errorcontent\n            }\n            if (options.errorpane) {\n                this.dom.errorpane_id = options.errorpane\n            }\n            if (options.gameport) {\n                this.dom.gameport_id = options.gameport\n            }\n            if (options.loadingpane) {\n                this.dom.loadingpane_id = options.loadingpane\n            }\n            if (options.windowport) {\n                this.dom.windowport_id = options.windowport\n            }\n\n            if (options.Blorb) {\n                this.windows.blorb = options.Blorb\n            }\n\n            // The windowport is required to already exist\n            const windowport = this.dom.windowport()\n            if (!windowport.length) {\n                throw new Error(`Cannot find windowport element #${this.dom.windowport_id}`)\n            }\n            windowport.empty()\n\n            // Augment the viewport meta tag\n            // Rather than requiring all users to update their HTML we will add new properties here\n            // The properties we want are initial-scale, minimum-scale, width, and the new interactive-widget\n            // See https://developer.chrome.com/blog/viewport-resize-behavior\n            let viewport_meta_tag_content = 'initial-scale=1,interactive-widget=resizes-content,minimum-scale=1,width=device-width'\n\n            // Prevent iOS from zooming in when focusing input, but allow Android to still pinch zoom\n            // As they handle the maximum-scale viewport meta option differently, we will conditionally add it only in iOS\n            // Idea from https://stackoverflow.com/a/62750441/2854284\n            if (is_iOS) {\n                viewport_meta_tag_content += ',maximum-scale=1'\n            }\n\n            (document.head.querySelector('meta[name=\"viewport\"]')! as HTMLMetaElement).content = viewport_meta_tag_content\n\n            await this.metrics_calculator.measure()\n\n            // Set up transcript recording\n            if (options.recording_url || options.recording_handler) {\n                if (options.recording_format && options.recording_format !== 'simple') {\n                    console.warn('GlkOte: only the \"simple\" recording_format is supported')\n                }\n                else {\n                    // Check if the user has opted out\n                    const query_feedback = (new URLSearchParams(document.location.search)).get('feedback')\n                    const cookie_name = options.recording_cookie || 'transcript_recording_opt_out'\n                    if ((query_feedback && query_feedback !== '1') || document.cookie.includes(`${cookie_name}=1`)) {\n                        console.log('User has opted out of transcript recording.')\n                    }\n                    else {\n                        this.transcript_recorder = new TranscriptRecorder(options, this.windows)\n                    }\n                }\n            }\n\n            // Set up sound channels now to try to avoid the autoplaying-without-user input problem\n            if (typeof AudioContext !== 'undefined') {\n                this.schannels = new SoundChannelManager(this)\n            }\n\n            // Note that this must be called last as it will result in VM.start() being called\n            return super.init(options)\n        }\n        catch (err) {\n            this.error(err as Error)\n        }\n    }\n\n    protected autorestore(data: AutosaveState) {\n        // erkyrath/glkote history is an object rather than an array\n        if (Array.isArray(data.history)) {\n            this.windows.history = data.history\n        }\n\n        for (const win of this.windows.values()) {\n            // Scroll all buffer windows\n            if (win.type === 'buffer') {\n                win.scroll_to_bottom()\n            }\n        }\n\n        if (data.graphics_bg) {\n            for (const [winid, colour] of data.graphics_bg) {\n                (this.windows.get(winid) as GraphicsWindow).fillcolour = colour\n            }\n        }\n\n        if (data.transcript_recorder_session && this.transcript_recorder) {\n            this.transcript_recorder.session = data.transcript_recorder_session\n            console.log(`Resuming autosaved transcript recording session: ${data.transcript_recorder_session}`)\n        }\n\n        // Always send a rearrange event after autorestoring\n        setTimeout(() => this.send_event({type: 'arrange'}), 0)\n    }\n\n    protected cancel_inputs(windows: protocol.InputUpdate[]) {\n        this.windows.cancel_inputs(windows)\n    }\n\n    protected capabilities(): string[] {\n        const capabilities = [\n            'garglktext',\n            'graphics',\n            'graphicswin',\n            'hyperlinks',\n            'timer',\n        ]\n        if (typeof AudioContext !== 'undefined') {\n            capabilities.push('sounds')\n        }\n        return capabilities\n    }\n\n    protected disable(disable: boolean) {\n        for (const win of this.windows.values()) {\n            win.textinput.el.prop('disabled', disable || !win.inputs?.type)\n        }\n        this.disabled = disable\n    }\n\n    private embellish_error() {\n        if (typeof $ === 'undefined') {\n            return\n        }\n\n        const errorpane = $(`#${this.dom.errorpane_id}`)\n\n        // Add close button\n        if (!errorpane.find('#errorclose').length) {\n            $('<button>', {\n                'aria-label': 'Close',\n                click: () => {\n                    errorpane.hide()\n                    return false\n                },\n                id: 'errorclose',\n                text: '\u2716',\n                type: 'button',\n            })\n                .appendTo(errorpane)\n        }\n\n        // If autorestoring, add a link to restart after clearing the autosave\n        // TODO: fix for AsyncDialog\n        if (this.autorestoring && !this.Dialog?.async && this.Dialog?.autosave_clear) {\n            const link = $('<a>', {\n                click: async () => {\n                    if (!this.Dialog!.async) {\n                        await this.Dialog!.autosave_clear!()\n                    }\n                    location.reload()\n                },\n                text: 'Clear autosave and restart',\n            })\n            $('<div>')\n                .append(link)\n                .appendTo(errorpane)\n        }\n    }\n\n    error(error: Error | string) {\n        error ??= '???'\n        let msg: string\n        if (typeof error === 'string') {\n            msg = error\n            error = new Error(error)\n        }\n        else {\n            msg = error.toString()\n        }\n\n        // Don't use jQuery, because this is called if jQuery isn't present\n        const errorcontent = document.getElementById(this.dom.errorcontent_id)\n        if (!errorcontent) {\n            throw new Error(msg)\n        }\n        errorcontent.innerHTML = msg\n\n        const errorpane = document.getElementById(this.dom.errorpane_id)!\n        if (errorpane.className === 'WarningPane') {\n            errorpane.className = ''\n        }\n\n        this.embellish_error()\n\n        errorpane.style.display = ''\n        this.showing_error = true\n        this.hide_loading()\n        console.error(error)\n    }\n\n    protected exit() {\n        // Try to clean up and remove any event handlers\n        this.metrics_calculator.destroy()\n        this.windows.destroy()\n    }\n\n    getdomcontext(): HTMLElement | undefined {\n        return this.dom.context_element\n    }\n\n    getdomid(name: string): string {\n        switch (name) {\n            case 'errorcontent': return this.dom.errorcontent_id\n            case 'errorpane': return this.dom.errorpane_id\n            case 'gameport': return this.dom.gameport_id\n            case 'loadingpane': return this.dom.loadingpane_id\n            case 'windowport': return this.dom.windowport_id\n            default: return name\n        }\n    }\n\n    private hide_loading() {\n        if (!this.showing_loading) {\n            return\n        }\n        this.showing_loading = false\n\n        // Don't use jQuery because this could be called from error()\n        const loadingpane = document.getElementById(this.dom.loadingpane_id)\n        if (loadingpane) {\n            loadingpane.style.display = 'none'\n        }\n    }\n\n    save_allstate(): AutosaveState {\n        const graphics_bg: Array<[number, string]> = []\n        for (const win of this.windows.values()) {\n            if (win.type === 'graphics') {\n                graphics_bg.push([win.id, win.fillcolour])\n            }\n        }\n\n        return {\n            graphics_bg,\n            history: this.windows.history,\n            transcript_recorder_session: this.transcript_recorder?.session,\n        }\n    }\n\n    // Send partial line input values\n    send_event(ev: Partial<protocol.Event>) {\n        if (ev.type !== 'init' && ev.type !== 'refresh' && ev.type !== 'specialresponse') {\n            for (const win of this.windows.values()) {\n                if (win.inputs?.type) {\n                    const val = win.textinput.el.val() as string\n                    if (val) {\n                        if (!ev.partial) {\n                            ev.partial = {}\n                        }\n                        ev.partial[win.id] = val\n                    }\n                }\n            }\n        }\n        if (this.transcript_recorder?.enabled) {\n            this.transcript_recorder.record_event(ev)\n        }\n        super.send_event(ev)\n    }\n\n    setdomcontext(val: HTMLElement) {\n        this.dom.context_element = val\n    }\n\n    protected set_page_bg(colour: string) {\n        $('body').css('background-color', colour)\n    }\n\n    update(data: protocol.Update) {\n        if (this.showing_loading) {\n            this.hide_loading()\n        }\n        super.update(data)\n        if (this.transcript_recorder?.enabled && data.type === 'update' && !data.autorestore) {\n            this.transcript_recorder.record_update(data)\n        }\n    }\n\n    protected update_content(content: protocol.ContentUpdate[]) {\n        this.windows.update_content(content)\n    }\n\n    protected update_inputs(windows: protocol.InputUpdate[]) {\n        this.windows.update_inputs(windows)\n    }\n\n    protected update_schannels(schannels: protocol.SoundChannelUpdate[]) {\n        this.schannels?.update(schannels)\n    }\n\n    protected update_windows(windows: protocol.WindowUpdate[]) {\n        this.windows.update(windows)\n    }\n\n    warning(msg: any) {\n        // Don't show warnings if an error is already being shown\n        if (this.showing_error) {\n            return\n        }\n\n        const errorpane = $(`#${this.dom.errorpane_id}`)\n\n        // Hide a warning\n        if (!msg) {\n            errorpane.hide()\n            return\n        }\n\n        const errorcontent = document.getElementById(this.dom.errorcontent_id)\n        if (!errorcontent) {\n            console.warn(msg)\n            return\n        }\n        errorcontent.innerHTML = msg\n\n        this.embellish_error()\n\n        errorpane.addClass('WarningPane')\n        errorpane.show()\n        this.hide_loading()\n    }\n}", "{\"bocfel.wasm\":{\"size\":2222183,\"gz\":594380},\"git.wasm\":{\"size\":1580689,\"gz\":500691},\"glulxe.wasm\":{\"size\":1577631,\"gz\":497790},\"hugo.wasm\":{\"size\":991015,\"gz\":305628},\"scare.wasm\":{\"size\":1655133,\"gz\":491453},\"tads.wasm\":{\"size\":3848737,\"gz\":1111038},\"glkaudio_bg.wasm\":{\"size\":556140,\"gz\":295809}}", "/*\n\nFormat specifications\n=====================\n\nCopyright (c) 2024 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/parchment\n\n*/\n\nimport {Blorb} from '../upstream/asyncglk/src/index-common.js'\n\nimport type {ParchmentOptions, StoryOptions} from './interface.js'\n\nexport interface Engine {\n    id: string\n    load: string[]\n    start: (story: StoryOptions, options: ParchmentOptions, requires: any) => void\n}\n\nexport interface Format {\n    blorbable?: boolean\n    engines?: Engine[]\n    extensions: RegExp\n    id: string\n}\n\nasync function generic_emglken_vm(story: StoryOptions, options: ParchmentOptions, requires: [any, Uint8Array]) {\n    const [engine, wasmBinary] = requires\n\n    const vm_options = Object.assign({}, options, {\n        arguments: [story.path],\n    })\n\n    const vm = await engine.default({wasmBinary})\n    vm.start(vm_options)\n}\n\nexport const formats: Format[] = [\n    {\n        id: 'blorb',\n        extensions: /\\.(blb|blorb)/i,\n    },\n\n    {\n        id: 'adrift4',\n        extensions: /\\.taf/i,\n        engines: [\n            {\n                id: 'scare',\n                load: ['scare.js', 'scare.wasm'],\n                start: generic_emglken_vm,\n            },\n        ],\n    },\n\n    /*{\n        id: 'adrift5',\n        blorbable: true,\n        extensions: /\\.(blb|blorb)/i,\n        engines: [\n            {\n                id: 'frankendrift',\n                load: ['frankendrift.js'],\n                start: (options, requires) => {\n                    const [file_data, FrankenDrift] = requires\n\n                    const vm = new FrankenDrift.FrankenDrift()\n                    const vm_options = Object.assign({}, options, {\n                        vm,\n                        Glk,\n                    })\n\n                    vm.init(file_data, vm_options)\n                    Glk.init(vm_options)\n                },\n            },\n        ],\n    },*/\n\n    {\n        id: 'hugo',\n        extensions: /\\.hex/i,\n        engines: [\n            {\n                id: 'hugo',\n                load: ['hugo.js', 'hugo.wasm'],\n                start: generic_emglken_vm,\n            },\n        ],\n    },\n\n    {\n        id: 'glulx',\n        blorbable: true,\n        extensions: /\\.(gblorb|glb|ulx)/i,\n        engines: [\n            /*{\n                id: 'quixe',\n                load: ['quixe.js'],\n                start: (_story: StoryOptions, options, requires) =>\n                {\n                    const [file_data, quixe] = requires\n                    const data_array = file_data\n\n                    const vm_options = Object.assign({}, options, {\n                        blorb_gamechunk_type: 'GLUL',\n                        GiDispa: new quixe.GiDispa(),\n                        GiLoad: quixe.GiLoad,\n                        image_info_map: 'StaticImageInfo',\n                        io: options.Glk,\n                        set_page_title: 0,\n                        spacing: 0,\n                        use_query_story: 0,\n                        vm: quixe.Quixe,\n                    })\n\n                    quixe.GiLoad.load_run(vm_options, data_array, 'array')\n                },\n            },*/\n\n            {\n                id: 'glulxe',\n                load: ['glulxe.js', 'glulxe.wasm'],\n                start: generic_emglken_vm,\n            },\n\n            {\n                id: 'git',\n                load: ['git.js', 'git.wasm'],\n                start: generic_emglken_vm,\n            },\n        ],\n    },\n\n    {\n        id: 'tads',\n        extensions: /\\.(gam|t3)/i,\n        engines: [\n            {\n                id: 'tads',\n                load: ['tads.js', 'tads.wasm'],\n                start: generic_emglken_vm,\n            },\n        ],\n    },\n\n    {\n        id: 'zcode',\n        blorbable: true,\n        extensions: /\\.(zblorb|zlb|z3|z4|z5|z8)/i,\n        engines: [\n            /*{\n                id: 'zvm',\n                load: ['zvm.js'],\n                start: (_story: StoryOptions, options, requires) =>\n                {\n                    const [file_data, zvm] = requires\n\n                    const vm = new zvm.ZVM()\n                    const vm_options = Object.assign({}, options, {\n                        vm,\n                        GiDispa: new zvm.ZVMDispatch(),\n                    })\n\n                    vm.prepare(file_data, vm_options)\n                    vm_options.Glk.init(vm_options)\n                },\n            },*/\n\n            {\n                id: 'bocfel',\n                load: ['bocfel.js', 'bocfel.wasm'],\n                start: generic_emglken_vm,\n            },\n        ],\n    },\n]\n\n/** Match a format by format ID or file extension */\nexport function find_format(format?: string | null, path?: string) {\n    for (const formatspec of formats) {\n        if (formatspec.id === format || (path && formatspec.extensions.test(path))) {\n            return formatspec\n        }\n    }\n    throw new Error('Unknown storyfile format')\n}\n\n/** Search within a Blorb to find what format is inside\n * Must be passed a Blorb instance */\nexport function identify_blorb_storyfile_format(blorb: Blorb) {\n    const blorb_chunks: Record<string, string> = {\n        GLUL: 'glulx',\n        ZCOD: 'zcode',\n    }\n    const chunktype = blorb.get_chunk('exec', 0)?.blorbtype\n    if (chunktype && blorb_chunks[chunktype]) {\n        return find_format(blorb_chunks[chunktype])\n    }\n    throw new Error('Unknown storyfile format in Blorb')\n}", "/*\n\nCommon Parchment Options\n========================\n\nCopyright (c) 2024 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/parchment\n\n*/\n\nimport {ProviderBasedBrowserDialog, WebGlkOte} from '../upstream/asyncglk/src/index-browser.js'\n//import GlkOte_GlkApi from '../upstream/glkote/glkapi.js'\n\nimport type {ParchmentOptions} from './interface.js'\n\nexport function get_default_options(): ParchmentOptions {\n    return {\n        auto_launch: 1,\n        // Autoplay by default, unless we're loaded inside an iframe\n        autoplay: window.self === window.top,\n        Dialog: new ProviderBasedBrowserDialog(),\n        direct_domains: [\n            'ifarchive.org',\n            'mirror.ifarchive.org',\n            'unbox.ifarchive.org',\n            'www.ifarchive.org',\n        ],\n        do_vm_autosave: 1,\n        //Glk: GlkOte_GlkApi,\n        GlkOte: new WebGlkOte(),\n        // This only makes sense after the source files are built\n        lib_path: import.meta.url,\n        proxy_url: 'https://iplayif.com/proxy/',\n        set_body_to_page_bg: 1,\n        theme_cookie: 'parchment_theme',\n        use_proxy: 1,\n    }\n}\n\n/** Get options specified in the URL query */\nexport function get_query_options(possible_query_options: Array<keyof ParchmentOptions>): Partial<ParchmentOptions> {\n    const query = new URLSearchParams(document.location.search)\n    const options: Partial<ParchmentOptions> = {}\n    for (const option of possible_query_options) {\n        if (query.has(option)) {\n            // I couldn't work out how to apply proper types here, so tell TS to ignore it\n            const value = query.get(option)\n            try {\n                options[option] = JSON.parse(value!)\n            }\n            catch {\n                options[option] = value as any\n            }\n        }\n    }\n    return options\n}\n", "const BYTE_UNITS = [\n\t'B',\n\t'kB',\n\t'MB',\n\t'GB',\n\t'TB',\n\t'PB',\n\t'EB',\n\t'ZB',\n\t'YB',\n];\n\nconst BIBYTE_UNITS = [\n\t'B',\n\t'KiB',\n\t'MiB',\n\t'GiB',\n\t'TiB',\n\t'PiB',\n\t'EiB',\n\t'ZiB',\n\t'YiB',\n];\n\nconst BIT_UNITS = [\n\t'b',\n\t'kbit',\n\t'Mbit',\n\t'Gbit',\n\t'Tbit',\n\t'Pbit',\n\t'Ebit',\n\t'Zbit',\n\t'Ybit',\n];\n\nconst BIBIT_UNITS = [\n\t'b',\n\t'kibit',\n\t'Mibit',\n\t'Gibit',\n\t'Tibit',\n\t'Pibit',\n\t'Eibit',\n\t'Zibit',\n\t'Yibit',\n];\n\n/*\nFormats the given number using `Number#toLocaleString`.\n- If locale is a string, the value is expected to be a locale-key (for example: `de`).\n- If locale is true, the system default locale is used for translation.\n- If no value for locale is specified, the number is returned unmodified.\n*/\nconst toLocaleString = (number, locale, options) => {\n\tlet result = number;\n\tif (typeof locale === 'string' || Array.isArray(locale)) {\n\t\tresult = number.toLocaleString(locale, options);\n\t} else if (locale === true || options !== undefined) {\n\t\tresult = number.toLocaleString(undefined, options);\n\t}\n\n\treturn result;\n};\n\nexport default function prettyBytes(number, options) {\n\tif (!Number.isFinite(number)) {\n\t\tthrow new TypeError(`Expected a finite number, got ${typeof number}: ${number}`);\n\t}\n\n\toptions = {\n\t\tbits: false,\n\t\tbinary: false,\n\t\tspace: true,\n\t\t...options,\n\t};\n\n\tconst UNITS = options.bits\n\t\t? (options.binary ? BIBIT_UNITS : BIT_UNITS)\n\t\t: (options.binary ? BIBYTE_UNITS : BYTE_UNITS);\n\n\tconst separator = options.space ? ' ' : '';\n\n\tif (options.signed && number === 0) {\n\t\treturn ` 0${separator}${UNITS[0]}`;\n\t}\n\n\tconst isNegative = number < 0;\n\tconst prefix = isNegative ? '-' : (options.signed ? '+' : '');\n\n\tif (isNegative) {\n\t\tnumber = -number;\n\t}\n\n\tlet localeOptions;\n\n\tif (options.minimumFractionDigits !== undefined) {\n\t\tlocaleOptions = {minimumFractionDigits: options.minimumFractionDigits};\n\t}\n\n\tif (options.maximumFractionDigits !== undefined) {\n\t\tlocaleOptions = {maximumFractionDigits: options.maximumFractionDigits, ...localeOptions};\n\t}\n\n\tif (number < 1) {\n\t\tconst numberString = toLocaleString(number, options.locale, localeOptions);\n\t\treturn prefix + numberString + separator + UNITS[0];\n\t}\n\n\tconst exponent = Math.min(Math.floor(options.binary ? Math.log(number) / Math.log(1024) : Math.log10(number) / 3), UNITS.length - 1);\n\tnumber /= (options.binary ? 1024 : 1000) ** exponent;\n\n\tif (!localeOptions) {\n\t\tnumber = number.toPrecision(3);\n\t}\n\n\tconst numberString = toLocaleString(Number(number), options.locale, localeOptions);\n\n\tconst unit = UNITS[exponent];\n\n\treturn prefix + numberString + separator + unit;\n}\n", "<script lang=\"ts\">\n    import prettyBytes from 'pretty-bytes'\n\n    import '../../upstream/asyncglk/src/common/ui/common.css'\n\n    import type {FileSize} from '../interface.js'\n\n    export let cover_image_url: string\n    export let play: () => void\n    export let playing: boolean = false\n    export let title: string\n\n    let progress = 0\n    let set_storyfile_size = false\n    let totalsize = 0\n    let totalsize_gz = 0\n\n    export function add_file(filesize: FileSize, is_storyfile?: boolean) {\n        totalsize += filesize.size\n        totalsize_gz += filesize.gz\n        if (is_storyfile) {\n            set_storyfile_size = true\n        }\n    }\n\n    export function update_progress(chunk_length: number) {\n        progress += chunk_length\n    }\n\n    function on_play() {\n        playing = true\n        play()\n    }\n</script>\n\n<style>\n    :global(#loadingpane) {\n        position: absolute;\n        width: 100%;\n        text-align: center;\n        top: 20%;\n    }\n\n    progress {\n        width: 250px;\n    }\n</style>\n\n<div id=\"loadingpane\" class=\"asyncglk_ui\">\n    <h1>{title}</h1>\n    <p><img src=\"{cover_image_url}\" alt=\"Cover art\"></p>\n    {#if playing}\n        {#if set_storyfile_size}\n            <p><progress max=\"{totalsize}\" value=\"{progress}\"></progress></p>\n            <p>{prettyBytes(totalsize_gz, {maximumFractionDigits: 1, minimumFractionDigits: 1})}</p>\n        {:else}\n            <p><progress></progress></p>\n        {/if}\n    {:else}\n        <p><button on:click={on_play}>Play!</button></p>\n    {/if}\n</div>", "/*\n\nParchment Launcher\n==================\n\nCopyright (c) 2024 Dannii Willis\nMIT licenced\nhttps://github.com/curiousdannii/parchment\n\n*/\n\nimport '../web/web.css'\n\nimport Cookies from 'js-cookie'\n\nimport {/*AsyncGlk,*/ Blorb, fetch_resource, FileView, type ProgressCallback} from '../upstream/asyncglk/src/index-browser.js'\nimport emglken_file_sizes from 'emglken/build/file-sizes.json'\n\nimport {find_format, identify_blorb_storyfile_format} from './formats.js'\nimport type {ParchmentOptions, StoryOptions} from './interface.js'\nimport {get_default_options, get_query_options} from './options.js'\n\nimport LoadingPane from './ui/LoadingPane.svelte'\n\ninterface ParchmentWindow extends Window {\n    parchment: ParchmentLauncher\n    parchment_options?: ParchmentOptions\n}\ndeclare let window: ParchmentWindow\n\nclass ParchmentLauncher {\n    loading_pane?: LoadingPane\n    options: ParchmentOptions\n    story?: StoryOptions\n\n    constructor(parchment_options?: ParchmentOptions) {\n        // Only get story from the URL if there is no story already in the parchment_options\n        const query_options: Array<keyof ParchmentOptions> = ['autoplay', 'do_vm_autosave', 'use_asyncglk']\n        if (!parchment_options?.story) {\n            query_options.push('story')\n        }\n        this.options = Object.assign({}, get_default_options(), parchment_options, get_query_options(query_options))\n        // Use AsyncGlk if requested\n        /*if (this.options.use_asyncglk) {\n            this.options.Glk = new AsyncGlk()\n        }*/\n    }\n\n    get_storyfile_path(): StoryOptions | null {\n        if (this.options.story) {\n            if (typeof this.options.story === 'string') {\n                return {url: this.options.story}\n            }\n            return this.options.story\n        }\n        if (this.options.default_story) {\n            return {url: this.options.default_story?.[0]}\n        }\n        return null\n    }\n\n    async launch() {\n        try {\n            // Update the Dialog storage version\n            await this.options.Dialog.init(this.options)\n\n            // Apply the dark theme if set\n            const theme = this.options.theme\n                || Cookies.get(this.options.theme_cookie)\n                // Or if the browser tells us to prefer dark\n                || (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : '')\n            if (theme) {\n                document.documentElement.setAttribute('data-theme', theme)\n            }\n\n            const storyfile = this.get_storyfile_path()\n            if (!storyfile) {\n                // Set up all the ways we can load a story\n                $('#custom-file-upload').show().on('keydown', event => {\n                    if (event.keyCode === 32 /*Space*/ || event.keyCode === 13 /*Enter*/) {\n                        event.target.click()\n                    }\n                })\n                $('#file-upload').on('change', () => {\n                    const file = ($('#file-upload')[0] as HTMLInputElement)?.files?.[0]\n                    if (file) {\n                        this.load_uploaded_file(file)\n                    }\n                })\n                $('#play-url').show()\n                $('#play-url-button').on('click', () => this.play_url())\n                $('#play-url-input').on('keydown', event => {\n                    if (event.keyCode === 13 /*Enter*/) {\n                        this.play_url()\n                    }\n                })\n                return\n            }\n\n            this.story = storyfile\n            this.preload()\n        }\n        catch (err) {\n            this.options.GlkOte.error(err)\n            throw err\n        }\n    }\n\n    /** Prepare to load the game, but if autoplaying is disabled this will only show the loading pane */\n    preload() {\n        try {\n            const story = this.story!\n            // Check we were given a sufficient story object\n            if (!story.path) {\n                if (!story.url) {\n                    throw new Error('Needs story path or URL')\n                }\n            }\n\n            // Hide the about page, and show the loading pane instead\n            $('#about').remove()\n            const cover_image_url = $('#loadingpane img').attr('src')!\n            $('#loadingpane').remove()\n\n            const gameport = document.getElementById('gameport')!\n            this.loading_pane = new LoadingPane({\n                target: gameport,\n                props: {\n                    cover_image_url,\n                    play: this.load,\n                    playing: !!this.options.autoplay,\n                    // At this point in time we don't know the final (after following redirects) URL of the storyfile. For Unboxer URLs we could have an ugly query string, so try to account for that by just cutting off the URL after the last =\n                    title: story.title ?? /([/=])([^/=]+)$/.exec((story.path || story.url)!)![2],\n                },\n            })\n            if (this.options.autoplay) {\n                this.load()\n            }\n        }\n        catch (err) {\n            this.options.GlkOte.error(err)\n            throw err\n        }\n    }\n\n    /** Actually load and play the storyfile */\n    load = async () => {\n        try {\n            const story = this.story!\n            // We'll display download progress only if we know the file size of the storyfile\n            let progress_callback: ProgressCallback | undefined\n            if (story.filesize) {\n                this.loading_pane!.add_file(story.filesize, true)\n                progress_callback = this.loading_pane!.update_progress\n            }\n\n            // Identify the format\n            let format = find_format(story.format, story.path || story.url)\n\n            // If a blorb file extension is generic, we must download it first to identify its format\n            const options = Object.assign({}, this.options)\n            if (format.id === 'blorb') {\n                if (!story.path) {\n                    story.path = await this.options.Dialog.download(story.url!, progress_callback)\n                }\n                const data = (await this.options.Dialog.read(story.path))!\n                options.Blorb = new Blorb(data)\n                format = identify_blorb_storyfile_format(options.Blorb)\n            }\n\n            const engine = format.engines![0]\n\n            const requires = await Promise.all([\n                story.path || this.options.Dialog.download(story.url!, progress_callback),\n                ...engine.load.map(path => {\n                    if (story.filesize && (path in emglken_file_sizes)) {\n                        this.loading_pane!.add_file(emglken_file_sizes[path as keyof typeof emglken_file_sizes])\n                    }\n                    return fetch_resource(this.options, path, progress_callback)\n                }),\n            ])\n            // TODO: load glkaudio_bg.wasm if we predict we'll need it\n            story.path = requires.shift()\n\n            // If the story is a Blorb then parse it\n            if (format.blorbable && !options.Blorb) {\n                const data = (await this.options.Dialog.read(story.path!))!\n                const view = new FileView(data)\n                if (view.getFourCC(0) === 'FORM' && view.getFourCC(8) === 'IFRS') {\n                    options.Blorb = new Blorb(data)\n                }\n            }\n\n            await engine.start(story, options, requires)\n        }\n        catch (err) {\n            this.options.GlkOte.error(err)\n            throw err\n        }\n    }\n\n    async load_uploaded_file(file: File) {\n        try {\n            this.options.autoplay = 1\n            this.story = {\n                path: await this.options.Dialog.upload(file),\n                title: file.name,\n            }\n            this.preload()\n        }\n        catch (err) {\n            this.options.GlkOte.error(err)\n            throw err\n        }\n    }\n\n    play_url() {\n        const url = $('#play-url-input').val() as string\n        if (!url) {\n            return\n        }\n        // Validate the URL\n        try {\n            new URL(url)\n        }\n        catch {\n            $('#play-url-error').text('Please enter a valid URL')\n            return\n        }\n\n        // Change the page URL\n        const new_url = new URL(window.location + '')\n        new_url.searchParams.set('story', url)\n        window.location = new_url + ''\n\n        // TODO: We could use the history API, but we need to then handle going back\n        //history.pushState(null, '', new_url)\n        //this.load(url)\n    }\n}\n\n$(() => {\n    const parchment = new ParchmentLauncher(window.parchment_options)\n    window.parchment = parchment\n\n    if (parchment.options.auto_launch) {\n        parchment.launch()\n    }\n})\n"],
  "mappings": "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",
  "names": ["b", "c", "d", "g", "e", "f", "a", "h", "i", "j", "k", "l", "m", "module", "assign", "target", "i", "source", "key", "defaultConverter", "value", "init", "converter", "defaultAttributes", "set", "name", "attributes", "stringifiedAttributes", "attributeName", "get", "cookies", "jar", "parts", "found", "api", "freeGlobal", "freeGlobal_default", "freeSelf", "root", "freeGlobal_default", "root_default", "Symbol", "root_default", "Symbol_default", "objectProto", "hasOwnProperty", "nativeObjectToString", "symToStringTag", "Symbol_default", "getRawTag", "value", "isOwn", "tag", "unmasked", "result", "getRawTag_default", "objectProto", "nativeObjectToString", "objectToString", "value", "objectToString_default", "nullTag", "undefinedTag", "symToStringTag", "Symbol_default", "baseGetTag", "value", "getRawTag_default", "objectToString_default", "baseGetTag_default", "isObjectLike", "value", "isObjectLike_default", "symbolTag", "isSymbol", "value", "isObjectLike_default", "baseGetTag_default", "isSymbol_default", "arrayMap", "array", "iteratee", "index", "length", "result", "arrayMap_default", "isArray", "isArray_default", "INFINITY", "symbolProto", "Symbol_default", "symbolToString", "baseToString", "value", "isArray_default", "arrayMap_default", "isSymbol_default", "result", "baseToString_default", "reWhitespace", "trimmedEndIndex", "string", "index", "trimmedEndIndex_default", "reTrimStart", "baseTrim", "string", "trimmedEndIndex_default", "baseTrim_default", "isObject", "value", "type", "isObject_default", "NAN", "reIsBadHex", "reIsBinary", "reIsOctal", "freeParseInt", "toNumber", "value", "isSymbol_default", "isObject_default", "other", "baseTrim_default", "isBinary", "toNumber_default", "toString", "value", "baseToString_default", "toString_default", "basePropertyOf", "object", "key", "basePropertyOf_default", "now", "root_default", "now_default", "FUNC_ERROR_TEXT", "nativeMax", "nativeMin", "debounce", "func", "wait", "options", "lastArgs", "lastThis", "maxWait", "result", "timerId", "lastCallTime", "lastInvokeTime", "leading", "maxing", "trailing", "toNumber_default", "isObject_default", "invokeFunc", "time", "args", "thisArg", "leadingEdge", "timerExpired", "remainingWait", "timeSinceLastCall", "timeSinceLastInvoke", "timeWaiting", "shouldInvoke", "now_default", "trailingEdge", "cancel", "flush", "debounced", "isInvoking", "debounce_default", "FUNC_ERROR_TEXT", "throttle", "func", "wait", "options", "leading", "trailing", "isObject_default", "debounce_default", "throttle_default", "htmlUnescapes", "unescapeHtmlChar", "basePropertyOf_default", "unescapeHtmlChar_default", "reEscapedHtml", "reHasEscapedHtml", "unescape", "string", "toString_default", "unescapeHtmlChar_default", "unescape_default", "FileView", "data", "byteOffset", "byteLength", "index", "length", "text", "is_pinch_zoomed", "utf8decoder", "utf8encoder", "IFF", "data", "view", "FileView", "i", "length", "chunk_length", "buffer_length", "chunk", "BLORB_RESOURCE_INDEX_USAGES", "UNKNOWN_IMAGE_TYPE", "Blorb", "data", "options", "iff", "IFF", "iff_chunk", "view", "FileView", "xml", "utf8decoder", "bibliographic", "entry_pattern", "linebreak_pattern", "whitespace_pattern", "result", "tag", "content", "unescape_default", "i", "usage", "resource_number", "text_length", "chunk", "resource_offset", "resource_chunk", "type", "key", "num", "gametype", "get_jpeg_dimensions", "get_png_dimensions", "img", "field", "get_jpeg_dimensions", "data", "view", "FileView", "i", "marker", "chunklength", "get_png_dimensions", "chunktype", "DEFAULT_METRICS", "KEY_CODES_TO_NAMES", "KEY_CODE_DOWN", "KEY_CODE_RETURN", "KEY_CODE_UP", "NBSP", "OFFSCREEN_OFFSET", "PACKAGE_VERSION", "filetype_to_extension", "filetype", "GlkOteBase", "PACKAGE_VERSION", "DEFAULT_METRICS", "options", "error", "value", "name", "msg", "val", "data", "err", "replyfunc", "ref", "filetype_to_extension", "filename", "ex", "ev", "colour", "windows", "u8", "u16", "i32", "fleb", "fdeb", "clim", "freb", "eb", "start", "b", "i", "r", "j", "_a", "fl", "revfl", "_b", "fd", "revfd", "rev", "x", "hMap", "cd", "mb", "s", "l", "le", "co", "rvb", "sv", "r_1", "v", "m", "flt", "fdt", "flrm", "hMap", "flt", "fdrm", "hMap", "fdt", "max", "a", "m", "i", "bits", "d", "p", "o", "bits16", "shft", "slc", "v", "s", "e", "u8", "ec", "err", "ind", "msg", "nt", "e", "inflt", "dat", "st", "buf", "dict", "sl", "dl", "u8", "noBuf", "resize", "noSt", "cbuf", "l", "bl", "nbuf", "final", "pos", "bt", "lm", "dm", "lbt", "dbt", "tbts", "bits", "type", "flrm", "fdrm", "hLit", "hcLen", "tl", "ldt", "clt", "i", "clim", "clb", "max", "clbmsk", "clm", "hMap", "r", "s", "c", "n", "lt", "dt", "shft", "t", "lms", "dms", "lpos", "bits16", "sym", "add", "b", "fleb", "fl", "d", "dsym", "fd", "fdeb", "end", "shift", "dend", "slc", "et", "u8", "gzs", "d", "err", "flg", "st", "zs", "gzl", "l", "gunzipSync", "data", "opts", "st", "gzs", "err", "inflt", "u8", "gzl", "td", "tds", "et", "resource_map", "fetch_resource", "options", "path", "progress_callback", "cached", "response", "fetch_resource_inner", "resource", "node", "data_base64", "data", "parse_base64", "gunzipSync", "lib_path", "url", "read_response", "parse_base64_with_data_url", "chunks", "i", "blob", "length", "reader", "done", "value", "result", "offset", "chunk", "import_file_saver", "assertPath", "path", "normalizeStringPosix", "allowAboveRoot", "res", "lastSegmentLength", "lastSlash", "dots", "code", "i", "lastSlashIndex", "_format", "sep", "pathObject", "dir", "base", "posix", "_cwd", "resolvedPath", "resolvedAbsolute", "cwd", "isAbsolute", "trailingSeparator", "joined", "arg", "from", "to", "from2", "to2", "fromStart", "fromEnd", "fromLen", "toStart", "toEnd", "toLen", "length", "lastCommonSep", "fromCode", "toCode", "out", "hasRoot", "end", "matchedSlash", "ext", "start", "extIdx", "firstNonSlashEnd", "startDot", "startPart", "preDotState", "ret", "noop", "assign", "tar", "src", "k", "run", "fn", "blank_object", "run_all", "fns", "is_function", "thing", "safe_not_equal", "a", "b", "src_url_equal_anchor", "src_url_equal", "element_src", "url", "is_empty", "obj", "create_slot", "definition", "ctx", "$$scope", "fn", "slot_ctx", "get_slot_context", "assign", "get_slot_changes", "dirty", "lets", "merged", "len", "i", "update_slot_base", "slot", "slot_definition", "slot_changes", "get_slot_context_fn", "slot_context", "get_all_dirty_from_scope", "$$scope", "dirty", "length", "i", "action_destroyer", "action_result", "is_function", "noop", "globals", "ResizeObserverSingleton", "_ResizeObserverSingleton", "globals", "options", "element", "listener", "entries", "entry", "is_hydrating", "start_hydrating", "end_hydrating", "append", "target", "node", "insert", "target", "node", "anchor", "detach", "node", "destroy_each", "iterations", "detaching", "i", "element", "name", "svg_element", "name", "text", "data", "space", "empty", "listen", "node", "event", "handler", "options", "prevent_default", "fn", "stop_propagation", "attr", "node", "attribute", "value", "children", "element", "set_data", "text", "data", "set_input_value", "input", "value", "select_option", "select", "value", "mounting", "i", "option", "select_value", "select", "selected_option", "toggle_class", "element", "name", "toggle", "custom_event", "type", "detail", "bubbles", "cancelable", "get_custom_elements_slots", "element", "result", "node", "current_component", "set_current_component", "component", "get_current_component", "createEventDispatcher", "component", "get_current_component", "type", "detail", "cancelable", "callbacks", "event", "custom_event", "fn", "dirty_components", "binding_callbacks", "render_callbacks", "flush_callbacks", "resolved_promise", "update_scheduled", "schedule_update", "flush", "add_render_callback", "fn", "render_callbacks", "add_flush_callback", "flush_callbacks", "seen_callbacks", "flushidx", "flush", "saved_component", "current_component", "dirty_components", "component", "set_current_component", "update", "binding_callbacks", "i", "callback", "update_scheduled", "$$", "run_all", "dirty", "flush_render_callbacks", "fns", "filtered", "targets", "c", "outroing", "outros", "group_outros", "check_outros", "run_all", "transition_in", "block", "local", "transition_out", "detach", "callback", "ensure_array_like", "array_like_or_iterator", "_boolean_attributes", "boolean_attributes", "bind", "component", "name", "callback", "index", "create_component", "block", "mount_component", "component", "target", "anchor", "fragment", "after_update", "add_render_callback", "new_on_destroy", "run", "is_function", "run_all", "destroy_component", "detaching", "$$", "flush_render_callbacks", "make_dirty", "i", "dirty_components", "schedule_update", "init", "options", "instance", "create_fragment", "not_equal", "props", "append_styles", "dirty", "parent_component", "current_component", "set_current_component", "noop", "blank_object", "ready", "ret", "rest", "value", "start_hydrating", "nodes", "children", "detach", "transition_in", "end_hydrating", "flush", "SvelteElement", "$$componentCtor", "$$slots", "use_shadow_dom", "type", "listener", "unsub", "idx", "create_slot", "name", "node", "element", "attr", "insert", "existing_slots", "get_custom_elements_slots", "attribute", "get_custom_element_value", "key", "reflect_attributes", "attribute_value", "_oldValue", "newValue", "attribute_name", "prop", "props_definition", "transform", "SvelteComponent", "destroy_component", "noop", "type", "callback", "is_function", "callbacks", "index", "props", "is_empty", "PUBLIC_VERSION", "PUBLIC_VERSION", "ctx", "insert", "target", "dialog_1", "anchor", "append", "div2", "div1", "div0", "button", "dialog", "$$value", "insert", "target", "textarea", "anchor", "ctx", "button", "ALERT_MODE_PROMPT", "create_if_block_1", "ALERT_MODE_ALERT", "create_if_block", "p", "div0", "div2", "append", "div1", "base_dialog", "$$value", "ALERT_MODE_ALERT", "ALERT_MODE_CONFIRM", "ALERT_MODE_PROMPT", "NullProvider", "_path", "_files", "show_alert", "title", "message", "alert", "AlertDialog_default", "DownloadProvider", "options", "NullProvider", "url", "progress_callback", "final_url", "data", "fetch_storyfile", "path", "url_to_path", "file", "read_uploaded_file", "files", "story_url", "story_domain", "same_protocol", "same_domain", "response", "node", "data_base64", "parse_base64", "gunzipSync", "direct_access", "direct_domains", "domain", "read_response", "text", "utf8decoder", "matched", "resolve", "reject", "reader", "pairStrings", "lookupE", "lookupD", "pairString", "r", "encodeRepertoire", "pair", "first", "last", "codePoint", "numZBits", "chr", "z", "encode", "uint8Array", "length", "str", "i", "uint8", "j", "bit", "decode", "numUint8s", "numUint8Bits", "METADATA_KEY", "STORAGE_VERSION_KEY", "WebStorageProvider", "prefix", "store", "dirs", "browseable", "NullProvider", "migrate_localStorage", "path", "METADATA_KEY", "res", "decode", "dir", "old_path", "new_path", "new_file_path", "data", "old_transaction", "op", "now", "files", "was_already_in_transaction", "wrote_files", "next_files", "encode", "show_alert", "DIALOG_V1_TYPES_TO_EXTS", "version", "STORAGE_VERSION_KEY", "metadata", "key", "key_data", "ch", "dirent_key", "dirent", "dirent_data", "insert", "target", "span", "anchor", "ctx", "set_data", "t", "t_value", "append", "button", "create_if_block_1", "create_if_block", "div", "i", "cur_dir", "$$props", "insert", "target", "svg", "anchor", "append", "path", "ctx", "create_if_block_2", "create_if_block_1", "div", "button0", "button1", "set_data", "t1", "t1_value", "button", "create_if_block_3", "create_if_block", "div2", "div0", "div1", "ctx", "insert", "target", "div", "anchor", "append", "label", "textarea", "create_if_block_3", "add_render_callback", "select", "option", "set_data", "t0", "t0_value", "t", "t_value", "create_if_block_1", "i", "create_if_block_4", "create_if_block_2", "create_if_block", "div1", "div0", "button0", "button1", "div2", "div5", "div3", "div4", "button2", "button3", "input", "each_blocks", "cur_filter", "select_value", "upload_files", "$$value", "base_dialog", "ProviderBasedBrowserDialog", "options", "DownloadProvider", "WebStorageProvider", "i", "provider", "next", "DialogController", "url", "progress_callback", "file_path", "extension", "save", "show_alert", "path", "file", "files", "parsed_path", "posix", "FileDialog_default", "action", "filter", "extension_to_filter", "dir_path", "data", "filesave_saveAs", "now", "new_file_name", "new_path", "refresh", "read_files", "read_uploaded_file", "create", "tag", "className", "DOM", "options", "id", "props", "is_input_focused", "activeElement_tagName", "is_iOS", "get_size", "el", "metrics_differ", "newmetrics", "oldmetrics", "Metrics", "glkote", "throttle_default", "height", "is_input_focused", "resolve", "is_iOS", "dom", "gameport", "layout_test_pane", "line", "create", "bufwin", "bufinnerwin", "bufline1", "bufline2", "bufspan", "graphwin", "graphcanvas", "gridwin", "gridline1", "gridline2", "gridspan", "font_family", "bufwinsize", "bufspansize", "bufline1size", "bufline2size", "graphicswinsize", "canvassize", "gridwinsize", "gridspansize", "gridline1size", "gridline2size", "is_pinch_zoomed", "wasm", "cachedUint8ArrayMemory0", "getUint8ArrayMemory0", "WASM_VECTOR_LEN", "passArray8ToWasm0", "arg", "malloc", "ptr", "cachedDataViewMemory0", "getDataViewMemory0", "getArrayU8FromWasm0", "len", "decode", "buffer", "retptr", "ptr0", "len0", "r0", "r1", "v2", "__wbg_load", "module", "imports", "e", "bytes", "instance", "__wbg_get_imports", "__wbg_finalize_init", "instance", "module", "wasm", "__wbg_init", "cachedDataViewMemory0", "cachedUint8ArrayMemory0", "__wbg_init", "module_or_path", "wasm", "imports", "__wbg_get_imports", "instance", "module", "__wbg_load", "__wbg_finalize_init", "glkaudio_default", "__wbg_init", "priming_mp3", "SoundChannelManager", "glkote", "schannels", "wanted_schannels", "schannel", "id", "ops", "SoundChannel", "context", "source", "data", "parse_base64", "op", "chunk", "wasm", "glkaudio_default", "fetch_resource", "decoded", "decode", "currentTime", "gain", "current_value", "notify", "_toConsumableArray", "arr", "i", "arr2", "hasPassiveEvents", "passiveTestOptions", "isIosDevice", "locks", "documentListenerAdded", "initialClientY", "previousBodyOverflowSetting", "previousBodyPosition", "previousBodyPaddingRight", "allowTouchMove", "el", "lock", "preventDefault", "rawEvent", "e", "setOverflowHidden", "options", "_reserveScrollBarGap", "scrollBarGap", "computedBodyPaddingRight", "restoreOverflowSetting", "setPositionFixed", "_window", "scrollY", "scrollX", "innerHeight", "bottomBarHeight", "restorePositionSetting", "y", "x", "isTargetElementTotallyScrolled", "targetElement", "handleScroll", "event", "clientY", "disableBodyScroll", "enableBodyScroll", "targetElement", "locks", "lock", "isIosDevice", "documentListenerAdded", "preventDefault", "hasPassiveEvents", "restorePositionSetting", "restoreOverflowSetting", "MAX_HISTORY_LENGTH", "TextInput", "win", "debounce_default", "full_screen", "ev", "is_iOS", "is_input_focused", "is_pinch_zoomed", "char", "keycode", "KEY_CODE_DOWN", "KEY_CODE_UP", "history", "changed", "terminator", "KEY_CODES_TO_NAMES", "code", "KEY_CODE_RETURN", "OFFSCREEN_OFFSET", "inputparent", "val", "update", "metrics", "css_styles", "reverse", "apply_text_run_styles", "no_text_selected", "WindowBase", "options", "window_types", "ev", "TextInput", "remove_frame", "apply_text_run_styles", "orig_styles", "reverse", "el", "styles", "bg", "fg", "split_after_spaces", "text", "res", "whitespace", "prev_whitespace", "c", "is_whitespace", "TextualWindow", "onlink", "target", "windowid", "selector", "original_styles", "full_selector", "css_styles", "reverse_styles", "normal_styles", "rule", "properties", "property", "name", "value", "run", "split_words", "run_style", "monospace_val", "monospace_class", "create", "els", "linkval", "styles_need_refreshing", "inline_alignment_classes", "BufferWindow", "frameel", "is_iOS", "disableBodyScroll", "enableBodyScroll", "_", "rect", "after_metrics_change", "data", "line_index", "line", "content", "divel", "line_has_style", "NBSP", "run_index", "instruction", "is_pinch_zoomed", "GraphicsWindow", "debounce_default", "key", "url", "image", "height", "width", "dPR", "buffercontext", "i", "frame", "loading_images", "op", "GridWindow", "lineel", "window_classes", "Windows", "glkote", "windows", "window", "win", "testRO", "entries", "newinputs", "entry", "box", "update", "id", "type", "windowstoclose", "oldgen", "TranscriptRecorder", "options", "windows", "state", "ev", "event", "eventtype", "input", "output", "update", "win", "textdata", "data", "content", "run_index", "instruction", "response", "err", "WebGlkOte", "GlkOteBase", "DOM", "Metrics", "Windows", "options", "windowport", "viewport_meta_tag_content", "is_iOS", "query_feedback", "cookie_name", "TranscriptRecorder", "SoundChannelManager", "err", "data", "win", "winid", "colour", "windows", "capabilities", "disable", "errorpane", "link", "error", "msg", "errorcontent", "name", "loadingpane", "graphics_bg", "ev", "val", "content", "schannels", "file_sizes_default", "generic_emglken_vm", "story", "options", "requires", "engine", "wasmBinary", "vm_options", "formats", "find_format", "format", "path", "formatspec", "identify_blorb_storyfile_format", "blorb", "blorb_chunks", "chunktype", "get_default_options", "ProviderBasedBrowserDialog", "WebGlkOte", "get_query_options", "possible_query_options", "query", "options", "option", "value", "BYTE_UNITS", "BIBYTE_UNITS", "BIT_UNITS", "BIBIT_UNITS", "toLocaleString", "number", "locale", "options", "result", "prettyBytes", "UNITS", "separator", "isNegative", "prefix", "localeOptions", "numberString", "exponent", "unit", "insert", "target", "p", "anchor", "append", "button", "ctx", "create_if_block_1", "prettyBytes", "p0", "progress_1", "p1", "create_if_block", "attr", "img", "img_src_value", "div", "h1", "ParchmentLauncher", "parchment_options", "query_options", "get_default_options", "get_query_options", "theme", "api", "storyfile", "event", "file", "err", "story", "cover_image_url", "gameport", "LoadingPane_default", "progress_callback", "format", "find_format", "options", "data", "Blorb", "identify_blorb_storyfile_format", "engine", "requires", "path", "file_sizes_default", "fetch_resource", "view", "FileView", "url", "new_url", "parchment"]
}
