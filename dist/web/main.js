var $u=Object.defineProperty;var ju=(a,e)=>{for(var r in e)$u(a,r,{get:e[r],enumerable:!0})};function Ar(a){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)a[i]=r[i]}return a}var Lu={read:function(a){return a[0]==='"'&&(a=a.slice(1,-1)),a.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(a){return encodeURIComponent(a).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function on(a,e){function r(f,u,_){if(!(typeof document>"u")){_=Ar({},e,_),typeof _.expires=="number"&&(_.expires=new Date(Date.now()+_.expires*864e5)),_.expires&&(_.expires=_.expires.toUTCString()),f=encodeURIComponent(f).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var p="";for(var y in _)_[y]&&(p+="; "+y,_[y]!==!0&&(p+="="+_[y].split(";")[0]));return document.cookie=f+"="+a.write(u,f)+p}}function i(f){if(!(typeof document>"u"||arguments.length&&!f)){for(var u=document.cookie?document.cookie.split("; "):[],_={},p=0;p<u.length;p++){var y=u[p].split("="),x=y.slice(1).join("=");try{var b=decodeURIComponent(y[0]);if(_[b]=a.read(x,b),f===b)break}catch{}}return f?_[f]:_}}return Object.create({set:r,get:i,remove:function(f,u){r(f,"",Ar({},u,{expires:-1}))},withAttributes:function(f){return on(this.converter,Ar({},this.attributes,f))},withConverter:function(f){return on(Ar({},this.converter,f),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(a)}})}var Vo=on(Lu,{path:"/"});var zu=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],qu=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],Nu=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],Hu=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],Ko=(a,e,r)=>{let i=a;return typeof e=="string"||Array.isArray(e)?i=a.toLocaleString(e,r):(e===!0||r!==void 0)&&(i=a.toLocaleString(void 0,r)),i};function an(a,e){if(!Number.isFinite(a))throw new TypeError(`Expected a finite number, got ${typeof a}: ${a}`);e={bits:!1,binary:!1,space:!0,...e};let r=e.bits?e.binary?Hu:Nu:e.binary?qu:zu,i=e.space?" ":"";if(e.signed&&a===0)return` 0${i}${r[0]}`;let f=a<0,u=f?"-":e.signed?"+":"";f&&(a=-a);let _;if(e.minimumFractionDigits!==void 0&&(_={minimumFractionDigits:e.minimumFractionDigits}),e.maximumFractionDigits!==void 0&&(_={maximumFractionDigits:e.maximumFractionDigits,..._}),a<1){let b=Ko(a,e.locale,_);return u+b+i+r[0]}let p=Math.min(Math.floor(e.binary?Math.log(a)/Math.log(1024):Math.log10(a)/3),r.length-1);a/=(e.binary?1024:1e3)**p,_||(a=a.toPrecision(3));let y=Ko(Number(a),e.locale,_),x=r[p];return u+y+i+x}var Vu=typeof global=="object"&&global&&global.Object===Object&&global,Gr=Vu;var Ku=typeof self=="object"&&self&&self.Object===Object&&self,Yu=Gr||Ku||Function("return this")(),Y=Yu;var Ju=Y.Symbol,ue=Ju;var Yo=Object.prototype,Qu=Yo.hasOwnProperty,Xu=Yo.toString,rr=ue?ue.toStringTag:void 0;function Zu(a){var e=Qu.call(a,rr),r=a[rr];try{a[rr]=void 0;var i=!0}catch{}var f=Xu.call(a);return i&&(e?a[rr]=r:delete a[rr]),f}var Jo=Zu;var ec=Object.prototype,tc=ec.toString;function rc(a){return tc.call(a)}var Qo=rc;var ic="[object Null]",nc="[object Undefined]",Xo=ue?ue.toStringTag:void 0;function oc(a){return a==null?a===void 0?nc:ic:Xo&&Xo in Object(a)?Jo(a):Qo(a)}var ye=oc;function ac(a){return a!=null&&typeof a=="object"}var ce=ac;var sc="[object Symbol]";function lc(a){return typeof a=="symbol"||ce(a)&&ye(a)==sc}var Cr=lc;function fc(a,e){for(var r=-1,i=a==null?0:a.length,f=Array(i);++r<i;)f[r]=e(a[r],r,a);return f}var Zo=fc;var uc=Array.isArray,Le=uc;var cc=1/0,ea=ue?ue.prototype:void 0,ta=ea?ea.toString:void 0;function ra(a){if(typeof a=="string")return a;if(Le(a))return Zo(a,ra)+"";if(Cr(a))return ta?ta.call(a):"";var e=a+"";return e=="0"&&1/a==-cc?"-0":e}var ia=ra;var _c=/\s/;function dc(a){for(var e=a.length;e--&&_c.test(a.charAt(e)););return e}var na=dc;var pc=/^\s+/;function hc(a){return a&&a.slice(0,na(a)+1).replace(pc,"")}var oa=hc;function mc(a){var e=typeof a;return a!=null&&(e=="object"||e=="function")}var ne=mc;var aa=NaN,gc=/^[-+]0x[0-9a-f]+$/i,yc=/^0b[01]+$/i,bc=/^0o[0-7]+$/i,wc=parseInt;function kc(a){if(typeof a=="number")return a;if(Cr(a))return aa;if(ne(a)){var e=typeof a.valueOf=="function"?a.valueOf():a;a=ne(e)?e+"":e}if(typeof a!="string")return a===0?a:+a;a=oa(a);var r=yc.test(a);return r||bc.test(a)?wc(a.slice(2),r?2:8):gc.test(a)?aa:+a}var sn=kc;var xc="[object AsyncFunction]",vc="[object Function]",Sc="[object GeneratorFunction]",Tc="[object Proxy]";function Ac(a){if(!ne(a))return!1;var e=ye(a);return e==vc||e==Sc||e==xc||e==Tc}var Er=Ac;var Gc=Y["__core-js_shared__"],Ir=Gc;var sa=function(){var a=/[^.]+$/.exec(Ir&&Ir.keys&&Ir.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}();function Cc(a){return!!sa&&sa in a}var la=Cc;var Ec=Function.prototype,Ic=Ec.toString;function Rc(a){if(a!=null){try{return Ic.call(a)}catch{}try{return a+""}catch{}}return""}var Ge=Rc;var Fc=/[\\^$.*+?()[\]{}|]/g,Oc=/^\[object .+?Constructor\]$/,Dc=Function.prototype,Wc=Object.prototype,Bc=Dc.toString,Mc=Wc.hasOwnProperty,Uc=RegExp("^"+Bc.call(Mc).replace(Fc,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Pc(a){if(!ne(a)||la(a))return!1;var e=Er(a)?Uc:Oc;return e.test(Ge(a))}var fa=Pc;function $c(a,e){return a?.[e]}var ua=$c;function jc(a,e){var r=ua(a,e);return fa(r)?r:void 0}var se=jc;var Lc=se(Y,"WeakMap"),Rr=Lc;var ca=Object.create,zc=function(){function a(){}return function(e){if(!ne(e))return{};if(ca)return ca(e);a.prototype=e;var r=new a;return a.prototype=void 0,r}}(),_a=zc;function qc(a,e){var r=-1,i=a.length;for(e||(e=Array(i));++r<i;)e[r]=a[r];return e}var da=qc;var Nc=function(){try{var a=se(Object,"defineProperty");return a({},"",{}),a}catch{}}(),ln=Nc;function Hc(a,e){for(var r=-1,i=a==null?0:a.length;++r<i&&e(a[r],r,a)!==!1;);return a}var pa=Hc;var Vc=9007199254740991,Kc=/^(?:0|[1-9]\d*)$/;function Yc(a,e){var r=typeof a;return e=e??Vc,!!e&&(r=="number"||r!="symbol"&&Kc.test(a))&&a>-1&&a%1==0&&a<e}var ha=Yc;function Jc(a,e,r){e=="__proto__"&&ln?ln(a,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):a[e]=r}var Fr=Jc;function Qc(a,e){return a===e||a!==a&&e!==e}var Or=Qc;var Xc=Object.prototype,Zc=Xc.hasOwnProperty;function e_(a,e,r){var i=a[e];(!(Zc.call(a,e)&&Or(i,r))||r===void 0&&!(e in a))&&Fr(a,e,r)}var Dr=e_;function t_(a,e,r,i){var f=!r;r||(r={});for(var u=-1,_=e.length;++u<_;){var p=e[u],y=i?i(r[p],a[p],p,r,a):void 0;y===void 0&&(y=a[p]),f?Fr(r,p,y):Dr(r,p,y)}return r}var ze=t_;var r_=9007199254740991;function i_(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=r_}var Wr=i_;function n_(a){return a!=null&&Wr(a.length)&&!Er(a)}var Br=n_;var o_=Object.prototype;function a_(a){var e=a&&a.constructor,r=typeof e=="function"&&e.prototype||o_;return a===r}var mt=a_;function s_(a,e){for(var r=-1,i=Array(a);++r<a;)i[r]=e(r);return i}var ma=s_;var l_="[object Arguments]";function f_(a){return ce(a)&&ye(a)==l_}var fn=f_;var ga=Object.prototype,u_=ga.hasOwnProperty,c_=ga.propertyIsEnumerable,__=fn(function(){return arguments}())?fn:function(a){return ce(a)&&u_.call(a,"callee")&&!c_.call(a,"callee")},ya=__;function d_(){return!1}var ba=d_;var xa=typeof exports=="object"&&exports&&!exports.nodeType&&exports,wa=xa&&typeof module=="object"&&module&&!module.nodeType&&module,p_=wa&&wa.exports===xa,ka=p_?Y.Buffer:void 0,h_=ka?ka.isBuffer:void 0,m_=h_||ba,Mr=m_;var g_="[object Arguments]",y_="[object Array]",b_="[object Boolean]",w_="[object Date]",k_="[object Error]",x_="[object Function]",v_="[object Map]",S_="[object Number]",T_="[object Object]",A_="[object RegExp]",G_="[object Set]",C_="[object String]",E_="[object WeakMap]",I_="[object ArrayBuffer]",R_="[object DataView]",F_="[object Float32Array]",O_="[object Float64Array]",D_="[object Int8Array]",W_="[object Int16Array]",B_="[object Int32Array]",M_="[object Uint8Array]",U_="[object Uint8ClampedArray]",P_="[object Uint16Array]",$_="[object Uint32Array]",H={};H[F_]=H[O_]=H[D_]=H[W_]=H[B_]=H[M_]=H[U_]=H[P_]=H[$_]=!0;H[g_]=H[y_]=H[I_]=H[b_]=H[R_]=H[w_]=H[k_]=H[x_]=H[v_]=H[S_]=H[T_]=H[A_]=H[G_]=H[C_]=H[E_]=!1;function j_(a){return ce(a)&&Wr(a.length)&&!!H[ye(a)]}var va=j_;function L_(a){return function(e){return a(e)}}var gt=L_;var Sa=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ir=Sa&&typeof module=="object"&&module&&!module.nodeType&&module,z_=ir&&ir.exports===Sa,un=z_&&Gr.process,q_=function(){try{var a=ir&&ir.require&&ir.require("util").types;return a||un&&un.binding&&un.binding("util")}catch{}}(),Ce=q_;var Ta=Ce&&Ce.isTypedArray,N_=Ta?gt(Ta):va,Aa=N_;var H_=Object.prototype,V_=H_.hasOwnProperty;function K_(a,e){var r=Le(a),i=!r&&ya(a),f=!r&&!i&&Mr(a),u=!r&&!i&&!f&&Aa(a),_=r||i||f||u,p=_?ma(a.length,String):[],y=p.length;for(var x in a)(e||V_.call(a,x))&&!(_&&(x=="length"||f&&(x=="offset"||x=="parent")||u&&(x=="buffer"||x=="byteLength"||x=="byteOffset")||ha(x,y)))&&p.push(x);return p}var Ur=K_;function Y_(a,e){return function(r){return a(e(r))}}var Pr=Y_;var J_=Pr(Object.keys,Object),Ga=J_;var Q_=Object.prototype,X_=Q_.hasOwnProperty;function Z_(a){if(!mt(a))return Ga(a);var e=[];for(var r in Object(a))X_.call(a,r)&&r!="constructor"&&e.push(r);return e}var Ca=Z_;function ed(a){return Br(a)?Ur(a):Ca(a)}var yt=ed;function td(a){var e=[];if(a!=null)for(var r in Object(a))e.push(r);return e}var Ea=td;var rd=Object.prototype,id=rd.hasOwnProperty;function nd(a){if(!ne(a))return Ea(a);var e=mt(a),r=[];for(var i in a)i=="constructor"&&(e||!id.call(a,i))||r.push(i);return r}var Ia=nd;function od(a){return Br(a)?Ur(a,!0):Ia(a)}var bt=od;var ad=se(Object,"create"),Ee=ad;function sd(){this.__data__=Ee?Ee(null):{},this.size=0}var Ra=sd;function ld(a){var e=this.has(a)&&delete this.__data__[a];return this.size-=e?1:0,e}var Fa=ld;var fd="__lodash_hash_undefined__",ud=Object.prototype,cd=ud.hasOwnProperty;function _d(a){var e=this.__data__;if(Ee){var r=e[a];return r===fd?void 0:r}return cd.call(e,a)?e[a]:void 0}var Oa=_d;var dd=Object.prototype,pd=dd.hasOwnProperty;function hd(a){var e=this.__data__;return Ee?e[a]!==void 0:pd.call(e,a)}var Da=hd;var md="__lodash_hash_undefined__";function gd(a,e){var r=this.__data__;return this.size+=this.has(a)?0:1,r[a]=Ee&&e===void 0?md:e,this}var Wa=gd;function wt(a){var e=-1,r=a==null?0:a.length;for(this.clear();++e<r;){var i=a[e];this.set(i[0],i[1])}}wt.prototype.clear=Ra;wt.prototype.delete=Fa;wt.prototype.get=Oa;wt.prototype.has=Da;wt.prototype.set=Wa;var cn=wt;function yd(){this.__data__=[],this.size=0}var Ba=yd;function bd(a,e){for(var r=a.length;r--;)if(Or(a[r][0],e))return r;return-1}var qe=bd;var wd=Array.prototype,kd=wd.splice;function xd(a){var e=this.__data__,r=qe(e,a);if(r<0)return!1;var i=e.length-1;return r==i?e.pop():kd.call(e,r,1),--this.size,!0}var Ma=xd;function vd(a){var e=this.__data__,r=qe(e,a);return r<0?void 0:e[r][1]}var Ua=vd;function Sd(a){return qe(this.__data__,a)>-1}var Pa=Sd;function Td(a,e){var r=this.__data__,i=qe(r,a);return i<0?(++this.size,r.push([a,e])):r[i][1]=e,this}var $a=Td;function kt(a){var e=-1,r=a==null?0:a.length;for(this.clear();++e<r;){var i=a[e];this.set(i[0],i[1])}}kt.prototype.clear=Ba;kt.prototype.delete=Ma;kt.prototype.get=Ua;kt.prototype.has=Pa;kt.prototype.set=$a;var Ne=kt;var Ad=se(Y,"Map"),He=Ad;function Gd(){this.size=0,this.__data__={hash:new cn,map:new(He||Ne),string:new cn}}var ja=Gd;function Cd(a){var e=typeof a;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?a!=="__proto__":a===null}var La=Cd;function Ed(a,e){var r=a.__data__;return La(e)?r[typeof e=="string"?"string":"hash"]:r.map}var Ve=Ed;function Id(a){var e=Ve(this,a).delete(a);return this.size-=e?1:0,e}var za=Id;function Rd(a){return Ve(this,a).get(a)}var qa=Rd;function Fd(a){return Ve(this,a).has(a)}var Na=Fd;function Od(a,e){var r=Ve(this,a),i=r.size;return r.set(a,e),this.size+=r.size==i?0:1,this}var Ha=Od;function xt(a){var e=-1,r=a==null?0:a.length;for(this.clear();++e<r;){var i=a[e];this.set(i[0],i[1])}}xt.prototype.clear=ja;xt.prototype.delete=za;xt.prototype.get=qa;xt.prototype.has=Na;xt.prototype.set=Ha;var Va=xt;function Dd(a){return a==null?"":ia(a)}var Ka=Dd;function Wd(a,e){for(var r=-1,i=e.length,f=a.length;++r<i;)a[f+r]=e[r];return a}var $r=Wd;var Bd=Pr(Object.getPrototypeOf,Object),jr=Bd;function Md(a){return function(e){return a?.[e]}}var Ya=Md;function Ud(){this.__data__=new Ne,this.size=0}var Ja=Ud;function Pd(a){var e=this.__data__,r=e.delete(a);return this.size=e.size,r}var Qa=Pd;function $d(a){return this.__data__.get(a)}var Xa=$d;function jd(a){return this.__data__.has(a)}var Za=jd;var Ld=200;function zd(a,e){var r=this.__data__;if(r instanceof Ne){var i=r.__data__;if(!He||i.length<Ld-1)return i.push([a,e]),this.size=++r.size,this;r=this.__data__=new Va(i)}return r.set(a,e),this.size=r.size,this}var es=zd;function vt(a){var e=this.__data__=new Ne(a);this.size=e.size}vt.prototype.clear=Ja;vt.prototype.delete=Qa;vt.prototype.get=Xa;vt.prototype.has=Za;vt.prototype.set=es;var ts=vt;function qd(a,e){return a&&ze(e,yt(e),a)}var rs=qd;function Nd(a,e){return a&&ze(e,bt(e),a)}var is=Nd;var ss=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ns=ss&&typeof module=="object"&&module&&!module.nodeType&&module,Hd=ns&&ns.exports===ss,os=Hd?Y.Buffer:void 0,as=os?os.allocUnsafe:void 0;function Vd(a,e){if(e)return a.slice();var r=a.length,i=as?as(r):new a.constructor(r);return a.copy(i),i}var ls=Vd;function Kd(a,e){for(var r=-1,i=a==null?0:a.length,f=0,u=[];++r<i;){var _=a[r];e(_,r,a)&&(u[f++]=_)}return u}var fs=Kd;function Yd(){return[]}var Lr=Yd;var Jd=Object.prototype,Qd=Jd.propertyIsEnumerable,us=Object.getOwnPropertySymbols,Xd=us?function(a){return a==null?[]:(a=Object(a),fs(us(a),function(e){return Qd.call(a,e)}))}:Lr,St=Xd;function Zd(a,e){return ze(a,St(a),e)}var cs=Zd;var ep=Object.getOwnPropertySymbols,tp=ep?function(a){for(var e=[];a;)$r(e,St(a)),a=jr(a);return e}:Lr,zr=tp;function rp(a,e){return ze(a,zr(a),e)}var _s=rp;function ip(a,e,r){var i=e(a);return Le(a)?i:$r(i,r(a))}var qr=ip;function np(a){return qr(a,yt,St)}var ds=np;function op(a){return qr(a,bt,zr)}var ps=op;var ap=se(Y,"DataView"),Nr=ap;var sp=se(Y,"Promise"),Hr=sp;var lp=se(Y,"Set"),Vr=lp;var hs="[object Map]",fp="[object Object]",ms="[object Promise]",gs="[object Set]",ys="[object WeakMap]",bs="[object DataView]",up=Ge(Nr),cp=Ge(He),_p=Ge(Hr),dp=Ge(Vr),pp=Ge(Rr),ot=ye;(Nr&&ot(new Nr(new ArrayBuffer(1)))!=bs||He&&ot(new He)!=hs||Hr&&ot(Hr.resolve())!=ms||Vr&&ot(new Vr)!=gs||Rr&&ot(new Rr)!=ys)&&(ot=function(a){var e=ye(a),r=e==fp?a.constructor:void 0,i=r?Ge(r):"";if(i)switch(i){case up:return bs;case cp:return hs;case _p:return ms;case dp:return gs;case pp:return ys}return e});var Tt=ot;var hp=Object.prototype,mp=hp.hasOwnProperty;function gp(a){var e=a.length,r=new a.constructor(e);return e&&typeof a[0]=="string"&&mp.call(a,"index")&&(r.index=a.index,r.input=a.input),r}var ws=gp;var yp=Y.Uint8Array,_n=yp;function bp(a){var e=new a.constructor(a.byteLength);return new _n(e).set(new _n(a)),e}var At=bp;function wp(a,e){var r=e?At(a.buffer):a.buffer;return new a.constructor(r,a.byteOffset,a.byteLength)}var ks=wp;var kp=/\w*$/;function xp(a){var e=new a.constructor(a.source,kp.exec(a));return e.lastIndex=a.lastIndex,e}var xs=xp;var vs=ue?ue.prototype:void 0,Ss=vs?vs.valueOf:void 0;function vp(a){return Ss?Object(Ss.call(a)):{}}var Ts=vp;function Sp(a,e){var r=e?At(a.buffer):a.buffer;return new a.constructor(r,a.byteOffset,a.length)}var As=Sp;var Tp="[object Boolean]",Ap="[object Date]",Gp="[object Map]",Cp="[object Number]",Ep="[object RegExp]",Ip="[object Set]",Rp="[object String]",Fp="[object Symbol]",Op="[object ArrayBuffer]",Dp="[object DataView]",Wp="[object Float32Array]",Bp="[object Float64Array]",Mp="[object Int8Array]",Up="[object Int16Array]",Pp="[object Int32Array]",$p="[object Uint8Array]",jp="[object Uint8ClampedArray]",Lp="[object Uint16Array]",zp="[object Uint32Array]";function qp(a,e,r){var i=a.constructor;switch(e){case Op:return At(a);case Tp:case Ap:return new i(+a);case Dp:return ks(a,r);case Wp:case Bp:case Mp:case Up:case Pp:case $p:case jp:case Lp:case zp:return As(a,r);case Gp:return new i;case Cp:case Rp:return new i(a);case Ep:return xs(a);case Ip:return new i;case Fp:return Ts(a)}}var Gs=qp;function Np(a){return typeof a.constructor=="function"&&!mt(a)?_a(jr(a)):{}}var Cs=Np;var Hp="[object Map]";function Vp(a){return ce(a)&&Tt(a)==Hp}var Es=Vp;var Is=Ce&&Ce.isMap,Kp=Is?gt(Is):Es,Rs=Kp;var Yp="[object Set]";function Jp(a){return ce(a)&&Tt(a)==Yp}var Fs=Jp;var Os=Ce&&Ce.isSet,Qp=Os?gt(Os):Fs,Ds=Qp;var Xp=1,Zp=2,e7=4,Ws="[object Arguments]",t7="[object Array]",r7="[object Boolean]",i7="[object Date]",n7="[object Error]",Bs="[object Function]",o7="[object GeneratorFunction]",a7="[object Map]",s7="[object Number]",Ms="[object Object]",l7="[object RegExp]",f7="[object Set]",u7="[object String]",c7="[object Symbol]",_7="[object WeakMap]",d7="[object ArrayBuffer]",p7="[object DataView]",h7="[object Float32Array]",m7="[object Float64Array]",g7="[object Int8Array]",y7="[object Int16Array]",b7="[object Int32Array]",w7="[object Uint8Array]",k7="[object Uint8ClampedArray]",x7="[object Uint16Array]",v7="[object Uint32Array]",q={};q[Ws]=q[t7]=q[d7]=q[p7]=q[r7]=q[i7]=q[h7]=q[m7]=q[g7]=q[y7]=q[b7]=q[a7]=q[s7]=q[Ms]=q[l7]=q[f7]=q[u7]=q[c7]=q[w7]=q[k7]=q[x7]=q[v7]=!0;q[n7]=q[Bs]=q[_7]=!1;function Kr(a,e,r,i,f,u){var _,p=e&Xp,y=e&Zp,x=e&e7;if(r&&(_=f?r(a,i,f,u):r(a)),_!==void 0)return _;if(!ne(a))return a;var b=Le(a);if(b){if(_=ws(a),!p)return da(a,_)}else{var A=Tt(a),I=A==Bs||A==o7;if(Mr(a))return ls(a,p);if(A==Ms||A==Ws||I&&!f){if(_=y||I?{}:Cs(a),!p)return y?_s(a,is(_,a)):cs(a,rs(_,a))}else{if(!q[A])return f?a:{};_=Gs(a,A,p)}}u||(u=new ts);var J=u.get(a);if(J)return J;u.set(a,_),Ds(a)?a.forEach(function(re){_.add(Kr(re,e,r,re,a,u))}):Rs(a)&&a.forEach(function(re,P){_.set(P,Kr(re,e,r,P,a,u))});var V=x?y?ps:ds:y?bt:yt,Q=b?void 0:V(a);return pa(Q||a,function(re,P){Q&&(P=re,re=a[P]),Dr(_,P,Kr(re,e,r,P,a,u))}),_}var Us=Kr;var S7=1,T7=4;function A7(a){return Us(a,S7|T7)}var nr=A7;var G7=function(){return Y.Date.now()},Yr=G7;var C7="Expected a function",E7=Math.max,I7=Math.min;function R7(a,e,r){var i,f,u,_,p,y,x=0,b=!1,A=!1,I=!0;if(typeof a!="function")throw new TypeError(C7);e=sn(e)||0,ne(r)&&(b=!!r.leading,A="maxWait"in r,u=A?E7(sn(r.maxWait)||0,e):u,I="trailing"in r?!!r.trailing:I);function J(j){var oe=i,pe=f;return i=f=void 0,x=j,_=a.apply(pe,oe),_}function V(j){return x=j,p=setTimeout(P,e),b?J(j):_}function Q(j){var oe=j-y,pe=j-x,We=e-oe;return A?I7(We,u-pe):We}function re(j){var oe=j-y,pe=j-x;return y===void 0||oe>=e||oe<0||A&&pe>=u}function P(){var j=Yr();if(re(j))return Fe(j);p=setTimeout(P,Q(j))}function Fe(j){return p=void 0,I&&i?J(j):(i=f=void 0,_)}function Oe(){p!==void 0&&clearTimeout(p),x=0,i=y=f=p=void 0}function De(){return p===void 0?_:Fe(Yr())}function de(){var j=Yr(),oe=re(j);if(i=arguments,f=this,y=j,oe){if(p===void 0)return V(y);if(A)return clearTimeout(p),p=setTimeout(P,e),J(y)}return p===void 0&&(p=setTimeout(P,e)),_}return de.cancel=Oe,de.flush=De,de}var at=R7;var F7="Expected a function";function O7(a,e,r){var i=!0,f=!0;if(typeof a!="function")throw new TypeError(F7);return ne(r)&&(i="leading"in r?!!r.leading:i,f="trailing"in r?!!r.trailing:f),at(a,e,{leading:i,maxWait:e,trailing:f})}var st=O7;var D7={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},W7=Ya(D7),Ps=W7;var $s=/&(?:amp|lt|gt|quot|#39);/g,B7=RegExp($s.source);function M7(a){return a=Ka(a),a&&B7.test(a)?a.replace($s,Ps):a}var dn=M7;var le=class extends DataView{constructor(e,r,i){e instanceof Uint8Array?super(e.buffer,e.byteOffset,e.byteLength):super(e,r,i)}getFourCC(e){return String.fromCharCode(this.getUint8(e),this.getUint8(e+1),this.getUint8(e+2),this.getUint8(e+3))}getUint8Subarray(e,r){return new Uint8Array(this.buffer,this.byteOffset+(e||0),r)}setFourCC(e,r){this.setUint8(e,r.charCodeAt(0)),this.setUint8(e+1,r.charCodeAt(1)),this.setUint8(e+2,r.charCodeAt(2)),this.setUint8(e+3,r.charCodeAt(3))}setUint8Array(e,r){this.getUint8Subarray(e,r.length).set(r)}};function js(a){let e=new Uint8Array(a.length*4),r=new DataView(e.buffer);for(let i=0;i<a.length;i++)r.setUint32(i*4,a[i]);return e}function Ls(a){let e=new DataView(a.buffer,a.byteOffset,a.length),r=new Uint32Array(a.length/4);for(let i=0;i<a.length;i+=4)r[i/4]=e.getUint32(i);return r}function Gt(a){return a.BYTES_PER_ELEMENT===4}var or=new TextDecoder,zs=new TextEncoder;var ar=class{constructor(){this.type="";this.chunks=[]}parse(e){let r=new le(e);if(r.getFourCC(0)!=="FORM")throw new Error("Not an IFF file");this.type=r.getFourCC(8);let i=12,f=e.length;for(;i<f;){let u=r.getUint32(i+4);if(u<0||u+i>f)throw new Error("IFF chunk out of range");this.chunks.push({data:r.getUint8Subarray(i+8,u),offset:i,type:r.getFourCC(i)}),i+=8+u,i%2&&i++}}write(){let e=12;for(let f of this.chunks)e+=8+f.data.length,e%2&&e++;let r=new le(new ArrayBuffer(e));r.setFourCC(0,"FORM"),r.setUint32(4,e-8),r.setFourCC(8,this.type);let i=12;for(let f of this.chunks)r.setFourCC(i,f.type),r.setUint32(i+4,f.data.length),r.setUint8Array(i+8,f.data),i+=8+f.data.length,i%2&&i++;return r.getUint8Subarray()}};var qs={Data:"data",Exec:"exec",Pict:"pict","Snd ":"sound"},Ns="????",Ct=class{constructor(e){this.classname="Blorb";this.chunks={};this.is_inited=!1;this.metadata={};e&&this.init(e)}init(e,r){if(!this.is_inited){if(e instanceof Uint8Array){let i=new ar;if(i.parse(e),i.type!=="IFRS")throw new Error("Not a Blorb file");if(i.chunks[0].type!=="RIdx")throw new Error("Malformed blorb: chunk 1 is not RIdx");for(let f of i.chunks)switch(f.type){case"Dbug":{this.debugdata=f.data;break}case"Fspc":{let u=new le(f.data);this.coverimagenum=u.getUint32(0);break}case"IFmd":{let u=or.decode(f.data),_=/<bibliographic>(.+)<\/bibliographic>/is.exec(u),p=/<(\w+)>(.+)<\/\1>/gi,y=/<br\/>/g,x=/\s+/g;if(_){let b;for(;b=p.exec(_[1]);){let A=b[1].toLowerCase(),I=b[2].replace(x," ");A==="description"&&(I=I.replace(y,`
`)),this.metadata[A]=dn(I)}}break}case"RDes":{let u=new le(f.data),_=4;for(;_<u.byteLength;){let p=qs[u.getFourCC(_)],y=u.getUint32(_+4),x=u.getUint32(_+8),b=this.chunks[`${p}:${y}`];b&&(b.alttext=or.decode(u.getUint8Subarray(_+12,x))),_+=12+x}break}case"RIdx":{let u=new le(f.data),_=4;for(;_<u.byteLength;){let p=u.getFourCC(_),y=u.getUint32(_+4),x=u.getUint32(_+8);_+=12;let b=i.chunks.filter(J=>J.offset===x)[0];if(!b)throw new Error(`No Blorb chunk at offset ${x}`);let A=b.type,I={blorbtype:A,content:A==="FORM"?e.subarray(b.offset,b.offset+8+b.data.length):b.data,usage:qs[p]};p==="Pict"&&(A==="JPEG"?I.type="jpeg":A==="PNG "?I.type="png":I.type=Ns),p==="Data"&&(I.binary=A==="BINA"||A==="FORM"),this.chunks[`${I.usage}:${y}`]=I}break}}}else if(r?.format==="infomap")for(let i in e){if(!Number.isInteger(+i))continue;let f=Object.assign({},e[i]);delete f.image,f.height&&f.width&&(f.imagesize={height:f.height,width:f.width},delete f.height,delete f.width),f.type=f.url.endsWith(".png")?"png":"jpeg",f.usage="pict",this.chunks[`pict:${i}`]=f}else if(!(Array.isArray(e)&&e.length===0))throw new Error("Unsupported Blorb.init data format");this.is_inited=!0}}getlibrary(){return null}get_chunk(e,r){return this.chunks[`${e}:${r}`]||null}get_cover_pict(){return this.coverimagenum??null}get_data_chunk(e){let r=this.chunks[`data:${e}`];return r?.content?{binary:r.binary,data:r.content}:null}get_debug_info(){return this.debugdata}get_exec_data(e){let r=this.chunks["exec:0"];return!r?.content||e&&r.blorbtype!==e?null:r.content}get_image_info(e){let r=this.chunks[`pict:${e}`];if(!r)return null;!r.imagesize&&r.content&&(r.type==="jpeg"?r.imagesize=U7(r.content):r.type==="png"&&(r.imagesize=P7(r.content)));let i=Object.assign({image:e},r);return i.imagesize&&(i.height=i.imagesize.height,i.width=i.imagesize.width),i}get_image_url(e){let r=this.chunks[`pict:${e}`];return r?r.url?r.url:r.type!==Ns&&r.content?(r.url=URL.createObjectURL(new Blob([r.content],{type:`image/${r.type}`})),r.url):null:null}get_metadata(e){return this.metadata[e]}inited(){return this.is_inited}};function U7(a){let e=new le(a),r=0;for(;r<e.byteLength;){if(e.getUint8(r)!==255)return;for(;e.getUint8(r)===255;)r++;let i=e.getUint8(r++);if(i===1||i>=208&&i<=217)continue;let f=e.getUint16(r);if(i>=192&&i<=207&&i!==200)return f<7?void 0:{height:e.getUint16(r+3),width:e.getUint16(r+5)};r+=f}}function P7(a){let e=new le(a);if(e.getFourCC(0)!=="\x89PNG")return;let r=8;for(;r<e.byteLength;){let i=e.getUint32(r),f=e.getFourCC(r+4);if(r+=8,f==="IHDR")return{height:e.getInt32(r+4),width:e.getInt32(r)};r+=i+4}}var sr={buffercharheight:1,buffercharwidth:1,buffermarginx:0,buffermarginy:0,graphicsmarginx:0,graphicsmarginy:0,gridcharheight:1,gridcharwidth:1,gridmarginx:0,gridmarginy:0,height:50,inspacingx:0,inspacingy:0,outspacingx:0,outspacingy:0,width:80},pn={8:"delete",9:"tab",13:"return",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",112:"func1",113:"func2",114:"func3",115:"func4",116:"func5",117:"func6",118:"func7",119:"func8",120:"func9",121:"func10",122:"func11",123:"func12"},hn=40,mn=13,gn=38,Jr="\xA0";var Hs="-10000px",Qr="0.1.0";var wo={};ju(wo,{evtype_Arrange:()=>eo,evtype_CharInput:()=>Qn,evtype_Hyperlink:()=>ro,evtype_LineInput:()=>Xn,evtype_MouseInput:()=>Zn,evtype_None:()=>li,evtype_Redraw:()=>to,evtype_SoundNotify:()=>V7,evtype_Timer:()=>fi,evtype_VolumeNotify:()=>K7,filemode_Read:()=>te,filemode_ReadWrite:()=>Se,filemode_Write:()=>be,filemode_WriteAppend:()=>di,fileusage_BinaryMode:()=>f1,fileusage_Data:()=>a1,fileusage_InputRecord:()=>l1,fileusage_SavedGame:()=>_i,fileusage_TextMode:()=>ao,fileusage_Transcript:()=>s1,fileusage_TypeMask:()=>Bt,gestalt_CharInput:()=>bn,gestalt_CharOutput:()=>kn,gestalt_CharOutput_ApproxPrint:()=>j7,gestalt_CharOutput_CannotPrint:()=>$7,gestalt_CharOutput_ExactPrint:()=>xn,gestalt_DateTime:()=>Wn,gestalt_DrawImage:()=>An,gestalt_GarglkText:()=>Un,gestalt_Graphics:()=>Tn,gestalt_GraphicsCharInput:()=>Mn,gestalt_GraphicsTransparency:()=>En,gestalt_HyperlinkInput:()=>Cn,gestalt_Hyperlinks:()=>Gn,gestalt_LineInput:()=>wn,gestalt_LineInputEcho:()=>Fn,gestalt_LineTerminatorKey:()=>Dn,gestalt_LineTerminators:()=>On,gestalt_MouseInput:()=>vn,gestalt_ResourceStream:()=>Bn,gestalt_Sound:()=>L7,gestalt_Sound2:()=>H7,gestalt_SoundMusic:()=>N7,gestalt_SoundNotify:()=>q7,gestalt_SoundVolume:()=>z7,gestalt_Timer:()=>Sn,gestalt_Unicode:()=>In,gestalt_UnicodeNorm:()=>Rn,gestalt_Version:()=>yn,imagealign_InlineCenter:()=>m1,imagealign_InlineDown:()=>h1,imagealign_InlineUp:()=>p1,imagealign_MarginLeft:()=>g1,imagealign_MarginRight:()=>y1,keycode_Delete:()=>qn,keycode_Down:()=>Ln,keycode_End:()=>Yn,keycode_Escape:()=>Et,keycode_Func1:()=>It,keycode_Func10:()=>ai,keycode_Func11:()=>si,keycode_Func12:()=>lt,keycode_Func2:()=>Xr,keycode_Func3:()=>Zr,keycode_Func4:()=>ei,keycode_Func5:()=>ti,keycode_Func6:()=>ri,keycode_Func7:()=>ii,keycode_Func8:()=>ni,keycode_Func9:()=>oi,keycode_Home:()=>Kn,keycode_Left:()=>lr,keycode_MAXVAL:()=>Jn,keycode_PageDown:()=>Vn,keycode_PageUp:()=>Hn,keycode_Return:()=>zn,keycode_Right:()=>$n,keycode_Tab:()=>Nn,keycode_Unknown:()=>Pn,keycode_Up:()=>jn,seekmode_Current:()=>lo,seekmode_End:()=>ut,seekmode_Start:()=>so,style_Alert:()=>e1,style_BlockQuote:()=>r1,style_Emphasized:()=>J7,style_Header:()=>X7,style_Input:()=>i1,style_NUMSTYLES:()=>ui,style_Normal:()=>Y7,style_Note:()=>t1,style_Preformatted:()=>Q7,style_Subheader:()=>Z7,style_User1:()=>n1,style_User2:()=>o1,stylehint_BackColor:()=>go,stylehint_Indentation:()=>fo,stylehint_Justification:()=>cr,stylehint_NUMHINTS:()=>bo,stylehint_Oblique:()=>po,stylehint_ParaIndentation:()=>uo,stylehint_Proportional:()=>ho,stylehint_ReverseColor:()=>yo,stylehint_Size:()=>co,stylehint_TextColor:()=>mo,stylehint_Weight:()=>_o,stylehint_just_Centered:()=>_1,stylehint_just_LeftFlush:()=>u1,stylehint_just_LeftRight:()=>c1,stylehint_just_RightFlush:()=>d1,winmethod_Above:()=>Ot,winmethod_Below:()=>io,winmethod_Border:()=>no,winmethod_BorderMask:()=>ft,winmethod_DirMask:()=>Dt,winmethod_DivisionMask:()=>Wt,winmethod_Fixed:()=>Je,winmethod_Left:()=>Ye,winmethod_NoBorder:()=>oo,winmethod_Proportional:()=>ci,winmethod_Right:()=>Ft,wintype_AllTypes:()=>fr,wintype_Blank:()=>Rt,wintype_Graphics:()=>Ke,wintype_Pair:()=>ur,wintype_TextBuffer:()=>ve,wintype_TextGrid:()=>Ie,zcolor_Current:()=>hi,zcolor_Default:()=>pi});var yn=0,bn=1,wn=2,kn=3,$7=0,j7=1,xn=2,vn=4,Sn=5,Tn=6,An=7,L7=8,z7=9,q7=10,Gn=11,Cn=12,N7=13,En=14,In=15,Rn=16,Fn=17,On=18,Dn=19,Wn=20,H7=21,Bn=22,Mn=23,Un=4352,Pn=4294967295,lr=4294967294,$n=4294967293,jn=4294967292,Ln=4294967291,zn=4294967290,qn=4294967289,Et=4294967288,Nn=4294967287,Hn=4294967286,Vn=4294967285,Kn=4294967284,Yn=4294967283,It=4294967279,Xr=4294967278,Zr=4294967277,ei=4294967276,ti=4294967275,ri=4294967274,ii=4294967273,ni=4294967272,oi=4294967271,ai=4294967270,si=4294967269,lt=4294967268,Jn=28,li=0,fi=1,Qn=2,Xn=3,Zn=4,eo=5,to=6,V7=7,ro=8,K7=9,Y7=0,J7=1,Q7=2,X7=3,Z7=4,e1=5,t1=6,r1=7,i1=8,n1=9,o1=10,ui=11,fr=0,ur=1,Rt=2,ve=3,Ie=4,Ke=5,Ye=0,Ft=1,Ot=2,io=3,Dt=15,Je=16,ci=32,Wt=240,no=0,oo=256,ft=256,a1=0,_i=1,s1=2,l1=3,Bt=15,ao=256,f1=0,be=1,te=2,Se=3,di=5,so=0,lo=1,ut=2,fo=0,uo=1,cr=2,co=3,_o=4,po=5,ho=6,mo=7,go=8,yo=9,bo=10,u1=0,c1=1,_1=2,d1=3,p1=1,h1=2,m1=3,g1=4,y1=5,pi=-1,hi=-2;var mi=class{constructor(e,r,i){this.binary=r,this.buf=e,this.fref=i,this.uni=Gt(e)}convert(){if(this.uni){if(this.binary)return js(this.buf);{let e=String.fromCodePoint(...this.buf);return zs.encode(e)}}else return this.buf.slice()}},gi=class{constructor(e){this.cache={};this.classname="CachingDialogWrapper";this.streaming=!1;this.write=at(()=>{for(let e in this.cache){let r=this.cache[e];if(this.Dialog.streaming){let i=this.Dialog.file_fopen(1,r.fref);i.fwrite(r.convert()),i.fclose()}else this.Dialog.file_write(r.fref,r.convert())}this.cache={}},0);this.Dialog=e}init(e){}file_ref_exists(e){return!!this.cache[e.filename]||this.Dialog.file_ref_exists(e)}file_read(e){if(this.cache[e.filename])return this.cache[e.filename].convert();if(this.Dialog.streaming){let r=this.Dialog.file_fopen(2,e);if(!r)return null;r.fseek(0,2);let i=r.ftell(),f=new Uint8Array(i);return r.fseek(0,0),r.fread(f),r.fclose(),f}else return this.Dialog.file_read(e)}file_remove_ref(e){this.cache[e.filename]&&delete this.cache[e.filename],this.Dialog.file_remove_ref(e)}file_write(e,r){throw new Error("CachingDialogWrapper.write_file should be called instead")}inited(){return!0}write_file(e,r){return this.cache[e.filename]=r,this.write(),!0}autosave_read(e){return this.Dialog.autosave_read(e)}autosave_write(e,r){this.Dialog.autosave_write(e,r)}file_clean_fixed_name(e,r){return this.Dialog.file_clean_fixed_name(e,r)}file_construct_ref(e,r,i){return this.Dialog.file_construct_ref(e,r,i)}file_construct_temp_ref(e){return this.Dialog.file_construct_temp_ref(e)}getlibrary(e){return this.Dialog.getlibrary(e)}open(e,r,i,f){this.Dialog.open(e,r,i,f)}};function _r(a,e,r){let i=Math.min(r,e.length);for(let f=0;f<i;f++)e[f]=a[f]}var yi=class{constructor(e,r,i,f,u){this.next=null;this.prev=null;this.binary=!(u&256),this.Dialog=e,this.filename=r,this.dfref=i,this.rock=f}delete_file(){this.Dialog.file_remove_ref(this.dfref)}exists(){return this.Dialog.file_ref_exists(this.dfref)}read(){return this.Dialog.file_read(this.dfref)}write(e){let r=new mi(e,this.binary,this.dfref);this.Dialog.write_file(this.dfref,r)}};var dr={dummy:"Glk call has not yet returned"};var Ks=0,Qe=255,Xe=63,ko=["margin-left","text-indent","text-align","font-size","font-weight","font-style","monospace","color","background-color","reverse"],Ys={1:"write",2:"read",3:"readwrite",5:"writeappend"},bi={0:"data",1:"save",2:"transcript",3:"command"},Js={1:"inlineup",2:"inlinedown",3:"inlinecenter",4:"marginleft",5:"marginright"},Qs={delete:4294967289,down:4294967291,end:4294967283,escape:4294967288,func1:4294967279,func2:4294967278,func3:4294967277,func4:4294967276,func5:4294967275,func6:4294967274,func7:4294967273,func8:4294967272,func9:4294967271,func10:4294967270,func11:4294967269,func12:4294967268,home:4294967284,left:4294967294,pagedown:4294967285,pageup:4294967286,return:4294967290,right:4294967293,tab:4294967287,up:4294967292},wi={0:"normal",1:"emphasized",2:"preformatted",3:"header",4:"subheader",5:"alert",6:"note",7:"blockquote",8:"input",9:"user1",10:"user2"},xo={4294967288:"escape",4294967279:"func1",4294967278:"func2",4294967277:"func3",4294967276:"func4",4294967275:"func5",4294967274:"func6",4294967273:"func7",4294967272:"func8",4294967271:"func9",4294967270:"func10",4294967269:"func11",4294967268:"func12"},Xs={escape:4294967288,func1:4294967279,func2:4294967278,func3:4294967277,func4:4294967276,func5:4294967275,func6:4294967274,func7:4294967273,func8:4294967272,func9:4294967271,func10:4294967270,func11:4294967269,func12:4294967268};var pr=class{constructor(e,r){this.next=null;this.prev=null;this.write_count=0;this.fmode=e,this.rock=r}close(e){e&&(e.set_field(0,0),e.set_field(1,this.write_count))}get_buffer(e){return 0}get_char(e){return-1}get_line(e){return 0}get_position(){return 0}set_position(e,r){}},Ze=class extends pr{constructor(r,i,f,u){super(i,f);this.pos=0;this.read_count=0;this.type="array";this.buf=r,this.close_cb=u,this.expandable=i===1,this.len=i===1?0:r.length,this.uni=Gt(r)}close(r){this.close_cb?.(),this.write(),r&&(r.set_field(0,this.read_count),r.set_field(1,this.write_count))}expand(r){this.len=Math.min(this.pos+r,this.buf.length),this.len===this.buf.length&&(this.expandable=!1)}get_buffer(r){let i=Math.min(r.length,this.len-this.pos);if(!Gt(r)&&this.uni)for(let f=0;f<i;f++){let u=this.buf[this.pos+f];r[f]=u>Qe?Xe:u}else r.set(this.buf.subarray(this.pos,this.pos+i));return this.pos+=i,this.read_count+=i,i}get_char(r){if(this.pos<this.len){this.read_count++;let i=this.buf[this.pos++];return!r&&i>Qe?Xe:i}return-1}get_line(r){let i=Math.min(r.length-1,this.len-this.pos);if(i<0)return 0;let f=!Gt(r)&&this.uni,u=0;for(;u<i;){let _=this.buf[this.pos++];if(r[u++]=f&&_>Qe?Xe:_,_===10)break}return r[u]=Ks,this.read_count+=u,u}get_position(){return this.pos}put_buffer(r,i){let f=r.length;this.write_count+=f,this.pos+f>this.len&&this.expandable&&this.expand(f);let u=Math.min(f,this.len-this.pos);if(u!==0){if(i&&!this.uni)for(let _=0;_<u;_++){let p=r[_];this.buf[this.pos+_]=p>Qe?Xe:p}else Array.isArray(r)&&(r=(i?Uint32Array:Uint8Array).from(r)),this.buf.set(r.subarray(0,u),this.pos);this.pos+=u,this.write()}}put_char(r){this.write_count++,this.pos===this.len&&this.expandable&&this.expand(1),this.pos<this.len&&(this.buf[this.pos++]=!this.uni&&r>Qe?Xe:r,this.write())}put_string(r){this.put_buffer(Uint32Array.from(r,i=>i.codePointAt(0)),!0)}set_position(r,i){r===1?this.pos+=i:r===2?this.pos=this.len+i:this.pos=i,this.pos<0&&(this.pos=0),this.pos>this.len&&(this.pos=this.len)}write(){}},ki=class extends Ze{constructor(e,r,i,f){super(r,i,f),this.expandable=!0,this.fref=e}expand(e){let r=this.pos+e;this.len=r;let i=this.buf.length;if(r>i){i+=Math.max(r-i,100);let f=this.buf;this.buf=new(this.uni?Uint32Array:Uint8Array)(i),this.buf.set(f)}}write(){this.fref.write(this.buf.subarray(0,this.len))}},xi=class extends pr{constructor(){super(...arguments);this.type="null"}put_buffer(r,i){this.write_count+=r.length}put_char(r){this.write_count++}put_string(r,i){this.write_count+=[...r].length}},vi=class extends pr{constructor(r){super(1,0);this.type="window";this.win=r}put_buffer(r,i){if(this.win.input.type==="line")throw new Error("Window has pending line request");this.write_count+=r.length,this.win.put_string(String.fromCodePoint(...r)),this.win.echostr?.put_buffer(r,i)}put_char(r){if(this.win.input.type==="line")throw new Error("Window has pending line request");this.write_count++,this.win.put_string(String.fromCodePoint(r)),this.win.echostr?.put_char(r)}put_string(r,i){if(this.win.input.type==="line")throw new Error("Window has pending line request");this.write_count+=[...r].length,this.win.put_string(r,i),this.win.echostr?.put_string(r,i)}set_css(r,i){this.win.set_css(r,i),this.win.echostr?.type==="window"&&this.win.echostr.set_css(r,i)}set_hyperlink(r){this.win.set_hyperlink(r),this.win.echostr?.type==="window"&&this.win.echostr.set_hyperlink(r)}set_style(r){this.win.set_style(r),this.win.echostr?.type==="window"&&this.win.echostr.set_style(r)}};var Ut=class{constructor(e){this.box={bottom:0,left:0,right:0,top:0};this.disprock=0;this.echostr=null;this.input={id:0};this.next=null;this.parent=null;this.prev=null;this.rock=e,this.str=new vi(this)}clear(){}put_string(e,r){}set_css(e,r){}set_hyperlink(e){}set_style(e){}update(){if(this.type==="blank"||this.type==="pair")return{content:null,input:null,size:null};let e={id:this.input.id};Mt(this.input,e,"hyperlink"),Mt(this.input,e,"mouse");let r=this.box;return{content:null,input:e,size:{height:r.bottom-r.top,id:this.disprock,left:r.left,rock:this.rock,top:r.top,type:this.type,width:r.right-r.left}}}},Si=class extends Ut{constructor(){super(...arguments);this.type="blank";this.typenum=2}},Ti=class extends Ut{constructor(r,i){super(r);this.cleared=!0;this.request_echo_line_input=!0;this.stylehints=nr(i)}update(){let r=super.update();Object.keys(this.stylehints).length&&(r.size.styles=this.stylehints);let i=this.input,f=r.input;return i.type&&(Mt(i,f,"gen"),Mt(i,f,"type"),i.type==="line"&&(f.maxlen=this.line_input_buf.length,Mt(i,f,"initial"),Mt(i,f,"terminators"))),delete i.initial,r}},Ai=class extends Ti{constructor(r,i){super(r,i);this.echo_line_input=!0;this.last_textrun=fe(Ii,!0);this.type="buffer";this.typenum=3;this.last_textrun=fe(Ii,!0),this.content=[{content:[this.last_textrun]}],this.last_par=this.content[0]}clear(){this.cleared=!0,this.clear_content()}clear_content(){this.last_textrun=fe(this.last_textrun,!1),this.content=[{append:!0,content:[this.last_textrun]}],this.last_par=this.content[0]}clone_textrun(r,i){(i||this.last_textrun.text!=="")&&(this.last_textrun=fe(this.last_textrun,r),this.last_par.content.push(this.last_textrun))}put_image(r){r.hyperlink=this.last_textrun.hyperlink,this.last_par.content.push(r),this.clone_textrun(!1,!0)}put_string(r,i){let f=this.last_textrun.style;i&&this.set_style(i);for(let[u,_]of r.split(`
`).entries())u!==0&&(this.last_textrun=fe(this.last_textrun,!1),this.last_par={content:[this.last_textrun]},this.content.push(this.last_par)),this.last_textrun.text+=_;i&&this.set_style(f)}set_css(r,i){this.last_textrun.css_styles[r]!==i&&(this.clone_textrun(!0),i===void 0?delete this.last_textrun.css_styles[r]:this.last_textrun.css_styles[r]=i)}set_flow_break(){this.last_par.flowbreak=!0}set_hyperlink(r){r===0&&(r=void 0),r!==this.last_textrun.hyperlink&&(this.clone_textrun(!1),r?this.last_textrun.hyperlink=r:delete this.last_textrun.hyperlink)}set_style(r){r!==this.last_textrun.style&&(this.clone_textrun(!1),this.last_textrun.style=r)}update(){let r=super.update();this.last_textrun=fe(this.last_textrun,!1);let i=this.content;for(let f of i)f.content=Zs(f.content.filter(u=>"special"in u||u.text));return(this.cleared||i.length>1||i[0].content.length)&&(r.content={id:this.disprock,text:i.map(f=>f.append||f.flowbreak||f.content.length?f:{})},this.cleared&&(r.content.clear=!0,this.cleared=!1)),this.clear_content(),r}},Gi=class extends Ut{constructor(){super(...arguments);this.draw=[];this.height=0;this.type="graphics";this.typenum=5;this.width=0}clear(){this.draw=this.draw.filter(r=>r.special==="setcolor").slice(-1),this.draw.push({special:"fill"})}update(){let r=super.update();return this.draw.length&&(r.content={draw:this.draw,id:this.disprock},this.draw=[]),r.size.graphheight=this.height,r.size.graphwidth=this.width,r}},Ci=class extends Ti{constructor(){super(...arguments);this.current_styles=fe(Ii,!0);this.height=0;this.lines=[];this.type="grid";this.typenum=4;this.width=0;this.x=0;this.y=0}clear(){this.cleared=!0;let r=this.height;this.update_size(0,this.width),this.update_size(r,this.width),this.x=this.y=0}fit_cursor(){if(this.x>=this.width&&(this.x=0,this.y++),this.y>=this.height)return!0}put_string(r,i){let f=this.current_styles.style;i&&this.set_style(i);for(let u of r){if(this.fit_cursor())break;if(u===`
`){this.x=0,this.y++;continue}let _=this.lines[this.y];_.changed=!0,_.content[this.x++]=fe(this.current_styles,!1,u)}i&&this.set_style(f)}set_css(r,i){this.current_styles.css_styles[r]!==i&&(this.current_styles=fe(this.current_styles,!0),i===void 0?delete this.current_styles.css_styles[r]:this.current_styles.css_styles[r]=i)}set_hyperlink(r){r?this.current_styles.hyperlink=r:delete this.current_styles.hyperlink}set_style(r){this.current_styles.style=r}update_size(r,i){let f=this.height,u=this.width;this.height=r,this.width=i;let _=fe(Ii,!0," ");if(f>r)this.lines.length=r;else if(r>f)for(let y=f;y<r;y++){let x=[];for(let b=0;b<i;b++)x.push(fe(_,!1," "));this.lines[y]={changed:!0,content:x}}let p=Math.min(r,f);if(p&&i!==u)for(let y=0;y<p;y++){let x=this.lines[y];if(i<u)x.changed=!0,x.content.length=i;else{x.changed=!0;for(let b=u;b<i;b++)x.content.push(fe(_,!1," "))}}}update(){let r=super.update();if(this.lines.find(i=>i.changed)&&(r.content={id:this.disprock,lines:this.lines.flatMap((i,f)=>i.changed?(i.changed=!1,{content:Zs(i.content.reduce((u,_)=>{if(!u.length)return[fe(_,!1,_.text)];let p=u[u.length-1];return _.css_styles===p.css_styles&&_.hyperlink===p.hyperlink&&_.style===p.style?p.text+=_.text:u.push(fe(_,!1,_.text)),u},[])),line:f}):[])},this.cleared&&(r.content.clear=!0,this.cleared=!1)),this.input.type){let i=r.input;this.fit_cursor()?(i.xpos=this.width-1,i.ypos=this.height-1):(i.xpos=this.x,i.ypos=this.y)}return r.size.gridheight=this.height,r.size.gridwidth=this.width,r}},Ei=class extends Ut{constructor(r,i,f){super(0);this.child1=null;this.child2=null;this.type="pair";this.typenum=1;this.border=(i&256)===256,this.dir=i&15,this.fixed=(i&240)===16,this.key=r,this.size=f,this.backward=this.dir===0||this.dir===2,this.vertical=this.dir===0||this.dir===1}},Ii={css_styles:{},style:"normal",text:""};function Zs(a){return a.map(e=>("special"in e||Object.keys(e.css_styles).length||delete e.css_styles,e))}function fe(a,e,r=""){return Object.assign({},a,{css_styles:e?Object.assign({},a.css_styles):a.css_styles,text:r})}function Mt(a,e,r){a[r]&&(e[r]=a[r])}var Oi=class{constructor(){this.value=0}get_value(){return this.value}set_value(e){this.value=e}},Di=class{constructor(){this.fields=[]}get_field(e){return this.fields[e]}get_fields(){return this.fields}push_field(e){this.fields.push(e)}set_field(e,r){this.fields[e]=r}},gr=class{constructor(){this.Dialog=null;this.GlkOte=null;this.VM=null;this.disprock_counter=1;this.do_autosave=!1;this.exited=!1;this.first_fref=null;this.gen=0;this.metrics=sr;this.current_stream=null;this.first_stream=null;this.stylehints={buffer:{},grid:{}};this.support=[];this.timer={interval:0,last_interval:0,started:0};this.version=Qr;this.first_window=null;this.root_window=null;this.windows_changed=!1;this.Const=wo;this.DidNotReturn=dr;this.RefBox=Oi;this.RefStruct=Di}init(e){if(this.before_select_hook=e.before_select_hook,this.Blorb=e.Blorb,e.Dialog)this.Dialog=new gi(e.Dialog);else throw new Error("No reference to Dialog");if(this.do_autosave=!!e.do_vm_autosave,this.GiDispa=e.GiDispa,this.gestalt_hook=e.glk_gestalt_hook,e.GlkOte)this.GlkOte=e.GlkOte;else throw new Error("No reference to GlkOte");if(e.vm)this.VM=e.vm;else throw new Error("No reference to VM");this.before_select_hook?.(),this.GiDispa?.init({io:this,vm:this.VM});let r=e;r.accept=this.accept.bind(this),this.GlkOte.init(r)}call_may_not_return(e){return e===1||e===192||e===98}fatal_error(e){if(this.exited=!0,!this.GlkOte){console.error("Fatal error: "+e);return}this.GlkOte.error(e),this.GlkOte.update({type:"update",disable:!0,gen:this.gen})}getlibrary(e){switch(e){case"Blorb":return this.Blorb||null;case"Dialog":return this.Dialog;case"GiDispa":return this.GiDispa||null;case"GlkOte":return this.GlkOte;case"VM":return this.VM;default:return null}}inited(){return!!(this.GlkOte&&this.VM)}restore_allstate(e){throw new Error("Autosaves not yet supported")}save_allstate(){throw new Error("Autosaves not yet supported")}update(){let e={gen:this.gen,type:"update"};this.exited&&(e.disable=!0);let r=[],i=[],f=[];for(let _=this.first_window;_;_=_.next){let p=_.update();if(p.content&&r.push(p.content),p.input){let y=p.input;(y.hyperlink||y.mouse||y.type)&&i.push(y)}this.windows_changed&&p.size&&f.push(p.size)}r.length&&(e.content=r),i.length&&(e.input=i),f.length&&(e.windows=f),this.windows_changed=!1,this.special&&(e.specialinput=this.special,delete this.special);let u=this.timer;u.last_interval!==u.interval&&(e.timer=u.interval||null,u.last_interval=u.interval),this.GlkOte.update(nr(e)),this.before_select_hook?.()}byte_array_to_string(e){return String.fromCodePoint(...e)}glk_put_jstring(e,r){this.glk_put_jstring_stream(this.current_stream,e)}glk_put_jstring_stream(e,r,i){if(!e)throw new Error("Invalid Stream");e.put_string(r)}uni_array_to_string(e){return String.fromCodePoint(...e)}glk_buffer_canon_decompose_uni(e,r){return hr(e,r,i=>i.normalize("NFD"))}glk_buffer_canon_normalize_uni(e,r){return hr(e,r,i=>i.normalize("NFC"))}glk_buffer_to_lower_case_uni(e,r){return hr(e,r,i=>i.toLowerCase())}glk_buffer_to_title_case_uni(e,r,i){return hr(e,r,f=>f.reduce((u,_,p)=>{let y={\u00DF:"Ss",\u01C4:"\u01C5",\u01C5:"\u01C5",\u01C6:"\u01C5",\u01C7:"\u01C8",\u01C8:"\u01C8",\u01C9:"\u01C8",\u01CA:"\u01CB",\u01CB:"\u01CB",\u01CC:"\u01CB",\u01F1:"\u01F2",\u01F2:"\u01F2",\u01F3:"\u01F2",\u0587:"\u0535\u0582",\u1FB2:"\u1FBA\u0345",\u1FB3:"\u1FBC",\u1FB4:"\u0386\u0345",\u1FB7:"\u0391\u0342\u0345",\u1FBC:"\u1FBC",\u1FC2:"\u1FCA\u0345",\u1FC3:"\u1FCC",\u1FC4:"\u0389\u0345",\u1FC7:"\u0397\u0342\u0345",\u1FCC:"\u1FCC",\u1FF2:"\u1FFA\u0345",\u1FF3:"\u1FFC",\u1FF4:"\u038F\u0345",\u1FF7:"\u03A9\u0342\u0345",\u1FFC:"\u1FFC",\uFB00:"Ff",\uFB01:"Fi",\uFB02:"Fl",\uFB03:"Ffi",\uFB04:"Ffl",\uFB05:"St",\uFB06:"St",\uFB13:"\u0544\u0576",\uFB14:"\u0544\u0565",\uFB15:"\u0544\u056B",\uFB16:"\u054E\u0576",\uFB17:"\u0544\u056D"},x=["\u1F88\u1F89\u1F8A\u1F8B\u1F8C\u1F8D\u1F8E\u1F8F","\u1F98\u1F99\u1F9A\u1F9B\u1F9C\u1F9D\u1F9E\u1F9F","\u1FA8\u1FA9\u1FAA\u1FAB\u1FAC\u1FAD\u1FAE\u1FAF"],b=String.fromCodePoint(_);return p===0?y[b]?b=y[b]:_>=8064&&_<8112?b=x[(_-8064)/16|0][_%8]:b=b.toUpperCase():i&&(b=b.toLowerCase()),u+b},""),!0)}glk_buffer_to_upper_case_uni(e,r){return hr(e,r,i=>i.toUpperCase())}glk_cancel_char_event(e){if(!e)throw new Error("Invalid Window");delete e.input.type}glk_cancel_hyperlink_event(e){if(!e)throw new Error("Invalid Window");(e.type==="buffer"||e.type==="grid")&&delete e.input.hyperlink}glk_cancel_line_event(e,r){if(!e)throw new Error("Invalid Window");if(e.input.type!=="line"){r&&Ri(r);return}this.handle_line_input(e,this.partial_inputs?.[e.disprock]??"",r)}glk_cancel_mouse_event(e){if(!e)throw new Error("Invalid Window");(e.type==="graphics"||e.type==="grid")&&delete e.input.mouse}glk_char_to_lower(e){return e>=65&&e<=90||e>=192&&e<=222&&e!==215?e+32:e}glk_char_to_upper(e){return e>=97&&e<=122||e>=224&&e<=254&&e!==247?e-32:e}glk_current_simple_time(e){return Math.floor(Date.now()/(e*1e3))}glk_current_time(e){vo(Date.now(),e)}glk_date_to_simple_time_local(e,r){return Math.floor(tl(e)/(r*1e3))}glk_date_to_simple_time_utc(e,r){return Math.floor(rl(e)/(r*1e3))}glk_date_to_time_local(e,r){vo(tl(e),r)}glk_date_to_time_utc(e,r){vo(rl(e),r)}glk_exit(){return this.exited=!0,dr}glk_fileref_create_by_name(e,r,i){let f=this.Dialog.file_clean_fixed_name(r,e&15);return this.create_fileref(f,i,e)}glk_fileref_create_by_prompt(e,r,i){let f=Ys[r]??"read",u=e&15,_=bi[u]??"data";return this.special={filemode:f,filetype:_,type:"fileref_prompt"},u===1&&(this.special.gameid=this.VM.get_signature()),this.special_data={rock:i,usage:e},dr}glk_fileref_create_from_fileref(e,r,i){if(!r)throw new Error("Invalid Fileref");return this.create_fileref(r.filename,i,e)}glk_fileref_create_temp(e,r){let i=bi[e&15],f=this.Dialog.file_construct_temp_ref(i);return this.create_fileref(f.filename,r,e,f)}glk_fileref_delete_file(e){if(!e)throw new Error("Invalid Fileref");e.delete_file()}glk_fileref_destroy(e){if(!e)throw new Error("Invalid Fileref");this.GiDispa?.class_unregister("fileref",e);let r=e.prev,i=e.next;e.prev=null,e.next=null,r?r.next=i:this.first_fref=i,i&&(i.prev=r)}glk_fileref_does_file_exist(e){if(!e)throw new Error("Invalid Fileref");return e.exists()}glk_fileref_get_rock(e){if(!e)throw new Error("Invalid Fileref");return e.rock}glk_fileref_iterate(e,r){let i=e?e.next:this.first_fref;return r&&r.set_value(i?i.rock:0),i}glk_gestalt(e,r){return this.glk_gestalt_ext(e,r,null)}glk_gestalt_ext(e,r,i){let f=this.gestalt_hook?.(e,r,i);if(f)return f;switch(e){case 0:return 1797;case 1:return r<=4294967294&&r>=4294967268?1:r>=4294967296-28||r>1114111||r>=0&&r<32||r>=127&&r<160?0:1;case 2:return r>1114111||r>=0&&r<32||r>=127&&r<160?0:1;case 3:return i&&(i[0]=1),2;case 19:return+(r===4294967288||r>=4294967268&&r<=4294967279);case 7:return+((r===5||r===3)&&this.support.includes("graphics"));case 4352:return+this.support.includes("garglktext");case 6:case 23:case 14:return+this.support.includes("graphics");case 11:return+this.support.includes("hyperlinks");case 12:return+((r===3||r===4)&&this.support.includes("hyperlinks"));case 4:return+((r===5||r===4)&&this.support.includes("graphics"));case 5:return+this.support.includes("timer");case 20:case 17:case 18:case 22:case 15:case 16:return 1;default:return 0}}glk_get_buffer_stream(e,r){if(!e)throw new Error("Invalid Stream");if(e.fmode!==2&&e.fmode!==3)throw new Error("Cannot read from write-only stream");return Array.isArray(r)?Fi(r,Uint8Array,i=>e.get_buffer(i)):e.get_buffer(r)}glk_get_buffer_stream_uni(e,r){if(!e)throw new Error("Invalid Stream");if(e.fmode!==2&&e.fmode!==3)throw new Error("Cannot read from write-only stream");return Array.isArray(r)?Fi(r,Uint32Array,i=>e.get_buffer(i)):e.get_buffer(r)}glk_get_char_stream(e){if(!e)throw new Error("Invalid Stream");if(e.fmode!==2&&e.fmode!==3)throw new Error("Cannot read from write-only stream");return e.get_char(!1)}glk_get_char_stream_uni(e){if(!e)throw new Error("Invalid Stream");if(e.fmode!==2&&e.fmode!==3)throw new Error("Cannot read from write-only stream");return e.get_char(!0)}glk_get_line_stream(e,r){if(!e)throw new Error("Invalid Stream");if(e.fmode!==2&&e.fmode!==3)throw new Error("Cannot read from write-only stream");return Array.isArray(r)?Fi(r,Uint8Array,i=>e.get_line(i)+1)-1:e.get_line(r)}glk_get_line_stream_uni(e,r){if(!e)throw new Error("Invalid Stream");if(e.fmode!==2&&e.fmode!==3)throw new Error("Cannot read from write-only stream");return Array.isArray(r)?Fi(r,Uint32Array,i=>e.get_line(i)+1)-1:e.get_line(r)}glk_image_draw(e,r,i,f){let u=this.Blorb?.get_image_info(r);return u?(this.draw_image(e,u,u.height||0,i,f,u.width||0),1):0}glk_image_draw_scaled(e,r,i,f,u,_){let p=this.Blorb?.get_image_info(r);return p?(this.draw_image(e,p,_||0,i,f,u||0),1):0}glk_image_get_info(e,r,i){let f=this.Blorb?.get_image_info(e);return i&&i.set_value(f?.height||0),r&&r.set_value(f?.width||0),f?1:0}glk_put_buffer(e){this.glk_put_buffer_stream(this.current_stream,e)}glk_put_buffer_stream(e,r){if(!e)throw new Error("Invalid Stream");if(e.fmode===2)throw new Error("Cannot write to read-only stream");e.put_buffer(r,!1)}glk_put_buffer_stream_uni(e,r){if(!e)throw new Error("Invalid Stream");if(e.fmode===2)throw new Error("Cannot write to read-only stream");e.put_buffer(r,!0)}glk_put_buffer_uni(e){this.glk_put_buffer_stream_uni(this.current_stream,e)}glk_put_char(e){this.glk_put_char_stream(this.current_stream,e)}glk_put_char_stream(e,r){if(!e)throw new Error("Invalid Stream");if(e.fmode===2)throw new Error("Cannot write to read-only stream");e.put_char(r)}glk_put_char_stream_uni(e,r){this.glk_put_char_stream(e,r)}glk_put_char_uni(e){this.glk_put_char_stream(this.current_stream,e)}glk_put_string(e){this.glk_put_string_stream(this.current_stream,e)}glk_put_string_stream(e,r){if(!e)throw new Error("Invalid Stream");if(e.fmode===2)throw new Error("Cannot write to read-only stream");e.put_string(r)}glk_put_string_stream_uni(e,r){this.glk_put_string_stream(e,r)}glk_put_string_uni(e){this.glk_put_string_stream(this.current_stream,e)}glk_request_char_event(e){this.request_char_event(e,!1)}glk_request_char_event_uni(e){this.request_char_event(e,!0)}glk_request_hyperlink_event(e){if(!e)throw new Error("Invalid Window");(e.type==="buffer"||e.type==="grid")&&(e.input.hyperlink=!0)}glk_request_line_event(e,r,i){this.request_line_event(e,r,!1,i)}glk_request_line_event_uni(e,r,i){this.request_line_event(e,r,!0,i)}glk_request_mouse_event(e){if(!e)throw new Error("Invalid Window");(e.type==="graphics"||e.type==="grid")&&(e.input.mouse=!0)}glk_request_timer_events(e){this.timer.interval=e,this.timer.started=e?Date.now():0}glk_schannel_create(e){return null}glk_schannel_create_ext(e,r){return null}glk_schannel_destroy(e){throw new Error("Invalid Schannel")}glk_schannel_get_rock(e){throw new Error("Invalid Schannel")}glk_schannel_iterate(e,r){return r&&r.set_value(0),null}glk_schannel_pause(e){throw new Error("Invalid Schannel")}glk_schannel_play(e,r){throw new Error("Invalid Schannel")}glk_schannel_play_ext(e,r,i,f){throw new Error("Invalid Schannel")}glk_schannel_play_multi(e,r,i){throw new Error("Invalid Schannel")}glk_schannel_set_volume(e,r){throw new Error("Invalid Schannel")}glk_schannel_set_volume_ext(e,r,i,f){throw new Error("Invalid Schannel")}glk_schannel_stop(e){throw new Error("Invalid Schannel")}glk_schannel_unpause(e){throw new Error("Invalid Schannel")}glk_select(e){return this.selectref=e,dr}glk_select_poll(e){Ri(e);let r=this.timer;if(r.interval){let i=Date.now();i-r.started>r.interval&&(r.last_interval=0,r.started=i,e.set_field(0,1))}}glk_set_echo_line_event(e,r){if(!e)throw new Error("Invalid Window");e.type==="buffer"&&(e.echo_line_input=!!r)}glk_set_hyperlink(e){this.glk_set_hyperlink_stream(this.current_stream,e)}glk_set_hyperlink_stream(e,r){if(!e)throw new Error("Invalid Stream");e.type==="window"&&e.set_hyperlink(r)}glk_set_style(e){this.glk_set_style_stream(this.current_stream,e)}glk_set_style_stream(e,r){if(!e)throw new Error("Invalid Stream");e.type==="window"&&((r<0||r>11)&&(r=0),e.set_style(wi[r]))}glk_set_terminators_line_event(e,r){if(!e)throw new Error("Invalid Window");let i=[];if(r)for(let f of r)xo[f]&&i.push(xo[f]);i.length?e.input.terminators=i:delete e.input.terminators}glk_set_window(e){this.current_stream=e?e.str:null}glk_sound_load_hint(e,r){}glk_stream_close(e,r){if(!e)throw new Error("Invalid Stream");e.close(r),this.unregister_stream(e)}glk_stream_get_current(){return this.current_stream}glk_stream_get_position(e){if(!e)throw new Error("Invalid Stream");return e.get_position()}glk_stream_get_rock(e){if(!e)throw new Error("Invalid Stream");return e.rock}glk_stream_iterate(e,r){let i=e?e.next:this.first_stream;return r&&r.set_value(i?i.rock:0),i}glk_stream_open_file(e,r,i){return this.create_file_stream(e,r,i,!1)}glk_stream_open_file_uni(e,r,i){return this.create_file_stream(e,r,i,!0)}glk_stream_open_memory(e,r,i){return this.create_memory_stream(e,r,i,Uint8Array)}glk_stream_open_memory_uni(e,r,i){return this.create_memory_stream(e,r,i,Uint32Array)}glk_stream_open_resource(e,r){return this.create_resource_stream(e,r,!1)}glk_stream_open_resource_uni(e,r){return this.create_resource_stream(e,r,!0)}glk_stream_set_current(e){this.current_stream=e}glk_stream_set_position(e,r,i){if(!e)throw new Error("Invalid Stream");e.set_position(i,r)}glk_style_distinguish(e,r,i){return 0}glk_style_measure(e,r,i,f){return f&&f.set_value(0),0}glk_stylehint_clear(e,r,i){let f=`.Style_${wi[r]}${i<=2?"_par":""}`;function u(_){_[f]&&(delete _[f][ko[i]],Object.keys(_[f]).length||delete _[f])}(e===0||e===3)&&u(this.stylehints.buffer),(e===0||e===4)&&u(this.stylehints.grid)}glk_stylehint_set(e,r,i,f){if(r<0||r>=11||i<0||i>=10)return;if(e===0){this.glk_stylehint_set(3,r,i,f),this.glk_stylehint_set(4,r,i,f);return}if(e===2||e===5||e===1)return;let u=e===3?this.stylehints.buffer:this.stylehints.grid,_=`.Style_${wi[r]}${i<=2?"_par":""}`,p=["left","justify","center","right"],y=["lighter","normal","bold"],x;(i===0||i===1)&&(x=f+"em"),i===2&&(x=p[f]),i===3&&(x=1+f*.1+"em"),i===4&&(x=y[f+1]),i===5&&(x=f?"italic":"normal"),i===6&&(x=f?0:1),(i===7||i===8)&&(x=mr(f)),i===9&&(x=f),x!==void 0&&(u[_]||(u[_]={}),u[_][ko[i]]=x)}glk_tick(){}glk_simple_time_to_date_local(e,r,i){nl(e*1e3*r,i)}glk_simple_time_to_date_utc(e,r,i){ol(e*1e3*r,i)}glk_time_to_date_local(e,r){nl(al(e),r)}glk_time_to_date_utc(e,r){ol(al(e),r)}glk_window_clear(e){if(!e)throw new Error("Invalid Window");if(e.input.type==="line")throw new Error("Window has pending line input");e.clear()}glk_window_close(e,r){if(!e)throw new Error("Invalid Window");if(e.str.close(r),e===this.root_window)this.root_window=null,this.remove_window(e,!0);else{let i=e.parent,f=i.child1===e?i.child2:i.child1,u=i.parent;u?(u.child1===i?u.child1=f:u.child2=f,f.parent=u):(this.root_window=f,f.parent=null),this.remove_window(e,!0),this.remove_window(i,!1),this.rearrange_window(f,i.box)}}glk_window_erase_rect(e,r,i,f,u){if(!e)throw new Error("Invalid Window");if(e.type!=="graphics")throw new Error("Invalid Window: not a graphics window");e.draw.push({height:u,special:"fill",width:f,x:r,y:i})}glk_window_fill_rect(e,r,i,f,u,_){if(!e)throw new Error("Invalid Window");if(e.type!=="graphics")throw new Error("Invalid Window: not a graphics window");e.draw.push({color:mr(r),height:_,special:"fill",width:u,x:i,y:f})}glk_window_flow_break(e){if(!e)throw new Error("Invalid Window");e.type==="buffer"&&e.set_flow_break()}glk_window_get_arrangement(e,r,i,f){if(!e)throw new Error("Invalid Window");if(e.type!=="pair")throw new Error("Invalid Window: not a pair window");f&&f?.set_value(e.key),r&&r?.set_value(e.dir|(e.fixed?16:32)|(e.border?0:256)),i&&i?.set_value(e.size)}glk_window_get_echo_stream(e){if(!e)throw new Error("Invalid Window");return e.echostr}glk_window_get_parent(e){if(!e)throw new Error("Invalid Window");return e.parent}glk_window_get_rock(e){if(!e)throw new Error("Invalid Window");return e.rock}glk_window_get_root(){return this.root_window}glk_window_get_sibling(e){if(!e)throw new Error("Invalid Window");let r=e.parent;return r?r.child1===e?r.child2:r.child1:null}glk_window_get_size(e,r,i){if(!e)throw new Error("Invalid Window");let f=this.metrics,u=0,_=0;switch(e.type){case"buffer":u=Pt((e.box.bottom-e.box.top-f.buffermarginy)/f.buffercharheight),_=Pt((e.box.right-e.box.left-f.buffermarginx)/f.buffercharwidth);break;case"graphics":case"grid":u=e.height,_=e.width;break}i&&i?.set_value(u),r&&r?.set_value(_)}glk_window_get_stream(e){if(!e)throw new Error("Invalid Window");return e.str}glk_window_get_type(e){if(!e)throw new Error("Invalid Window");return e.typenum}glk_window_iterate(e,r){let i=e?e.next:this.first_window;return r&&r?.set_value(i?i.rock:0),i}glk_window_move_cursor(e,r,i){if(!e)throw new Error("Invalid Window");if(e.type!=="grid")throw new Error("Invalid Window: not a grid window");e.x=Math.max(0,r),e.y=Math.max(0,i)}glk_window_open(e,r,i,f,u){if(this.root_window){if(!e)throw new Error("Invalid splitwin");if(e.type==="pair")throw new Error("Invalid splitwin: must not be a pair window");let p=r&240,y=r&15;if(p!==16&&p!==32)throw new Error("Invalid method: must be fixed or proportional");if(p===16&&e.type==="blank")throw new Error("Invalid method: blank windows cannot be only be split proportionally");if(y!==2&&y!==3&&y!==0&&y!==1)throw new Error("Invalid method: bad direction")}else if(e)throw new Error("Invalid splitwin: must be null for first window");let _;switch(f){case 2:_=new Si(u);break;case 5:_=new Gi(u);break;case 3:_=new Ai(u,this.stylehints.buffer);break;case 4:_=new Ci(u,this.stylehints.grid);break;default:throw new Error("Invalid wintype")}if(this.register_window(_),e){let p=new Ei(_,r,i);this.register_window(p),p.child1=e,p.child2=_;let y=e.parent;e.parent=p,_.parent=p,p.parent=y,y?y.child1===e?y.child1=p:y.child2=p:this.root_window=p,this.rearrange_window(p,e.box)}else this.root_window=_,this.rearrange_window(_,{bottom:this.metrics.height,left:0,right:this.metrics.width,top:0});return _}glk_window_set_arrangement(e,r,i,f){if(!e)throw new Error("Invalid Window");if(e.type!=="pair")throw new Error("Invalid Window: not a pair window");if(f){if(f.type==="pair")throw new Error("Invalid keywin: cannot be a pair window");let x=f;for(;(x=x?.parent)&&x!==e;);if(!x)throw new Error("keywin must be a descendent")}let u=r&15,_=u===0||u===1;if(f||(f=e.key),_&&!e.vertical)throw new Error("Invalid method: split must stay horizontal");if(!_&&e.vertical)throw new Error("Invalid method: split must stay vertical");let p=(r&240)===16;if(f.type==="blank"&&p)throw new Error("Invalid method: blank windows cannot be only be split proportionally");let y=u===0||u===2;if(y!==e.backward){let x=e.child1;e.child1=e.child2,e.child2=x}e.backward=y,e.border=(r&256)===256,e.dir=u,e.fixed=p,e.key=f,e.size=i,e.vertical=_,this.rearrange_window(e,e.box)}glk_window_set_background_color(e,r){if(!e)throw new Error("Invalid Window");if(e.type!=="graphics")throw new Error("Invalid Window: not a graphics window");e.draw.push({color:mr(r),special:"setcolor"})}glk_window_set_echo_stream(e,r){if(!e)throw new Error("Invalid Window");e.echostr=r}garglk_set_reversevideo(e){this.garglk_set_reversevideo_stream(this.current_stream,e)}garglk_set_reversevideo_stream(e,r){if(!e)throw new Error("Invalid Stream");e.type==="window"&&e.set_css("reverse",r?1:void 0)}garglk_set_zcolors(e,r){this.garglk_set_zcolors_stream(this.current_stream,e,r)}garglk_set_zcolors_stream(e,r,i){if(!e)throw new Error("Invalid Stream");e.type==="window"&&(r!==-2&&e.set_css("color",r===-1?void 0:mr(r)),i!==-2&&e.set_css("background-color",i===-1?void 0:mr(i)))}accept(e){if(this.exited)return this.GlkOte.log("GlkApi has exited");if(e.gen!==this.gen)return this.GlkOte.log(`Input event has wrong generation number: expected ${this.gen}, received ${e.gen}`);if(this.gen++,!this.selectref&&e.type!=="init"&&e.type!=="specialresponse")return;this.partial_inputs=e.partial;let r=0,i=null,f=0,u=0,_;if("window"in e)for(i=this.first_window;i&&i.disprock!==e.window;i=i.next);switch(e.type){case"init":this.metrics=il(e.metrics),this.support=e.support,this.VM.start();return;case"arrange":this.metrics=il(e.metrics),this.root_window&&this.rearrange_window(this.root_window,{bottom:this.metrics.height,left:0,right:this.metrics.width,top:0}),r=5;break;case"char":if(i?.input.type!=="char")return;delete i.input.type,r=2,e.value.length===1?(f=e.value.codePointAt(0),!i.uni_input&&f>Qe&&(f=Xe)):f=Qs[e.value]??4294967295;break;case"hyperlink":if(!i?.input.hyperlink)return;delete i.input.hyperlink,r=8,f=e.value;break;case"line":if(i?.input.type!=="line")return;this.handle_line_input(i,e.value,this.selectref,e.terminator),this.GiDispa?.prepare_resume(this.selectref),delete this.selectref;break;case"mouse":if(!i?.input.mouse)return;delete i.input.mouse,r=4,f=e.x,u=e.y;break;case"redraw":r=6;break;case"specialresponse":{if(e.response!=="fileref_prompt")throw new Error("Unknown type of specialresponse event");let p=e.value;if(typeof p=="string")throw new Error("AsyncGlk no longer supports bare-string filenames from Dialog");p&&(_=this.create_fileref(p.filename,this.special_data.rock,this.special_data.usage,p));break}case"timer":r=1,this.timer.started=Date.now();break;default:throw new Error(`Event type ${e.type} not supported by AsyncGlk`)}this.selectref&&(Ri(this.selectref,r,i,f,u),this.GiDispa?.prepare_resume(this.selectref),delete this.selectref),this.VM.resume(_)}create_fileref(e,r,i,f){if(!f){let _=i&15,p=_===1?this.VM.get_signature():void 0;f=this.Dialog.file_construct_ref(e,bi[_]??"xxx",p)}let u=new yi(this.Dialog,e,f,r,i);return u.next=this.first_fref,this.first_fref=u,u.next&&(u.next.prev=u),this.GiDispa?.class_register("fileref",u),u}create_file_stream(e,r,i,f){if(!e)throw new Error("Invalid Fileref");if(r!==1&&r!==2&&r!==3&&r!==5)throw new Error("Invalid filemode");if(r===2&&!e.exists())return null;let u=null;r!==1&&(u=e.read()),u||(u=new Uint8Array(0),e.write(u));let _=el(u,e.binary,r,i,f,e);return r===5&&_.set_position(2,0),this.register_stream(_),_}create_memory_stream(e,r,i,f){if(r!==2&&r!==1&&r!==3)throw new Error("Illegal filemode");let u;if(e){let _=()=>this.GiDispa?.unretain_array(e);if(Array.isArray(e)){let p=f.from(e);r===2?u=new Ze(p,r,i,_):u=new Ze(p,r,i,()=>{_r(p,e,e.length),_()})}else u=new Ze(e,r,i,_);this.GiDispa?.retain_array(e)}else u=new xi(r,i);return this.register_stream(u),u}create_resource_stream(e,r,i){if(!this.Blorb)return null;let f=this.Blorb.get_data_chunk(e);if(!f)return null;let u=el(f.data,f.binary,2,r,i);return this.register_stream(u),u}draw_image(e,r,i,f,u,_){let p={alttext:r.alttext,height:i,image:r.image,special:"image",url:r.url,width:_};switch(e.type){case"buffer":return p.alignment=Js[f]??"inlineup",e.put_image(p),1;case"graphics":return p.x=f,p.y=u,e.draw.push(p),1}return 0}handle_line_input(e,r,i,f){e.request_echo_line_input&&(e.put_string(r+`
`,"input"),e.echostr&&e.echostr.put_string(r+`
`,"input")),r.length>e.line_input_buf.length&&(r=r.slice(0,e.line_input_buf.length)),e.uni_input||(r=r.replace(/[^\x00-\xff]/g,"?"));let u=Uint32Array.from(r,p=>p.codePointAt(0));Array.isArray(e.line_input_buf)?_r(u,e.line_input_buf,r.length):e.line_input_buf?.set(u);let _=Xs[f]??0;i&&Ri(i,3,e,r.length,_),this.GiDispa?.unretain_array(e.line_input_buf),delete e.input.type,delete e.line_input_buf}rearrange_window(e,r){let i=this.metrics;this.windows_changed=!0,e.box=r;let f=r.bottom-r.top,u=r.right-r.left;switch(e.type){case"graphics":{e.height=Pt(f-i.graphicsmarginy),e.width=Pt(u-i.graphicsmarginx);break}case"grid":{let _=Pt((f-i.gridmarginy)/i.gridcharheight),p=Pt((u-i.gridmarginx)/i.gridcharwidth);e.update_size(_,p);break}case"pair":{let _,p,y;e.vertical?(_=r.left,p=r.right,y=i.inspacingx):(_=r.top,p=r.bottom,y=i.inspacingy),e.border||(y=0);let x=p-_,b=0;if(e.fixed){switch(e.key.type){case"buffer":e.vertical?b=e.size*i.buffercharwidth+i.buffermarginx:b=e.size*i.buffercharheight+i.buffermarginy;break;case"graphics":b=e.size+(e.vertical?i.graphicsmarginx:i.graphicsmarginy);break;case"grid":e.vertical?b=e.size*i.gridcharwidth+i.gridmarginx:b=e.size*i.gridcharheight+i.gridmarginy;break}b=Math.ceil(b)}else b=Math.floor(x*e.size/100);e.backward?b=_+b:b=p-b-y,_>=p?b=_:b=Math.min(Math.max(b,_),p-y);let A,I;e.vertical?(A={bottom:r.bottom,left:r.left,right:b,top:r.top},I={bottom:r.bottom,left:b+y,right:r.right,top:r.top}):(A={bottom:b,left:r.left,right:r.right,top:r.top},I={bottom:r.bottom,left:r.left,right:r.right,top:b+y}),this.rearrange_window(e.child1,e.backward?I:A),this.rearrange_window(e.child2,e.backward?A:I);break}}}register_stream(e){e.next=this.first_stream,this.first_stream=e,e.next&&(e.next.prev=e),this.GiDispa?.class_register("stream",e)}register_window(e){this.windows_changed=!0,e.next=this.first_window,this.first_window=e,e.next&&(e.next.prev=e),this.GiDispa?this.GiDispa?.class_register("window",e):e.disprock=this.disprock_counter++,e.input.id=e.disprock,this.register_stream(e.str)}remove_window(e,r){this.windows_changed=!0,this.GiDispa&&"line_input_buf"in e&&e.line_input_buf&&(this.GiDispa.unretain_array(e.line_input_buf),delete e.line_input_buf),e.type==="pair"&&(r&&(this.remove_window(e.child1,!0),this.remove_window(e.child2,!0)),e.child1=null,e.child2=null,e.key=null),this.unregister_stream(e.str),e.echostr=null,e.parent=null,this.GiDispa?.class_unregister("window",e);let i=e.prev,f=e.next;e.prev=null,e.next=null,i?i.next=f:this.first_window=f,f&&(f.prev=i)}request_char_event(e,r){if(!e)throw new Error("Invalid Window");if(e.input.type)throw new Error("Window already has keyboard request");if(e.type==="blank"||e.type==="pair")throw new Error("Window does not support character input");e.input.gen=this.gen,e.input.type="char",e.uni_input=r}request_line_event(e,r,i,f){if(!e)throw new Error("Invalid Window");if(e.input.type)throw new Error("Window already has keyboard request");if(e.type!=="buffer"&&e.type!=="grid")throw new Error("Window does not support line input");e.input.gen=this.gen,f&&(e.input.initial=String.fromCodePoint(...r.slice(0,f))),e.input.type="line",e.line_input_buf=r,e.type==="buffer"&&(e.request_echo_line_input=e.echo_line_input),e.uni_input=i,this.GiDispa?.retain_array(r)}unregister_stream(e){this.current_stream===e&&(this.current_stream=null),this.GiDispa?.class_unregister("stream",e);let r=e.prev,i=e.next;e.prev=null,e.next=null,r?r.next=i:this.first_stream=i,i&&(i.prev=r)}};function hr(a,e,r,i){let f=Array.isArray(a)?a.slice(0,e):a.subarray(0,e),u=i?f:f.reduce((x,b)=>x+String.fromCodePoint(b),""),_=r(u),p=Uint32Array.from(_,x=>x.codePointAt(0)),y=p.length;return Array.isArray(a)?_r(p,a,y):a.set(p.subarray(0,Math.min(a.length,y))),y}function mr(a){return"#"+(a&16777215).toString(16).toUpperCase().padStart(6,"0")}function el(a,e,r,i,f,u){let _;if(f)if(e)_=Ls(a);else{let p=or.decode(a);_=Uint32Array.from(p,y=>y.codePointAt(0))}else _=a;return r===2?new Ze(_,r,i):new ki(u,_,r,i)}function tl(a){return new Date(a.get_field(0),a.get_field(1)-1,a.get_field(2),a.get_field(4),a.get_field(5),a.get_field(6),a.get_field(7)/1e3).getTime()}function rl(a){let e=new Date(0);return e.setUTCFullYear(a.get_field(0)),e.setUTCMonth(a.get_field(1)-1),e.setUTCDate(a.get_field(2)),e.setUTCHours(a.get_field(4)),e.setUTCMinutes(a.get_field(5)),e.setUTCSeconds(a.get_field(6)),e.setUTCMilliseconds(a.get_field(7)/1e3),e.getTime()}function il(a){let e=Object.assign({},sr),r;if(r=a.charheight,r!==void 0&&(e.buffercharheight=r,e.gridcharheight=r),r=a.charwidth,r!==void 0&&(e.buffercharwidth=r,e.gridcharwidth=r),r=a.margin,r!==void 0&&(e.buffermarginx=r,e.buffermarginy=r,e.graphicsmarginx=r,e.graphicsmarginy=r,e.gridmarginx=r,e.gridmarginy=r),r=a.buffermargin,r!==void 0&&(e.buffermarginx=r,e.buffermarginy=r),r=a.graphicsmargin,r!==void 0&&(e.graphicsmarginx=r,e.graphicsmarginy=r),r=a.gridmargin,r!==void 0&&(e.gridmarginx=r,e.gridmarginy=r),r=a.marginx,r!==void 0&&(e.buffermarginx=r,e.graphicsmarginx=r,e.gridmarginx=r),r=a.marginy,r!==void 0&&(e.buffermarginy=r,e.graphicsmarginy=r,e.gridmarginy=r),r=a.spacing,r!==void 0&&(e.inspacingx=r,e.inspacingy=r),r=a.inspacing,r!==void 0&&(e.inspacingx=r,e.inspacingy=r),r=a.spacingx,r!==void 0&&(e.inspacingx=r),r=a.spacingy,r!==void 0&&(e.inspacingy=r),Object.assign(e,a),a.outspacing||e.outspacingx||e.outspacingy)throw new Error("AsyncGlk requires that outspacing metrics be 0");return e}function Pt(a){return Math.max(0,Math.floor(a))}function Ri(a,e=0,r=null,i=0,f=0){a.set_field(0,e),a.set_field(1,r),a.set_field(2,i),a.set_field(3,f)}function nl(a,e){let r=new Date(a);e.set_field(0,r.getFullYear()),e.set_field(1,r.getMonth()+1),e.set_field(2,r.getDate()),e.set_field(3,r.getDay()),e.set_field(4,r.getHours()),e.set_field(5,r.getMinutes()),e.set_field(6,r.getSeconds()),e.set_field(7,r.getMilliseconds()*1e3)}function ol(a,e){let r=new Date(a);e.set_field(0,r.getUTCFullYear()),e.set_field(1,r.getUTCMonth()+1),e.set_field(2,r.getUTCDate()),e.set_field(3,r.getUTCDay()),e.set_field(4,r.getUTCHours()),e.set_field(5,r.getUTCMinutes()),e.set_field(6,r.getUTCSeconds()),e.set_field(7,r.getUTCMilliseconds()*1e3)}function vo(a,e){e.set_field(0,Math.floor(a/4294967296e3)),e.set_field(1,Math.floor(a/1e3)>>>0);let r=Math.floor(a%1e3*1e3);r<0&&(r+=1e6),e.set_field(2,r)}function al(a){return a.get_field(0)*4294967296e3+a.get_field(1)*1e3+a.get_field(2)/1e3}function Fi(a,e,r){let i=new e(a.length),f=r(i);return _r(i,a,f),f}var yr=class{constructor(){this.classname="GlkOte";this.version=Qr;this.accept_func=()=>{};this.autorestoring=!1;this.current_metrics=Object.assign({},sr);this.disabled=!1;this.generation=0;this.is_inited=!1;this.options={};this.timer=null;this.waiting_for_update=!1}async init(e){if(!e)return this.error("no options provided");if(!e.accept)return this.error("an accept function was not given to GlkOte");this.options=e,this.accept_func=e.accept,e.Blorb&&(this.Blorb=e.Blorb),e.Dialog&&(this.Dialog=e.Dialog),this.is_inited=!0,this.send_event({type:"init"})}error(e){throw typeof e=="string"?new Error(e):e}extevent(e){this.send_event({type:"external",value:e})}getdomcontext(){throw new Error("getdomcontext is not applicable to this GlkOte library")}getdomid(e){throw new Error("getdomid is not applicable to this GlkOte library")}getinterface(){return this.options}getlibrary(e){switch(e){case"Blorb":return this.Blorb;case"Dialog":return this.Dialog;default:return null}}inited(){return this.is_inited}log(e){console.log(e)}setdomcontext(e){throw new Error("setdomcontext is not applicable to this GlkOte library")}update(e){try{if(this.autorestoring=!1,this.waiting_for_update=!1,e.type==="error")return this.error(e.message);if(e.type==="pass")return;if(e.type==="retry"){setTimeout(()=>this.send_event({type:"refresh"}),2e3);return}if(e.type!=="update")return this.error(`Unknown update type: ${e.type}`);if(e.gen===this.generation){this.log(`Ignoring repeated generation number: ${e.gen}`);return}this.generation=e.gen,this.disabled&&this.disable(!1),e.input&&this.cancel_inputs(e.input),e.windows&&this.update_windows(e.windows),e.content&&this.update_content(e.content),e.input&&this.update_inputs(e.input),e.timer!==void 0&&(this.timer&&(clearInterval(this.timer),this.timer=null),e.timer&&(this.timer=setInterval(()=>this.ontimer(),e.timer))),e.specialinput&&this.handle_specialinput(e.specialinput),this.disabled=!1,(e.disable||e.specialinput)&&this.disable(!0),e.autorestore&&(this.autorestoring=!0,this.autorestore(e.autorestore)),typeof e.page_margin_bg<"u"&&this.options.set_body_to_page_bg&&this.set_page_bg(e.page_margin_bg),e.disable&&this.exit()}catch(r){this.error(r)}}warning(e){console.warn(e)}autorestore(e){}capabilities(){return["timer"]}exit(){}handle_specialinput(e){if(e.type==="fileref_prompt"){let r=i=>this.send_event({type:"specialresponse",response:"fileref_prompt",value:i});try{this.Dialog?this.Dialog.open(e.filemode!=="read",e.filetype,e.gameid,r):setTimeout(()=>r(null),0)}catch(i){this.log(`Unable to open file dialog: ${i}`),setTimeout(()=>r(null),0)}}else this.error(`Request for unknown special input type: ${e.type}`)}ontimer(){this.disabled||this.send_event({type:"timer"})}save_allstate(){}send_event(e){if(!(this.disabled&&e.type!=="specialresponse")){if(this.waiting_for_update){console.log("Trying to send event when waiting for input",e);return}switch(this.waiting_for_update=!0,e.gen=this.generation,e.type){case"arrange":e.metrics=this.current_metrics;break;case"init":e.metrics=this.current_metrics,e.support=this.capabilities();break;case"specialresponse":e.response="fileref_prompt";break}this.accept_func(e)}}set_page_bg(e){}};function _e(a,e){return $(`<${a}>`,{class:e})}var Wi=class{constructor(e){this.context_element=e.context_element,this.errorcontent_id=e.errorcontent_id,this.errorpane_id=e.errorpane_id,this.gameport_id=e.gameport_id,this.loadingpane_id=e.loadingpane_id,this.prefix=e.prefix,this.windowport_id=e.windowport_id}create(e,r,i){return i??={},typeof i=="string"&&(i={class:i}),i.id=this.prefix+r,$(`<${e}>`,i)}gameport(){return $(`#${this.gameport_id}`,this.context_element)}id(e){return $(`#${this.prefix}${e}`,this.context_element)}windowport(){return $(`#${this.windowport_id}`,this.context_element)}};function $t(){return visualViewport?visualViewport.scale-1>.001:!1}function Te(a){return{height:a.outerHeight(),width:a.outerWidth()}}function w1(a,e){return e.buffercharheight!==a.buffercharheight||e.buffercharwidth!==a.buffercharwidth||e.gridcharheight!==a.gridcharheight||e.gridcharwidth!==a.gridcharwidth||e.height!==a.height||e.width!==a.width}var k1=/(iPad; CPU|iPhone) OS 15_0/i.test(navigator.userAgent),br=class{constructor(e){this.on_gameport_resize=st(async()=>{if(this.glkote.disabled||!this.glkote.inited()){this.on_gameport_resize();return}let e=Object.assign({},this.metrics);await this.measure(),w1(this.metrics,e)&&this.glkote.send_event({type:"arrange"})},200,{leading:!1});this.on_visualViewport_resize=()=>{if($t())return;let e=this.glkote.dom.gameport(),r=document.activeElement?.tagName==="INPUT";k1&&e.toggleClass("ios15fix",r),e.outerHeight(visualViewport.height,!0),window.scrollTo(0,0),this.on_gameport_resize()};this.glkote=e,this.metrics=e.current_metrics,document.readyState==="complete"?this.loaded=Promise.resolve():this.loaded=new Promise(r=>{window.addEventListener("load",r,{once:!0})}),window.ResizeObserver?(this.observer=new ResizeObserver(this.on_gameport_resize),this.observer.observe(this.glkote.dom.gameport()[0])):$(window).on("resize",this.on_gameport_resize),visualViewport&&$(visualViewport).on("resize",this.on_visualViewport_resize)}destroy(){this.observer?this.observer.disconnect():$(window).off("resize",this.on_gameport_resize),visualViewport&&$(visualViewport).off("resize",this.on_visualViewport_resize)}async measure(){let e=this.glkote.dom,r=e.gameport();if(!r.length)throw new Error(`Cannot find gameport element #${e.gameport_id}`);e.id("layouttestpane").remove();let i=e.create("div","layout_test_pane");i.text("This should not be visible");let f=$("<div>");_e("span","Style_normal").text("12345678").appendTo(f);let u=_e("div","WindowFrame BufferWindow"),_=_e("div","BufferWindowInner").appendTo(u),p=f.clone().addClass("BufferLine").appendTo(_),y=f.clone().addClass("BufferLine").appendTo(_);_e("span","InvisibleCursor").appendTo(y);let x=p.children("span");i.append(u);let b=_e("div","WindowFrame GraphicsWindow"),A=$("<canvas>",{height:32,width:64}).appendTo(b);i.append(b);let I=_e("div","WindowFrame GridWindow"),J=f.clone().addClass("GridLine").appendTo(I),V=f.clone().addClass("GridLine").appendTo(I),Q=J.children("span");i.append(I),r.append(i),await this.loaded;let re=getComputedStyle(I[0]).getPropertyValue("--glkote-grid-mono-family").split(",")[0].replace(/"/g,"");await document.fonts.load(`14px ${re}`),this.metrics.height=r.height(),this.metrics.width=r.width();let P=Te(u),Fe=Te(x),Oe=Te(p),De=Te(y);this.metrics.buffercharheight=Math.max(1,y.position().top-p.position().top),this.metrics.buffercharwidth=Math.max(1,x.width()/8),this.metrics.buffermarginx=P.width-Fe.width,this.metrics.buffermarginy=P.height-(Oe.height+De.height);let de=Te(b),j=Te(A);this.metrics.graphicsmarginx=de.width-j.width,this.metrics.graphicsmarginy=de.height-j.height;let oe=Te(I),pe=Te(Q),We=Te(J),he=Te(V);this.metrics.gridcharheight=Math.max(1,V.position().top-J.position().top),this.metrics.gridcharwidth=Math.max(1,Q.width()/8),this.metrics.gridmarginx=oe.width-pe.width,this.metrics.gridmarginy=oe.height-(We.height+he.height),i.remove()}};var wr=class{constructor(e,r){this.enabled=!1;this.handler=e=>this.web_handler(e);this.label="";this.session=Date.now()+Math.ceil(Math.random()*1e4).toString(16);this.url="";this.windows=r,e.recording_handler&&(this.enabled=!0,this.handler=e.recording_handler,this.url="(custom handler)"),e.recording_url&&(this.enabled=!0,this.url=e.recording_url),this.label=e.recording_label??"",this.enabled&&console.log(`Transcript recording active: session ${this.session} "${this.label}", destination ${this.url}`)}record_event(e){this.event=e,this.timestamp=Date.now()}record_update(e){if(!e.content)return;let r=this.event,i=r.type,f="";if(i==="char"||i==="line")f=r.value;else if(!(!i||i==="external"||i==="init"||i==="specialresponse"))return;let u="";for(let _ of e.content){let p=this.windows.get(_.id);if(!p||p.type!=="buffer")continue;let y=_.text||[];for(let x of y){x.append||(u+=`
`);let b=x.content;if(b?.length)for(let A=0;A<b.length;A++){let I=b[A];typeof I=="string"?u+=b[++A]:"text"in I&&(u+=I.text)}}}this.handler({format:"simple",input:f,label:this.label,output:u,outtimestamp:Date.now(),sessionId:this.session,timestamp:this.timestamp})}async web_handler(e){try{let r=await fetch(this.url,{body:JSON.stringify(e),headers:{"Content-Type":"application/json"},method:"POST"});if(!r.ok)throw new Error(`Could not submit transcript update, got ${r.status}`)}catch(r){this.enabled=!1,console.log(`Transcript recording failed; disabling. Error: ${r}`)}}};var sl=25,Bi=class{constructor(e){this.history_index=0;this.is_line=!1;this.window=e,this.el=$("<textarea>",{"aria-hidden":"true",autocapitalize:"off",class:"Input",data:{window:e},on:{blur:()=>this.onblur(),focus:()=>this.onfocus(),input:r=>this.oninput(r),keydown:r=>this.onkeydown(r),keypress:r=>this.onkeypress(r)},rows:1}).prop("disabled",!0).appendTo(e.frameel)}destroy(){this.el.remove()}onblur(){ll()}onfocus(){this.window.type==="buffer"&&!$t()&&this.window.scroll_to_bottom(),ll()}oninput(e){if(!this.window.inputs?.type)return this.el.trigger("blur"),!1;if(this.window.inputs.type==="char"){let r=e.target.value[0];return this.submit_char(r),r===" "&&this.el.trigger("blur").trigger("focus"),!1}}onkeydown(e){if(!this.window.inputs?.type)return this.el.trigger("blur"),!1;let r=e.which;if(r){if(this.is_line){if(r===hn||r===gn){let i=this.window.manager.history,f;return r===hn&&this.history_index>0?(this.history_index--,f=1):r===gn&&this.history_index<i.length&&(this.history_index++,f=1),f&&this.el.val(this.history_index===0?"":i[this.history_index-1]),!1}else if(this.window.inputs.terminators){let i=pn[r];if(this.window.inputs.terminators.includes(i))return this.submit_line(e.target.value,i),!1}}else{let i=pn[r];if(i)return this.submit_char(i),!1}e.stopPropagation()}}onkeypress(e){if(!this.window.inputs?.type)return this.el.trigger("blur"),!1;let r=e.which;if(r)if(this.is_line){if(r===mn)return this.submit_line(e.target.value),!1}else{let i=r===mn?"return":String.fromCharCode(r);return this.submit_char(i),!1}}refocus(){this.window.type==="buffer"&&this.window.innerel.outerHeight()-this.window.updatescrolltop>this.window.height_above_keyboard||this.el[0].focus({preventScroll:!0})}reset(){this.history_index=0,this.el.attr({"aria-hidden":"true",class:"Input"}).css({"background-color":"",color:"",left:Hs,top:"",width:""}).val("");let e=this.window.type==="buffer"?this.window.innerel:this.window.frameel;this.el.parent().is(e)||this.el.appendTo(e)}submit_char(e){this.window.send_text_event({type:"char",value:e})}submit_line(e,r){let i=this.window.manager.history;e&&e!==i[0]&&(i.unshift(e),i.length>sl&&(i.length=sl)),this.window.send_text_event({type:"line",terminator:r,value:e})}update(){this.reset();let e=this.window.inputs;if(!(e.type!=="char"&&e.type!=="line")){if(this.is_line=e.type==="line",this.el.attr({"aria-hidden":"false",maxlength:this.is_line?e.maxlen:1}).prop("disabled",!1).val(e.initial||""),this.is_line){if(this.window.type==="graphics")throw new Error(`Cannot request line input in graphics window ${this.window.id}`);this.el.addClass("LineInput")}switch(this.window.type){case"buffer":(this.window.lastline||this.window.innerel).append(this.el);break;case"grid":{let r=this.window.metrics;this.el.css({left:e.xpos*r.gridcharwidth+r.gridmarginx/2,top:e.ypos*r.gridcharheight+r.gridmarginy/2,width:(e.maxlen||1)*r.gridcharwidth});break}}if(this.window.type!=="graphics"){let r=this.window.last_run_styles;if(r){let i=!!r.reverse;this.el.toggleClass("reverse",i),So(r,i,this.el)}}}}},ll=st(()=>{function a(e){window.scrollTo(0,0),e>0&&setTimeout(a,50,e-1)}a(12)},1e3);function Pi(){return window.getSelection()+""==""}var Mi=class{constructor(e){this.desired=!0;this.blorb=e.blorb,this.dom=e.dom,this.id=e.id,this.manager=e.manager,this.metrics=e.metrics,this.type=e.type,this.frameel=this.dom.create("div",`window${e.id}`,{class:`WindowFrame ${T1[this.type]} WindowRock_${e.rock}`,click:r=>this.onclick(r)}).appendTo(this.dom.windowport()),this.textinput=new Bi(this)}destroy(e){this.textinput.destroy(),e?this.frameel.remove():this.inputs=void 0}measure_height(){}onclick(e){if(this.inputs?.type&&Pi())return this.textinput.el.trigger("focus"),!1}send_text_event(e){this.measure_height(),this.textinput.reset(),this.inputs.type=void 0,this.manager.active_window=this,e.window=this.id,this.manager.send_event(e)}};function So(a,e,r){let i=Object.assign({},a);if(e){let f=i["background-color"],u=i.color;f?i.color=f:delete i.color,u?i["background-color"]=u:delete i["background-color"],delete i.reverse}r.css(i)}function x1(a){let e=[""],r=/\s/,i=!1;for(let f of a){let u=r.test(f);!u&&i&&e.unshift(""),e[0]+=f,i=u}return e.reverse(),e}var Ui=class extends Mi{constructor(e){super(e);let r=i=>this.onlink(i);this.frameel.on("click","a",function(){r(this)}),e.styles&&(this.styles=e.styles,this.add_stylehints())}add_stylehints(){let e=`#window${this.id}`,r={};if(this.styles){for(let[_,p]of Object.entries(this.styles)){let y=`${e} ${_}`.trim(),x=r[y]=Object.assign({},p);if(_){let b=x["background-color"],A=x.color;if(b||A){let I=r[`${y}.reverse`]={};b&&(I.color=b),A&&(I["background-color"]=A)}delete x.monospace,x.reverse&&(delete x["background-color"],delete x.color),delete x.reverse,Object.keys(x).length===0&&delete r[y]}}r[`${e} .Style_input`]&&(r[`${e} .LineInput`]=r[`${e} .Style_input`])}let i=r[`${e} .Style_normal`],f=this.bg||i?.["background-color"],u=this.fg||i?.color;(f||u)&&(r[e]||(r[e]={}),r[e]["background-color"]=f||`var(--glkote-${this.type}-bg)`,r[`${e}.reverse`]={"background-color":u||`var(--glkote-${this.type}-reverse-bg)`}),Object.keys(r).length&&(this.frameel.children("style").remove(),this.frameel.prepend(`<style>${Object.entries(r).map(_=>{let[p,y]=_;return`${p} {${Object.entries(y).map(x=>{let[b,A]=x;return`${b}: ${A}`}).join("; ")}}`}).join(`
`)}</style>`))}create_text_run(e,r){let i=e.style,f=e.css_styles?.monospace??this.styles?.[`.Style_${i}`]?.monospace,u="";typeof f<"u"&&(i==="preformatted"?f||(u=" proportional"):f&&(u=" monospace"));let _=e.css_styles?.reverse??this.styles?.[`.Style_${i}`]?.reverse,p=_e("span",`Style_${i}${_?" reverse":""}${u}`);e.css_styles&&So(e.css_styles,!!_,p),typeof r>"u"&&(r=!!f||i==="preformatted");let y=r?$(x1(e.text).map(x=>p.clone().text(x)[0])):p.text(e.text);return e.hyperlink?$("<a>",{data:{glklink:e.hyperlink},href:"#"}).append(y):y}onlink(e){let r=$(e).data("glklink");if(r)return this.inputs?.hyperlink&&this.manager.send_event({type:"hyperlink",value:r,window:this.id}),!1}refresh_styles(e,r){let i;typeof e<"u"&&e!==this.bg&&(this.bg=e,i=1),typeof r<"u"&&r!==this.fg&&(this.fg=r,i=1),i&&this.add_stylehints()}},v1={inlinecenter:"ImageInlineCenter",inlinedown:"ImageInlineDown",inlineup:"ImageInlineUp",marginleft:"ImageMarginLeft",marginright:"ImageMarginRight"},To=class extends Ui{constructor(r){super(r);this.type="buffer";this.is_scrolled_down=!0;this.updatescrolltop=0;this.onscroll=()=>{let r=this.frameel[0];this.is_scrolled_down=r.scrollHeight-r.scrollTop-r.clientHeight<1};this.frameel.attr({"aria-live":"polite",role:"log",tabindex:-1}).on("scroll",this.onscroll),this.innerel=_e("div","BufferWindowInner").append(this.textinput.el).appendTo(this.frameel),this.height_above_keyboard=this.frameel.height()}measure_height(){this.height_above_keyboard=this.frameel.height()}onclick(r){if(this.inputs?.type&&Pi()){if(this.lastline&&this.height_above_keyboard){let i=this.lastline[0].getBoundingClientRect();if(i.bottom<0||i.top>document.documentElement.clientHeight)return!1}return this.textinput.el.trigger("focus"),!1}}scroll_to_bottom(r){(!r||this.is_scrolled_down)&&(this.frameel.scrollTop(this.innerel.height()),this.is_scrolled_down=!0)}update(r){if(r.clear&&(this.textinput.reset(),this.innerel.children(".BufferLine").remove(),this.is_scrolled_down=!0,this.lastline=void 0,this.last_run_styles=void 0,this.refresh_styles(r.bg,r.fg)),!r.text)return;this.frameel.attr("aria-busy","true"),this.updatescrolltop=Math.max(0,(this.lastline?.position().top||0)-20);let i=0;for(;i<r.text.length;){let f=r.text[i++],u=f.content,_,p;if(f.append&&this.lastline)_=this.lastline,p=1;else if(_=_e("div","BufferLine"),this.innerel.append(_),this.lastline=_,!u?.length){_.addClass("BlankPara"),_.append(_e("span","BlankLineSpace").text(Jr));continue}if(f.flowbreak&&_.addClass("FlowBreak"),!!u?.length)for(let y=0;y<u.length;y++){let x,b=u[y];if(typeof b=="string")x={style:u[y++],text:u[y]};else if("special"in b&&b.special==="image"){let A=$("<img>",{alt:b.alttext||`Image ${b.image}`,class:v1[b.alignment||"inlineup"],height:b.height,src:this.blorb&&this.blorb.get_image_url(b.image)||b.url,width:b.width});if(b.hyperlink){$("<a>",{data:{glklink:b.hyperlink},href:"#"}).append(A).appendTo(_);continue}_.append(A);continue}else x=b;p||(p=1,_.addClass(`Style_${x.style}_par`)),_.append(this.create_text_run(x,i===r.text.length?!0:void 0)),this.last_run_styles=x.css_styles}}$t()||this.frameel.scrollTop(this.updatescrolltop),this.frameel.attr("aria-busy","false")}},Ao=class extends Mi{constructor(r){super(r);this.type="graphics";this.fillcolour="";this.framequeue=[];this.height=0;this.image_cache=new Map;this.width=0;this.clear_cache=at(()=>{this.image_cache.clear()},5e3);this.canvas=this.dom.create("canvas",`win${r.id}_canvas`,{data:{window:this}}),this.frameel.append(this.canvas),this.manager.canvasResizeObserver?.observe(this.canvas[0]),this.buffer=this.dom.create("canvas",`win${r.id}_buffer`)}decode_image(r,i){let f=new Image;return f.src=i,f.decode().then(()=>{this.image_cache.set(r,f)}).catch(()=>{})}destroy(r){this.manager.canvasResizeObserver?.unobserve(this.canvas[0]),super.destroy(r)}onclick(r){return this.inputs?.mouse&&r.button===0?(this.inputs.mouse=!1,this.manager.send_event({type:"mouse",window:this.id,x:Math.floor(r.offsetX-this.metrics.graphicsmarginx/2),y:Math.floor(r.offsetY-this.metrics.graphicsmarginy/2)}),!1):super.onclick(r)}set_dimensions(r,i){this.canvas.css({height:r,width:i}),this.height=r,this.width=i;let f=devicePixelRatio;r=r*f,i=i*f,this.buffer.attr({height:r,width:i}),this.canvas.attr({height:r,width:i})}async update(){let r=this.buffer[0].getContext("2d");for(let i=0;i<this.framequeue.length;i++){let f=this.framequeue[i];if(!this.height||!this.width)break;if(!f.length)continue;let u=[];for(let p of f)if(p.special==="image"){let y=p.url||p.image;if(this.image_cache.has(y))continue;let x=p.url||this.blorb&&this.blorb.get_image_url(p.image);x&&u.push(this.decode_image(y,x))}await Promise.all(u);let _=devicePixelRatio;for(let p of f)switch(p.special){case"fill":r.fillStyle=p.color||this.fillcolour,Number.isFinite(p.x)?r.fillRect(p.x*_,p.y*_,p.width*_,p.height*_):r.fillRect(0,0,parseInt(this.buffer.attr("width")),parseInt(this.buffer.attr("height")));break;case"image":{let y=this.image_cache.get(p.url||p.image);y&&r.drawImage(y,p.x*_,p.y*_,p.width*_,p.height*_);break}case"setcolor":this.fillcolour=p.color;break}}this.height&&this.width&&this.canvas[0].getContext("2d").drawImage(this.buffer[0],0,0),this.framequeue.length=0,this.clear_cache()}},Go=class extends Ui{constructor(r){super(r);this.type="grid";this.height=0;this.lines=[];this.width=0;this.frameel.attr({"aria-atomic":"true","aria-live":"off",role:"status"})}onclick(r){return this.inputs?.mouse&&r.button===0&&Pi()?(this.inputs.mouse=!1,this.manager.send_event({type:"mouse",window:this.id,x:Math.floor((r.offsetX-this.metrics.gridmarginx/2)/this.metrics.gridcharwidth),y:Math.floor((r.offsetY-this.metrics.gridmarginy/2)/this.metrics.gridcharheight)}),!1):super.onclick(r)}update(r){r.clear&&(this.last_run_styles=void 0,this.refresh_styles(r.bg,r.fg)),this.frameel.attr("aria-busy","true");for(let i of r.lines){let f=this.lines[i.line];if(!f.length)throw new Error(`Got content for nonexistent line ${i.line} of window ${this.id}`);let u=i.content;if(!u||!u.length)f.text(Jr);else{f.empty();for(let _=0;_<u.length;_++){let p;typeof u[_]=="string"?p={style:u[_++],text:u[_]}:p=u[_],f.append(this.create_text_run(p,!1)),this.last_run_styles=p.css_styles}}}this.frameel.toggleClass("reverse",$(`#window${this.id} span:not(.reverse)`).length===0).attr({"aria-busy":"false","aria-live":this.lines.length>3?"polite":"off"})}},S1={buffer:To,graphics:Ao,grid:Go},T1={buffer:"BufferWindow",graphics:"GraphicsWindow",grid:"GridWindow"},kr=class extends Map{constructor(r){super();this.history=[];this.onkeydown=r=>{if(!this.glkote.disabled&&r.target.nodeName!=="input"&&!(r.target.nodeName==="div"&&$(r.target).is(".BufferWindow:focus"))){let i=[...this.values()],f=i.filter(u=>u.inputs?.type)[0]||i.filter(u=>u.type==="buffer")[0];f&&(f.frameel.trigger("click"),f.textinput.el.is(":focus")?f.textinput.el.trigger(r):f.type==="buffer"&&f.frameel.trigger("focus"))}};if(this.dom=r.dom,this.glkote=r,this.metrics=r.current_metrics,window.ResizeObserver){let i=new ResizeObserver(f=>{typeof f?.[0].devicePixelContentBoxSize?.[0].blockSize<"u"&&(this.canvasResizeObserver=new ResizeObserver(u=>this.oncanvasresize(u))),i.disconnect()});i.observe(document.body)}this.send_event=i=>r.send_event(i),$(document).on("keydown",this.onkeydown),this.dom.gameport().on("click",()=>this.onclick())}destroy(){for(let r of this.values())r.destroy(!1),this.delete(r.id);$(document).off("keydown",this.onkeydown)}cancel_inputs(r){let i={};for(let f of r)i[f.id]=f;for(let f of this.values())!i[f.id]&&f.inputs&&(f.textinput.el.is(":focus")&&(this.active_window=f),f.textinput.el.prop("disabled",!0),delete f.inputs)}oncanvasresize(r){for(let i of r){let f=i.devicePixelContentBoxSize[0],u=f.blockSize,_=f.inlineSize,p=$(i.target).data("window");p.buffer.attr({height:u,width:_}),p.canvas.attr({height:u,width:_})}this.send_event({type:"redraw"})}onclick(){if(!this.glkote.disabled&&Pi()){for(let r of this.values())if(r.inputs?.type){r.frameel.trigger("click");break}}}update(r){for(let f of this.values())f.desired=!1;for(let f of r){let u=f.id,_=f.type,p=this.get(u);if(!p)p=new S1[_]({blorb:this.blorb,dom:this.dom,id:u,manager:this,metrics:this.metrics,rock:f.rock,styles:f.styles,type:_}),this.set(u,p);else if(p.type!==_)throw new Error(`Window ${u} was created with type ${p.type}, but now is described as type ${_}`);if(p.desired=!0,p.type==="graphics"&&(p.height!==f.graphheight||p.width!==f.graphwidth)&&p.set_dimensions(f.graphheight,f.graphwidth),p.type==="grid"){if(f.gridheight>p.height)for(let y=p.height;y<f.gridheight;y++){let x=this.dom.create("div",`win${p.id}_ln${y}`,"GridLine");x.append(Jr),p.frameel.append(x),p.lines[y]=x}if(f.gridheight<p.height)for(let y=f.gridheight;y<p.height;y++)this.dom.id(`win${p.id}_ln${y}`).remove();p.height=f.gridheight,p.lines.length=p.height,p.width=f.gridwidth}p.frameel.css({height:f.height,left:f.left,top:f.top,width:f.width}),p.type==="buffer"&&p.scroll_to_bottom(!0)}let i=[];for(let f of this.values())f.desired||i.push(f);for(let f of i)f.destroy(!0),this.delete(f.id)}update_content(r){for(let i of r){let f=this.get(i.id);if(!f)throw new Error(`Got content update for window ${i.id}, which does not exist`);switch(f.type){case"buffer":f.update(i);break;case"graphics":f.framequeue.push(i.draw),f.framequeue.length===1&&f.update();break;case"grid":f.update(i);break}}}update_inputs(r){for(let i of r){let f=this.get(i.id);if(!f)throw new Error(`Got input update for window ${i.id}, which does not exist`);let u=f.inputs?.gen;f.inputs=i,i.type&&i.gen!==u&&f.textinput.update()}this.active_window&&(this.has(this.active_window.id)&&this.active_window.inputs?.type?this.active_window.textinput.refocus():[...this.values()].filter(i=>i.inputs?.type)[0]?.textinput.refocus())}};var jt=class extends yr{constructor(){super();this.dom=new Wi({context_element:void 0,errorcontent_id:"errorcontent",errorpane_id:"errorpane",gameport_id:"gameport",loadingpane_id:"loadingpane",prefix:"",windowport_id:"windowport"});this.showing_error=!1;this.showing_loading=!0;this.on_document_scroll=st(async()=>{window.scrollTo(0,0)},500,{leading:!1});this.metrics_calculator=new br(this),this.windows=new kr(this)}async init(r){try{if(!r)throw new Error("no options provided");if(typeof jQuery>"u")throw new Error("jQuery is not loaded");r.dom_prefix&&(this.dom.prefix=r.dom_prefix),r.errorcontent&&(this.dom.errorcontent_id=r.errorcontent),r.errorpane&&(this.dom.errorpane_id=r.errorpane),r.gameport&&(this.dom.gameport_id=r.gameport),r.loadingpane&&(this.dom.loadingpane_id=r.loadingpane),r.windowport&&(this.dom.windowport_id=r.windowport),r.Blorb&&(this.windows.blorb=r.Blorb);let i=this.dom.windowport();if(!i.length)throw new Error(`Cannot find windowport element #${this.dom.windowport_id}`);i.empty(),$(document).on("scroll",this.on_document_scroll);let f="initial-scale=1,interactive-widget=resizes-content,minimum-scale=1,width=device-width";if(/iPhone OS/i.test(navigator.userAgent)&&(f+=",maximum-scale=1"),document.head.querySelector('meta[name="viewport"]').content=f,await this.metrics_calculator.measure(),r.recording_url||r.recording_handler)if(r.recording_format&&r.recording_format!=="simple")console.warn('GlkOte: only the "simple" recording_format is supported');else{let u=new URLSearchParams(document.location.search).get("feedback"),_=r.recording_cookie||"transcript_recording_opt_out";u&&u!=="1"||document.cookie.includes(`${_}=1`)?console.log("User has opted out of transcript recording."):this.transcript_recorder=new wr(r,this.windows)}return super.init(r)}catch(i){this.error(i)}}autorestore(r){Array.isArray(r.history)&&(this.windows.history=r.history);for(let i of this.windows.values())i.type==="buffer"&&i.scroll_to_bottom();if(r.graphics_bg)for(let[i,f]of r.graphics_bg)this.windows.get(i).fillcolour=f;r.transcript_recorder_session&&this.transcript_recorder&&(this.transcript_recorder.session=r.transcript_recorder_session,console.log(`Resuming autosaved transcript recording session: ${r.transcript_recorder_session}`)),setTimeout(()=>this.send_event({type:"arrange"}),0)}cancel_inputs(r){this.windows.cancel_inputs(r)}capabilities(){return["garglktext","graphics","graphicswin","hyperlinks","timer"]}disable(r){for(let i of this.windows.values())i.textinput.el.prop("disabled",r||!i.inputs?.type);this.disabled=r}embellish_error(){if(typeof $>"u")return;let r=$(`#${this.dom.errorpane_id}`);if(r.find("#errorclose").length||$("<button>",{"aria-label":"Close",click:()=>{r.hide()},id:"errorclose",text:"\u2716",type:"button"}).appendTo(r),this.autorestoring&&this.Dialog?.autosave_clear){let i=$("<a>",{click:async()=>{await this.Dialog.autosave_clear(),location.reload()},text:"Clear autosave and restart"});$("<div>").append(i).appendTo(r)}}error(r){r??="???";let i;typeof r=="string"?(i=r,r=new Error(r)):i=r.toString();let f=document.getElementById(this.dom.errorcontent_id);if(!f)throw new Error(i);f.innerHTML=i;let u=document.getElementById(this.dom.errorpane_id);u.className==="WarningPane"&&(u.className=""),this.embellish_error(),u.style.display="",this.showing_error=!0,this.hide_loading(),console.error(r)}exit(){this.metrics_calculator.destroy(),this.windows.destroy()}getdomcontext(){return this.dom.context_element}getdomid(r){switch(r){case"errorcontent":return this.dom.errorcontent_id;case"errorpane":return this.dom.errorpane_id;case"gameport":return this.dom.gameport_id;case"loadingpane":return this.dom.loadingpane_id;case"windowport":return this.dom.windowport_id;default:return r}}hide_loading(){if(!this.showing_loading)return;this.showing_loading=!1;let r=document.getElementById(this.dom.loadingpane_id);r&&(r.style.display="none")}save_allstate(){let r=[];for(let i of this.windows.values())i.type==="graphics"&&r.push([i.id,i.fillcolour]);return{graphics_bg:r,history:this.windows.history,transcript_recorder_session:this.transcript_recorder?.session}}send_event(r){if(r.type!=="init"&&r.type!=="refresh"&&r.type!=="specialresponse"){for(let i of this.windows.values())if(i.inputs?.type){let f=i.textinput.el.val();f&&(r.partial||(r.partial={}),r.partial[i.id]=f)}}this.transcript_recorder?.enabled&&this.transcript_recorder.record_event(r),super.send_event(r)}setdomcontext(r){this.dom.context_element=r}set_page_bg(r){$("body").css("background-color",r)}update(r){this.showing_loading&&this.hide_loading(),super.update(r),this.transcript_recorder?.enabled&&r.type==="update"&&!r.autorestore&&this.transcript_recorder.record_update(r)}update_content(r){this.windows.update_content(r)}update_inputs(r){this.windows.update_inputs(r)}update_windows(r){this.windows.update(r)}warning(r){if(this.showing_error)return;let i=$(`#${this.dom.errorpane_id}`);if(!r){i.hide();return}let f=document.getElementById(this.dom.errorcontent_id);if(!f){console.warn(r);return}f.innerHTML=r,this.embellish_error(),i.addClass("WarningPane"),i.show(),this.hide_loading()}};var A1=new TextDecoder;async function Eo(a,e,r){let i=new URL(e,document.URL),f=i.hostname,u=f===document.location.hostname,_=`${a.proxy_url}?url=${i}`,p;if(i.protocol==="embedded:"){let b=document.getElementById(i.pathname).text;return Co(b)}let y=u||i.protocol==="data:";if(!y){for(let b of a.direct_domains)if(f.endsWith(b)){y=!0;break}}if(y)try{p=await fetch(""+i)}catch{throw new Error("Failed to fetch storyfile (possible CORS error)")}else if(a.use_proxy)p=await fetch(_);else throw new Error("Storyfile not in list of direct domains and proxy disabled");if(!p.ok)throw new Error(`Could not fetch storyfile, got ${p.status}`);let x=await cl(p,r);if(e.endsWith(".js")){let b=A1.decode(x),A=/processBase64Zcode\(['"]([a-zA-Z0-9+/=]+)['"]\)/.exec(b);if(!A)throw new Error("Abnormal JSified story");return Co(A[1])}return x}async function fl(a,e,r){if(a.single_file){let u=document.getElementById(e).text;if(e.endsWith(".js"))return import(`data:text/javascript,${encodeURIComponent(u)}`);if(!e.endsWith(".wasm"))throw new Error(`Can't load ${e} in single file mode`);return Co(u,"wasm")}if(e.endsWith(".js"))return import(e);let i;try{i=new URL(e,a.lib_path)}catch{i=a.lib_path+e}let f=await fetch(i);return cl(f,r)}async function Co(a,e="octet-binary"){let r=await fetch(`data:application/${e};base64,${a}`);if(!r.ok)throw new Error(`Could not parse base64: ${r.status}`);return new Uint8Array(await r.arrayBuffer())}function ul(a){return new Promise((e,r)=>{let i=new FileReader;i.onerror=()=>r(i.error),i.onload=()=>e(new Uint8Array(i.result)),i.readAsArrayBuffer(a)})}async function cl(a,e){if(!a.ok)throw new Error(`Could not fetch ${a.url}, got ${a.status}`);if(!e)return new Uint8Array(await a.arrayBuffer());let r=[],i=0,f=a.body.getReader();for(;;){let{done:_,value:p}=await f.read();if(_)break;r.push([i,p]),e(p.length),i+=p.length}let u=new Uint8Array(i);for(let[_,p]of r)u.set(p,_);return u}async function Lt(a,e){let[r,i,f]=e,u=Object.assign({},a,{wasmBinary:f.buffer}),_=new i.default;_.init(r,u),await _.start()}var G1=[{id:"blorb",extensions:/\.(blb|blorb)/i},{id:"adrift4",extensions:/\.taf/i,engines:[{id:"scare",load:["./scare.js","./scare-core.wasm"],start:Lt}]},{id:"hugo",extensions:/\.hex/i,engines:[{id:"hugo",load:["./hugo.js","./hugo-core.wasm"],start:Lt}]},{id:"glulx",extensions:/\.(gblorb|glb|ulx)/i,engines:[{id:"quixe",load:["./quixe.js"],start:(a,e)=>{let[r,i]=e,f=r,u=Object.assign({},a,{blorb_gamechunk_type:"GLUL",GiDispa:new i.GiDispa,GiLoad:i.GiLoad,image_info_map:"StaticImageInfo",io:a.Glk,set_page_title:0,spacing:0,use_query_story:0,vm:i.Quixe});i.GiLoad.load_run(u,f,"array")}},{id:"glulxe",load:["./glulxe.js","./glulxe-core.wasm"],start:Lt},{id:"git",load:["./git.js","./git-core.wasm"],start:Lt}]},{id:"tads",extensions:/\.(gam|t3)/i,engines:[{id:"tads",load:["./tads.js","./tads-core.wasm"],start:Lt}]},{id:"zcode",extensions:/\.(zblorb|zlb|z3|z4|z5|z8)/i,engines:[{id:"zvm",load:["./zvm.js"],start:(a,e)=>{let[r,i]=e,f=new i.ZVM,u=Object.assign({},a,{vm:f,GiDispa:new i.ZVMDispatch});f.prepare(r,u),u.Glk.init(u)}},{id:"bocfel",load:["./bocfel.js","./bocfel-core.wasm"],start:Lt}]}];function Io(a,e){for(let r of G1)if(r.id===a||e&&r.extensions.test(e))return r;throw new Error("Unknown storyfile format")}function _l(a){let e={GLUL:"glulx",ZCOD:"zcode"},r=a.get_chunk("exec",0)?.blorbtype;if(r&&e[r])return Io(e[r]);throw new Error("Unknown storyfile format in Blorb")}var C1=["\u04A0\u04BF\u0500\u051F\u0680\u06BF\u0760\u079F\u07C0\u07DF\u1000\u101F\u10A0\u10BF\u1100\u115F\u1180\u119F\u11E0\u123F\u1260\u127F\u12E0\u12FF\u1320\u133F\u13A0\u13DF\u1420\u165F\u16A0\u16DF\u1780\u179F\u1820\u185F\u18C0\u18DF\u1980\u199F\u19E0\u19FF\u1A20\u1A3F\u1BC0\u1BDF\u1C00\u1C1F\u1D00\u1D1F\u21E0\u21FF\u22C0\u22DF\u2340\u23DF\u2400\u241F\u2500\u275F\u2780\u27BF\u2800\u297F\u29A0\u29BF\u2A20\u2A5F\u2A80\u2ABF\u2AE0\u2B5F\u2C00\u2C1F\u2C80\u2CDF\u2D00\u2D1F\u2D40\u2D5F\u2EA0\u2EDF\u31C0\u31DF\u3400\u4D9F\u4DC0\u9FBF\uA000\uA47F\uA4A0\uA4BF\uA500\uA5FF\uA640\uA65F\uA6A0\uA6DF\uA700\uA75F\uA780\uA79F\uA840\uA85F","\u0180\u019F\u0240\u029F"],$i={},Ro={};C1.forEach((a,e)=>{let r=[];a.match(/../gu).forEach(f=>{let u=f.codePointAt(0),_=f.codePointAt(1);for(let p=u;p<=_;p++)r.push(String.fromCodePoint(p))});let i=15-8*e;$i[i]=r,r.forEach((f,u)=>{Ro[f]=[i,u]})});var Re=a=>{let e=a.length,r="",i=0,f=0;for(let u=0;u<e;u++){let _=a[u];for(let p=7;p>=0;p--){let y=_>>p&1;i=(i<<1)+y,f++,f===15&&(r+=$i[f][i],i=0,f=0)}}if(f!==0){for(;!(f in $i);)i=(i<<1)+1,f++;r+=$i[f][i]}return r},ji=a=>{let e=a.length,r=new Uint8Array(Math.floor(e*15/8)),i=0,f=0,u=0;for(let _=0;_<e;_++){let p=a.charAt(_);if(!(p in Ro))throw new Error(`Unrecognised Base32768 character: ${p}`);let[y,x]=Ro[p];if(y!==15&&_!==e-1)throw new Error("Secondary character found before end of input at position "+String(_));for(let b=y-1;b>=0;b--){let A=x>>b&1;f=(f<<1)+A,u++,u===8&&(r[i]=f,i++,f=0,u=0)}}if(f!==(1<<u)-1)throw new Error("Padding mismatch");return new Uint8Array(r.buffer,0,i)};var E1=new TextDecoder,Li=new TextEncoder;function I1(a){return Uint8Array.from(a,e=>e.charCodeAt(0))}var R1=function(){var a="dialog",e=!1,r=null,i,f,u,_,p,y,x,b;function A(){try{let w=parseInt(localStorage.getItem("dialog_storage_version"),10);if(w>1)throw new Error("dialog_storage_version is newer than this library supports");if(!w){console.log("Dialog: updating storage version");for(let[k,v]of Object.entries(localStorage))if(k.startsWith("content:")&&v!==""&&localStorage.setItem(k,Re(/\[[,\d]*\]/.test(v)?JSON.parse(v):I1(v))),k.startsWith("autosave:")){localStorage.removeItem(k);let S=JSON.parse(v);S.ram&&(localStorage.setItem(k+".ram",Re(S.ram)),delete S.ram),localStorage.setItem(k,Re(Li.encode(JSON.stringify(S)))),localStorage.setItem(k+".meta",Re(Li.encode(JSON.stringify({modified:Date.now()}))))}localStorage.setItem("dialog_storage_version","1")}}catch{}}function I(w,k,v,S){if(e)throw new Error("Dialog: dialog box is already open.");if(!D)throw new Error("Dialog: no storage API is available.");r=S,i=w,f=!1,u=!1,_=null,p=k,x=v,y=Q(p);var O="windowport",L=window.Game;window.GlkOte&&(L=window.GlkOte.getinterface()),L&&L.windowport&&(O=L.windowport);var B=$("#"+O);if(!B.length)throw new Error("Dialog: unable to find root element #"+O+".");var E=$("#"+a+"_screen");E.length||(E=$("<div>",{id:a+"_screen"}),B.append(E));var M=$("#"+a+"_frame");M.length||(M=$("<div>",{id:a+"_frame"}),B.append(M));var z=$("#"+a);z.length&&z.remove(),z=$("<div>",{id:a});var W,C,R;W=$("<form>"),W.on("submit",i?de:De),z.append(W),R=$("<div>",{class:"DiaButtonsFloat"}),C=$("<button>",{id:a+"_edit",type:"button"}),C.append("Edit"),C.on("click",j),R.append(C),W.append(R),R=$("<div>",{id:a+"_cap",class:"DiaCaption"}),R.append("XXX"),W.append(R),i&&(R=$("<div>",{id:a+"_input",class:"DiaInput"}),W.append(R),C=$("<input>",{id:a+"_infield",type:"text",name:"filename"}),R.append(C),R=$("<div>",{id:a+"_warning",class:"DiaWarning"}),R.text("Warning: data may be erased by clearing cookies or browser privacy policies."),W.append(R)),R=$("<div>",{id:a+"_body",class:"DiaBody"}),W.append(R),R=$("<div>",{id:a+"_cap2",class:"DiaCaption"}),R.hide(),W.append(R),R=$("<div>",{id:a+"_buttonrow",class:"DiaButtons"}),C=$("<button>",{id:a+"_cancel",type:"button"}),C.append("Cancel"),C.on("click",We),R.append(C),C=$("<button>",{id:a+"_delete",type:"button"}),C.append("Delete"),C.on("click",oe),C.hide(),R.append(C),C=$("<button>",{id:a+"_display",type:"button"}),C.append("Display"),C.on("click",pe),C.hide(),R.append(C),C=$("<button>",{id:a+"_accept",type:"submit"}),C.append(i?"Save":"Load"),C.on("click",i?de:De),R.append(C),W.append(R),M.append(z),e=!0,he();var K;i?K=function(){var ie=$("#"+a+"_infield");ie.length&&ie.focus()}:K=function(){var ie=$("#"+a+"_select");ie.length&&ie.focus()},P(K)}function J(){var w=$("#"+a);w.length&&w.remove();var k=$("#"+a+"_frame");k.length&&k.remove();var v=$("#"+a+"_screen");v.length&&v.remove(),e=!1,r=null,b=null,u=!1,_=null}function V(w,k){var v=k?a+"_cap":a+"_cap2",S=$("#"+v);S.length&&(w?(S.text(w),S.show()):S.hide())}function Q(w){switch(w){case"data":return"data file";case"save":return"save file";case"transcript":return"transcript";case"command":return"command script";default:return"file"}}function re(w){return w=="transcript"||w=="command"}function P(w){return window.setTimeout(w,.01*1e3)}function Fe(){if(!e||f)return!1;var w=$("#"+a+"_select");if(!w.length)return!1;var k=w.prop("selectedIndex");if(!b||k<0||k>=b.length)return!1;var v=b[k],S=$("#"+a+"_infield");return S.length&&S.val(v.dirent.filename),!1}function Oe(){if(!e||!u||_)return!1;var w=$("#"+a+"_delete");w.prop("disabled",!0),w=$("#"+a+"_display"),w.prop("disabled",!0);var k=$("#"+a+"_select");if(!k.length)return!1;var v=k.prop("selectedIndex");if(!b||v<0||v>=b.length)return!1;var S=b[v];if(!S||!S.dirent||!d(S.dirent))return!1;w=$("#"+a+"_delete"),w.prop("disabled",!1),w=$("#"+a+"_display"),w.prop("disabled",!1)}function De(w){if(w.preventDefault(),!e||u)return!1;var k=$("#"+a+"_select");if(!k.length)return!1;var v=k.prop("selectedIndex");if(!b||v<0||v>=b.length)return!1;var S=b[v];if(!S||!S.dirent||!d(S.dirent))return!1;var O=r;return J(),O&&O(S.dirent),!1}function de(w){if(w.preventDefault(),!e||u)return!1;var k=$("#"+a+"_infield");if(!k.length)return!1;var v=k.val();if(v=jQuery.trim(v),!v.length)return!1;var S=zt(v,p,x);if(d(S)&&!f){f=!0,V("You already have a "+y+' "'+S.filename+'". Do you want to replace it?',!1),k.prop("disabled",!0);var O=$("#"+a+"_accept");return O.text("Replace"),!1}var L=r;return J(),L&&L(S),!1}function j(w){if(w.preventDefault(),!e)return!1;if(u){if(_)return u=!0,_=null,$("#"+a+"_buttonrow").show(),$("#"+a+"_edit").text("Done"),he(),!1;{u=!1,_=null;let k=$("#"+a+"_input");k.length&&k.show();let v=$("#"+a+"_edit");return v.text("Edit"),v=$("#"+a+"_delete"),v.hide(),v=$("#"+a+"_display"),v.hide(),v=$("#"+a+"_accept"),v.show(),he(),!1}}else{if(u=!0,_=null,f){f=!1,V(null,!1),$("#"+a+"_infield").prop("disabled",!1);let O=$("#"+a+"_accept");O.prop("disabled",!1),O.text("Save")}let k=$("#"+a+"_input");k.length&&k.hide();let v=$("#"+a+"_edit");return v.text("Done"),v=$("#"+a+"_delete"),v.show(),v=$("#"+a+"_display"),v.show(),v=$("#"+a+"_accept"),v.hide(),he(),!1}}function oe(w){if(w.preventDefault(),!e||!u||_)return!1;var k=$("#"+a+"_select");if(!k.length)return!1;var v=k.prop("selectedIndex");if(!b||v<0||v>=b.length)return!1;var S=b[v];return!S||!S.dirent||(Be(S.dirent),he()),!1}function pe(w){if(w.preventDefault(),!e||!u||_)return!1;var k=$("#"+a+"_select");if(!k.length)return!1;var v=k.prop("selectedIndex");if(!b||v<0||v>=b.length)return!1;var S=b[v];if(!S||!S.dirent||!d(S.dirent))return!1;$("#"+a+"_buttonrow").hide();var O=$("#"+a+"_edit");return O.text("Close"),_=S.dirent,he(),!1}function We(w){if(w.preventDefault(),!e)return!1;if(f){f=!1,V(null,!1);var k=$("#"+a+"_infield");k.prop("disabled",!1);var v=$("#"+a+"_accept");return v.prop("disabled",!1),v.text("Save"),!1}var S=r;return J(),S&&S(null),!1}function he(){if(!e)return!1;var w,k;let v=$("#"+a+"_body");if(!v.length)return!1;if(u&&_&&(d(_)||(_=null,$("#"+a+"_buttonrow").show(),w=$("#"+a+"_edit"),w.text("Done"))),u&&_){v.empty();let E=_t(_);if(E=String.fromCharCode.apply(this,E),re(_.usage)){var S=$("<pre>",{class:"DiaDisplayText"});S.text(E),v.append(S),V("Displaying file contents...",!0)}else{var O=window.btoa(E),L=$("<a>",{href:"data:application/octet-stream;base64,"+O,target:"_blank",download:"data"});L.text(_.filename),v.append(L),V('Use "Save As" option in your browser to download this link.',!0)}return!1}if(u){let E=et(null,x);if(x!=""&&(E=E.concat(et(null,""))),E.sort(function(C,R){return C.dirent.usage<R.dirent.usage?-1:C.dirent.usage>R.dirent.usage?1:R.modified.getTime()-C.modified.getTime()}),E.length==0)return v.empty(),w=$("#"+a+"_delete"),w.prop("disabled",!0),w=$("#"+a+"_display"),w.prop("disabled",!0),V("You have no stored files. Press Done to continue.",!0),!1;b=[];let M="";for(let C=0;C<E.length;C++){let R=E[C];R.dirent.usage!=M&&(M=R.dirent.usage,b.push({label:M})),b.push(R)}E=b,v.empty();let z=$("<select>",{id:a+"_select",name:"files"});z.prop("size","5");let W=!1;for(let C=0;C<E.length;C++){let R=E[C];if(!R.dirent){k=$("<option>",{name:"f"+C}),k.prop("disabled",!0),k.text("-- "+Q(R.label)+"s --"),z.append(k);continue}k=$("<option>",{name:"f"+C}),W||(W=!0,k.selected=!0);let K=Vt(R.modified);k.text(R.dirent.filename+" -- "+K),z.append(k)}return v.append(z),z.on("change",Oe),Oe(),V("All stored files are now visible. You may delete them, and display files containing text. Press Done when finished.",!0),!1}let B=et(p,x);if(B.sort(function(E,M){return M.modified.getTime()-E.modified.getTime()}),b=B,B.length==0)v.empty();else{v.empty();let E=$("<select>",{id:a+"_select",name:"files"});E.prop("size","5");let M,z;for(let W=0;W<B.length;W++)M=B[W],k=$("<option>",{name:"f"+W}),W==0&&(k.selected=!0),z=Vt(M.modified),k.text(M.dirent.filename+" -- "+z),E.append(k);v.append(E),i&&E.on("change",Fe)}i?(V("Name this "+y+".",!0),k=$("#"+a+"_accept"),k.prop("disabled",!1)):B.length==0?(V("You have no "+y+"s for this game.",!0),k=$("#"+a+"_accept"),k.prop("disabled",!0)):(V("Select a "+y+" to load.",!0),k=$("#"+a+"_accept"),k.prop("disabled",!1))}function zi(w){return w}function zt(w,k,v){w||(w=""),k||(k=""),v||(v="");var S=k+":"+v+":"+w,O={dirent:"dirent:"+S,content:"content:"+S,filename:w,usage:k,gameid:v};return O}function qi(w){var k=new Date().getTime(),v="_temp_"+k+"_"+Math.random();return v=v.replace(".",""),zt(v,w)}function xr(w){if(w.slice(0,7)!="dirent:")return null;var k=7,v=w.indexOf(":",k);if(v<0)return null;var S=w.slice(k,v);if(k=v+1,v=w.indexOf(":",k),v<0)return null;var O=w.slice(k,v);k=v+1;var L=w.slice(k),B="cont"+w.slice(3),E={dirent:w,content:B,filename:L,usage:S,gameid:O};return E}function qt(w){if(typeof w!="object"&&(w=xr(w),!w))return null;var k=D.getItem(w.dirent);if(!k)return null;var v={dirent:w},S,O,L,B,E=k.toString().split(",");for(S=0;S<E.length;S++)if(B=E[S],O=B.indexOf(":"),!(O<0))switch(L=B.slice(0,O),B=B.slice(O+1),L){case"created":v.created=new Date(Number(B));break;case"modified":v.modified=new Date(Number(B));break}return v}function d(w){var k=D.getItem(w.dirent);return!!k}function Be(w){D.removeItem(w.dirent),D.removeItem(w.content)}function ct(w,k,v){if(v&&k!=="")throw new Error("Dialog raw mode is no longer supported");var S,O,L,B,E=qt(w);return E||(E={dirent:w,created:new Date}),E.modified=new Date,k=Re(k),O=[],E.created&&O.push("created:"+E.created.getTime()),E.modified&&O.push("modified:"+E.modified.getTime()),S=O.join(","),L=D.setItem(E.dirent.dirent,S),B=D.setItem(E.dirent.content,k),!(L||B)}function _t(w,k){if(k)throw new Error("Dialog raw mode is no longer supported");var v=qt(w);if(!v)return null;var S=D.getItem(w.content);return S==null?null:ji(S)}function Nt(){throw new Error("streaming function not implemented in Dialog")}function Ht(w,k,v){return!(k!=null&&w.usage!=k||v!=null&&w.gameid!=v)}function et(w,k){var v,S=[];if(!D)return S;var O=D.getKeys();for(v=0;v<O.length;v++){var L=O[v];if(L){var B=xr(L.toString());if(B&&Ht(B,w,k)){var E=qt(B);S.push(E)}}}return S}function Vt(w){if(!w)return"???";var k=w.getMonth()+1+"/"+w.getDate(),v=w.getHours()+":"+(w.getMinutes()<10?"0":"")+w.getMinutes();return k+" "+v}function Kt(w,k){let v="autosave:"+w,S=v+".meta",O=v+".ram";k?(k.ram&&(D.setItem(O,Re(k.ram)),delete k.ram),D.setItem(v,Re(Li.encode(JSON.stringify(k)))),D.setItem(S,Re(Li.encode(JSON.stringify({modified:Date.now()}))))):(D.removeItem(v),D.removeItem(S),D.removeItem(O))}let we;function Ni(w){we=w;let k="autosave:"+w,v=k+".ram",S=D.getItem(k);if(S)try{let O=JSON.parse(E1.decode(ji(S))),L=D.getItem(v);return L&&(O.ram=ji(L)),O}catch{return null}return null}async function Hi(){if(!we)throw new Error("Dialog.autosave_clear must be called after Dialog.autosave_read");Kt(we,null)}var D=null;try{var ae=null;if(window.localStorage!=null?ae=window.localStorage:window.globalStorage!=null&&(ae=window.globalStorage[location.hostname]),ae)try{if(ae.setItem("_dialogtest","xyzzy"),ae.getItem("_dialogtest")!="xyzzy")throw new Error("localStorage test did not match");ae.removeItem("_dialogtest"),D={getItem:function(w){try{return ae.getItem(w)}catch{return null}},removeItem:function(w){try{ae.removeItem(w)}catch{return null}},setItem:function(w,k){try{ae.setItem(w,k)}catch{return!0}},getKeys:function(){for(var w=[],k=0;k<ae.length;k++)w.push(ae.key(k));return w}}}catch{}}catch{}return D==null&&(D={data:{},keys:[],getItem:function(w){return D.data[w]},setItem:function(w,k){D.keys.indexOf(w)<0&&D.keys.push(w),D.data[w]=k},removeItem:function(w){var k=D.keys.indexOf(w);k>=0&&(D.keys.splice(k,1),delete D.data[w])},getKeys:function(){return D.keys.slice(0)}}),$(window).on("storage",he),{streaming:!1,init:A,open:I,file_clean_fixed_name:zi,file_construct_ref:zt,file_construct_temp_ref:qi,file_ref_exists:d,file_remove_ref:Be,file_write:ct,file_read:_t,file_fopen:Nt,autosave_clear:Hi,autosave_write:Kt,autosave_read:Ni}}(),dl=R1;var F1=function(){var a=null;let e=null,r=null,i=null,f=null,u={};var _,p,y,x,b,A=!1,I=!1,J=null,V=null,Q=0,re=null,P=null;function Fe(t){if(t.Dialog)r=t.Dialog;else throw new Error("No reference to Dialog");if(t.GiDispa&&(i=t.GiDispa),t.Blorb&&(e=t.Blorb),t.GlkOte)f=t.GlkOte;else throw new Error("No reference to GlkOte");a=t.vm,i&&(i.set_vm?i.set_vm(a):i.init({io:this,vm:a})),t.accept=Oe,f.init(t),_=t.exit_warning,p=t.do_vm_autosave,y=t.before_select_hook,x=t.extevent_hook,b=t.glk_gestalt_hook,y&&y()}function Oe(t){var o;if(I){S("### ui is disabled, ignoring event");return}if(t.gen!=Q){f.log("Input event had wrong generation number: got "+t.gen+", currently at "+Q);return}switch(Q+=1,re=t.partial,t.type){case"init":F=t.metrics,t.support&&t.support.forEach(n=>u[n]=1),a.start();break;case"external":{let n=null;x&&(n=x(t.value)),!n&&t.value=="timer"&&(dt=Date.now(),n={type:d.evtype_Timer}),n&&n.type&&j(n);break}case"timer":{dt=Date.now();let n={type:d.evtype_Timer};j(n);break}case"hyperlink":oe(t.window,t.value);break;case"mouse":pe(t.window,t.x,t.y);break;case"char":We(t.window,t.value);break;case"line":he(t.window,t.value,t.terminator);break;case"arrange":F=t.metrics,o={left:F.outspacingx,top:F.outspacingy,right:F.width-F.outspacingx,bottom:F.height-F.outspacingy},ie&&Pe(ie,o),De();break;case"redraw":de();break;case"specialresponse":t.response=="fileref_prompt"&&nf(t);break}}function De(){G&&(G.set_field(0,d.evtype_Arrange),G.set_field(1,null),G.set_field(2,0),G.set_field(3,0),i&&i.prepare_resume(G),G=null,a.resume())}function de(){G&&(G.set_field(0,d.evtype_Redraw),G.set_field(1,null),G.set_field(2,0),G.set_field(3,0),i&&i.prepare_resume(G),G=null,a.resume())}function j(t){if(G){var o=0,n=0;t.val1&&(o=t.val1),t.val2&&(n=t.val2),G.set_field(0,t.type),G.set_field(1,null),G.set_field(2,o),G.set_field(3,n),i&&i.prepare_resume(G),G=null,a.resume()}}function oe(t,o){if(G){var n=null;for(n=K;n&&n.disprock!=t;n=n.next);!n||!n.hyperlink_request||(G.set_field(0,d.evtype_Hyperlink),G.set_field(1,n),G.set_field(2,o),G.set_field(3,0),n.hyperlink_request=!1,i&&i.prepare_resume(G),G=null,a.resume())}}function pe(t,o,n){if(G){var s=null;for(s=K;s&&s.disprock!=t;s=s.next);!s||!s.mouse_request||(G.set_field(0,d.evtype_MouseInput),G.set_field(1,s),G.set_field(2,o),G.set_field(3,n),s.mouse_request=!1,i&&i.prepare_resume(G),G=null,a.resume())}}function We(t,o){var n;if(G){var s=null;for(s=K;s&&s.disprock!=t;s=s.next);!s||!s.char_request||(o.length==1?(n=o.charCodeAt(0),s.char_request_uni||(n=n&255)):(n=Be[o],n||(n=d.keycode_Unknown)),G.set_field(0,d.evtype_CharInput),G.set_field(1,s),G.set_field(2,n),G.set_field(3,0),s.char_request=!1,s.char_request_uni=!1,s.input_generation=null,i&&i.prepare_resume(G),G=null,a.resume())}}function he(t,o,n){var s;if(G){var l=null;for(l=K;l&&l.disprock!=t;l=l.next);if(!(!l||!l.line_request)){for(o.length>l.linebuf.length&&(o=o.slice(0,l.linebuf.length)),l.request_echo_line_input&&(s=l.style,it(l.str,d.style_Input),tt(l,o),l.echostr&&me(l.echostr,o),it(l.str,s),tt(l,`
`),l.echostr&&me(l.echostr,`
`)),s=0;s<o.length;s++)l.linebuf[s]=o.charCodeAt(s);var c=0;n&&Be[n]&&(c=Be[n]),G.set_field(0,d.evtype_LineInput),G.set_field(1,l),G.set_field(2,o.length),G.set_field(3,c),i&&i.unretain_array(l.linebuf),l.line_request=!1,l.line_request_uni=!1,l.request_echo_line_input=null,l.input_generation=null,l.linebuf=null,i&&i.prepare_resume(G),G=null,a.resume()}}}function zi(){var t={type:"update",gen:Q},o=null,n=null,s=null,l,c,g,m,h,T,X,N,U,ee,ge;if(Yt){for(Yt=!1,o=[],l=K;l;l=l.next)if(l.type!=d.wintype_Pair){switch(c={id:l.disprock,rock:l.rock},o.push(c),l.type){case d.wintype_TextBuffer:c.type="buffer",c.styles=Sr(l.stylehints);break;case d.wintype_TextGrid:c.type="grid",c.gridwidth=l.gridwidth,c.gridheight=l.gridheight,c.styles=Sr(l.stylehints);break;case d.wintype_Graphics:c.type="graphics",c.graphwidth=l.graphwidth,c.graphheight=l.graphheight;break}c.left=l.bbox.left,c.top=l.bbox.top,c.width=l.bbox.right-l.bbox.left,c.height=l.bbox.bottom-l.bbox.top}}for(l=K;l;l=l.next){switch(m=!1,c={id:l.disprock},n==null&&(n=[]),l.type){case d.wintype_TextBuffer:if(Yi(l),l.content.length&&(c.text=l.content.slice(0),l.content.length=0,m=!0),l.clearcontent&&(c.clear=!0,c.bg=l.cleared_bg,c.fg=l.cleared_fg,l.clearcontent=!1,m=!0,c.text||(c.text=[]),l.reserve.length=0),c.text&&c.text.length)for(N=0;N<c.text.length;N++)l.reserve.push(c.text[N]);l.reserve.length>100&&l.reserve.splice(0,l.reserve.length-100);break;case d.wintype_TextGrid:if(l.gridwidth==0||l.gridheight==0)break;for(c.lines=[],N=0;N<l.gridheight;N++)if(h=l.lines[N],!!h.dirty){for(h.dirty=!1,T=[],ge=0,U=0;U<l.gridwidth;){let je=h.styles[U],ht=h.hyperlinks[U],Zt=h.fgs[U],er=h.bgs[U],tr=h.reverses[U];for(;U<l.gridwidth&&h.styles[U]===je&&h.hyperlinks[U]===ht&&h.fgs[U]===Zt&&h.bgs[U]===er&&h.reverses[U]===tr;U++);ge<U&&(!ht&&Zt==null&&er==null&&!tr?(T.push(_t[je]),T.push(h.chars.slice(ge,U).join(""))):(g={style:_t[je],text:h.chars.slice(ge,U).join(""),hyperlink:ht},(er||Zt||tr)&&(g.css_styles={},er&&(g.css_styles["background-color"]=er),Zt&&(g.css_styles.color=Zt),tr&&(g.css_styles.reverse=tr)),T.push(g)),ge=U)}c.lines.push({line:N,content:T})}l.clearcontent&&(c.clear=!0,c.bg=l.cleared_bg,c.fg=l.cleared_fg,l.clearcontent=!1),m=c.lines.length;break;case d.wintype_Graphics:l.content.length&&(c.draw=l.content.slice(0),l.content.length=0,m=!0);var $e=-1;if(c.draw&&c.draw.length)for(N=0;N<c.draw.length;N++){var xe=c.draw[N];xe.special=="fill"&&xe.x===void 0&&xe.y===void 0&&xe.width===void 0&&xe.height===void 0&&($e=l.reserve.length),l.reserve.push(xe)}if($e>=0){var nt=null;for(let je=0;je<l.reserve.length&&je<$e;je++){let ht=l.reserve[je];ht.special=="setcolor"&&(nt=ht)}l.reserve.splice(0,$e),nt&&l.reserve.unshift(nt)}break}m&&n.push(c)}for(s=[],l=K;l;l=l.next)c=null,l.char_request&&(c={id:l.disprock,type:"char",gen:l.input_generation},l.type==d.wintype_TextGrid&&(Do(l)?(c.xpos=l.gridwidth,c.ypos=l.gridheight-1):(c.xpos=l.cursorx,c.ypos=l.cursory))),l.line_request&&(ee="",P&&(X=P[l.disprock],X&&(ee=X)),c={id:l.disprock,type:"line",gen:l.input_generation,maxlen:l.linebuf.length,initial:ee},l.line_input_terminators.length&&(c.terminators=l.line_input_terminators),l.type==d.wintype_TextGrid&&(Do(l)?(c.xpos=l.gridwidth,c.ypos=l.gridheight-1):(c.xpos=l.cursorx,c.ypos=l.cursory))),l.hyperlink_request&&(c||(c={id:l.disprock}),c.hyperlink=!0),l.mouse_request&&(c||(c={id:l.disprock}),c.mouse=!0),c&&s.push(c);t.windows=o,t.content=n,t.input=s,Vi!=Ae&&(t.timer=Ae,Vi=Ae),J&&(t.specialinput=J),I&&(t.disable=!0);let nn=ke.buffer[".Style_normal"]?.["background-color"];if($o!=nn&&($o=nn,t.page_margin_bg=nn||""),P=null,R&&(t.autorestore=R),R=null,f.update(t,R),y&&y(),p){if(A)a.do_autosave(-1);else if(i){var Ho=i.check_autosave();Ho&&a.do_autosave(Ho)}}}function zt(t){switch(t){case"VM":return a;case"GlkOte":return f;case"GiDispa":return i;case"Blorb":return e;case"Dialog":return f.getlibrary("Dialog")}return null}function qi(){var t={};ie&&(t.rootwin=ie.disprock),Z&&(t.currentstr=Z.disprock),Ae&&(t.timer_interval=Ae),t.windows=[];for(var o=K;o;o=o.next){var n={type:o.type,rock:o.rock,disprock:o.disprock,style:o.style,hyperlink:o.hyperlink,bg:o.bg,fg:o.fg,reverse:o.reverse,cleared_bg:o.cleared_bg,cleared_fg:o.cleared_fg};if(o.parent&&(n.parent=o.parent.disprock),n.str=o.str.disprock,o.echostr&&(n.echostr=o.echostr.disprock),n.bbox={left:o.bbox.left,right:o.bbox.right,top:o.bbox.top,bottom:o.bbox.bottom},o.linebuf!==null){var s=i.get_retained_array(o.linebuf);n.linebuf={addr:s.addr,len:s.len,arr:s.arr.slice(0),arg:s.arg.serialize()}}switch(n.char_request=o.char_request,n.line_request=o.line_request,n.char_request_uni=o.char_request_uni,n.line_request_uni=o.line_request_uni,n.hyperlink_request=o.hyperlink_request,n.mouse_request=o.mouse_request,n.echo_line_input=o.echo_line_input,n.request_echo_line_input=o.request_echo_line_input,n.line_input_terminators=o.line_input_terminators.slice(0),o.type){case d.wintype_TextBuffer:n.reserve=o.reserve.slice(0),n.stylehints=o.stylehints;break;case d.wintype_TextGrid:n.gridwidth=o.gridwidth,n.gridheight=o.gridheight,n.lines=[];for(var l=0;l<o.lines.length;l++){var c=o.lines[l];n.lines.push({chars:c.chars.slice(0),styles:c.styles.slice(0),hyperlinks:c.hyperlinks.slice(0),fgs:c.fgs.slice(0),bgs:c.bgs.slice(0),reverses:c.reverses.slice(0)})}n.cursorx=o.cursorx,n.cursory=o.cursory,n.stylehints=o.stylehints;break;case d.wintype_Graphics:n.graphwidth=o.graphwidth,n.graphheight=o.graphheight,n.reserve=o.reserve.slice(0);break;case d.wintype_Pair:n.pair_dir=o.pair_dir,n.pair_division=o.pair_division,n.pair_key=o.pair_key.disprock,n.pair_keydamage=!1,n.pair_size=o.pair_size,n.pair_hasborder=o.pair_hasborder,n.pair_vertical=o.pair_vertical,n.pair_backward=o.pair_backward,n.child1=o.child1.disprock,n.child2=o.child2.disprock;break}t.windows.push(n)}t.streams=[];for(let g=Me;g;g=g.next){let m={type:g.type,rock:g.rock,disprock:g.disprock,unicode:g.unicode,isbinary:g.isbinary,readcount:g.readcount,writecount:g.writecount,readable:g.readable,writable:g.writable,streaming:g.streaming};switch(g.type){case z:g.win&&(m.win=g.win.disprock);break;case W:if(g.buf!==null){let h=i.get_retained_array(g.buf);m.buf={addr:h.addr,len:h.len,arr:h.arr.slice(0),arg:h.arg.serialize()}}m.buflen=g.buflen,m.bufpos=g.bufpos,m.bufeof=g.bufeof;break;case C:m.resfilenum=g.resfilenum,m.buflen=g.buflen,m.bufpos=g.bufpos,m.bufeof=g.bufeof;break;case M:m.origfmode=g.origfmode,r.streaming?(g.fstream.fflush(),m.ref=g.ref,m.filepos=g.fstream.ftell()):(m.ref=g.ref,Bo(g),m.buflen=g.buflen,m.bufpos=g.bufpos,m.bufeof=g.bufeof);break}t.streams.push(m)}t.filerefs=[];for(let g=Ue;g;g=g.next){let m={type:g.type,rock:g.rock,disprock:g.disprock,filename:g.filename,textmode:g.textmode,filetype:g.filetype,filetypename:g.filetypename};m.ref=g.ref,t.filerefs.push(m)}return t.stylehints=ke,t.glkote=f.save_allstate(),t}function xr(t){if(K||Me||Ue)throw"restore_allstate: glkapi module has already been launched";for(let g=t.windows.length-1;g>=0;g--){let m=t.windows[g],h={type:m.type,rock:m.rock,disprock:m.disprock,style:m.style,hyperlink:m.hyperlink,bg:m.bg,fg:m.fg,reverse:m.reverse,cleared_bg:m.cleared_bg,cleared_fg:m.cleared_fg};i.class_register("window",h,h.disprock),h.prev=null,h.next=K,K=h,h.next&&(h.next.prev=h)}for(let g=t.streams.length-1;g>=0;g--){let m=t.streams[g],h={type:m.type,rock:m.rock,disprock:m.disprock,unicode:m.unicode,isbinary:m.isbinary,readcount:m.readcount,writecount:m.writecount,readable:m.readable,writable:m.writable,streaming:m.streaming};i.class_register("stream",h,h.disprock),h.prev=null,h.next=Me,Me=h,h.next&&(h.next.prev=h)}for(let g=t.filerefs.length-1;g>=0;g--){let m=t.filerefs[g],h={type:m.type,rock:m.rock,disprock:m.disprock,filename:m.filename,textmode:m.textmode,filetype:m.filetype,filetypename:m.filetypename};i.class_register("fileref",h,h.disprock),h.prev=null,h.next=Ue,Ue=h,h.next&&(h.next.prev=h)}for(let g=0;g<t.windows.length;g++){let m=t.windows[g],h=i.class_obj_from_id("window",m.disprock);switch(h.parent=i.class_obj_from_id("window",m.parent),h.str=i.class_obj_from_id("stream",m.str),h.echostr=i.class_obj_from_id("stream",m.echostr),h.bbox={left:m.bbox.left,right:m.bbox.right,top:m.bbox.top,bottom:m.bbox.bottom},h.input_generation=null,(m.char_request||m.line_request)&&(h.input_generation=Q),h.linebuf=null,m.linebuf!==void 0&&(h.linebuf=m.linebuf.arr,i.retain_array(h.linebuf,m.linebuf)),h.char_request=m.char_request,h.line_request=m.line_request,h.char_request_uni=m.char_request_uni,h.line_request_uni=m.line_request_uni,h.hyperlink_request=m.hyperlink_request,h.mouse_request=m.mouse_request,h.echo_line_input=m.echo_line_input,h.request_echo_line_input=m.request_echo_line_input,h.line_input_terminators=m.line_input_terminators.slice(0),h.type){case d.wintype_TextBuffer:h.accum=[],h.accumstyle=h.style,h.accumhyperlink=h.hyperlink,h.accum_fg=h.fg,h.accum_bg=h.bg,h.accum_reverse=h.reverse,h.content=m.reserve.slice(0),h.clearcontent=!0,h.reserve=[],h.stylehints=Tr(m.stylehints);break;case d.wintype_TextGrid:h.gridwidth=m.gridwidth,h.gridheight=m.gridheight,h.lines=[];for(var o=0;o<m.lines.length;o++){var n=m.lines[o];h.lines.push({dirty:!0,chars:n.chars.slice(0),styles:n.styles.slice(0),hyperlinks:n.hyperlinks.slice(0),fgs:n.fgs.slice(0),bgs:n.bgs.slice(0),reverses:n.reverses.slice(0)})}h.cursorx=m.cursorx,h.cursory=m.cursory,h.clearcontent=!0,h.stylehints=Tr(m.stylehints);break;case d.wintype_Graphics:h.graphwidth=m.graphwidth,h.graphheight=m.graphheight,h.content=m.reserve.slice(0),h.reserve=[];break;case d.wintype_Pair:h.pair_dir=m.pair_dir,h.pair_division=m.pair_division,h.pair_key=i.class_obj_from_id("window",m.pair_key),h.pair_keydamage=!1,h.pair_size=m.pair_size,h.pair_hasborder=m.pair_hasborder,h.pair_vertical=m.pair_vertical,h.pair_backward=m.pair_backward,h.child1=i.class_obj_from_id("window",m.child1),h.child2=i.class_obj_from_id("window",m.child2);break}}for(let g=0;g<t.streams.length;g++){let m=t.streams[g],h=i.class_obj_from_id("stream",m.disprock);switch(h.win=null,h.ref=null,h.file=null,h.buf=null,h.bufpos=0,h.buflen=0,h.bufeof=0,h.timer_id=null,h.flush_func=null,h.fstream=null,h.type){case z:h.win=i.class_obj_from_id("window",m.win);break;case W:m.buf!==void 0&&(h.buf=m.buf.arr,i.retain_array(h.buf,m.buf)),h.buflen=m.buflen,h.bufpos=m.bufpos,h.bufeof=m.bufeof;break;case C:h.resfilenum=m.resfilenum;var s=e.find_data_chunk(h.resfilenum);s&&(h.buf=s.data),h.buflen=m.buflen,h.bufpos=m.bufpos,h.bufeof=m.bufeof;break;case M:if(h.origfmode=m.origfmode,r.streaming){if(h.ref=m.ref,h.fstream=r.file_fopen(h.origfmode,h.ref),!h.fstream){var c=r.file_construct_temp_ref(h.ref.usage);if(h.fstream=r.file_fopen(h.origfmode,c),!h.fstream)throw"restore_allstate: could not reopen even a temp stream for: "+h.ref.filename}h.origfmode!=d.filemode_WriteAppend&&h.fstream.fseek(m.filepos,d.seekmode_Start),h.buffer4=h.fstream.BufferClass.alloc(4)}else{h.ref=m.ref,h.buflen=m.buflen,h.bufpos=m.bufpos,h.bufeof=m.bufeof;var l=r.file_read(h.ref);l==null&&(l=[],r.file_write(h.ref,"",!0)),h.buf=l,h.bufeof=l.length,h.bufpos>h.bufeof&&(h.bufpos=h.bufeof)}break}}for(let g=0;g<t.filerefs.length;g++){let m=t.filerefs[g],h=i.class_obj_from_id("fileref",m.disprock);h.ref=m.ref}ie=i.class_obj_from_id("window",t.rootwin),Z=i.class_obj_from_id("stream",t.currentstr),t.timer_interval&&zo(t.timer_interval),ke.buffer=Tr(t.stylehints.buffer),ke.grid=Tr(t.stylehints.grid),R=t.glkote}function qt(t){if(A=!0,I=!0,!f){console.log("Fatal error:",t);return}f.error(t);var o={type:"update",gen:Q,disable:!0};o.input=[],f.update(o)}var d={gestalt_Version:0,gestalt_CharInput:1,gestalt_LineInput:2,gestalt_CharOutput:3,gestalt_CharOutput_CannotPrint:0,gestalt_CharOutput_ApproxPrint:1,gestalt_CharOutput_ExactPrint:2,gestalt_MouseInput:4,gestalt_Timer:5,gestalt_Graphics:6,gestalt_DrawImage:7,gestalt_Sound:8,gestalt_SoundVolume:9,gestalt_SoundNotify:10,gestalt_Hyperlinks:11,gestalt_HyperlinkInput:12,gestalt_SoundMusic:13,gestalt_GraphicsTransparency:14,gestalt_Unicode:15,gestalt_UnicodeNorm:16,gestalt_LineInputEcho:17,gestalt_LineTerminators:18,gestalt_LineTerminatorKey:19,gestalt_DateTime:20,gestalt_Sound2:21,gestalt_ResourceStream:22,gestalt_GraphicsCharInput:23,gestalt_GarglkText:4352,keycode_Unknown:4294967295,keycode_Left:4294967294,keycode_Right:4294967293,keycode_Up:4294967292,keycode_Down:4294967291,keycode_Return:4294967290,keycode_Delete:4294967289,keycode_Escape:4294967288,keycode_Tab:4294967287,keycode_PageUp:4294967286,keycode_PageDown:4294967285,keycode_Home:4294967284,keycode_End:4294967283,keycode_Func1:4294967279,keycode_Func2:4294967278,keycode_Func3:4294967277,keycode_Func4:4294967276,keycode_Func5:4294967275,keycode_Func6:4294967274,keycode_Func7:4294967273,keycode_Func8:4294967272,keycode_Func9:4294967271,keycode_Func10:4294967270,keycode_Func11:4294967269,keycode_Func12:4294967268,keycode_MAXVAL:28,evtype_None:0,evtype_Timer:1,evtype_CharInput:2,evtype_LineInput:3,evtype_MouseInput:4,evtype_Arrange:5,evtype_Redraw:6,evtype_SoundNotify:7,evtype_Hyperlink:8,evtype_VolumeNotify:9,style_Normal:0,style_Emphasized:1,style_Preformatted:2,style_Header:3,style_Subheader:4,style_Alert:5,style_Note:6,style_BlockQuote:7,style_Input:8,style_User1:9,style_User2:10,style_NUMSTYLES:11,wintype_AllTypes:0,wintype_Pair:1,wintype_Blank:2,wintype_TextBuffer:3,wintype_TextGrid:4,wintype_Graphics:5,winmethod_Left:0,winmethod_Right:1,winmethod_Above:2,winmethod_Below:3,winmethod_DirMask:15,winmethod_Fixed:16,winmethod_Proportional:32,winmethod_DivisionMask:240,winmethod_Border:0,winmethod_NoBorder:256,winmethod_BorderMask:256,fileusage_Data:0,fileusage_SavedGame:1,fileusage_Transcript:2,fileusage_InputRecord:3,fileusage_TypeMask:15,fileusage_TextMode:256,fileusage_BinaryMode:0,filemode_Write:1,filemode_Read:2,filemode_ReadWrite:3,filemode_WriteAppend:5,seekmode_Start:0,seekmode_Current:1,seekmode_End:2,stylehint_Indentation:0,stylehint_ParaIndentation:1,stylehint_Justification:2,stylehint_Size:3,stylehint_Weight:4,stylehint_Oblique:5,stylehint_Proportional:6,stylehint_TextColor:7,stylehint_BackColor:8,stylehint_ReverseColor:9,stylehint_NUMHINTS:10,stylehint_just_LeftFlush:0,stylehint_just_LeftRight:1,stylehint_just_Centered:2,stylehint_just_RightFlush:3,imagealign_InlineUp:1,imagealign_InlineDown:2,imagealign_InlineCenter:3,imagealign_MarginLeft:4,imagealign_MarginRight:5,zcolor_Default:-1,zcolor_Current:-2},Be={left:d.keycode_Left,right:d.keycode_Right,up:d.keycode_Up,down:d.keycode_Down,return:d.keycode_Return,delete:d.keycode_Delete,escape:d.keycode_Escape,tab:d.keycode_Tab,pageup:d.keycode_PageUp,pagedown:d.keycode_PageDown,home:d.keycode_Home,end:d.keycode_End,func1:d.keycode_Func1,func2:d.keycode_Func2,func3:d.keycode_Func3,func4:d.keycode_Func4,func5:d.keycode_Func5,func6:d.keycode_Func6,func7:d.keycode_Func7,func8:d.keycode_Func8,func9:d.keycode_Func9,func10:d.keycode_Func10,func11:d.keycode_Func11,func12:d.keycode_Func12},ct=null,_t={0:"normal",1:"emphasized",2:"preformatted",3:"header",4:"subheader",5:"alert",6:"note",7:"blockquote",8:"input",9:"user1",10:"user2"},Nt={0:"data",1:"save",2:"transcript",3:"command"},Ht={181:924,223:[83,83],255:376,305:73,329:[700,78],383:83,405:502,414:544,447:503,454:452,457:455,460:458,477:398,496:[74,780],499:497,595:385,596:390,598:393,599:394,601:399,603:400,608:403,611:404,616:407,617:406,623:412,626:413,629:415,640:422,643:425,648:430,650:433,651:434,658:439,837:921,912:[921,776,769],940:902,941:904,942:905,943:906,944:[933,776,769],962:931,972:908,973:910,974:911,976:914,977:920,981:934,982:928,1008:922,1010:1017,1013:917,1415:[1333,1362],7830:[72,817],7831:[84,776],7832:[87,778],7833:[89,778],7834:[65,702],7835:7776,8016:[933,787],8018:[933,787,768],8020:[933,787,769],8022:[933,787,834],8048:8122,8049:8123,8050:8136,8051:8137,8052:8138,8053:8139,8054:8154,8055:8155,8056:8184,8057:8185,8058:8170,8059:8171,8060:8186,8061:8187,8064:[7944,921],8065:[7945,921],8066:[7946,921],8067:[7947,921],8068:[7948,921],8069:[7949,921],8070:[7950,921],8071:[7951,921],8072:[7944,921],8073:[7945,921],8074:[7946,921],8075:[7947,921],8076:[7948,921],8077:[7949,921],8078:[7950,921],8079:[7951,921],8080:[7976,921],8081:[7977,921],8082:[7978,921],8083:[7979,921],8084:[7980,921],8085:[7981,921],8086:[7982,921],8087:[7983,921],8088:[7976,921],8089:[7977,921],8090:[7978,921],8091:[7979,921],8092:[7980,921],8093:[7981,921],8094:[7982,921],8095:[7983,921],8096:[8040,921],8097:[8041,921],8098:[8042,921],8099:[8043,921],8100:[8044,921],8101:[8045,921],8102:[8046,921],8103:[8047,921],8104:[8040,921],8105:[8041,921],8106:[8042,921],8107:[8043,921],8108:[8044,921],8109:[8045,921],8110:[8046,921],8111:[8047,921],8114:[8122,921],8115:[913,921],8116:[902,921],8118:[913,834],8119:[913,834,921],8124:[913,921],8126:921,8130:[8138,921],8131:[919,921],8132:[905,921],8134:[919,834],8135:[919,834,921],8140:[919,921],8146:[921,776,768],8147:[921,776,769],8150:[921,834],8151:[921,776,834],8162:[933,776,768],8163:[933,776,769],8164:[929,787],8165:8172,8166:[933,834],8167:[933,776,834],8178:[8186,921],8179:[937,921],8180:[911,921],8182:[937,834],8183:[937,834,921],8188:[937,921],64256:[70,70],64257:[70,73],64258:[70,76],64259:[70,70,73],64260:[70,70,76],64261:[83,84],64262:[83,84],64275:[1348,1350],64276:[1348,1333],64277:[1348,1339],64278:[1358,1350],64279:[1348,1341]};(function(){var t,o,n,s=Ht;for(t=[7936,7937,7938,7939,7940,7941,7942,7943,7952,7953,7954,7955,7956,7957,7968,7969,7970,7971,7972,7973,7974,7975,7984,7985,7986,7987,7988,7989,7990,7991,8e3,8001,8002,8003,8004,8005,8017,8019,8021,8023,8032,8033,8034,8035,8036,8037,8038,8039,8112,8113,8144,8145,8160,8161],o=0;o<54;o++)n=t[o],s[n]=n+8;for(n=257;n<=303;n+=2)s[n]=n-1;for(n=331;n<=375;n+=2)s[n]=n-1;for(n=505;n<=543;n+=2)s[n]=n-1;for(n=1121;n<=1153;n+=2)s[n]=n-1;for(n=1163;n<=1215;n+=2)s[n]=n-1;for(n=1233;n<=1269;n+=2)s[n]=n-1;for(n=7681;n<=7829;n+=2)s[n]=n-1;for(n=7841;n<=7929;n+=2)s[n]=n-1;for(t=[307,309,311,314,316,318,320,322,324,326,328,378,380,382,387,389,392,396,402,409,417,419,421,424,429,432,436,438,441,445,453,456,459,462,464,466,468,470,472,474,476,479,481,483,485,487,489,491,493,495,498,501,547,549,551,553,555,557,559,561,563,985,987,989,991,993,995,997,999,1001,1003,1005,1007,1016,1019,1218,1220,1222,1224,1226,1228,1230,1273,1281,1283,1285,1287,1289,1291,1293,1295],o=0;o<91;o++)n=t[o],s[n]=n-1;for(n=8560;n<=8575;n+=1)s[n]=n-16;for(n=9424;n<=9449;n+=1)s[n]=n-26;for(n=97;n<=122;n+=1)s[n]=n-32;for(n=224;n<=246;n+=1)s[n]=n-32;for(n=945;n<=961;n+=1)s[n]=n-32;for(n=1072;n<=1103;n+=1)s[n]=n-32;for(n=65345;n<=65370;n+=1)s[n]=n-32;for(t=[248,249,250,251,252,253,254,963,964,965,966,967,968,969,970,971],o=0;o<16;o++)n=t[o],s[n]=n-32;for(n=66600;n<=66639;n+=1)s[n]=n-40;for(n=1377;n<=1414;n+=1)s[n]=n-48;for(n=1104;n<=1119;n+=1)s[n]=n-80;s[1009]=929})();var et={304:[105,775],376:255,385:595,390:596,393:598,394:599,398:477,399:601,400:603,403:608,404:611,406:617,407:616,412:623,413:626,415:629,422:640,425:643,430:648,433:650,434:651,439:658,452:454,455:457,458:460,497:499,502:405,503:447,544:414,902:940,904:941,905:942,906:943,908:972,910:973,911:974,1012:952,1017:1010,8122:8048,8123:8049,8124:8115,8136:8050,8137:8051,8138:8052,8139:8053,8140:8131,8154:8054,8155:8055,8170:8058,8171:8059,8172:8165,8184:8056,8185:8057,8186:8060,8187:8061,8188:8179,8486:969,8490:107,8491:229};(function(){var t,o,n,s=et;for(n=1024;n<=1039;n+=1)s[n]=n+80;for(n=1329;n<=1366;n+=1)s[n]=n+48;for(n=66560;n<=66599;n+=1)s[n]=n+40;for(n=65;n<=90;n+=1)s[n]=n+32;for(n=192;n<=214;n+=1)s[n]=n+32;for(n=913;n<=929;n+=1)s[n]=n+32;for(n=1040;n<=1071;n+=1)s[n]=n+32;for(n=65313;n<=65338;n+=1)s[n]=n+32;for(t=[216,217,218,219,220,221,222,931,932,933,934,935,936,937,938,939],o=0;o<16;o++)n=t[o],s[n]=n+32;for(n=9398;n<=9423;n+=1)s[n]=n+26;for(n=8544;n<=8559;n+=1)s[n]=n+16;for(n=256;n<=302;n+=2)s[n]=n+1;for(n=330;n<=374;n+=2)s[n]=n+1;for(n=504;n<=542;n+=2)s[n]=n+1;for(n=1120;n<=1152;n+=2)s[n]=n+1;for(n=1162;n<=1214;n+=2)s[n]=n+1;for(n=1232;n<=1268;n+=2)s[n]=n+1;for(n=7680;n<=7828;n+=2)s[n]=n+1;for(n=7840;n<=7928;n+=2)s[n]=n+1;for(t=[306,308,310,313,315,317,319,321,323,325,327,377,379,381,386,388,391,395,401,408,416,418,420,423,428,431,435,437,440,444,453,456,459,461,463,465,467,469,471,473,475,478,480,482,484,486,488,490,492,494,498,500,546,548,550,552,554,556,558,560,562,984,986,988,990,992,994,996,998,1e3,1002,1004,1006,1015,1018,1217,1219,1221,1223,1225,1227,1229,1272,1280,1282,1284,1286,1288,1290,1292,1294],o=0;o<91;o++)n=t[o],s[n]=n+1;for(t=[7944,7945,7946,7947,7948,7949,7950,7951,7960,7961,7962,7963,7964,7965,7976,7977,7978,7979,7980,7981,7982,7983,7992,7993,7994,7995,7996,7997,7998,7999,8008,8009,8010,8011,8012,8013,8025,8027,8029,8031,8040,8041,8042,8043,8044,8045,8046,8047,8072,8073,8074,8075,8076,8077,8078,8079,8088,8089,8090,8091,8092,8093,8094,8095,8104,8105,8106,8107,8108,8109,8110,8111,8120,8121,8152,8153,8168,8169],o=0;o<78;o++)n=t[o],s[n]=n-8})();var Vt={223:[83,115],452:453,453:453,454:453,455:456,456:456,457:456,458:459,459:459,460:459,497:498,498:498,499:498,1415:[1333,1410],8114:[8122,837],8115:8124,8116:[902,837],8119:[913,834,837],8124:8124,8130:[8138,837],8131:8140,8132:[905,837],8135:[919,834,837],8140:8140,8178:[8186,837],8179:8188,8180:[911,837],8183:[937,834,837],8188:8188,64256:[70,102],64257:[70,105],64258:[70,108],64259:[70,102,105],64260:[70,102,108],64261:[83,116],64262:[83,116],64275:[1348,1398],64276:[1348,1381],64277:[1348,1387],64278:[1358,1398],64279:[1348,1389]};(function(){var t,o,n,s=Vt;for(t=[8072,8073,8074,8075,8076,8077,8078,8079,8072,8073,8074,8075,8076,8077,8078,8079,8088,8089,8090,8091,8092,8093,8094,8095,8088,8089,8090,8091,8092,8093,8094,8095,8104,8105,8106,8107,8108,8109,8110,8111,8104,8105,8106,8107,8108,8109,8110,8111],o=0;o<48;o++)n=t[o],s[o+8064]=n})();var Kt={192:[65,768],193:[65,769],194:[65,770],195:[65,771],196:[65,776],197:[65,778],199:[67,807],200:[69,768],201:[69,769],202:[69,770],203:[69,776],204:[73,768],205:[73,769],206:[73,770],207:[73,776],209:[78,771],210:[79,768],211:[79,769],212:[79,770],213:[79,771],214:[79,776],217:[85,768],218:[85,769],219:[85,770],220:[85,776],221:[89,769],224:[97,768],225:[97,769],226:[97,770],227:[97,771],228:[97,776],229:[97,778],231:[99,807],232:[101,768],233:[101,769],234:[101,770],235:[101,776],236:[105,768],237:[105,769],238:[105,770],239:[105,776],241:[110,771],242:[111,768],243:[111,769],244:[111,770],245:[111,771],246:[111,776],249:[117,768],250:[117,769],251:[117,770],252:[117,776],253:[121,769],296:[73,771],297:[105,771],298:[73,772],299:[105,772],300:[73,774],301:[105,774],302:[73,808],303:[105,808],304:[73,775],308:[74,770],309:[106,770],310:[75,807],311:[107,807],313:[76,769],314:[108,769],315:[76,807],316:[108,807],317:[76,780],318:[108,780],323:[78,769],324:[110,769],325:[78,807],326:[110,807],327:[78,780],328:[110,780],332:[79,772],333:[111,772],334:[79,774],335:[111,774],336:[79,779],337:[111,779],416:[79,795],417:[111,795],431:[85,795],432:[117,795],478:[65,776,772],479:[97,776,772],480:[65,775,772],481:[97,775,772],482:[198,772],483:[230,772],486:[71,780],487:[103,780],488:[75,780],489:[107,780],490:[79,808],491:[111,808],492:[79,808,772],493:[111,808,772],494:[439,780],495:[658,780],496:[106,780],500:[71,769],501:[103,769],542:[72,780],543:[104,780],550:[65,775],551:[97,775],552:[69,807],553:[101,807],554:[79,776,772],555:[111,776,772],556:[79,771,772],557:[111,771,772],558:[79,775],559:[111,775],560:[79,775,772],561:[111,775,772],562:[89,772],563:[121,772],832:768,833:769,835:787,836:[776,769],884:697,894:59,901:[168,769],902:[913,769],903:183,904:[917,769],905:[919,769],906:[921,769],908:[927,769],910:[933,769],911:[937,769],912:[953,776,769],938:[921,776],939:[933,776],940:[945,769],941:[949,769],942:[951,769],943:[953,769],944:[965,776,769],970:[953,776],971:[965,776],972:[959,769],973:[965,769],974:[969,769],979:[978,769],980:[978,776],1024:[1045,768],1025:[1045,776],1027:[1043,769],1031:[1030,776],1036:[1050,769],1037:[1048,768],1038:[1059,774],1049:[1048,774],1081:[1080,774],1104:[1077,768],1105:[1077,776],1107:[1075,769],1111:[1110,776],1116:[1082,769],1117:[1080,768],1118:[1091,774],1142:[1140,783],1143:[1141,783],1217:[1046,774],1218:[1078,774],1232:[1040,774],1233:[1072,774],1234:[1040,776],1235:[1072,776],1238:[1045,774],1239:[1077,774],1242:[1240,776],1243:[1241,776],1244:[1046,776],1245:[1078,776],1246:[1047,776],1247:[1079,776],1250:[1048,772],1251:[1080,772],1252:[1048,776],1253:[1080,776],1254:[1054,776],1255:[1086,776],1258:[1256,776],1259:[1257,776],1260:[1069,776],1261:[1101,776],1262:[1059,772],1263:[1091,772],1264:[1059,776],1265:[1091,776],1266:[1059,779],1267:[1091,779],1268:[1063,776],1269:[1095,776],1272:[1067,776],1273:[1099,776],1570:[1575,1619],1571:[1575,1620],1572:[1608,1620],1573:[1575,1621],1574:[1610,1620],1728:[1749,1620],1730:[1729,1620],1747:[1746,1620],2345:[2344,2364],2353:[2352,2364],2356:[2355,2364],2392:[2325,2364],2393:[2326,2364],2394:[2327,2364],2395:[2332,2364],2396:[2337,2364],2397:[2338,2364],2398:[2347,2364],2399:[2351,2364],2507:[2503,2494],2508:[2503,2519],2524:[2465,2492],2525:[2466,2492],2527:[2479,2492],2611:[2610,2620],2614:[2616,2620],2649:[2582,2620],2650:[2583,2620],2651:[2588,2620],2654:[2603,2620],2888:[2887,2902],2891:[2887,2878],2892:[2887,2903],2908:[2849,2876],2909:[2850,2876],2964:[2962,3031],3018:[3014,3006],3019:[3015,3006],3020:[3014,3031],3144:[3142,3158],3264:[3263,3285],3271:[3270,3285],3272:[3270,3286],3274:[3270,3266],3275:[3270,3266,3285],3402:[3398,3390],3403:[3399,3390],3404:[3398,3415],3546:[3545,3530],3548:[3545,3535],3549:[3545,3535,3530],3550:[3545,3551],3907:[3906,4023],3917:[3916,4023],3922:[3921,4023],3927:[3926,4023],3932:[3931,4023],3945:[3904,4021],3955:[3953,3954],3957:[3953,3956],3958:[4018,3968],3960:[4019,3968],3969:[3953,3968],3987:[3986,4023],3997:[3996,4023],4002:[4001,4023],4007:[4006,4023],4012:[4011,4023],4025:[3984,4021],4134:[4133,4142],7835:[383,775],7960:[917,787],7961:[917,788],7962:[917,787,768],7963:[917,788,768],7964:[917,787,769],7965:[917,788,769],8008:[927,787],8009:[927,788],8010:[927,787,768],8011:[927,788,768],8012:[927,787,769],8013:[927,788,769],8016:[965,787],8017:[965,788],8018:[965,787,768],8019:[965,788,768],8020:[965,787,769],8021:[965,788,769],8022:[965,787,834],8023:[965,788,834],8025:[933,788],8027:[933,788,768],8029:[933,788,769],8118:[945,834],8119:[945,834,837],8120:[913,774],8121:[913,772],8122:[913,768],8123:[913,769],8124:[913,837],8126:953,8129:[168,834],8130:[951,768,837],8131:[951,837],8132:[951,769,837],8134:[951,834],8135:[951,834,837],8136:[917,768],8137:[917,769],8138:[919,768],8139:[919,769],8140:[919,837],8141:[8127,768],8142:[8127,769],8143:[8127,834],8144:[953,774],8145:[953,772],8146:[953,776,768],8147:[953,776,769],8150:[953,834],8151:[953,776,834],8152:[921,774],8153:[921,772],8154:[921,768],8155:[921,769],8178:[969,768,837],8179:[969,837],8180:[969,769,837],8182:[969,834],8183:[969,834,837],8184:[927,768],8185:[927,769],8186:[937,768],8187:[937,769],8188:[937,837],8189:180,8192:8194,8193:8195,8486:937,8490:75,8491:[65,778],8602:[8592,824],8603:[8594,824],8622:[8596,824],8653:[8656,824],8654:[8660,824],8655:[8658,824],8708:[8707,824],8713:[8712,824],8716:[8715,824],8740:[8739,824],8742:[8741,824],8769:[8764,824],8772:[8771,824],8775:[8773,824],8777:[8776,824],8800:[61,824],8802:[8801,824],8813:[8781,824],8814:[60,824],8815:[62,824],8816:[8804,824],8817:[8805,824],8820:[8818,824],8821:[8819,824],8824:[8822,824],8825:[8823,824],8832:[8826,824],8833:[8827,824],8836:[8834,824],8837:[8835,824],8840:[8838,824],8841:[8839,824],8876:[8866,824],8877:[8872,824],8878:[8873,824],8879:[8875,824],8928:[8828,824],8929:[8829,824],8930:[8849,824],8931:[8850,824],8938:[8882,824],8939:[8883,824],8940:[8884,824],8941:[8885,824],9001:12296,9002:12297,10972:[10973,824],12364:[12363,12441],12366:[12365,12441],12368:[12367,12441],12370:[12369,12441],12372:[12371,12441],12374:[12373,12441],12376:[12375,12441],12378:[12377,12441],12380:[12379,12441],12382:[12381,12441],12384:[12383,12441],12386:[12385,12441],12389:[12388,12441],12391:[12390,12441],12393:[12392,12441],12400:[12399,12441],12401:[12399,12442],12403:[12402,12441],12404:[12402,12442],12406:[12405,12441],12407:[12405,12442],12409:[12408,12441],12410:[12408,12442],12412:[12411,12441],12413:[12411,12442],12436:[12358,12441],12446:[12445,12441],12460:[12459,12441],12462:[12461,12441],12464:[12463,12441],12466:[12465,12441],12468:[12467,12441],12470:[12469,12441],12472:[12471,12441],12474:[12473,12441],12476:[12475,12441],12478:[12477,12441],12480:[12479,12441],12482:[12481,12441],12485:[12484,12441],12487:[12486,12441],12489:[12488,12441],12496:[12495,12441],12497:[12495,12442],12499:[12498,12441],12500:[12498,12442],12502:[12501,12441],12503:[12501,12442],12505:[12504,12441],12506:[12504,12442],12508:[12507,12441],12509:[12507,12442],12532:[12454,12441],12535:[12527,12441],12536:[12528,12441],12537:[12529,12441],12538:[12530,12441],12542:[12541,12441],64016:22618,64018:26228,64021:20958,64022:29482,64023:30410,64024:31036,64025:31070,64026:31077,64027:31119,64028:38742,64029:31934,64030:32701,64032:34322,64034:35576,64037:36920,64038:37117,64042:39151,64043:39164,64044:39208,64045:40372,64285:[1497,1460],64287:[1522,1463],64298:[1513,1473],64299:[1513,1474],64300:[1513,1468,1473],64301:[1513,1468,1474],64302:[1488,1463],64303:[1488,1464],64304:[1488,1468],64305:[1489,1468],64306:[1490,1468],64307:[1491,1468],64308:[1492,1468],64309:[1493,1468],64310:[1494,1468],64312:[1496,1468],64313:[1497,1468],64314:[1498,1468],64315:[1499,1468],64316:[1500,1468],64318:[1502,1468],64320:[1504,1468],64321:[1505,1468],64323:[1507,1468],64324:[1508,1468],64326:[1510,1468],64327:[1511,1468],64328:[1512,1468],64329:[1513,1468],64330:[1514,1468],64331:[1493,1465],64332:[1489,1471],64333:[1499,1471],64334:[1508,1471],119134:[119127,119141],119135:[119128,119141],119136:[119128,119141,119150],119137:[119128,119141,119151],119138:[119128,119141,119152],119139:[119128,119141,119153],119140:[119128,119141,119154],119227:[119225,119141],119228:[119226,119141],119229:[119225,119141,119150],119230:[119226,119141,119150],119231:[119225,119141,119151],119232:[119226,119141,119151]};(function(){var t,o,n,s=Kt;for(t=[[121,776],[65,772],[97,772],[65,774],[97,774],[65,808],[97,808],[67,769],[99,769],[67,770],[99,770],[67,775],[99,775],[67,780],[99,780],[68,780],[100,780]],o=0;o<17;o++)n=t[o],s[o+255]=n;for(t=[[69,772],[101,772],[69,774],[101,774],[69,775],[101,775],[69,808],[101,808],[69,780],[101,780],[71,770],[103,770],[71,774],[103,774],[71,775],[103,775],[71,807],[103,807],[72,770],[104,770]],o=0;o<20;o++)n=t[o],s[o+274]=n;for(t=[[82,769],[114,769],[82,807],[114,807],[82,780],[114,780],[83,769],[115,769],[83,770],[115,770],[83,807],[115,807],[83,780],[115,780],[84,807],[116,807],[84,780],[116,780]],o=0;o<18;o++)n=t[o],s[o+340]=n;for(t=[[85,771],[117,771],[85,772],[117,772],[85,774],[117,774],[85,778],[117,778],[85,779],[117,779],[85,808],[117,808],[87,770],[119,770],[89,770],[121,770],[89,776],[90,769],[122,769],[90,775],[122,775],[90,780],[122,780]],o=0;o<23;o++)n=t[o],s[o+360]=n;for(t=[[65,780],[97,780],[73,780],[105,780],[79,780],[111,780],[85,780],[117,780],[85,776,772],[117,776,772],[85,776,769],[117,776,769],[85,776,780],[117,776,780],[85,776,768],[117,776,768]],o=0;o<16;o++)n=t[o],s[o+461]=n;for(t=[[78,768],[110,768],[65,778,769],[97,778,769],[198,769],[230,769],[216,769],[248,769],[65,783],[97,783],[65,785],[97,785],[69,783],[101,783],[69,785],[101,785],[73,783],[105,783],[73,785],[105,785],[79,783],[111,783],[79,785],[111,785],[82,783],[114,783],[82,785],[114,785],[85,783],[117,783],[85,785],[117,785],[83,806],[115,806],[84,806],[116,806]],o=0;o<36;o++)n=t[o],s[o+504]=n;for(t=[[65,805],[97,805],[66,775],[98,775],[66,803],[98,803],[66,817],[98,817],[67,807,769],[99,807,769],[68,775],[100,775],[68,803],[100,803],[68,817],[100,817],[68,807],[100,807],[68,813],[100,813],[69,772,768],[101,772,768],[69,772,769],[101,772,769],[69,813],[101,813],[69,816],[101,816],[69,807,774],[101,807,774],[70,775],[102,775],[71,772],[103,772],[72,775],[104,775],[72,803],[104,803],[72,776],[104,776],[72,807],[104,807],[72,814],[104,814],[73,816],[105,816],[73,776,769],[105,776,769],[75,769],[107,769],[75,803],[107,803],[75,817],[107,817],[76,803],[108,803],[76,803,772],[108,803,772],[76,817],[108,817],[76,813],[108,813],[77,769],[109,769],[77,775],[109,775],[77,803],[109,803],[78,775],[110,775],[78,803],[110,803],[78,817],[110,817],[78,813],[110,813],[79,771,769],[111,771,769],[79,771,776],[111,771,776],[79,772,768],[111,772,768],[79,772,769],[111,772,769],[80,769],[112,769],[80,775],[112,775],[82,775],[114,775],[82,803],[114,803],[82,803,772],[114,803,772],[82,817],[114,817],[83,775],[115,775],[83,803],[115,803],[83,769,775],[115,769,775],[83,780,775],[115,780,775],[83,803,775],[115,803,775],[84,775],[116,775],[84,803],[116,803],[84,817],[116,817],[84,813],[116,813],[85,804],[117,804],[85,816],[117,816],[85,813],[117,813],[85,771,769],[117,771,769],[85,772,776],[117,772,776],[86,771],[118,771],[86,803],[118,803],[87,768],[119,768],[87,769],[119,769],[87,776],[119,776],[87,775],[119,775],[87,803],[119,803],[88,775],[120,775],[88,776],[120,776],[89,775],[121,775],[90,770],[122,770],[90,803],[122,803],[90,817],[122,817],[104,817],[116,776],[119,778],[121,778]],o=0;o<154;o++)n=t[o],s[o+7680]=n;for(t=[[65,803],[97,803],[65,777],[97,777],[65,770,769],[97,770,769],[65,770,768],[97,770,768],[65,770,777],[97,770,777],[65,770,771],[97,770,771],[65,803,770],[97,803,770],[65,774,769],[97,774,769],[65,774,768],[97,774,768],[65,774,777],[97,774,777],[65,774,771],[97,774,771],[65,803,774],[97,803,774],[69,803],[101,803],[69,777],[101,777],[69,771],[101,771],[69,770,769],[101,770,769],[69,770,768],[101,770,768],[69,770,777],[101,770,777],[69,770,771],[101,770,771],[69,803,770],[101,803,770],[73,777],[105,777],[73,803],[105,803],[79,803],[111,803],[79,777],[111,777],[79,770,769],[111,770,769],[79,770,768],[111,770,768],[79,770,777],[111,770,777],[79,770,771],[111,770,771],[79,803,770],[111,803,770],[79,795,769],[111,795,769],[79,795,768],[111,795,768],[79,795,777],[111,795,777],[79,795,771],[111,795,771],[79,795,803],[111,795,803],[85,803],[117,803],[85,777],[117,777],[85,795,769],[117,795,769],[85,795,768],[117,795,768],[85,795,777],[117,795,777],[85,795,771],[117,795,771],[85,795,803],[117,795,803],[89,768],[121,768],[89,803],[121,803],[89,777],[121,777],[89,771],[121,771]],o=0;o<90;o++)n=t[o],s[o+7840]=n;for(t=[[945,787],[945,788],[945,787,768],[945,788,768],[945,787,769],[945,788,769],[945,787,834],[945,788,834],[913,787],[913,788],[913,787,768],[913,788,768],[913,787,769],[913,788,769],[913,787,834],[913,788,834],[949,787],[949,788],[949,787,768],[949,788,768],[949,787,769],[949,788,769]],o=0;o<22;o++)n=t[o],s[o+7936]=n;for(t=[[951,787],[951,788],[951,787,768],[951,788,768],[951,787,769],[951,788,769],[951,787,834],[951,788,834],[919,787],[919,788],[919,787,768],[919,788,768],[919,787,769],[919,788,769],[919,787,834],[919,788,834],[953,787],[953,788],[953,787,768],[953,788,768],[953,787,769],[953,788,769],[953,787,834],[953,788,834],[921,787],[921,788],[921,787,768],[921,788,768],[921,787,769],[921,788,769],[921,787,834],[921,788,834],[959,787],[959,788],[959,787,768],[959,788,768],[959,787,769],[959,788,769]],o=0;o<38;o++)n=t[o],s[o+7968]=n;for(t=[[933,788,834],[969,787],[969,788],[969,787,768],[969,788,768],[969,787,769],[969,788,769],[969,787,834],[969,788,834],[937,787],[937,788],[937,787,768],[937,788,768],[937,787,769],[937,788,769],[937,787,834],[937,788,834],[945,768],[945,769],[949,768],[949,769],[951,768],[951,769],[953,768],[953,769],[959,768],[959,769],[965,768],[965,769],[969,768],[969,769]],o=0;o<31;o++)n=t[o],s[o+8031]=n;for(t=[[945,787,837],[945,788,837],[945,787,768,837],[945,788,768,837],[945,787,769,837],[945,788,769,837],[945,787,834,837],[945,788,834,837],[913,787,837],[913,788,837],[913,787,768,837],[913,788,768,837],[913,787,769,837],[913,788,769,837],[913,787,834,837],[913,788,834,837],[951,787,837],[951,788,837],[951,787,768,837],[951,788,768,837],[951,787,769,837],[951,788,769,837],[951,787,834,837],[951,788,834,837],[919,787,837],[919,788,837],[919,787,768,837],[919,788,768,837],[919,787,769,837],[919,788,769,837],[919,787,834,837],[919,788,834,837],[969,787,837],[969,788,837],[969,787,768,837],[969,788,768,837],[969,787,769,837],[969,788,769,837],[969,787,834,837],[969,788,834,837],[937,787,837],[937,788,837],[937,787,768,837],[937,788,768,837],[937,787,769,837],[937,788,769,837],[937,787,834,837],[937,788,834,837],[945,774],[945,772],[945,768,837],[945,837],[945,769,837]],o=0;o<53;o++)n=t[o],s[o+8064]=n;for(t=[[8190,768],[8190,769],[8190,834],[965,774],[965,772],[965,776,768],[965,776,769],[961,787],[961,788],[965,834],[965,776,834],[933,774],[933,772],[933,768],[933,769],[929,788],[168,768],[168,769],96],o=0;o<19;o++)n=t[o],s[o+8157]=n;for(t=[35912,26356,36554,36040,28369,20018,21477,40860,40860,22865,37329,21895,22856,25078,30313,32645,34367,34746,35064,37007,27138,27931,28889,29662,33853,37226,39409,20098,21365,27396,29211,34349,40478,23888,28651,34253,35172,25289,33240,34847,24266,26391,28010,29436,37070,20358,20919,21214,25796,27347,29200,30439,32769,34310,34396,36335,38706,39791,40442,30860,31103,32160,33737,37636,40575,35542,22751,24324,31840,32894,29282,30922,36034,38647,22744,23650,27155,28122,28431,32047,32311,38475,21202,32907,20956,20940,31260,32190,33777,38517,35712,25295,27138,35582,20025,23527,24594,29575,30064,21271,30971,20415,24489,19981,27852,25976,32034,21443,22622,30465,33865,35498,27578,36784,27784,25342,33509,25504,30053,20142,20841,20937,26753,31975,33391,35538,37327,21237,21570,22899,24300,26053,28670,31018,38317,39530,40599,40654,21147,26310,27511,36706,24180,24976,25088,25754,28451,29001,29833,31178,32244,32879,36646,34030,36899,37706,21015,21155,21693,28872,35010,35498,24265,24565,25467,27566,31806,29557,20196,22265,23527,23994,24604,29618,29801,32666,32838,37428,38646,38728,38936,20363,31150,37300,38584,24801,20102,20698,23534,23615,26009,27138,29134,30274,34044,36988,40845,26248,38446,21129,26491,26611,27969,28316,29705,30041,30827,32016,39006,20845,25134,38520,20523,23833,28138,36650,24459,24900,26647,29575,38534,21033,21519,23653,26131,26446,26792,27877,29702,30178,32633,35023,35041,37324,38626,21311,28346,21533,29136,29848,34298,38563,40023,40607,26519,28107,33256,31435,31520,31890,29376,28825,35672,20160,33590,21050,20999,24230,25299,31958,23429,27934,26292,36667,34892,38477,35211,24275,20800,21952],o=0;o<270;o++)n=t[o],s[o+63744]=n;for(t=[20398,20711,20813,21193,21220,21329,21917,22022,22120,22592,22696,23652,23662,24724,24936,24974,25074,25935,26082,26257,26757,28023,28186,28450,29038,29227,29730,30865,31038,31049,31048,31056,31062,31069,31117,31118,31296,31361,31680,32244,32265,32321,32626,32773,33261,33401,33401,33879,35088,35222,35585,35641,36051,36104,36790,36920,38627,38911,38971],o=0;o<59;o++)n=t[o],s[o+64048]=n;for(t=[20029,20024,20033,131362,20320,20398,20411,20482,20602,20633,20711,20687,13470,132666,20813,20820,20836,20855,132380,13497,20839,20877,132427,20887,20900,20172,20908,20917,168415,20981,20995,13535,21051,21062,21106,21111,13589,21191,21193,21220,21242,21253,21254,21271,21321,21329,21338,21363,21373,21375,21375,21375,133676,28784,21450,21471,133987,21483,21489,21510,21662,21560,21576,21608,21666,21750,21776,21843,21859,21892,21892,21913,21931,21939,21954,22294,22022,22295,22097,22132,20999,22766,22478,22516,22541,22411,22578,22577,22700,136420,22770,22775,22790,22810,22818,22882,136872,136938,23020,23067,23079,23e3,23142,14062,14076,23304,23358,23358,137672,23491,23512,23527,23539,138008,23551,23558,24403,23586,14209,23648,23662,23744,23693,138724,23875,138726,23918,23915,23932,24033,24034,14383,24061,24104,24125,24169,14434,139651,14460,24240,24243,24246,24266,172946,24318,140081,140081,33281,24354,24354,14535,144056,156122,24418,24427,14563,24474,24525,24535,24569,24705,14650,14620,24724,141012,24775,24904,24908,24910,24908,24954,24974,25010,24996,25007,25054,25074,25078,25104,25115,25181,25265,25300,25424,142092,25405,25340,25448,25475,25572,142321,25634,25541,25513,14894,25705,25726,25757,25719,14956,25935,25964,143370,26083,26360,26185,15129,26257,15112,15076,20882,20885,26368,26268,32941,17369,26391,26395,26401,26462,26451,144323,15177,26618,26501,26706,26757,144493,26766,26655,26900,15261,26946,27043,27114,27304,145059,27355,15384,27425,145575,27476,15438,27506,27551,27578,27579,146061,138507,146170,27726,146620,27839,27853,27751,27926,27966,28023,27969,28009,28024,28037,146718,27956,28207,28270,15667,28363,28359,147153,28153,28526,147294,147342,28614,28729,28702,28699,15766,28746,28797,28791,28845,132389,28997,148067,29084,148395,29224,29237,29264,149e3,29312,29333,149301,149524,29562,29579,16044,29605,16056,16056,29767,29788,29809,29829,29898,16155,29988,150582,30014,150674,30064,139679,30224,151457,151480,151620,16380,16392,30452,151795,151794,151833,151859,30494,30495,30495,30538,16441,30603,16454,16534,152605,30798,30860,30924,16611,153126,31062,153242,153285,31119,31211,16687,31296,31306,31311,153980,154279,154279,31470,16898,154539,31686,31689,16935,154752,31954,17056,31976,31971,32e3,155526,32099,17153,32199,32258,32325,17204,156200,156231,17241,156377,32634,156478,32661,32762,32773,156890,156963,32864,157096,32880,144223,17365,32946,33027,17419,33086,23221,157607,157621,144275,144284,33281,33284,36766,17515,33425,33419,33437,21171,33457,33459,33469,33510,158524,33509,33565,33635,33709,33571,33725,33767,33879,33619,33738,33740,33756,158774,159083,158933,17707,34033,34035,34070,160714,34148,159532,17757,17761,159665,159954,17771,34384,34396,34407,34409,34473,34440,34574,34530,34681,34600,34667,34694,17879,34785,34817,17913,34912,34915,161383,35031,35038,17973,35066,13499,161966,162150,18110,18119,35488,35565,35722,35925,162984,36011,36033,36123,36215,163631,133124,36299,36284,36336,133342,36564,36664,165330,165357,37012,37105,37137,165678,37147,37432,37591,37592,37500,37881,37909,166906,38283,18837,38327,167287,18918,38595,23986,38691,168261,168474,19054,19062,38880,168970,19122,169110,38923,38923,38953,169398,39138,19251,39209,39335,39362,39422,19406,170800,39698,4e4,40189,19662,19693,40295,172238,19704,172293,172558,172689,40635,19798,40697,40702,40709,40719,40726,40763,173568],o=0;o<542;o++)n=t[o],s[o+194560]=n})();var we={768:230,769:230,770:230,771:230,772:230,773:230,774:230,775:230,776:230,777:230,778:230,779:230,780:230,781:230,782:230,783:230,784:230,785:230,786:230,787:230,788:230,789:232,790:220,791:220,792:220,793:220,794:232,795:216,796:220,797:220,798:220,799:220,800:220,801:202,802:202,803:220,804:220,805:220,806:220,807:202,808:202,809:220,810:220,811:220,812:220,813:220,814:220,815:220,816:220,817:220,818:220,819:220,820:1,821:1,822:1,823:1,824:1,825:220,826:220,827:220,828:220,829:230,830:230,831:230,832:230,833:230,834:230,835:230,836:230,837:240,838:230,839:220,840:220,841:220,842:230,843:230,844:230,845:220,846:220,848:230,849:230,850:230,851:220,852:220,853:220,854:220,855:230,861:234,862:234,863:233,864:234,865:234,866:233,867:230,868:230,869:230,870:230,871:230,872:230,873:230,874:230,875:230,876:230,877:230,878:230,879:230,1155:230,1156:230,1157:230,1158:230,1425:220,1426:230,1427:230,1428:230,1429:230,1430:220,1431:230,1432:230,1433:230,1434:222,1435:220,1436:230,1437:230,1438:230,1439:230,1440:230,1441:230,1443:220,1444:220,1445:220,1446:220,1447:220,1448:230,1449:230,1450:220,1451:230,1452:230,1453:222,1454:228,1455:230,1456:10,1457:11,1458:12,1459:13,1460:14,1461:15,1462:16,1463:17,1464:18,1465:19,1467:20,1468:21,1469:22,1471:23,1473:24,1474:25,1476:230,1552:230,1553:230,1554:230,1555:230,1556:230,1557:230,1611:27,1612:28,1613:29,1614:30,1615:31,1616:32,1617:33,1618:34,1619:230,1620:230,1621:220,1622:220,1623:230,1624:230,1648:35,1750:230,1751:230,1752:230,1753:230,1754:230,1755:230,1756:230,1759:230,1760:230,1761:230,1762:230,1763:220,1764:230,1767:230,1768:230,1770:220,1771:230,1772:230,1773:220,1809:36,1840:230,1841:220,1842:230,1843:230,1844:220,1845:230,1846:230,1847:220,1848:220,1849:220,1850:230,1851:220,1852:220,1853:230,1854:220,1855:230,1856:230,1857:230,1858:220,1859:230,1860:220,1861:230,1862:220,1863:230,1864:220,1865:230,1866:230,2364:7,2381:9,2385:230,2386:220,2387:230,2388:230,2492:7,2509:9,2620:7,2637:9,2748:7,2765:9,2876:7,2893:9,3021:9,3149:9,3157:84,3158:91,3260:7,3277:9,3405:9,3530:9,3640:103,3641:103,3642:9,3656:107,3657:107,3658:107,3659:107,3768:118,3769:118,3784:122,3785:122,3786:122,3787:122,3864:220,3865:220,3893:220,3895:220,3897:216,3953:129,3954:130,3956:132,3962:130,3963:130,3964:130,3965:130,3968:130,3970:230,3971:230,3972:9,3974:230,3975:230,4038:220,4151:7,4153:9,5908:9,5940:9,6098:9,6109:230,6313:228,6457:222,6458:230,6459:220,8400:230,8401:230,8402:1,8403:1,8404:230,8405:230,8406:230,8407:230,8408:1,8409:1,8410:1,8411:230,8412:230,8417:230,8421:1,8422:1,8423:230,8424:220,8425:230,8426:1,12330:218,12331:228,12332:232,12333:222,12334:224,12335:224,12441:8,12442:8,64286:26,65056:230,65057:230,65058:230,65059:230,119141:216,119142:216,119143:1,119144:1,119145:1,119149:226,119150:216,119151:216,119152:216,119153:216,119154:216,119163:220,119164:220,119165:220,119166:220,119167:220,119168:220,119169:220,119170:220,119173:230,119174:230,119175:230,119176:230,119177:230,119178:220,119179:220,119210:230,119211:230,119212:230,119213:230},Ni={60:{824:8814},61:{824:8800},62:{824:8815},65:{768:192,769:193,770:194,771:195,772:256,774:258,775:550,776:196,777:7842,778:197,780:461,783:512,785:514,803:7840,805:7680,808:260},66:{775:7682,803:7684,817:7686},67:{769:262,770:264,775:266,780:268,807:199},68:{775:7690,780:270,803:7692,807:7696,813:7698,817:7694},69:{768:200,769:201,770:202,771:7868,772:274,774:276,775:278,776:203,777:7866,780:282,783:516,785:518,803:7864,807:552,808:280,813:7704,816:7706},70:{775:7710},71:{769:500,770:284,772:7712,774:286,775:288,780:486,807:290},72:{770:292,775:7714,776:7718,780:542,803:7716,807:7720,814:7722},73:{768:204,769:205,770:206,771:296,772:298,774:300,775:304,776:207,777:7880,780:463,783:520,785:522,803:7882,808:302,816:7724},74:{770:308},75:{769:7728,780:488,803:7730,807:310,817:7732},76:{769:313,780:317,803:7734,807:315,813:7740,817:7738},77:{769:7742,775:7744,803:7746},78:{768:504,769:323,771:209,775:7748,780:327,803:7750,807:325,813:7754,817:7752},79:{768:210,769:211,770:212,771:213,772:332,774:334,775:558,776:214,777:7886,779:336,780:465,783:524,785:526,795:416,803:7884,808:490},80:{769:7764,775:7766},82:{769:340,775:7768,780:344,783:528,785:530,803:7770,807:342,817:7774},83:{769:346,770:348,775:7776,780:352,803:7778,806:536,807:350},84:{775:7786,780:356,803:7788,806:538,807:354,813:7792,817:7790},85:{768:217,769:218,770:219,771:360,772:362,774:364,776:220,777:7910,778:366,779:368,780:467,783:532,785:534,795:431,803:7908,804:7794,808:370,813:7798,816:7796},86:{771:7804,803:7806},87:{768:7808,769:7810,770:372,775:7814,776:7812,803:7816},88:{775:7818,776:7820},89:{768:7922,769:221,770:374,771:7928,772:562,775:7822,776:376,777:7926,803:7924},90:{769:377,770:7824,775:379,780:381,803:7826,817:7828},97:{768:224,769:225,770:226,771:227,772:257,774:259,775:551,776:228,777:7843,778:229,780:462,783:513,785:515,803:7841,805:7681,808:261},98:{775:7683,803:7685,817:7687},99:{769:263,770:265,775:267,780:269,807:231},100:{775:7691,780:271,803:7693,807:7697,813:7699,817:7695},101:{768:232,769:233,770:234,771:7869,772:275,774:277,775:279,776:235,777:7867,780:283,783:517,785:519,803:7865,807:553,808:281,813:7705,816:7707},102:{775:7711},103:{769:501,770:285,772:7713,774:287,775:289,780:487,807:291},104:{770:293,775:7715,776:7719,780:543,803:7717,807:7721,814:7723,817:7830},105:{768:236,769:237,770:238,771:297,772:299,774:301,776:239,777:7881,780:464,783:521,785:523,803:7883,808:303,816:7725},106:{770:309,780:496},107:{769:7729,780:489,803:7731,807:311,817:7733},108:{769:314,780:318,803:7735,807:316,813:7741,817:7739},109:{769:7743,775:7745,803:7747},110:{768:505,769:324,771:241,775:7749,780:328,803:7751,807:326,813:7755,817:7753},111:{768:242,769:243,770:244,771:245,772:333,774:335,775:559,776:246,777:7887,779:337,780:466,783:525,785:527,795:417,803:7885,808:491},112:{769:7765,775:7767},114:{769:341,775:7769,780:345,783:529,785:531,803:7771,807:343,817:7775},115:{769:347,770:349,775:7777,780:353,803:7779,806:537,807:351},116:{775:7787,776:7831,780:357,803:7789,806:539,807:355,813:7793,817:7791},117:{768:249,769:250,770:251,771:361,772:363,774:365,776:252,777:7911,778:367,779:369,780:468,783:533,785:535,795:432,803:7909,804:7795,808:371,813:7799,816:7797},118:{771:7805,803:7807},119:{768:7809,769:7811,770:373,775:7815,776:7813,778:7832,803:7817},120:{775:7819,776:7821},121:{768:7923,769:253,770:375,771:7929,772:563,775:7823,776:255,777:7927,778:7833,803:7925},122:{769:378,770:7825,775:380,780:382,803:7827,817:7829},168:{768:8173,769:901,834:8129},194:{768:7846,769:7844,771:7850,777:7848},196:{772:478},197:{769:506},198:{769:508,772:482},199:{769:7688},202:{768:7872,769:7870,771:7876,777:7874},207:{769:7726},212:{768:7890,769:7888,771:7894,777:7892},213:{769:7756,772:556,776:7758},214:{772:554},216:{769:510},220:{768:475,769:471,772:469,780:473},226:{768:7847,769:7845,771:7851,777:7849},228:{772:479},229:{769:507},230:{769:509,772:483},231:{769:7689},234:{768:7873,769:7871,771:7877,777:7875},239:{769:7727},244:{768:7891,769:7889,771:7895,777:7893},245:{769:7757,772:557,776:7759},246:{772:555},248:{769:511},252:{768:476,769:472,772:470,780:474},258:{768:7856,769:7854,771:7860,777:7858},259:{768:7857,769:7855,771:7861,777:7859},274:{768:7700,769:7702},275:{768:7701,769:7703},332:{768:7760,769:7762},333:{768:7761,769:7763},346:{775:7780},347:{775:7781},352:{775:7782},353:{775:7783},360:{769:7800},361:{769:7801},362:{776:7802},363:{776:7803},383:{775:7835},416:{768:7900,769:7898,771:7904,777:7902,803:7906},417:{768:7901,769:7899,771:7905,777:7903,803:7907},431:{768:7914,769:7912,771:7918,777:7916,803:7920},432:{768:7915,769:7913,771:7919,777:7917,803:7921},439:{780:494},490:{772:492},491:{772:493},550:{772:480},551:{772:481},552:{774:7708},553:{774:7709},558:{772:560},559:{772:561},658:{780:495},776:{769:836},913:{768:8122,769:902,772:8121,774:8120,787:7944,788:7945,837:8124},917:{768:8136,769:904,787:7960,788:7961},919:{768:8138,769:905,787:7976,788:7977,837:8140},921:{768:8154,769:906,772:8153,774:8152,776:938,787:7992,788:7993},927:{768:8184,769:908,787:8008,788:8009},929:{788:8172},933:{768:8170,769:910,772:8169,774:8168,776:939,788:8025},937:{768:8186,769:911,787:8040,788:8041,837:8188},940:{837:8116},942:{837:8132},945:{768:8048,769:940,772:8113,774:8112,787:7936,788:7937,834:8118,837:8115},949:{768:8050,769:941,787:7952,788:7953},951:{768:8052,769:942,787:7968,788:7969,834:8134,837:8131},953:{768:8054,769:943,772:8145,774:8144,776:970,787:7984,788:7985,834:8150},959:{768:8056,769:972,787:8e3,788:8001},961:{787:8164,788:8165},965:{768:8058,769:973,772:8161,774:8160,776:971,787:8016,788:8017,834:8166},969:{768:8060,769:974,787:8032,788:8033,834:8182,837:8179},970:{768:8146,769:912,834:8151},971:{768:8162,769:944,834:8167},974:{837:8180},978:{769:979,776:980},1030:{776:1031},1040:{774:1232,776:1234},1043:{769:1027},1045:{768:1024,774:1238,776:1025},1046:{774:1217,776:1244},1047:{776:1246},1048:{768:1037,772:1250,774:1049,776:1252},1050:{769:1036},1054:{776:1254},1059:{772:1262,774:1038,776:1264,779:1266},1063:{776:1268},1067:{776:1272},1069:{776:1260},1072:{774:1233,776:1235},1075:{769:1107},1077:{768:1104,774:1239,776:1105},1078:{774:1218,776:1245},1079:{776:1247},1080:{768:1117,772:1251,774:1081,776:1253},1082:{769:1116},1086:{776:1255},1091:{772:1263,774:1118,776:1265,779:1267},1095:{776:1269},1099:{776:1273},1101:{776:1261},1110:{776:1111},1140:{783:1142},1141:{783:1143},1240:{776:1242},1241:{776:1243},1256:{776:1258},1257:{776:1259},1488:{1463:64302,1464:64303,1468:64304},1489:{1468:64305,1471:64332},1490:{1468:64306},1491:{1468:64307},1492:{1468:64308},1493:{1465:64331,1468:64309},1494:{1468:64310},1496:{1468:64312},1497:{1460:64285,1468:64313},1498:{1468:64314},1499:{1468:64315,1471:64333},1500:{1468:64316},1502:{1468:64318},1504:{1468:64320},1505:{1468:64321},1507:{1468:64323},1508:{1468:64324,1471:64334},1510:{1468:64326},1511:{1468:64327},1512:{1468:64328},1513:{1468:64329,1473:64298,1474:64299},1514:{1468:64330},1522:{1463:64287},1575:{1619:1570,1620:1571,1621:1573},1608:{1620:1572},1610:{1620:1574},1729:{1620:1730},1746:{1620:1747},1749:{1620:1728},2325:{2364:2392},2326:{2364:2393},2327:{2364:2394},2332:{2364:2395},2337:{2364:2396},2338:{2364:2397},2344:{2364:2345},2347:{2364:2398},2351:{2364:2399},2352:{2364:2353},2355:{2364:2356},2465:{2492:2524},2466:{2492:2525},2479:{2492:2527},2503:{2494:2507,2519:2508},2582:{2620:2649},2583:{2620:2650},2588:{2620:2651},2603:{2620:2654},2610:{2620:2611},2616:{2620:2614},2849:{2876:2908},2850:{2876:2909},2887:{2878:2891,2902:2888,2903:2892},2962:{3031:2964},3014:{3006:3018,3031:3020},3015:{3006:3019},3142:{3158:3144},3263:{3285:3264},3270:{3266:3274,3285:3271,3286:3272},3274:{3285:3275},3398:{3390:3402,3415:3404},3399:{3390:3403},3545:{3530:3546,3535:3548,3551:3550},3548:{3530:3549},3904:{4021:3945},3906:{4023:3907},3916:{4023:3917},3921:{4023:3922},3926:{4023:3927},3931:{4023:3932},3953:{3954:3955,3956:3957,3968:3969},3984:{4021:4025},3986:{4023:3987},3996:{4023:3997},4001:{4023:4002},4006:{4023:4007},4011:{4023:4012},4018:{3968:3958},4019:{3968:3960},4133:{4142:4134},7734:{772:7736},7735:{772:7737},7770:{772:7772},7771:{772:7773},7778:{775:7784},7779:{775:7785},7840:{770:7852,774:7862},7841:{770:7853,774:7863},7864:{770:7878},7865:{770:7879},7884:{770:7896},7885:{770:7897},7936:{768:7938,769:7940,834:7942,837:8064},7937:{768:7939,769:7941,834:7943,837:8065},7938:{837:8066},7939:{837:8067},7940:{837:8068},7941:{837:8069},7942:{837:8070},7943:{837:8071},7944:{768:7946,769:7948,834:7950,837:8072},7945:{768:7947,769:7949,834:7951,837:8073},7946:{837:8074},7947:{837:8075},7948:{837:8076},7949:{837:8077},7950:{837:8078},7951:{837:8079},7952:{768:7954,769:7956},7953:{768:7955,769:7957},7960:{768:7962,769:7964},7961:{768:7963,769:7965},7968:{768:7970,769:7972,834:7974,837:8080},7969:{768:7971,769:7973,834:7975,837:8081},7970:{837:8082},7971:{837:8083},7972:{837:8084},7973:{837:8085},7974:{837:8086},7975:{837:8087},7976:{768:7978,769:7980,834:7982,837:8088},7977:{768:7979,769:7981,834:7983,837:8089},7978:{837:8090},7979:{837:8091},7980:{837:8092},7981:{837:8093},7982:{837:8094},7983:{837:8095},7984:{768:7986,769:7988,834:7990},7985:{768:7987,769:7989,834:7991},7992:{768:7994,769:7996,834:7998},7993:{768:7995,769:7997,834:7999},8e3:{768:8002,769:8004},8001:{768:8003,769:8005},8008:{768:8010,769:8012},8009:{768:8011,769:8013},8016:{768:8018,769:8020,834:8022},8017:{768:8019,769:8021,834:8023},8025:{768:8027,769:8029,834:8031},8032:{768:8034,769:8036,834:8038,837:8096},8033:{768:8035,769:8037,834:8039,837:8097},8034:{837:8098},8035:{837:8099},8036:{837:8100},8037:{837:8101},8038:{837:8102},8039:{837:8103},8040:{768:8042,769:8044,834:8046,837:8104},8041:{768:8043,769:8045,834:8047,837:8105},8042:{837:8106},8043:{837:8107},8044:{837:8108},8045:{837:8109},8046:{837:8110},8047:{837:8111},8048:{837:8114},8052:{837:8130},8060:{837:8178},8118:{837:8119},8127:{768:8141,769:8142,834:8143},8134:{837:8135},8182:{837:8183},8190:{768:8157,769:8158,834:8159},8592:{824:8602},8594:{824:8603},8596:{824:8622},8656:{824:8653},8658:{824:8655},8660:{824:8654},8707:{824:8708},8712:{824:8713},8715:{824:8716},8739:{824:8740},8741:{824:8742},8764:{824:8769},8771:{824:8772},8773:{824:8775},8776:{824:8777},8781:{824:8813},8801:{824:8802},8804:{824:8816},8805:{824:8817},8818:{824:8820},8819:{824:8821},8822:{824:8824},8823:{824:8825},8826:{824:8832},8827:{824:8833},8828:{824:8928},8829:{824:8929},8834:{824:8836},8835:{824:8837},8838:{824:8840},8839:{824:8841},8849:{824:8930},8850:{824:8931},8866:{824:8876},8872:{824:8877},8873:{824:8878},8875:{824:8879},8882:{824:8938},8883:{824:8939},8884:{824:8940},8885:{824:8941},10973:{824:10972},12358:{12441:12436},12363:{12441:12364},12365:{12441:12366},12367:{12441:12368},12369:{12441:12370},12371:{12441:12372},12373:{12441:12374},12375:{12441:12376},12377:{12441:12378},12379:{12441:12380},12381:{12441:12382},12383:{12441:12384},12385:{12441:12386},12388:{12441:12389},12390:{12441:12391},12392:{12441:12393},12399:{12441:12400,12442:12401},12402:{12441:12403,12442:12404},12405:{12441:12406,12442:12407},12408:{12441:12409,12442:12410},12411:{12441:12412,12442:12413},12445:{12441:12446},12454:{12441:12532},12459:{12441:12460},12461:{12441:12462},12463:{12441:12464},12465:{12441:12466},12467:{12441:12468},12469:{12441:12470},12471:{12441:12472},12473:{12441:12474},12475:{12441:12476},12477:{12441:12478},12479:{12441:12480},12481:{12441:12482},12484:{12441:12485},12486:{12441:12487},12488:{12441:12489},12495:{12441:12496,12442:12497},12498:{12441:12499,12442:12500},12501:{12441:12502,12442:12503},12504:{12441:12505,12442:12506},12507:{12441:12508,12442:12509},12527:{12441:12535},12528:{12441:12536},12529:{12441:12537},12530:{12441:12538},12541:{12441:12542},64329:{1473:64300,1474:64301},119127:{119141:119134},119128:{119141:119135},119135:{119150:119136,119151:119137,119152:119138,119153:119139,119154:119140},119225:{119141:119227},119226:{119141:119228},119227:{119150:119229,119151:119231},119228:{119150:119230,119151:119232}};function Hi(t){return t<65536?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(t&1023)))}function D(t){var o,n,s=t.length;for(o=0;o<s&&!(t[o]<0||t[o]>=256);o++);if(o==s)return t;for(n=Array(s),o=0;o<s;o++)t[o]<0||t[o]>=256?n[o]=63:n[o]=t[o];return n}function ae(t){var o,n,s=t.length;if(s==0)return"";for(o=0;o<s&&!(t[o]<0||t[o]>=256);o++);if(o==s)return String.fromCharCode.apply(this,t);for(n=Array(s),o=0;o<s;o++)n[o]=String.fromCharCode(t[o]&255);return n.join("")}function w(t){var o,n,s,l=t.length;if(l==0)return"";for(o=0;o<l&&!(t[o]>=65536);o++);if(o==l)return String.fromCharCode.apply(this,t);for(s=Array(l),o=0;o<l;o++)n=t[o],n<65536?s[o]=String.fromCharCode(n):(n-=65536,s[o]=String.fromCharCode(55296+(n>>10),56320+(n&1023)));return s.join("")}function k(t){var o=0;for(let s=0;s<t.length;s++){let l=t[s];l<128?o+=1:l<2048?o+=2:l<65536?o+=3:l<2097152?o+=4:o+=1}if(o==t.length)return t;let n=[];for(let s=0;s<t.length;s++){let l=t[s];l<128?n.push(l):l<2048?(n.push(192|(l&1984)>>6),n.push(128|l&63)):l<65536?(n.push(224|(l&61440)>>12),n.push(128|(l&4032)>>6),n.push(128|l&63)):l<2097152?(n.push(240|(l&1835008)>>18),n.push(128|(l&258048)>>12),n.push(128|(l&4032)>>6),n.push(128|l&63)):n.push(63)}return n}function v(t){for(var o=new Array(4*t.length),n=0;n<t.length;n++){var s=t[n];o[4*n]=s>>24&255,o[4*n+1]=s>>16&255,o[4*n+2]=s>>8&255,o[4*n+3]=s&255}return o}function S(t){window.console&&console.log&&console.log(t)}function O(){this.value=void 0,this.set_value=function(t){this.value=t},this.get_value=function(){return this.value}}function L(){this.fields=[],this.push_field=function(t){this.fields.push(t)},this.set_field=function(t,o){this.fields[t]=o},this.get_field=function(t){return this.fields[t]},this.get_fields=function(){return this.fields}}var B={dummy:"Glk call has not yet returned"};function E(t){return t==1||t==192||t==98}var M=1,z=2,W=3,C=4,R=null,K=null,ie=null,Yt=!0,F=null,Me=null,Ue=null,gl=null,Z=null,G=null,yl=1,Ae=null,dt=null,Vi=null;function Oo(t,o){var n={};return n.type=t,n.rock=o,n.disprock=void 0,n.parent=null,n.str=wl(n),n.echostr=null,n.style=d.style_Normal,n.hyperlink=0,n.input_generation=null,n.linebuf=null,n.char_request=!1,n.line_request=!1,n.char_request_uni=!1,n.line_request_uni=!1,n.hyperlink_request=!1,n.mouse_request=!1,n.echo_line_input=!0,n.line_input_terminators=[],n.request_echo_line_input=null,n.prev=null,n.next=K,K=n,n.next&&(n.next.prev=n),i?i.class_register("window",n):n.disprock=yl++,Yt=!0,n}function Ki(t){var o,n;i&&i.class_unregister("window",t),Yt=!0,t.echostr=null,t.str&&(Wo(t.str),t.str=null),o=t.prev,n=t.next,t.prev=null,t.next=null,o?o.next=n:K=n,n&&(n.prev=o),t.parent=null,t.rock=null,t.disprock=null}function bl(t){var o;for(o=K;o;o=o.next)o.echostr===t&&(o.echostr=null)}function tt(t,o){var n,s;switch(t.type){case d.wintype_TextBuffer:(t.style!=t.accumstyle||t.hyperlink!=t.accumhyperlink||t.fg!=t.accum_fg||t.bg!=t.accum_bg||t.reverse!=t.accum_reverse)&&Yi(t),t.accum.push(o);break;case d.wintype_TextGrid:for(n=0;n<o.length;n++){if(s=o.charAt(n),t.cursorx<0?t.cursorx=0:t.cursorx>=t.gridwidth&&(t.cursorx=0,t.cursory++),t.cursory<0)t.cursory=0;else if(t.cursory>=t.gridheight)break;if(s==`
`){t.cursory++,t.cursorx=0;continue}var l=t.lines[t.cursory];l.dirty=!0,l.chars[t.cursorx]=s,l.styles[t.cursorx]=t.style,l.hyperlinks[t.cursorx]=t.hyperlink,l.fgs[t.cursorx]=t.fg,l.bgs[t.cursorx]=t.bg,l.reverses[t.cursorx]=t.reverse,t.cursorx++}break}}function Do(t){if(t.cursorx<0?t.cursorx=0:t.cursorx>=t.gridwidth&&(t.cursorx=0,t.cursory++),t.cursory<0)t.cursory=0;else if(t.cursory>=t.gridheight)return!0;return!1}function Yi(t){var o=t.content,n=_t[t.accumstyle],s,l,c,g,m;if(t.accum.length){for(s=t.accum.join(""),l=s.split(`
`),c=0;c<l.length;c++)if(m=void 0,c==0?l[c]&&(o.length==0?(m=[],o.push({content:m,append:!0})):(g=o[o.length-1],g.content?m=g.content:(m=[],g.content=m))):l[c]?(m=[],o.push({content:m})):o.push({}),m!==void 0)if(!t.accumhyperlink&&!t.accum_fg&&!t.accum_bg&&!t.accum_reverse)m.push(n),m.push(l[c]);else{let h={style:n,text:l[c]};t.accumhyperlink&&(h.hyperlink=t.accumhyperlink),t.accum_fg&&(h.css_styles||(h.css_styles={}),h.css_styles.color=t.accum_fg),t.accum_bg&&(h.css_styles||(h.css_styles={}),h.css_styles["background-color"]=t.accum_bg),t.accum_reverse&&(h.css_styles||(h.css_styles={}),h.css_styles.reverse=1),m.push(h)}}t.accum.length=0,t.accumstyle=t.style,t.accumhyperlink=t.hyperlink,t.accum_fg=t.fg,t.accum_bg=t.bg,t.accum_reverse=t.reverse}function Ji(t,o,n){Yi(t);var s=t.content,l=void 0,c;s.length==0?(l=[],c={content:l,append:!0},n&&(c.flowbreak=!0),s.push(c)):(c=s[s.length-1],n&&(c.flowbreak=!0),c.content?l=c.content:(l=[],c.content=l)),l!==void 0&&o!==void 0&&l.push(o)}function Jt(t,o){var n;for(n=t.parent;n;n=n.parent)n.type==d.wintype_Pair&&n.pair_key===t&&(n.pair_key=null,n.pair_keydamage=!0);switch(i&&t.linebuf&&(i.unretain_array(t.linebuf),t.linebuf=null),t.type){case d.wintype_Pair:o&&(t.child1&&Jt(t.child1,!0),t.child2&&Jt(t.child2,!0)),t.child1=null,t.child2=null,t.pair_key=null;break;case d.wintype_TextBuffer:t.accum=null,t.content=null,t.reserve=null;break;case d.wintype_TextGrid:t.lines=null;break;case d.wintype_Graphics:t.content=null,t.reserve=null;break}Ki(t)}function Pe(t,o){var n,s,l,c,g,m,h,T,X,N,U,ee,ge,$e,xe,nt;switch(Yt=!0,t.bbox=o,t.type){case d.wintype_TextGrid:if(n=o.right-o.left,s=o.bottom-o.top,c=t.gridheight,t.gridwidth=Math.max(0,Math.floor((n-F.gridmarginx)/F.gridcharwidth)),t.gridheight=Math.max(0,Math.floor((s-F.gridmarginy)/F.gridcharheight)),c>t.gridheight)t.lines.length=t.gridheight;else if(c<t.gridheight)for(N=c;N<t.gridheight;N++)t.lines[N]={chars:[],styles:[],hyperlinks:[],fgs:[],bgs:[],reverses:[],dirty:!0};for(N=0;N<t.gridheight;N++)if(ee=t.lines[N],l=ee.chars.length,l>t.gridwidth)ee.dirty=!0,ee.chars.length=t.gridwidth,ee.styles.length=t.gridwidth,ee.hyperlinks.length=t.gridwidth,ee.fgs.length=t.gridwidth,ee.bgs.length=t.gridwidth,ee.reverses.length=t.gridwidth;else if(l<t.gridwidth)for(ee.dirty=!0,U=l;U<t.gridwidth;U++)ee.chars[U]=" ",ee.styles[U]=d.style_Normal,ee.hyperlinks[U]=0,ee.fgs[U]=null,ee.bgs[U]=null,ee.reverses[U]=0;break;case d.wintype_Graphics:n=o.right-o.left,s=o.bottom-o.top,t.graphwidth=Math.max(0,n-F.graphicsmarginx),t.graphheight=Math.max(0,s-F.graphicsmarginy);break;case d.wintype_Pair:t.pair_vertical?(g=t.bbox.left,m=t.bbox.right,X=F.inspacingx):(g=t.bbox.top,m=t.bbox.bottom,X=F.inspacingy),t.pair_hasborder||(X=0),h=m-g,t.pair_division==d.winmethod_Proportional?T=Math.floor(h*t.pair_size/100):t.pair_division==d.winmethod_Fixed?(T=0,t.pair_key&&t.pair_key.type==d.wintype_TextBuffer&&(t.pair_vertical?T=t.pair_size*F.buffercharwidth+F.buffermarginx:T=t.pair_size*F.buffercharheight+F.buffermarginy),t.pair_key&&t.pair_key.type==d.wintype_TextGrid&&(t.pair_vertical?T=t.pair_size*F.gridcharwidth+F.gridmarginx:T=t.pair_size*F.gridcharheight+F.gridmarginy),t.pair_key&&t.pair_key.type==d.wintype_Graphics&&(t.pair_vertical?T=t.pair_size+F.graphicsmarginx:T=t.pair_size+F.graphicsmarginy),T=Math.ceil(T)):T=Math.floor(h/2),t.pair_backward?T=g+T:T=m-T-X,g>=m?T=g:T=Math.min(Math.max(T,g),m-X),t.pair_splitpos=T,t.pair_splitwidth=X,t.pair_vertical?(ge={left:t.bbox.left,right:t.pair_splitpos,top:t.bbox.top,bottom:t.bbox.bottom},$e={left:ge.right+t.pair_splitwidth,right:t.bbox.right,top:t.bbox.top,bottom:t.bbox.bottom}):(ge={top:t.bbox.top,bottom:t.pair_splitpos,left:t.bbox.left,right:t.bbox.right},$e={top:ge.bottom+t.pair_splitwidth,bottom:t.bbox.bottom,left:t.bbox.left,right:t.bbox.right}),t.pair_backward?(xe=t.child2,nt=t.child1):(xe=t.child1,nt=t.child2),Pe(xe,ge),Pe(nt,$e);break}}function rt(t,o,n,s){var l={};return l.type=t,l.rock=s,l.disprock=void 0,l.unicode=!1,l.isbinary=!1,l.streaming=!1,l.ref=null,l.win=null,l.file=null,l.buf=null,l.bufpos=0,l.buflen=0,l.bufeof=0,l.timer_id=null,l.flush_func=null,l.fstream=null,l.readcount=0,l.writecount=0,l.readable=o,l.writable=n,l.prev=null,l.next=Me,Me=l,l.next&&(l.next.prev=l),i&&i.class_register("stream",l),l}function Wo(t){var o,n;t===Z&&(Z=null),bl(t),t.type==W?i&&i.unretain_array(t.buf):t.type==M&&t.fstream&&(t.fstream.fclose(),t.fstream=null),i&&i.class_unregister("stream",t),o=t.prev,n=t.next,t.prev=null,t.next=null,o?o.next=n:Me=n,n&&(n.prev=o),t.fstream=null,t.buf=null,t.readable=!1,t.writable=!1,t.ref=null,t.win=null,t.file=null,t.rock=null,t.disprock=null}function wl(t){var o;return o=rt(z,!1,!0,0),o.unicode=!0,o.win=t,o}function Qi(t){t.streaming&&f.log("### gli_stream_dirty_file called for streaming file!"),t.timer_id===null&&(t.flush_func===null&&(t.flush_func=function(){Bo(t)}),t.timer_id=setTimeout(t.flush_func,1e4))}function Bo(t){t.streaming&&f.log("### gli_stream_flush_file called for streaming file!"),t.timer_id!==null&&clearTimeout(t.timer_id),t.timer_id=null,r.file_write(t.ref,t.buf)}function vr(t,o,n,s){var l={};if(l.filename=t,l.rock=n,l.disprock=void 0,l.textmode=(o&d.fileusage_TextMode)!=0,l.filetype=o&d.fileusage_TypeMask,l.filetypename=Nt[l.filetype],l.filetypename||(l.filetypename="xxx"),!s){var c="";l.filetype==d.fileusage_SavedGame&&(c=a.get_signature()),s=r.file_construct_ref(l.filename,l.filetypename,c)}return l.ref=s,l.prev=null,l.next=Ue,Ue=l,l.next&&(l.next.prev=l),i&&i.class_register("fileref",l),l}function kl(t){var o,n;i&&i.class_unregister("fileref",t),o=t.prev,n=t.next,t.prev=null,t.next=null,o?o.next=n:Ue=n,n&&(n.prev=o),t.filename=null,t.ref=null,t.rock=null,t.disprock=null}function Qt(t,o){if(!t||!t.writable)throw"gli_put_char: invalid stream";switch(t.unicode||(o<0||o>=256)&&(o=63),t.writecount+=1,t.type){case M:if(t.streaming)if(!t.unicode)t.buffer4[0]=o,t.fstream.fwrite(t.buffer4,1);else if(t.isbinary)t.buffer4.writeUInt32BE(o,0,!0),t.fstream.fwrite(t.buffer4,4);else{var n;if(o<65536)n=t.buffer4.write(String.fromCharCode(o)),t.fstream.fwrite(t.buffer4,n);else{var s=k([o]),l=t.fstream.BufferClass.from(s);t.fstream.fwrite(l)}}else if(Qi(t),!t.unicode||o<128&&!t.isbinary)t.bufpos<t.buflen&&(t.buf[t.bufpos]=o,t.bufpos+=1,t.bufpos>t.bufeof&&(t.bufeof=t.bufpos));else{let c;t.isbinary?c=v([o]):c=k([o]);let g=c.length;g>t.buflen-t.bufpos&&(g=t.buflen-t.bufpos);for(let m=0;m<g;m++)t.buf[t.bufpos+m]=c[m];t.bufpos+=g,t.bufpos>t.bufeof&&(t.bufeof=t.bufpos)}break;case W:t.bufpos<t.buflen&&(t.buf[t.bufpos]=o,t.bufpos+=1,t.bufpos>t.bufeof&&(t.bufeof=t.bufpos));break;case z:if(t.win.line_request)throw"gli_put_char: window has pending line request";tt(t.win,Hi(o)),t.win.echostr&&Qt(t.win.echostr,o);break}}function Xt(t,o,n){var s,l;if(!t||!t.writable)throw"gli_put_array: invalid stream";switch(!t.unicode&&!n&&(o=D(o),n=!0),t.writecount+=o.length,t.type){case M:if(t.streaming)if(t.unicode)if(t.isbinary){let g=t.fstream.BufferClass.alloc(4*o.length);for(let m=0;m<o.length;m++)g.writeUInt32BE(o[m],4*m,!0);t.fstream.fwrite(g)}else{let g=k(o),m=t.fstream.BufferClass.from(g);t.fstream.fwrite(m)}else{let g=t.fstream.BufferClass.from(o);t.fstream.fwrite(g)}else{Qi(t);var c;t.unicode?t.isbinary?c=v(o):c=k(o):c=o;let g=c.length;g>t.buflen-t.bufpos&&(g=t.buflen-t.bufpos);for(let m=0;m<g;m++)t.buf[t.bufpos+m]=c[m];t.bufpos+=g,t.bufpos>t.bufeof&&(t.bufeof=t.bufpos)}break;case W:s=o.length,s>t.buflen-t.bufpos&&(s=t.buflen-t.bufpos);for(let g=0;g<s;g++)t.buf[t.bufpos+g]=o[g];t.bufpos+=s,t.bufpos>t.bufeof&&(t.bufeof=t.bufpos);break;case z:if(t.win.line_request)throw"gli_put_array: window has pending line request";n?l=String.fromCharCode.apply(this,o):l=w(o),tt(t.win,l),t.win.echostr&&Xt(t.win.echostr,o,n);break}}function pt(t,o){var n;if(!t||!t.readable)return-1;switch(t.type){case M:if(t.streaming)if(t.unicode){if(t.isbinary){if(t.fstream.fread(t.buffer4,4)<4)return-1;n=t.buffer4[0]<<24,n|=t.buffer4[1]<<16,n|=t.buffer4[2]<<8,n|=t.buffer4[3]}else{let s,l,c,g;if(!t.fstream.fread(t.buffer4,1))return-1;if(s=t.buffer4[0],s<128)n=s;else{if(!t.fstream.fread(t.buffer4,1)||(l=t.buffer4[0],(l&192)!=128))return-1;if((s&224)==192)n=(s&31)<<6,n|=l&63;else{if(!t.fstream.fread(t.buffer4,1)||(c=t.buffer4[0],(c&192)!=128))return-1;if((s&240)==224)n=(s&15)<<12&61440,n|=(l&63)<<6&4032,n|=c&63&63;else if((s&240)==240){if(!t.fstream.fread(t.buffer4,1)||(g=t.buffer4[0],(g&192)!=128))return-1;n=(s&7)<<18&1835008,n|=(l&63)<<12&258048,n|=(c&63)<<6&4032,n|=g&63&63}else return-1}}}return t.readcount++,n>>>=0,!o&&n>=256?63:n}else return t.fstream.fread(t.buffer4,1)?(t.readcount++,t.buffer4[0]):-1;case C:if(t.unicode){if(t.isbinary){if(t.bufpos>=t.bufeof||(n=t.buf[t.bufpos],t.bufpos++,t.bufpos>=t.bufeof)||(n=n<<8|t.buf[t.bufpos]&255,t.bufpos++,t.bufpos>=t.bufeof)||(n=n<<8|t.buf[t.bufpos]&255,t.bufpos++,t.bufpos>=t.bufeof))return-1;n=n<<8|t.buf[t.bufpos]&255,t.bufpos++}else{let s,l,c,g;if(t.bufpos>=t.bufeof)return-1;if(s=t.buf[t.bufpos],t.bufpos++,s<128)n=s;else{if(t.bufpos>=t.bufeof||(l=t.buf[t.bufpos],t.bufpos++,(l&192)!=128))return-1;if((s&224)==192)n=(s&31)<<6,n|=l&63;else{if(t.bufpos>=t.bufeof||(c=t.buf[t.bufpos],t.bufpos++,(c&192)!=128))return-1;if((s&240)==224)n=(s&15)<<12&61440,n|=(l&63)<<6&4032,n|=c&63&63;else if((s&240)==240){if(t.bufpos>=t.bufeof||(g=t.buf[t.bufpos],t.bufpos++,(g&192)!=128))return-1;n=(s&7)<<18&1835008,n|=(l&63)<<12&258048,n|=(c&63)<<6&4032,n|=g&63&63}else return-1}}}return t.readcount++,n>>>=0,!o&&n>=256?63:n}case W:return t.bufpos<t.bufeof?(n=t.buf[t.bufpos],t.bufpos++,t.readcount++,!o&&n>=256?63:n):-1;default:return-1}}function Mo(t,o,n){if(!t||!t.readable)return 0;var s=o.length,l,c,g;switch(t.type){case M:if(t.streaming){if(s==0)return 0;for(s-=1,g=!1,l=0;l<s&&!g&&(c=pt(t,n),c!=-1);l++)o[l]=c,g=c==10;return l}case C:if(t.unicode){if(s==0)return 0;for(s-=1,g=!1,l=0;l<s&&!g&&(c=pt(t,n),c!=-1);l++)o[l]=c,g=c==10;return l}case W:if(s==0)return 0;if(s-=1,t.bufpos>=t.bufeof?s=0:t.bufpos+s>t.bufeof&&(s=t.bufeof-t.bufpos),g=!1,n)for(l=0;l<s&&!g;l++)c=t.buf[t.bufpos++],o[l]=c,g=c==10;else for(l=0;l<s&&!g;l++)c=t.buf[t.bufpos++],!n&&c>=256&&(c=63),o[l]=c,g=c==10;return t.readcount+=l,l;default:return 0}}function Uo(t,o,n){if(!t||!t.readable)return 0;var s=o.length,l,c;switch(t.type){case M:if(t.streaming){for(l=0;l<s&&(c=pt(t,n),c!=-1);l++)o[l]=c;return l}case C:if(t.unicode){for(l=0;l<s&&(c=pt(t,n),c!=-1);l++)o[l]=c;return l}case W:if(t.bufpos>=t.bufeof?s=0:t.bufpos+s>t.bufeof&&(s=t.bufeof-t.bufpos),n)for(l=0;l<s;l++)o[l]=t.buf[t.bufpos++];else for(l=0;l<s;l++)c=t.buf[t.bufpos++],!n&&c>=256&&(c=63),o[l]=c;return t.readcount+=s,s;default:return 0}}function Xi(t,o){o&&(o.set_field(0,t.readcount),o.set_field(1,t.writecount))}function xl(t,o){me(Z,t,o)}function me(t,o,n){var s;if(!t||!t.writable)throw"glk_put_jstring: invalid stream";switch(t.writecount+=o.length,t.type){case M:if(t.streaming)if(t.unicode)if(t.isbinary){let c=t.fstream.BufferClass.alloc(4*o.length);for(let g=0;g<o.length;g++)c.writeUInt32BE(o.charCodeAt(g),4*g,!0);t.fstream.fwrite(c)}else{let c=t.fstream.BufferClass.from(o);t.fstream.fwrite(c)}else{let c=t.fstream.BufferClass.from(o,"binary");t.fstream.fwrite(c)}else{Qi(t);let c=[];for(let h=0;h<o.length;h++)c.push(o.charCodeAt(h));let g;t.unicode?t.isbinary?g=v(c):g=k(c):g=c;let m=g.length;m>t.buflen-t.bufpos&&(m=t.buflen-t.bufpos);for(let h=0;h<m;h++)t.buf[t.bufpos+h]=g[h];t.bufpos+=m,t.bufpos>t.bufeof&&(t.bufeof=t.bufpos)}break;case W:if(s=o.length,s>t.buflen-t.bufpos&&(s=t.buflen-t.bufpos),t.unicode||n)for(let c=0;c<s;c++)t.buf[t.bufpos+c]=o.charCodeAt(c);else for(let c=0;c<s;c++){var l=o.charCodeAt(c);(l<0||l>=256)&&(l=63),t.buf[t.bufpos+c]=l}t.bufpos+=s,t.bufpos>t.bufeof&&(t.bufeof=t.bufpos);break;case z:if(t.win.line_request)throw"glk_put_jstring: window has pending line request";tt(t.win,o),t.win.echostr&&me(t.win.echostr,o,n);break}}function it(t,o){if(!t||!t.writable)throw"gli_set_style: invalid stream";o>=d.style_NUMSTYLES&&(o=0),t.type==z&&(t.win.style=o,t.win.echostr&&it(t.win.echostr,o))}function Zi(t,o){if(!t||!t.writable)throw"gli_set_hyperlink: invalid stream";t.type==z&&(t.win.hyperlink=o,t.win.echostr&&Zi(t.win.echostr,o))}function vl(){return A=!0,I=!0,G=null,_&&f.warning(_),B}function Sl(){}function Tl(t,o){return Po(t,o,null)}function Po(t,o,n){switch(t){case 0:return 1796;case 1:return o<=d.keycode_Left&&o>=d.keycode_End?1:o>=4294967296-d.keycode_MAXVAL||o>1114111||o>=0&&o<32||o>=127&&o<160?0:1;case 2:return o>1114111||o>=0&&o<32||o>=127&&o<160?0:1;case 3:return o>1114111||o>=0&&o<32||o>=127&&o<160?(n&&(n[0]=1),0):(n&&(n[0]=1),2);case 4:return o==d.wintype_TextGrid||u.graphics&&o==d.wintype_Graphics?1:0;case 5:return u.timer||0;case 6:return u.graphics||0;case 7:return u.graphics&&(o===d.wintype_TextBuffer||o===d.wintype_Graphics)?1:0;case 8:return 0;case 9:return 0;case 10:return 0;case 11:return u.hyperlinks||0;case 12:return u.hyperlinks&&(o===d.wintype_TextBuffer||o===d.wintype_TextGrid)?1:0;case 13:return 0;case 14:return u.graphics||0;case 15:return 1;case 16:return 1;case 17:return 1;case 18:return 1;case 19:return o==d.keycode_Escape||o>=d.keycode_Func12&&o<=d.keycode_Func1?1:0;case 20:return 1;case 21:return 0;case 22:return 1;case 23:return 0;case 4352:return u.garglktext||0}if(b){var s=b(t,o,n);if(s!==void 0)return s}return 0}function Al(t,o){return t?t=t.next:t=K,t?(o&&o.set_value(t.rock),t):(o&&o.set_value(0),null)}function Gl(t){if(!t)throw"glk_window_get_rock: invalid window";return t.rock}function Cl(){return ie}function El(t,o,n,s,l){var c,g,m,h,T;if(ie){if(!t)throw"glk_window_open: splitwin must not be null";if(m=o&d.winmethod_DivisionMask,m!=d.winmethod_Fixed&&m!=d.winmethod_Proportional)throw"glk_window_open: invalid method (not fixed or proportional)";if(m=o&d.winmethod_DirMask,m!=d.winmethod_Above&&m!=d.winmethod_Below&&m!=d.winmethod_Left&&m!=d.winmethod_Right)throw"glk_window_open: invalid method (bad direction)";if(g=t.bbox,c=t.parent,c&&c.type!=d.wintype_Pair)throw"glk_window_open: parent window is not Pair"}else{if(t)throw"glk_window_open: splitwin must be null for first window";c=null,g={left:F.outspacingx,top:F.outspacingy,right:F.width-F.outspacingx,bottom:F.height-F.outspacingy}}switch(T=Oo(s,l),T.type){case d.wintype_TextBuffer:T.accum=[],T.accumstyle=null,T.accumhyperlink=0,T.accum_fg=null,T.accum_bg=null,T.accum_reverse=null,T.content=[],T.clearcontent=!1,T.reserve=[],T.stylehints=Sr(ke.buffer);break;case d.wintype_TextGrid:T.gridwidth=0,T.gridheight=0,T.lines=[],T.cursorx=0,T.cursory=0,T.clearcontent=!1,T.stylehints=Sr(ke.grid);break;case d.wintype_Graphics:if(!u.graphics)return Ki(T),null;T.content=[],T.reserve=[];break;case d.wintype_Blank:break;case d.wintype_Pair:throw"glk_window_open: cannot open pair window directly";default:return Ki(T),null}return t?(h=Oo(d.wintype_Pair,0),h.pair_dir=o&d.winmethod_DirMask,h.pair_division=o&d.winmethod_DivisionMask,h.pair_key=T,h.pair_keydamage=!1,h.pair_size=n,h.pair_hasborder=(o&d.winmethod_BorderMask)==d.winmethod_Border,h.pair_vertical=h.pair_dir==d.winmethod_Left||h.pair_dir==d.winmethod_Right,h.pair_backward=h.pair_dir==d.winmethod_Left||h.pair_dir==d.winmethod_Above,h.child1=t,h.child2=T,t.parent=h,T.parent=h,h.parent=c,c?c.child1==t?c.child1=h:c.child2=h:ie=h,Pe(h,g)):(ie=T,Pe(T,g)),T}function Il(t,o){if(!t)throw"glk_window_close: invalid window";if(t===ie||!t.parent)ie=null,Xi(t.str,o),Jt(t,!0);else{var n,s,l,c,g,m;if(n=t.parent,t===n.child1)l=n.child2;else if(t===n.child2)l=n.child1;else throw"glk_window_close: window tree is corrupted";for(c=n.bbox,s=n.parent,s?(s.child1===n?s.child1=l:s.child2=l,l.parent=s):(ie=l,l.parent=null),Xi(t.str,o),Jt(t,!0),t===n.child1?n.child1=null:t===n.child2&&(n.child2=null),Jt(n,!1),m=!1,g=l;g;g=g.parent)g.type==d.wintype_Pair&&g.pair_keydamage&&(m=!0,g.pair_keydamage=!1);Pe(m?ie:l,c)}}function Rl(t,o,n){if(!t)throw"glk_window_get_size: invalid window";var s=0,l=0,c,g;switch(t.type){case d.wintype_TextGrid:c=t.bbox.right-t.bbox.left,g=t.bbox.bottom-t.bbox.top,s=Math.max(0,Math.floor((c-F.gridmarginx)/F.gridcharwidth)),l=Math.max(0,Math.floor((g-F.gridmarginy)/F.gridcharheight));break;case d.wintype_TextBuffer:c=t.bbox.right-t.bbox.left,g=t.bbox.bottom-t.bbox.top,s=Math.max(0,Math.floor((c-F.buffermarginx)/F.buffercharwidth)),l=Math.max(0,Math.floor((g-F.buffermarginy)/F.buffercharheight));break;case d.wintype_Graphics:c=t.bbox.right-t.bbox.left,g=t.bbox.bottom-t.bbox.top,s=c-F.graphicsmarginx,l=g-F.graphicsmarginy;break}o&&o.set_value(s),n&&n.set_value(l)}function Fl(t,o,n,s){var l,c,g,m;if(!t)throw"glk_window_set_arrangement: invalid window";if(t.type!=d.wintype_Pair)throw"glk_window_set_arrangement: not a pair window";if(s){if(s.type==d.wintype_Pair)throw"glk_window_set_arrangement: keywin cannot be a pair window";for(l=s;l&&l!=t;l=l.parent);if(!l)throw"glk_window_set_arrangement: keywin must be a descendant"}if(c=o&d.winmethod_DirMask,g=c==d.winmethod_Left||c==d.winmethod_Right,m=c==d.winmethod_Left||c==d.winmethod_Above,s||(s=t.pair_key),g&&!t.pair_vertical)throw"glk_window_set_arrangement: split must stay horizontal";if(!g&&t.pair_vertical)throw"glk_window_set_arrangement: split must stay vertical";if(s&&s.type==d.wintype_Blank&&(o&d.winmethod_DivisionMask)==d.winmethod_Fixed)throw"glk_window_set_arrangement: a blank window cannot have a fixed size";(m&&!t.pair_backward||!m&&t.pair_backward)&&(l=t.child1,t.child1=t.child2,t.child2=l),t.pair_dir=c,t.pair_division=o&d.winmethod_DivisionMask,t.pair_key=s,t.pair_size=n,t.pair_hasborder=(o&d.winmethod_BorderMask)==d.winmethod_Border,t.pair_vertical=t.pair_dir==d.winmethod_Left||t.pair_dir==d.winmethod_Right,t.pair_backward=t.pair_dir==d.winmethod_Left||t.pair_dir==d.winmethod_Above,Pe(t,t.bbox)}function Ol(t,o,n,s){if(!t)throw"glk_window_get_arrangement: invalid window";if(t.type!=d.wintype_Pair)throw"glk_window_get_arrangement: not a pair window";n&&n.set_value(t.pair_size),s&&s.set_value(t.pair_key),o&&o.set_value(t.pair_dir|t.pair_division|(t.pair_hasborder?d.winmethod_Border:d.winmethod_NoBorder))}function Dl(t){if(!t)throw"glk_window_get_type: invalid window";return t.type}function Wl(t){if(!t)throw"glk_window_get_parent: invalid window";return t.parent}function Bl(t){if(!t)throw"glk_window_clear: invalid window";if(t.line_request)throw"glk_window_clear: window has pending line request";let o=null;switch(t.type){case d.wintype_TextBuffer:t.accum.length=0,t.accumstyle=null,t.accumhyperlink=0,t.accum_fg=null,t.accum_bg=null,t.accum_reverse=null,t.content.length=0,t.clearcontent=!0,t.cleared_bg=t.bg,t.cleared_fg=t.fg;break;case d.wintype_TextGrid:t.cursorx=0,t.cursory=0;for(let n=0;n<t.gridheight;n++){let s=t.lines[n];s.dirty=!0;for(let l=0;l<t.gridwidth;l++)s.chars[l]=" ",s.styles[l]=d.style_Normal,s.hyperlinks[l]=0,s.fgs[l]=t.fg,s.bgs[l]=t.bg,s.reverses[l]=t.reverse}t.clearcontent=!0,t.cleared_bg=t.bg,t.cleared_fg=t.fg;break;case d.wintype_Graphics:for(let n=0;n<t.content.length;n++)t.content[n].special=="setcolor"&&(o=t.content[n]);t.content.length=0,o!==null&&t.content.push(o),t.content.push({special:"fill"});break}}function Ml(t,o,n){if(!t)throw"glk_window_move_cursor: invalid window";if(t.type==d.wintype_TextGrid)t.cursorx=o,t.cursory=n;else throw"glk_window_move_cursor: not a grid window"}function Ul(t){if(!t)throw"glk_window_get_stream: invalid window";return t.str}function Pl(t,o){if(!t)throw"glk_window_set_echo_stream: invalid window";t.echostr=o}function $l(t){if(!t)throw"glk_window_get_echo_stream: invalid window";return t.echostr}function jl(t){t?Z=t.str:Z=null}function Ll(t){if(!t)throw"glk_window_get_sibling: invalid window";let o=t.parent;if(!o)return null;if(t===o.child1)return o.child2;if(t===o.child2)return o.child1;throw"glk_window_get_sibling: window tree is corrupted"}function zl(t,o){return t?t=t.next:t=Me,t?(o&&o.set_value(t.rock),t):(o&&o.set_value(0),null)}function ql(t){if(!t)throw"glk_stream_get_rock: invalid stream";return t.rock}function Nl(t,o,n){if(!t)throw"glk_stream_open_file: invalid fileref";var s,l;if(o!=d.filemode_Read&&o!=d.filemode_Write&&o!=d.filemode_ReadWrite&&o!=d.filemode_WriteAppend)throw"glk_stream_open_file: illegal filemode";if(o==d.filemode_Read&&!r.file_ref_exists(t.ref))return null;if(r.streaming){if(l=r.file_fopen(o,t.ref),!l)return null}else{var c=null;if(o!=d.filemode_Write&&(c=r.file_read(t.ref)),c==null&&(c=[],o!=d.filemode_Read&&r.file_write(t.ref,"",!0)),c.length==null)throw"glk_stream_open_file: data read had no length"}return s=rt(M,o!=d.filemode_Write,o!=d.filemode_Read,n),s.unicode=!1,s.isbinary=!t.textmode,s.ref=t.ref,s.origfmode=o,r.streaming?(s.streaming=!0,s.fstream=l,s.buffer4=l.BufferClass.alloc(4)):(s.streaming=!1,s.buf=c,s.buflen=4294967295,o==d.filemode_Write?s.bufeof=0:s.bufeof=c.length,o==d.filemode_WriteAppend?s.bufpos=s.bufeof:s.bufpos=0),s}function Hl(t,o,n){var s;if(o!=d.filemode_Read&&o!=d.filemode_Write&&o!=d.filemode_ReadWrite)throw"glk_stream_open_memory: illegal filemode";return s=rt(W,o!=d.filemode_Write,o!=d.filemode_Read,n),s.unicode=!1,t&&(s.buf=t,s.buflen=t.length,s.bufpos=0,o==d.filemode_Write?s.bufeof=0:s.bufeof=s.buflen,i&&i.retain_array(t)),s}function Vl(t,o){var n;if(!e||!e.find_data_chunk)return null;var s=e.find_data_chunk(t);if(!s)return null;var l=s.data,c=s.type=="BINA";return n=rt(C,!0,!1,o),n.unicode=!1,n.isbinary=c,n.resfilenum=t,n.streaming=!1,l&&(n.buf=l,n.buflen=l.length,n.bufpos=0,n.bufeof=n.buflen),n}function Kl(t,o){var n;if(!e||!e.find_data_chunk)return null;var s=e.find_data_chunk(t);if(!s)return null;var l=s.data,c=s.type=="BINA";return n=rt(C,!0,!1,o),n.unicode=!0,n.isbinary=c,n.resfilenum=t,n.streaming=!1,l&&(n.buf=l,n.buflen=l.length,n.bufpos=0,n.bufeof=n.buflen),n}function Yl(t,o){if(!t)throw"glk_stream_close: invalid stream";if(t.type==z)throw"glk_stream_close: cannot close window stream";t.type==M&&t.writable&&(t.streaming||(t.timer_id!==null&&(clearTimeout(t.timer_id),t.timer_id=null),r.file_write(t.ref,t.buf))),Xi(t,o),Wo(t)}function Jl(t,o,n){if(!t)throw"glk_stream_set_position: invalid stream";switch(t.type){case M:if(t.streaming){t.fstream.fseek(o,n);break}case C:case W:n==d.seekmode_Current?o=t.bufpos+o:n==d.seekmode_End&&(o=t.bufeof+o),o<0&&(o=0),o>t.bufeof&&(o=t.bufeof),t.bufpos=o}}function Ql(t){if(!t)throw"glk_stream_get_position: invalid stream";switch(t.type){case M:if(t.streaming)return t.fstream.ftell();case C:case W:return t.bufpos;default:return 0}}function Xl(t){Z=t}function Zl(){return Z}function ef(t,o){var n=t&d.fileusage_TypeMask,s=Nt[n],l=r.file_construct_temp_ref(s),c=vr(l.filename,t,o,l);return c}function tf(t,o,n){o=r.file_clean_fixed_name(o,t&d.fileusage_TypeMask);var s=vr(o,t,n,null);return s}function rf(t,o,n){var s,l=t&d.fileusage_TypeMask,c=Nt[l];switch(c||(c="xxx"),o){case d.filemode_Write:s="write";break;case d.filemode_ReadWrite:s="readwrite";break;case d.filemode_WriteAppend:s="writeappend";break;case d.filemode_Read:default:s="read";break}var g={type:"fileref_prompt",filetype:c,filemode:s},m={usage:t,rock:n};return l==d.fileusage_SavedGame&&(g.gameid=a.get_signature()),J=g,V=m,G=null,B}function nf(t){var o=t.value,n=V.usage,s=V.rock,l=null;o&&(l=vr(o.filename,n,s,o)),J=null,V=null,i&&i.prepare_resume(l),a.resume(l)}function of(t){if(!t)throw"glk_fileref_destroy: invalid fileref";kl(t)}function af(t,o){return t?t=t.next:t=Ue,t?(o&&o.set_value(t.rock),t):(o&&o.set_value(0),null)}function sf(t){if(!t)throw"glk_fileref_get_rock: invalid fileref";return t.rock}function lf(t){if(!t)throw"glk_fileref_delete_file: invalid fileref";r.file_remove_ref(t.ref)}function ff(t){if(!t)throw"glk_fileref_does_file_exist: invalid fileref";return r.file_ref_exists(t.ref)?1:0}function uf(t,o,n){if(!o)throw"glk_fileref_create_from_fileref: invalid fileref";var s=vr(o.filename,t,n,null);return s}function cf(t){Qt(Z,t&255)}function _f(t,o){Qt(t,o&255)}function df(t){me(Z,t,!0)}function pf(t,o){me(t,o,!0)}function hf(t){t=D(t),Xt(Z,t,!0)}function mf(t,o){o=D(o),Xt(t,o,!0)}function gf(t){it(Z,t)}function yf(t,o){it(t,o)}function bf(t){if(!t)throw"glk_get_char_stream: invalid stream";return pt(t,!1)}function wf(t,o){if(!t)throw"glk_get_line_stream: invalid stream";return Mo(t,o,!1)}function kf(t,o){if(!t)throw"glk_get_buffer_stream: invalid stream";return Uo(t,o,!1)}function xf(t){return t>=65&&t<=90||t>=192&&t<=222&&t!=215?t+32:t}function vf(t){return t>=97&&t<=122||t>=224&&t<=254&&t!=247?t-32:t}var $o=null,ke={buffer:{},grid:{}};function Sr(t){let o={};for(let[n,s]of Object.entries(t))o[n]=Object.assign({},s);return o}let en=["normal","emphasized","preformatted","header","subheader","alert","note","blockquote","input","user1","user2"],jo=["margin-left","text-indent","text-align","font-size","font-weight","font-style","monospace","color","background-color","reverse"];function Tr(t){if(Array.isArray(t)){let o={};for(let[n,s]of t.entries())for(let[l,c]of Object.entries(s)){let g=`.Style_${en[n]}${["margin-left","text-indent","text-align"].includes(l)?"_par":""}`;o[g]||(o[g]={}),o[g][l]=c}return o}return t}function Sf(t,o,n,s){(t===d.wintype_AllTypes||t===d.wintype_TextBuffer)&&Lo(ke.buffer,o,n,s),(t===d.wintype_AllTypes||t===d.wintype_TextGrid)&&n!==d.stylehint_Proportional&&Lo(ke.grid,o,n,s)}function Lo(t,o,n,s){let l=`.Style_${en[o]}${n<=d.stylehint_Justification?"_par":""}`;var c,g=["left","justify","center","right"],m=["lighter","normal","bold"];n===d.stylehint_Indentation&&(c=s+"em"),n===d.stylehint_ParaIndentation&&(c=s+"em"),n===d.stylehint_Justification&&(c=g[s]),n===d.stylehint_Size&&(c=1+s*.1+"em"),n===d.stylehint_Weight&&(c=m[s+1]),n===d.stylehint_Oblique&&(c=s?"italic":"normal"),n===d.stylehint_Proportional&&(c=s?0:1),n===d.stylehint_TextColor&&(c="#"+("000000"+s.toString(16)).slice(-6)),n===d.stylehint_BackColor&&(c="#"+("000000"+s.toString(16)).slice(-6)),n===d.stylehint_ReverseColor&&(c=s),t[l]||(t[l]={}),t[l][jo[n]]=c}function Tf(t,o,n){let s=`.Style_${en[o]}${n<=d.stylehint_Justification?"_par":""}`;function l(c){c[s]&&(delete c[s][jo[n]],Object.keys(c[s]).length||delete c[s])}(t===d.wintype_AllTypes||t===d.wintype_TextBuffer)&&l(ke.buffer),(t===d.wintype_AllTypes||t===d.wintype_TextGrid)&&l(ke.grid)}function Af(){return 0}function Gf(t,o,n,s){return s&&s.set_value(0),0}function Cf(t,o){tn(Z,t,o)}function tn(t,o,n){if(!t||!t.writable)throw"garglk_set_zcolors: invalid stream";o=o>>0,n=n>>0,t.type==z&&(o!==-2&&(t.win.fg=o===-1?null:"#"+("000000"+o.toString(16)).slice(-6)),n!==-2&&(t.win.bg=n===-1?null:"#"+("000000"+n.toString(16)).slice(-6)),t.win.echostr&&tn(t.win.echostr,o,n))}function Ef(t){rn(Z,t)}function rn(t,o){if(!t||!t.writable)throw"garglk_set_reversevideo: invalid stream";t.type==z&&(t.win.reverse=o||null,t.win.echostr&&rn(t.win.echostr,o))}function If(t){return G=t,B}function Rf(t){if(t.set_field(0,d.evtype_None),t.set_field(1,null),t.set_field(2,0),t.set_field(3,0),Ae){var o=Date.now();o-dt>Ae&&(dt=Date.now(),Vi=null,t.set_field(0,d.evtype_Timer))}}function Ff(t,o,n){if(!t)throw"glk_request_line_event: invalid window";if(t.char_request||t.line_request)throw"glk_request_line_event: window already has keyboard request";if(t.type==d.wintype_TextBuffer||t.type==d.wintype_TextGrid){if(n){var s=o.slice(0,n);P||(P={}),P[t.disprock]=ae(s)}t.line_request=!0,t.line_request_uni=!1,t.type==d.wintype_TextBuffer?t.request_echo_line_input=t.echo_line_input:t.request_echo_line_input=!0,t.input_generation=Q,t.linebuf=o,i&&i.retain_array(o)}else throw"glk_request_line_event: window does not support keyboard input"}function Of(t,o){if(!t)throw"glk_cancel_line_event: invalid window";if(!t.line_request){o&&(o.set_field(0,d.evtype_None),o.set_field(1,null),o.set_field(2,0),o.set_field(3,0));return}var n="",s,l;for(re&&(l=re[t.disprock],l&&(n=l)),n.length>t.linebuf.length&&(n=n.slice(0,t.linebuf.length)),t.request_echo_line_input&&(s=t.style,it(t.str,d.style_Input),tt(t,n),t.echostr&&me(t.echostr,n),it(t.str,s),tt(t,`
`),t.echostr&&me(t.echostr,`
`)),s=0;s<n.length;s++)t.linebuf[s]=n.charCodeAt(s);o&&(o.set_field(0,d.evtype_LineInput),o.set_field(1,t),o.set_field(2,n.length),o.set_field(3,0)),i&&i.unretain_array(t.linebuf),t.line_request=!1,t.line_request_uni=!1,t.request_echo_line_input=null,t.input_generation=null,t.linebuf=null}function Df(t){if(!t)throw"glk_request_char_event: invalid window";if(t.char_request||t.line_request)throw"glk_request_char_event: window already has keyboard request";if(t.type==d.wintype_TextBuffer||t.type==d.wintype_TextGrid)t.char_request=!0,t.char_request_uni=!1,t.input_generation=Q;else throw"glk_request_char_event: window does not support keyboard input"}function Wf(t){if(!t)throw"glk_cancel_char_event: invalid window";t.char_request=!1,t.char_request_uni=!1}function Bf(t,o){if(!t)throw"glk_set_echo_line_event: invalid window";t.echo_line_input=o!=0}function Mf(t,o){if(!t)throw"glk_set_terminators_line_event: invalid window";if(ct===null){ct={};for(let s in Be)ct[Be[s]]=s}let n=[];if(o)for(let s=0;s<o.length;s++){let l=ct[o[s]];l&&n.push(l)}t.line_input_terminators=n}function Uf(t){if(!t)throw"glk_request_mouse_event: invalid window";(t.type==d.wintype_TextGrid||t.type==d.wintype_Graphics)&&(t.mouse_request=!0)}function Pf(t){if(!t)throw"glk_cancel_mouse_event: invalid window";t.mouse_request=!1}function zo(t){t?(Ae=t,dt=Date.now()):(Ae=null,dt=null)}function $f(t,o,n){if(!e||!e.get_image_info)return null;var s=e.get_image_info(t);return s?(o&&o.set_value(s.width),n&&n.set_value(s.height),1):(o&&o.set_value(0),n&&n.set_value(0),0)}function jf(t,o,n,s){if(!t)throw"glk_image_draw: invalid window";if(!e||!e.get_image_info)return 0;var l=e.get_image_info(o);if(!l)return 0;var c={special:"image",image:o,url:l.url,alttext:l.alttext,width:l.width,height:l.height};switch(t.type){case d.wintype_TextBuffer:var g="inlineup";switch(n){case d.imagealign_InlineUp:g="inlineup";break;case d.imagealign_InlineDown:g="inlinedown";break;case d.imagealign_InlineCenter:g="inlinecenter";break;case d.imagealign_MarginLeft:g="marginleft";break;case d.imagealign_MarginRight:g="marginright";break}return c.alignment=g,t.hyperlink&&(c.hyperlink=t.hyperlink),Ji(t,c),1;case d.wintype_Graphics:return c.x=n,c.y=s,t.content.push(c),1}return 0}function Lf(t,o,n,s,l,c){if(!t)throw"glk_image_draw_scaled: invalid window";if(!e||!e.get_image_info)return 0;var g=e.get_image_info(o);if(!g)return 0;var m={special:"image",image:o,url:g.url,alttext:g.alttext,width:l,height:c};switch(t.type){case d.wintype_TextBuffer:var h="inlineup";switch(n){case d.imagealign_InlineUp:h="inlineup";break;case d.imagealign_InlineDown:h="inlinedown";break;case d.imagealign_InlineCenter:h="inlinecenter";break;case d.imagealign_MarginLeft:h="marginleft";break;case d.imagealign_MarginRight:h="marginright";break}return m.alignment=h,t.hyperlink&&(m.hyperlink=t.hyperlink),Ji(t,m),1;case d.wintype_Graphics:return m.x=n,m.y=s,t.content.push(m),1}return 0}function zf(t){if(!t)throw"glk_window_flow_break: invalid window";t.type==d.wintype_TextBuffer&&Ji(t,void 0,!0)}function qf(t,o,n,s,l){if(!t)throw"glk_window_erase_rect: invalid window";if(t.type!=d.wintype_Graphics)throw"glk_window_erase_rect: not a graphics window";t.content.push({special:"fill",x:o,y:n,width:s,height:l})}function Nf(t,o,n,s,l,c){if(!t)throw"glk_window_fill_rect: invalid window";if(t.type!=d.wintype_Graphics)throw"glk_window_fill_rect: not a graphics window";var g=qo(o);t.content.push({special:"fill",color:g,x:n,y:s,width:l,height:c})}function Hf(t,o){if(!t)throw"glk_window_set_background_color: invalid window";if(t.type!=d.wintype_Graphics)throw"glk_window_set_background_color: not a graphics window";var n=qo(o);t.content.push({special:"setcolor",color:n})}function qo(t){for(var o=(t&16777215).toString(16);o.length<6;)o="0"+o;return"#"+o.toUpperCase()}function Vf(t,o){return t?t=t.next:t=gl,t?(o&&o.set_value(t.rock),t):(o&&o.set_value(0),null)}function Kf(t){if(!t)throw"glk_schannel_get_rock: invalid schannel";return t.rock}function Yf(){return null}function Jf(){throw"glk_schannel_destroy: invalid schannel"}function Qf(){throw"glk_schannel_play: invalid schannel"}function Xf(){throw"glk_schannel_play_ext: invalid schannel"}function Zf(){throw"glk_schannel_stop: invalid schannel"}function eu(){throw"glk_schannel_set_volume: invalid schannel"}function tu(){}function ru(){return null}function iu(){throw"glk_schannel_play_multi: invalid schannel"}function nu(){throw"glk_schannel_pause: invalid schannel"}function ou(){throw"glk_schannel_unpause: invalid schannel"}function au(){throw"glk_schannel_set_volume_ext: invalid schannel"}function su(t){Zi(Z,t)}function lu(t,o){Zi(t,o)}function fu(t){if(!t)throw"glk_request_hyperlink_event: invalid window";(t.type==d.wintype_TextBuffer||t.type==d.wintype_TextGrid)&&(t.hyperlink_request=!0)}function uu(t){if(!t)throw"glk_cancel_hyperlink_event: invalid window";(t.type==d.wintype_TextBuffer||t.type==d.wintype_TextGrid)&&(t.hyperlink_request=!1)}function cu(t,o){var n,s,l,c,g,m=t.length,h=t.slice(0,o);if(m<o)throw"buffer_to_lower_case_uni: numchars exceeds array length";for(l=0,n=0;n<o;n++)if(g=h[n],c=et[g],c===void 0)t[l]=g,l++;else if(!(c instanceof Array))t[l]=c,l++;else for(s=0;s<c.length;s++)t[l]=c[s],l++;return t.length=m,l}function _u(t,o){var n,s,l,c,g,m=t.length,h=t.slice(0,o);if(m<o)throw"buffer_to_upper_case_uni: numchars exceeds array length";for(l=0,n=0;n<o;n++)if(g=h[n],c=Ht[g],c===void 0)t[l]=g,l++;else if(!(c instanceof Array))t[l]=c,l++;else for(s=0;s<c.length;s++)t[l]=c[s],l++;return t.length=m,l}function du(t,o,n){var s,l,c,g,m,h=t.length,T=t.slice(0,o);if(h<o)throw"buffer_to_title_case_uni: numchars exceeds array length";if(c=0,o==0)return 0;if(s=0,m=T[s],g=Vt[m],g===void 0&&(g=Ht[m]),g===void 0)t[c]=m,c++;else if(!(g instanceof Array))t[c]=g,c++;else for(l=0;l<g.length;l++)t[c]=g[l],c++;if(n)for(s=1;s<o;s++)if(m=T[s],g=et[m],g===void 0)t[c]=m,c++;else if(!(g instanceof Array))t[c]=g,c++;else for(l=0;l<g.length;l++)t[c]=g[l],c++;else for(s=1;s<o;s++)m=T[s],t[c]=m,c++;return t.length=h,c}function No(t,o){var n=t.slice(0,o),s,l,c,g,m,h,T,X,N;for(s=0,l=0;l<o;l++)if(g=n[l],m=Kt[g],m===void 0)t[s]=g,s++;else if(!(m instanceof Array))t[s]=m,s++;else for(c=0;c<m.length;c++)t[s]=m[c],s++;for(l=0;l<s;){if(!we[t[l]]){l++;continue}if(l>=s)break;for(h=l;l<s&&we[t[l]];)l++;if(T=l,T-h>=2)for(c=T-1;c>h;c--)for(X=h;X<c;X++)we[t[X]]>we[t[X+1]]&&(N=t[X],t[X]=t[X+1],t[X+1]=N)}return s}function pu(t,o){var n,s,l,c,g,m,h,T;if(o==0)return 0;for(T=0,l=t[0],g=we[l],g&&(g=999),n=1,s=n;;){if(s>=o){t[T]=l,T=n;break}c=t[s],m=we[c],h=Ni[l],h!==void 0&&h[c]!==void 0&&(!g||m&&g<m)?(l=h[c],t[T]=l):(m||(T=n,l=c),g=m,t[n]=c,n++),s++}return T}function hu(t,o){var n=t.length,s;return s=No(t,o),t.length=n,s}function mu(t,o){var n=t.length,s;return s=No(t,o),s=pu(t,s),t.length=n,s}function gu(t){Qt(Z,t)}function yu(t){me(Z,t,!1)}function bu(t){Xt(Z,t,!1)}function wu(t,o){Qt(t,o)}function ku(t,o){me(t,o,!1)}function xu(t,o){Xt(t,o,!1)}function vu(t){if(!t)throw"glk_get_char_stream_uni: invalid stream";return pt(t,!0)}function Su(t,o){if(!t)throw"glk_get_buffer_stream_uni: invalid stream";return Uo(t,o,!0)}function Tu(t,o){if(!t)throw"glk_get_line_stream_uni: invalid stream";return Mo(t,o,!0)}function Au(t,o,n){if(!t)throw"glk_stream_open_file_uni: invalid fileref";var s,l;if(o!=d.filemode_Read&&o!=d.filemode_Write&&o!=d.filemode_ReadWrite&&o!=d.filemode_WriteAppend)throw"glk_stream_open_file_uni: illegal filemode";if(o==d.filemode_Read&&!r.file_ref_exists(t.ref))return null;if(r.streaming){if(l=r.file_fopen(o,t.ref),!l)return null}else{var c=null;if(o!=d.filemode_Write&&(c=r.file_read(t.ref)),c==null&&(c=[],o!=d.filemode_Read&&r.file_write(t.ref,"",!0)),c.length==null)throw"glk_stream_open_file_uni: data read had no length"}return s=rt(M,o!=d.filemode_Write,o!=d.filemode_Read,n),s.unicode=!0,s.isbinary=!t.textmode,s.ref=t.ref,s.origfmode=o,r.streaming?(s.streaming=!0,s.fstream=l,s.buffer4=l.BufferClass.alloc(4)):(s.streaming=!1,s.buf=c,s.buflen=4294967295,o==d.filemode_Write?s.bufeof=0:s.bufeof=c.length,o==d.filemode_WriteAppend?s.bufpos=s.bufeof:s.bufpos=0),s}function Gu(t,o,n){var s;if(o!=d.filemode_Read&&o!=d.filemode_Write&&o!=d.filemode_ReadWrite)throw"glk_stream_open_memory: illegal filemode";return s=rt(W,o!=d.filemode_Write,o!=d.filemode_Read,n),s.unicode=!0,t&&(s.buf=t,s.buflen=t.length,s.bufpos=0,o==d.filemode_Write?s.bufeof=0:s.bufeof=s.buflen,i&&i.retain_array(t)),s}function Cu(t){if(!t)throw"glk_request_char_event: invalid window";if(t.char_request||t.line_request)throw"glk_request_char_event: window already has keyboard request";if(t.type==d.wintype_TextBuffer||t.type==d.wintype_TextGrid)t.char_request=!0,t.char_request_uni=!0,t.input_generation=Q;else throw"glk_request_char_event: window does not support keyboard input"}function Eu(t,o,n){if(!t)throw"glk_request_line_event: invalid window";if(t.char_request||t.line_request)throw"glk_request_line_event: window already has keyboard request";if(t.type==d.wintype_TextBuffer||t.type==d.wintype_TextGrid){if(n){var s=o.slice(0,n);P||(P={}),P[t.disprock]=w(s)}t.line_request=!0,t.line_request_uni=!0,t.type==d.wintype_TextBuffer?t.request_echo_line_input=t.echo_line_input:t.request_echo_line_input=!0,t.input_generation=Q,t.linebuf=o,i&&i.retain_array(o)}else throw"glk_request_line_event: window does not support keyboard input"}function Iu(t){var o=new Date().getTime(),n;t.set_field(0,Math.floor(o/4294967296e3)),t.set_field(1,Math.floor(o/1e3)>>>0),n=Math.floor(o%1e3*1e3),n<0&&(n=1e6+n),t.set_field(2,n)}function Ru(t){var o=new Date().getTime();return Math.floor(o/(t*1e3))}function Fu(t,o){var n=t.get_field(0)*4294967296e3+t.get_field(1)*1e3+t.get_field(2)/1e3,s=new Date(n);o.set_field(0,s.getUTCFullYear()),o.set_field(1,1+s.getUTCMonth()),o.set_field(2,s.getUTCDate()),o.set_field(3,s.getUTCDay()),o.set_field(4,s.getUTCHours()),o.set_field(5,s.getUTCMinutes()),o.set_field(6,s.getUTCSeconds()),o.set_field(7,1e3*s.getUTCMilliseconds())}function Ou(t,o){var n=t.get_field(0)*4294967296e3+t.get_field(1)*1e3+t.get_field(2)/1e3,s=new Date(n);o.set_field(0,s.getFullYear()),o.set_field(1,1+s.getMonth()),o.set_field(2,s.getDate()),o.set_field(3,s.getDay()),o.set_field(4,s.getHours()),o.set_field(5,s.getMinutes()),o.set_field(6,s.getSeconds()),o.set_field(7,1e3*s.getMilliseconds())}function Du(t,o,n){var s=t*(1e3*o),l=new Date(s);n.set_field(0,l.getUTCFullYear()),n.set_field(1,1+l.getUTCMonth()),n.set_field(2,l.getUTCDate()),n.set_field(3,l.getUTCDay()),n.set_field(4,l.getUTCHours()),n.set_field(5,l.getUTCMinutes()),n.set_field(6,l.getUTCSeconds()),n.set_field(7,1e3*l.getUTCMilliseconds())}function Wu(t,o,n){var s=t*(1e3*o),l=new Date(s);n.set_field(0,l.getFullYear()),n.set_field(1,1+l.getMonth()),n.set_field(2,l.getDate()),n.set_field(3,l.getDay()),n.set_field(4,l.getHours()),n.set_field(5,l.getMinutes()),n.set_field(6,l.getSeconds()),n.set_field(7,1e3*l.getMilliseconds())}function Bu(t,o){var n=new Date(0);n.setUTCFullYear(t.get_field(0)),n.setUTCMonth(t.get_field(1)-1),n.setUTCDate(t.get_field(2)),n.setUTCHours(t.get_field(4)),n.setUTCMinutes(t.get_field(5)),n.setUTCSeconds(t.get_field(6)),n.setUTCMilliseconds(t.get_field(7)/1e3);var s=n.getTime(),l;o.set_field(0,Math.floor(s/4294967296e3)),o.set_field(1,Math.floor(s/1e3)>>>0),l=Math.floor(s%1e3*1e3),l<0&&(l=1e6+l),o.set_field(2,l)}function Mu(t,o){var n=new Date(t.get_field(0),t.get_field(1)-1,t.get_field(2),t.get_field(4),t.get_field(5),t.get_field(6),t.get_field(7)/1e3),s=n.getTime(),l;o.set_field(0,Math.floor(s/4294967296e3)),o.set_field(1,Math.floor(s/1e3)>>>0),l=Math.floor(s%1e3*1e3),l<0&&(l=1e6+l),o.set_field(2,l)}function Uu(t,o){var n=new Date(0);n.setUTCFullYear(t.get_field(0)),n.setUTCMonth(t.get_field(1)-1),n.setUTCDate(t.get_field(2)),n.setUTCHours(t.get_field(4)),n.setUTCMinutes(t.get_field(5)),n.setUTCSeconds(t.get_field(6)),n.setUTCMilliseconds(t.get_field(7)/1e3);var s=n.getTime();return Math.floor(s/(o*1e3))}function Pu(t,o){var n=new Date(t.get_field(0),t.get_field(1)-1,t.get_field(2),t.get_field(4),t.get_field(5),t.get_field(6),t.get_field(7)/1e3),s=n.getTime();return Math.floor(s/(o*1e3))}return{version:"2.2.5",init:Fe,update:zi,getlibrary:zt,save_allstate:qi,restore_allstate:xr,fatal_error:qt,byte_array_to_string:ae,uni_array_to_string:w,Const:d,RefBox:O,RefStruct:L,DidNotReturn:B,call_may_not_return:E,glk_put_jstring:xl,glk_put_jstring_stream:me,glk_exit:vl,glk_tick:Sl,glk_gestalt:Tl,glk_gestalt_ext:Po,glk_window_iterate:Al,glk_window_get_rock:Gl,glk_window_get_root:Cl,glk_window_open:El,glk_window_close:Il,glk_window_get_size:Rl,glk_window_set_arrangement:Fl,glk_window_get_arrangement:Ol,glk_window_get_type:Dl,glk_window_get_parent:Wl,glk_window_clear:Bl,glk_window_move_cursor:Ml,glk_window_get_stream:Ul,glk_window_set_echo_stream:Pl,glk_window_get_echo_stream:$l,glk_set_window:jl,glk_window_get_sibling:Ll,glk_stream_iterate:zl,glk_stream_get_rock:ql,glk_stream_open_file:Nl,glk_stream_open_memory:Hl,glk_stream_close:Yl,glk_stream_set_position:Jl,glk_stream_get_position:Ql,glk_stream_set_current:Xl,glk_stream_get_current:Zl,glk_fileref_create_temp:ef,glk_fileref_create_by_name:tf,glk_fileref_create_by_prompt:rf,glk_fileref_destroy:of,glk_fileref_iterate:af,glk_fileref_get_rock:sf,glk_fileref_delete_file:lf,glk_fileref_does_file_exist:ff,glk_fileref_create_from_fileref:uf,glk_put_char:cf,glk_put_char_stream:_f,glk_put_string:df,glk_put_string_stream:pf,glk_put_buffer:hf,glk_put_buffer_stream:mf,glk_set_style:gf,glk_set_style_stream:yf,glk_get_char_stream:bf,glk_get_line_stream:wf,glk_get_buffer_stream:kf,glk_char_to_lower:xf,glk_char_to_upper:vf,glk_stylehint_set:Sf,glk_stylehint_clear:Tf,glk_style_distinguish:Af,glk_style_measure:Gf,glk_select:If,glk_select_poll:Rf,glk_request_line_event:Ff,glk_cancel_line_event:Of,glk_request_char_event:Df,glk_cancel_char_event:Wf,glk_request_mouse_event:Uf,glk_cancel_mouse_event:Pf,glk_request_timer_events:zo,glk_image_get_info:$f,glk_image_draw:jf,glk_image_draw_scaled:Lf,glk_window_flow_break:zf,glk_window_erase_rect:qf,glk_window_fill_rect:Nf,glk_window_set_background_color:Hf,glk_schannel_iterate:Vf,glk_schannel_get_rock:Kf,glk_schannel_create:Yf,glk_schannel_destroy:Jf,glk_schannel_play:Qf,glk_schannel_play_ext:Xf,glk_schannel_stop:Zf,glk_schannel_set_volume:eu,glk_schannel_create_ext:ru,glk_schannel_play_multi:iu,glk_schannel_pause:nu,glk_schannel_unpause:ou,glk_schannel_set_volume_ext:au,glk_sound_load_hint:tu,glk_set_hyperlink:su,glk_set_hyperlink_stream:lu,glk_request_hyperlink_event:fu,glk_cancel_hyperlink_event:uu,glk_buffer_to_lower_case_uni:cu,glk_buffer_to_upper_case_uni:_u,glk_buffer_to_title_case_uni:du,glk_buffer_canon_decompose_uni:hu,glk_buffer_canon_normalize_uni:mu,glk_put_char_uni:gu,glk_put_string_uni:yu,glk_put_buffer_uni:bu,glk_put_char_stream_uni:wu,glk_put_string_stream_uni:ku,glk_put_buffer_stream_uni:xu,glk_get_char_stream_uni:vu,glk_get_buffer_stream_uni:Su,glk_get_line_stream_uni:Tu,glk_stream_open_file_uni:Au,glk_stream_open_memory_uni:Gu,glk_request_char_event_uni:Cu,glk_request_line_event_uni:Eu,glk_set_echo_line_event:Bf,glk_set_terminators_line_event:Mf,glk_current_time:Iu,glk_current_simple_time:Ru,glk_time_to_date_utc:Fu,glk_time_to_date_local:Ou,glk_simple_time_to_date_utc:Du,glk_simple_time_to_date_local:Wu,glk_date_to_time_utc:Bu,glk_date_to_time_local:Mu,glk_date_to_simple_time_utc:Uu,glk_date_to_simple_time_local:Pu,glk_stream_open_resource:Vl,glk_stream_open_resource_uni:Kl,garglk_set_zcolors:Cf,garglk_set_zcolors_stream:tn,garglk_set_reversevideo:Ef,garglk_set_reversevideo_stream:rn}}(),pl=F1;function hl(){return{auto_launch:1,Dialog:dl,direct_domains:["unbox.ifarchive.org"],do_vm_autosave:1,Glk:pl,GlkOte:new jt,lib_path:import.meta.url,proxy_url:"https://iplayif.com/proxy/",set_body_to_page_bg:1,theme_cookie:"parchment_theme",use_proxy:1}}function ml(a){let e=new URLSearchParams(document.location.search),r={};for(let i of a)e.has(i)&&(r[i]=e.get(i));return r}var Fo=class{options;constructor(e){let r=["do_vm_autosave","use_asyncglk"];e?.story||r.push("story"),this.options=Object.assign({},hl(),e,ml(r)),this.options.use_asyncglk&&(this.options.Glk=new gr)}get_storyfile_path(){return this.options.story?typeof this.options.story=="string"?{url:this.options.story}:this.options.story:this.options.default_story?{url:this.options.default_story?.[0]}:null}launch(){try{this.options.Dialog.init();let e=this.options.theme||Vo.get(this.options.theme_cookie)||(matchMedia("(prefers-color-scheme: dark)").matches?"dark":"");e&&document.documentElement.setAttribute("data-theme",e);let r=this.get_storyfile_path();if(!r){$("#custom-file-upload").show().on("keydown",i=>{(i.keyCode===32||i.keyCode===13)&&i.target.click()}),$("#file-upload").on("change",()=>{let i=$("#file-upload")[0]?.files?.[0];i&&this.load_uploaded_file(i)}),$("#play-url").show(),$("#play-url-button").on("click",()=>this.load_url()),$("#play-url-input").on("keydown",i=>{i.keyCode===13&&this.load_url()});return}this.load(r)}catch(e){throw this.options.GlkOte.error(e),e}}async load(e){try{if($("#about").remove(),$("#loadingpane").show(),!e.url){if(!e.data)throw new Error("Needs story data or URL");if(!e.format)throw new Error("Cannot identify storyfile format without path")}let r=Io(e.format,e.url),i=0,f=$("#loading_progress"),u;f.length&&(u=A=>{i+=A,f.val(i)},e.filesize_gz&&$("#loading_size").text(an(e.filesize_gz,{maximumFractionDigits:1,minimumFractionDigits:1})));let _;r.id==="blorb"&&(e.data||(e.data=await Eo(this.options,e.url,u)),_=new Ct(e.data),r=_l(_));let p=r.engines[0],y=await Promise.all([e.data||Eo(this.options,e.url,u),...p.load.map(A=>fl(this.options,A))]);e.data=y[0];let x=Object.assign({},this.options),b=new le(e.data);b.getFourCC(0)==="FORM"&&b.getFourCC(8)==="IFRS"&&(x.Blorb=_||new Ct(e.data)),await p.start(x,y)}catch(r){throw this.options.GlkOte.error(r),r}}async load_uploaded_file(e){try{this.load({data:await ul(e),url:e.name})}catch(r){throw this.options.GlkOte.error(r),r}}load_url(){let e=$("#play-url-input").val();if(!e)return;try{new URL(e)}catch{$("#play-url-error").text("Please enter a valid URL");return}let r=new URL(window.location+"");r.searchParams.set("story",e),window.location=r+""}};$(()=>{let a=new Fo(window.parchment_options);window.parchment=a,a.options.auto_launch&&a.launch()});
/*! Bundled license information:

js-cookie/dist/js.cookie.mjs:
  (*! js-cookie v3.0.5 | MIT *)

lodash-es/lodash.js:
  (**
   * @license
   * Lodash (Custom Build) <https://lodash.com/>
   * Build: `lodash modularize exports="es" -o ./`
   * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
   * Released under MIT license <https://lodash.com/license>
   * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
   * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
   *)
*/
//# sourceMappingURL=main.js.map
